var Pit=Object.defineProperty;var Mit=(fi,Kr,pi)=>Kr in fi?Pit(fi,Kr,{enumerable:!0,configurable:!0,writable:!0,value:pi}):fi[Kr]=pi;var Io=(fi,Kr,pi)=>(Mit(fi,typeof Kr!="symbol"?Kr+"":Kr,pi),pi);(function(){"use strict";function fi(n,t){return t.forEach(function(e){e&&typeof e!="string"&&!Array.isArray(e)&&Object.keys(e).forEach(function(s){if(s!=="default"&&!(s in n)){var r=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(n,s,r.get?r:{enumerable:!0,get:function(){return e[s]}})}})}),Object.freeze(n)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kr=1e-7,pi=1e-4;class Q0{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class Gp{refCount(t){return is("refCount")}incRef(t){return is("incRef")}timerAvailable(){return!0}time(t){return is("time")}read(t){return is("read")}readSync(t){return is("readSync")}readToGPU(t,e){return is("readToGPU")}numDataIds(){return is("numDataIds")}disposeData(t,e){return is("disposeData")}write(t,e,s){return is("write")}move(t,e,s,r,o){return is("move")}createTensorFromGPUData(t,e,s){return is("createTensorFromGPUData")}memory(){return is("memory")}floatPrecision(){return is("floatPrecision")}epsilon(){return this.floatPrecision()===32?Kr:pi}dispose(){return is("dispose")}}function is(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n_(n){let t=n.length,e=0;for(;t>0;)e=Math.random()*t|0,t--,ba(n,t,e)}function mi(n,t,e){return Math.max(n,Math.min(t,e))}function Hp(n){return n%2===0?n:n+1}function ba(n,t,e){const s=n[t];n[t]=n[e],n[e]=s}function s_(n){let t=0;for(let e=0;e<n.length;e++)t+=n[e];return t}function A(n,t){if(!n)throw new Error(typeof t=="string"?t:t())}function rh(n,t,e=""){A(he(n,t),()=>e+` Shapes ${n} and ${t} must match`)}function t1(n){A(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function st(n){if(n.length===0)return 1;let t=n[0];for(let e=1;e<n.length;e++)t*=n[e];return t}function he(n,t){if(n===t)return!0;if(n==null||t==null||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function ya(n){return n%1===0}function Kp(n){const t=Math.ceil(Math.sqrt(n));return[t,Math.ceil(n/t)]}function wa(n,t){return t<=n.length?n:n+" ".repeat(t-n.length)}function e1(n,t=r=>0,e,s){return new Promise((r,o)=>{let i=0;const a=()=>{if(n()){r();return}i++;const l=t(i);if(e!=null&&i>=e){o();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function n1(n,t){let e=1,s=-1;for(let o=0;o<n.length;++o)if(n[o]>=0)e*=n[o];else if(n[o]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${o}`);s=o}else if(n[o]<0)throw Error(`Shapes can not be < 0. Found ${n[o]} at dim ${o}`);if(s===-1){if(t>0&&t!==e)throw Error(`Size(${t}) must match the product of shape ${n}`);return n}if(e===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(t%e!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${e}`);const r=n.slice();return r[s]=t/e,r}function Xt(n,t){const e=t.length;return n=n==null?t.map((s,r)=>r):[].concat(n),A(n.every(s=>s>=-e&&s<e),()=>`All values in axis param must be in range [-${e}, ${e}) but got axis ${n}`),A(n.every(s=>ya(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?e+s:s)}function $o(n,t){const e=[],s=[],r=t!=null&&Array.isArray(t)&&t.length===0,o=t==null||r?null:Xt(t,n).sort();let i=0;for(let a=0;a<n.length;++a){if(o!=null){if(o[i]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(o[i]==null||o[i]>a)&&n[a]===1&&(e.push(n[a]),s.push(a)),o[i]<=a&&i++}n[a]!==1&&(e.push(n[a]),s.push(a))}return{newShape:e,keptDims:s}}function kn(n,t){return He(n,t)}function He(n,t){let e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else if(n==="bool")e=new Uint8Array(t);else if(n==="string")e=new Array(t);else throw new Error(`Unknown data type ${n}`);return e}function r_(n,t){for(let e=0;e<n.length;e++){const s=n[e];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${t} being uploaded contains ${s}.`)}}function o_(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function s1(n,t){return!(t==="complex64"||t==="float32"&&n!=="complex64"||t==="int32"&&n!=="float32"&&n!=="complex64"||t==="bool"&&n==="bool")}function oh(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function i_(n){if(n==null)return 0;let t=0;return n.forEach(e=>t+=e.length),t}function _l(n){return typeof n=="string"||n instanceof String}function a_(n){return typeof n=="boolean"}function qp(n){return typeof n=="number"}function va(n){return Array.isArray(n)?va(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":qp(n)?"float32":_l(n)?"string":a_(n)?"bool":"float32"}function ih(n){return!!(n&&n.constructor&&n.call&&n.apply)}function jp(n,t){for(let e=t;e<n;++e)if(n%e===0)return e;return n}function _t(n){const t=n.length;if(t<2)return[];const e=new Array(t-1);e[t-2]=n[t-1];for(let s=t-3;s>=0;--s)e[s]=e[s+1]*n[s+1];return e}function r1(n,t,e,s=!1){const r=new Array;if(t.length===1){const o=t[0]*(s?2:1);for(let i=0;i<o;i++)r[i]=e[n+i]}else{const o=t[0],i=t.slice(1),a=i.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<o;l++)r[l]=r1(n+l*a,i,e,s)}return r}function sr(n,t,e=!1){if(n.length===0)return t[0];const s=n.reduce((r,o)=>r*o)*(e?2:1);if(s===0)return[];if(s!==t.length)throw new Error(`[${n}] does not match the input size ${t.length}${e?" for a complex tensor":""}.`);return r1(0,n,t,e)}function l_(n,t){if(Array.isArray(n))return n;if(t==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(t==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(t==="bool"||t==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${t}`)}function Xp(n,t){const e=Sn(n,t);for(let s=0;s<e.length;s++)e[s]=1;return e}function Sn(n,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${t}`)}function o1(n,t){const e=n.reduce((s,r)=>s*r,1);if(t==null||t==="float32")return sr(n,new Float32Array(e));if(t==="int32")return sr(n,new Int32Array(e));if(t==="bool")return sr(n,new Uint8Array(e));throw new Error(`Unknown data type ${t}`)}function qr(n){n.forEach(t=>{A(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function Cr(n,t,e){if(t===0)return 0;if(t===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=e[r]*n[r];return s}function Ca(n,t,e){if(t===0)return[];if(t===1)return[n];const s=new Array(t);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/e[r]),n-=s[r]*e[r];return s[s.length-1]=n,s}function ah(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i1="tfjsflags";class u_{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=c_,this.populateURLFlags()}setPlatform(t,e){this.platform!=null&&(J().getBool("IS_TEST")||J().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,s){if(this.flagRegistry[t]={evaluationFn:e,setHook:s},this.urlFlags[t]!=null){const r=this.urlFlags[t];J().getBool("IS_TEST")||J().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${r}.`),this.set(t,r)}}async getAsync(t){return t in this.flags?this.flags[t]:(this.flags[t]=await this.evaluateFlag(t),this.flags[t])}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(ah(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getString(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const t=this.getQueryParams(this.global.location.search);i1 in t&&t[i1].split(",").forEach(s=>{const[r,o]=s.split(":");this.urlFlags[r]=d_(r,o)})}}function c_(n){const t={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...s)=>(h_(t,s[0],s[1]),s.join("="))),t}function h_(n,t,e){n[decodeURIComponent(t)]=decodeURIComponent(e||"")}function d_(n,t){const e=t.toLowerCase();return e==="true"||e==="false"?e==="true":`${+e}`===e?+e:t}function J(){return a1}let a1=null;function f_(n){a1=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Yp;function l1(){if(Yp==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");Yp=n}return Yp}function p_(){const n=l1();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function Zp(n,t){const e=p_();if(e.has(n))return e.get(n);{const s=t();return e.set(n,s),e.get(n)}}const lh="Abs",Rl="Acos",Al="Acosh",Ia="Add",Jp="AddN",Qp="All",tm="Any",uh="ArgMax",ch="ArgMin",Dl="Asin",Fl="Asinh",Ol="Atan",Ll="Atanh",Pl="Atan2",hh="AvgPool",em="AvgPoolGrad",dh="AvgPool3D",nm="AvgPool3DGrad",fh="BatchMatMul",ph="BatchToSpaceND",sm="Bincount",rm="BitwiseAnd",m_="BroadcastTo",u1="BroadcastArgs",Ml="Cast",Bl="Ceil",zl="ClipByValue",om="Complex",mh="ComplexAbs",gh="Concat",xh="Conv2D",im="Conv2DBackpropFilter",bh="Conv2DBackpropInput",yh="Conv3D",am="Conv3DBackpropFilterV2",lm="Conv3DBackpropInputV2",Wl="Cos",Vl="Cosh",um="Cumprod",wh="Cumsum",cm="CropAndResize",hm="DenseBincount",dm="DepthToSpace",vh="DepthwiseConv2dNative",fm="DepthwiseConv2dNativeBackpropFilter",pm="DepthwiseConv2dNativeBackpropInput",c1="Diag",Ch="Dilation2D",mm="Dilation2DBackpropInput",gm="Dilation2DBackpropFilter",g_="Draw",Ul="RealDiv",xm="Einsum",Gl="Elu",bm="EluGrad",Hl="Erf",Ih="Equal",Kl="Exp",$h="ExpandDims",ql="Expm1",ym="FFT",wm="Fill",vm="FlipLeftRight",jl="Floor",Xl="FloorDiv",kh="FusedBatchNorm",Sh="GatherV2",h1="GatherNd",Nh="Greater",Yl="GreaterEqual",Zl="Identity",Cm="IFFT",Im="Imag",Jl="IsFinite",Ql="IsInf",tu="IsNan",Th="LeakyRelu",Eh="Less",_h="LessEqual",d1="LinSpace",eu="Log",nu="Log1p",Rh="LogicalAnd",Ah="LogicalNot",Dh="LogicalOr",x_="LogSoftmax",Fh="LRN",$m="LRNGrad",Oh="Max",su="Maximum",Lh="MaxPool",km="MaxPoolGrad",Ph="MaxPool3D",Sm="MaxPool3DGrad",f1="MaxPoolWithArgmax",Mh="Mean",Bh="Min",ru="Minimum",zh="MirrorPad",ou="Mod",p1="Multinomial",iu="Multiply",Wh="Neg",Vh="NotEqual",Nm="NonMaxSuppressionV3",Tm="NonMaxSuppressionV4",Em="NonMaxSuppressionV5",Uh="OnesLike",Gh="OneHot",Hh="Pack",Kh="PadV2",au="Pow",qh="Prelu",jh="Prod",m1="RaggedGather",g1="RaggedRange",x1="RaggedTensorToTensor",_m="Range",Rm="Real",lu="Reciprocal",uu="Relu",Xh="Reshape",Yh="ResizeNearestNeighbor",Am="ResizeNearestNeighborGrad",Zh="ResizeBilinear",Dm="ResizeBilinearGrad",cu="Relu6",Jh="Reverse",hu="Round",du="Rsqrt",b1="ScatterNd",y1="TensorScatterUpdate",w1="SearchSorted",Qh="Select",fu="Selu",td="Slice",pu="Sin",mu="Sinh",gu="Sign",xu="Sigmoid",bu="Softplus",yu="Sqrt",ed="Sum",nd="SpaceToBatchND",sd="SplitV",rd="Softmax",v1="SparseFillEmptyRows",C1="SparseReshape",I1="SparseSegmentMean",$1="SparseSegmentSum",k1="SparseToDense",wu="SquaredDifference",Fm="Square",Om="StaticRegexReplace",Lm="StridedSlice",S1="StringNGrams",N1="StringSplit",T1="StringToHashBucketFast",vu="Sub",Cu="Tan",Iu="Tanh",$u="Tile",Pm="TopK",Mm="Transform",$a="Transpose",Bm="Unique",od="Unpack",id="UnsortedSegmentSum",ad="ZerosLike",ku="Step",b_="FromPixels",zm="RotateWithOffset",ld="_FusedMatMul",ud="FusedConv2D",E1="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bs(...n){J().getBool("IS_TEST")||J().getBool("PROD")||console.warn(...n)}function y_(...n){J().getBool("IS_TEST")||J().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cd=Zp("kernelRegistry",()=>new Map),Wm=Zp("gradRegistry",()=>new Map);function _1(n,t){const e=F1(n,t);return cd.get(e)}function R1(n){return Wm.get(n)}function A1(n){const t=cd.entries(),e=[];for(;;){const{done:s,value:r}=t.next();if(s)break;const[o,i]=r,[a]=o.split("_");a===n&&e.push(i)}return e}function D1(n){const{kernelName:t,backendName:e}=n,s=F1(t,e);cd.has(s)&&bs(`The kernel '${t}' for backend '${e}' is already registered`),cd.set(s,n)}function w_(n){const{kernelName:t}=n;Wm.has(t)&&J().getBool("DEBUG")&&bs(`Overriding the gradient for '${t}'`),Wm.set(t,n)}function F1(n,t){return`${t}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O1(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var $e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function L1(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function v_(n){if(n.__esModule)return n;var t=n.default;if(typeof t=="function"){var e=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(e,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),e}var P1=_e,Fs=null;try{Fs=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function _e(n,t,e){this.low=n|0,this.high=t|0,this.unsigned=!!e}_e.prototype.__isLong__,Object.defineProperty(_e.prototype,"__isLong__",{value:!0});function as(n){return(n&&n.__isLong__)===!0}_e.isLong=as;var M1={},B1={};function gi(n,t){var e,s,r;return t?(n>>>=0,(r=0<=n&&n<256)&&(s=B1[n],s)?s:(e=Re(n,(n|0)<0?-1:0,!0),r&&(B1[n]=e),e)):(n|=0,(r=-128<=n&&n<128)&&(s=M1[n],s)?s:(e=Re(n,n<0?-1:0,!1),r&&(M1[n]=e),e))}_e.fromInt=gi;function Os(n,t){if(isNaN(n))return t?xi:Ls;if(t){if(n<0)return xi;if(n>=W1)return K1}else{if(n<=-V1)return ls;if(n+1>=V1)return H1}return n<0?Os(-n,t).neg():Re(n%ka|0,n/ka|0,t)}_e.fromNumber=Os;function Re(n,t,e){return new _e(n,t,e)}_e.fromBits=Re;var hd=Math.pow;function Vm(n,t,e){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Ls;if(typeof t=="number"?(e=t,t=!1):t=!!t,e=e||10,e<2||36<e)throw RangeError("radix");var s;if((s=n.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return Vm(n.substring(1),t,e).neg();for(var r=Os(hd(e,8)),o=Ls,i=0;i<n.length;i+=8){var a=Math.min(8,n.length-i),l=parseInt(n.substring(i,i+a),e);if(a<8){var u=Os(hd(e,a));o=o.mul(u).add(Os(l))}else o=o.mul(r),o=o.add(Os(l))}return o.unsigned=t,o}_e.fromString=Vm;function rr(n,t){return typeof n=="number"?Os(n,t):typeof n=="string"?Vm(n,t):Re(n.low,n.high,typeof t=="boolean"?t:n.unsigned)}_e.fromValue=rr;var z1=65536,C_=1<<24,ka=z1*z1,W1=ka*ka,V1=W1/2,U1=gi(C_),Ls=gi(0);_e.ZERO=Ls;var xi=gi(0,!0);_e.UZERO=xi;var Sa=gi(1);_e.ONE=Sa;var G1=gi(1,!0);_e.UONE=G1;var Um=gi(-1);_e.NEG_ONE=Um;var H1=Re(-1,2147483647,!1);_e.MAX_VALUE=H1;var K1=Re(-1,-1,!0);_e.MAX_UNSIGNED_VALUE=K1;var ls=Re(0,-2147483648,!1);_e.MIN_VALUE=ls;var xt=_e.prototype;xt.toInt=function(){return this.unsigned?this.low>>>0:this.low},xt.toNumber=function(){return this.unsigned?(this.high>>>0)*ka+(this.low>>>0):this.high*ka+(this.low>>>0)},xt.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ls)){var e=Os(t),s=this.div(e),r=s.mul(e).sub(this);return s.toString(t)+r.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var o=Os(hd(t,6),this.unsigned),i=this,a="";;){var l=i.div(o),u=i.sub(l.mul(o)).toInt()>>>0,h=u.toString(t);if(i=l,i.isZero())return h+a;for(;h.length<6;)h="0"+h;a=""+h+a}},xt.getHighBits=function(){return this.high},xt.getHighBitsUnsigned=function(){return this.high>>>0},xt.getLowBits=function(){return this.low},xt.getLowBitsUnsigned=function(){return this.low>>>0},xt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ls)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,e=31;e>0&&!(t&1<<e);e--);return this.high!=0?e+33:e+1},xt.isZero=function(){return this.high===0&&this.low===0},xt.eqz=xt.isZero,xt.isNegative=function(){return!this.unsigned&&this.high<0},xt.isPositive=function(){return this.unsigned||this.high>=0},xt.isOdd=function(){return(this.low&1)===1},xt.isEven=function(){return(this.low&1)===0},xt.equals=function(t){return as(t)||(t=rr(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low},xt.eq=xt.equals,xt.notEquals=function(t){return!this.eq(t)},xt.neq=xt.notEquals,xt.ne=xt.notEquals,xt.lessThan=function(t){return this.comp(t)<0},xt.lt=xt.lessThan,xt.lessThanOrEqual=function(t){return this.comp(t)<=0},xt.lte=xt.lessThanOrEqual,xt.le=xt.lessThanOrEqual,xt.greaterThan=function(t){return this.comp(t)>0},xt.gt=xt.greaterThan,xt.greaterThanOrEqual=function(t){return this.comp(t)>=0},xt.gte=xt.greaterThanOrEqual,xt.ge=xt.greaterThanOrEqual,xt.compare=function(t){if(as(t)||(t=rr(t)),this.eq(t))return 0;var e=this.isNegative(),s=t.isNegative();return e&&!s?-1:!e&&s?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},xt.comp=xt.compare,xt.negate=function(){return!this.unsigned&&this.eq(ls)?ls:this.not().add(Sa)},xt.neg=xt.negate,xt.add=function(t){as(t)||(t=rr(t));var e=this.high>>>16,s=this.high&65535,r=this.low>>>16,o=this.low&65535,i=t.high>>>16,a=t.high&65535,l=t.low>>>16,u=t.low&65535,h=0,d=0,f=0,m=0;return m+=o+u,f+=m>>>16,m&=65535,f+=r+l,d+=f>>>16,f&=65535,d+=s+a,h+=d>>>16,d&=65535,h+=e+i,h&=65535,Re(f<<16|m,h<<16|d,this.unsigned)},xt.subtract=function(t){return as(t)||(t=rr(t)),this.add(t.neg())},xt.sub=xt.subtract,xt.multiply=function(t){if(this.isZero())return Ls;if(as(t)||(t=rr(t)),Fs){var e=Fs.mul(this.low,this.high,t.low,t.high);return Re(e,Fs.get_high(),this.unsigned)}if(t.isZero())return Ls;if(this.eq(ls))return t.isOdd()?ls:Ls;if(t.eq(ls))return this.isOdd()?ls:Ls;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(U1)&&t.lt(U1))return Os(this.toNumber()*t.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,o=this.low>>>16,i=this.low&65535,a=t.high>>>16,l=t.high&65535,u=t.low>>>16,h=t.low&65535,d=0,f=0,m=0,g=0;return g+=i*h,m+=g>>>16,g&=65535,m+=o*h,f+=m>>>16,m&=65535,m+=i*u,f+=m>>>16,m&=65535,f+=r*h,d+=f>>>16,f&=65535,f+=o*u,d+=f>>>16,f&=65535,f+=i*l,d+=f>>>16,f&=65535,d+=s*h+r*u+o*l+i*a,d&=65535,Re(m<<16|g,d<<16|f,this.unsigned)},xt.mul=xt.multiply,xt.divide=function(t){if(as(t)||(t=rr(t)),t.isZero())throw Error("division by zero");if(Fs){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var e=(this.unsigned?Fs.div_u:Fs.div_s)(this.low,this.high,t.low,t.high);return Re(e,Fs.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?xi:Ls;var s,r,o;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return xi;if(t.gt(this.shru(1)))return G1;o=xi}else{if(this.eq(ls)){if(t.eq(Sa)||t.eq(Um))return ls;if(t.eq(ls))return Sa;var i=this.shr(1);return s=i.div(t).shl(1),s.eq(Ls)?t.isNegative()?Sa:Um:(r=this.sub(t.mul(s)),o=s.add(r.div(t)),o)}else if(t.eq(ls))return this.unsigned?xi:Ls;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();o=Ls}for(r=this;r.gte(t);){s=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),l=a<=48?1:hd(2,a-48),u=Os(s),h=u.mul(t);h.isNegative()||h.gt(r);)s-=l,u=Os(s,this.unsigned),h=u.mul(t);u.isZero()&&(u=Sa),o=o.add(u),r=r.sub(h)}return o},xt.div=xt.divide,xt.modulo=function(t){if(as(t)||(t=rr(t)),Fs){var e=(this.unsigned?Fs.rem_u:Fs.rem_s)(this.low,this.high,t.low,t.high);return Re(e,Fs.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},xt.mod=xt.modulo,xt.rem=xt.modulo,xt.not=function(){return Re(~this.low,~this.high,this.unsigned)},xt.and=function(t){return as(t)||(t=rr(t)),Re(this.low&t.low,this.high&t.high,this.unsigned)},xt.or=function(t){return as(t)||(t=rr(t)),Re(this.low|t.low,this.high|t.high,this.unsigned)},xt.xor=function(t){return as(t)||(t=rr(t)),Re(this.low^t.low,this.high^t.high,this.unsigned)},xt.shiftLeft=function(t){return as(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?Re(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):Re(0,this.low<<t-32,this.unsigned)},xt.shl=xt.shiftLeft,xt.shiftRight=function(t){return as(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?Re(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):Re(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},xt.shr=xt.shiftRight,xt.shiftRightUnsigned=function(t){if(as(t)&&(t=t.toInt()),t&=63,t===0)return this;var e=this.high;if(t<32){var s=this.low;return Re(s>>>t|e<<32-t,e>>>t,this.unsigned)}else return t===32?Re(e,0,this.unsigned):Re(e>>>t-32,0,this.unsigned)},xt.shru=xt.shiftRightUnsigned,xt.shr_u=xt.shiftRightUnsigned,xt.toSigned=function(){return this.unsigned?Re(this.low,this.high,!1):this},xt.toUnsigned=function(){return this.unsigned?this:Re(this.low,this.high,!0)},xt.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},xt.toBytesLE=function(){var t=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]},xt.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,e>>>24,e>>>16&255,e>>>8&255,e&255]},_e.fromBytes=function(t,e,s){return s?_e.fromBytesLE(t,e):_e.fromBytesBE(t,e)},_e.fromBytesLE=function(t,e){return new _e(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},_e.fromBytesBE=function(t,e){return new _e(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};var q1=L1(P1),I_=fi({__proto__:null,default:q1},[P1]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bi=q1||I_;function dd(n){return bi.fromString(n,!0,16)}const j1=dd("c3a5c85c97cb3127"),yi=dd("b492b66fbe98f273"),An=dd("9ae16a3b2f90404f");function Gm(n){return n.xor(n.shru(47))}function X1(n,t,e){const s=n.slice(t,t+e);return bi.fromBytes(Array.from(s),!0,!0)}function ke(n,t){return X1(n,t,8)}function Y1(n,t){return X1(n,t,4)}function hn(n,t){return t===0?n:n.shru(t).or(n.shl(64-t))}function ko(n,t,e=dd("9ddfea08eb382d69")){let s=n.xor(t).mul(e);s=s.xor(s.shru(47));let r=t.xor(s).mul(e);return r=r.xor(r.shru(47)),r=r.mul(e),r}function $_(n,t,e,s,r,o){r=r.add(n),o=hn(o.add(r).add(s),21);const i=r;return r=r.add(t),r=r.add(e),o=o.add(hn(r,44)),[r.add(s),o.add(i)]}function fd(n,t,e,s){return $_(ke(n,t),ke(n,t+8),ke(n,t+16),ke(n,t+24),e,s)}function k_(n,t=n.length){if(t>=8){const e=An.add(t*2),s=ke(n,0).add(An),r=ke(n,t-8),o=hn(r,37).mul(e).add(s),i=hn(s,25).add(r).mul(e);return ko(o,i,e)}if(t>=4){const e=An.add(t*2),s=Y1(n,0);return ko(s.shl(3).add(t),Y1(n,t-4),e)}if(t>0){const e=n[0],s=n[t>>1],r=n[t-1],o=e+(s<<8),i=t+(r<<2);return Gm(An.mul(o).xor(j1.mul(i))).mul(An)}return An}function S_(n,t=n.length){const e=An.add(t*2),s=ke(n,0).mul(yi),r=ke(n,8),o=ke(n,t-8).mul(e),i=ke(n,t-16).mul(An);return ko(hn(s.add(r),43).add(hn(o,30)).add(i),s.add(hn(r.add(An),18)).add(o),e)}function N_(n,t=n.length){const e=An.add(t*2),s=ke(n,0).mul(An),r=ke(n,8),o=ke(n,t-8).mul(e),i=ke(n,t-16).mul(An),a=hn(s.add(r),43).add(hn(o,30)).add(i),l=ko(a,s.add(hn(r.add(An),18)).add(o),e),u=ke(n,16).mul(e),h=ke(n,24),d=a.add(ke(n,t-32)).mul(e),f=l.add(ke(n,t-24)).mul(e);return ko(hn(u.add(h),43).add(hn(d,30)).add(f),u.add(hn(h.add(s),18)).add(d),e)}function T_(n,t=n.length){const e=bi.fromNumber(81,!0);if(t<=32)return t<=16?k_(n,t):S_(n,t);if(t<=64)return N_(n,t);let s=e,r=e.mul(yi).add(113),o=Gm(r.mul(An).add(113)).mul(An),i=[bi.UZERO,bi.UZERO],a=[bi.UZERO,bi.UZERO];s=s.mul(An).add(ke(n,0));let l=0;const u=(t-1>>6)*64,h=u+(t-1&63)-63;do s=hn(s.add(r).add(i[0]).add(ke(n,l+8)),37).mul(yi),r=hn(r.add(i[1]).add(ke(n,l+48)),42).mul(yi),s=s.xor(a[1]),r=r.add(i[0]).add(ke(n,l+40)),o=hn(o.add(a[0]),33).mul(yi),i=fd(n,l,i[1].mul(yi),s.add(a[0])),a=fd(n,l+32,o.add(a[1]),r.add(ke(n,l+16))),[o,s]=[s,o],l+=64;while(l!==u);const d=yi.add(o.and(255).shl(1));return l=h,a[0]=a[0].add(t-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),s=hn(s.add(r).add(i[0]).add(ke(n,l+8)),37).mul(d),r=hn(r.add(i[1]).add(ke(n,l+48)),42).mul(d),s=s.xor(a[1].mul(9)),r=r.add(i[0].mul(9).add(ke(n,l+40))),o=hn(o.add(a[0]),33).mul(d),i=fd(n,l,i[1].mul(d),s.add(a[0])),a=fd(n,l+32,o.add(a[1]),r.add(ke(n,l+16))),[o,s]=[s,o],ko(ko(i[0],a[0],d).add(Gm(r).mul(j1)).add(o),ko(i[1],a[1],d).add(s),d)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function So(n,t){return t==="string"?No(n):wi([n],t)}function E_(n,t){return n instanceof Float32Array&&t==="float32"||n instanceof Int32Array&&t==="int32"||n instanceof Uint8Array&&t==="bool"}function wi(n,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=vi(n)),J().getBool("DEBUG")&&r_(n,t),E_(n,t))return n;if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool"){const e=new Uint8Array(n.length);for(let s=0;s<e.length;++s)Math.round(n[s])!==0&&(e[s]=1);return e}else throw new Error(`Unknown data type ${t}`)}function Nn(){return J().platform.now()}function No(n,t="utf-8"){return t=t||"utf-8",J().platform.encode(n,t)}function To(n,t="utf-8"){return t=t||"utf-8",J().platform.decode(n,t)}function ys(n){return J().platform.isTypedArray!=null?J().platform.isTypedArray(n):O1(n)}function vi(n,t=[],e=!1){if(t==null&&(t=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||ah(n)||n==null||ys(n)&&e)t.push(n);else if(Array.isArray(n)||ys(n))for(let s=0;s<n.length;++s)vi(n[s],t,e);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)vi(n[r],t,e)}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class __{constructor(t,e){this.backendTimer=t,this.logger=e,e==null&&(this.logger=new A_)}profileKernel(t,e,s){let r;const o=()=>{r=s()};let i;const a=Nn();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();for(const u of r)u.dataSync();i=Promise.resolve({kernelMs:Nn()-a})}if(J().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const h=r[u];h.data().then(d=>{R_(d,h.dtype,t)})}return{kernelName:t,outputs:r,inputs:e,timeMs:i.then(u=>u.kernelMs),extraInfo:i.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(t){const{kernelName:e,outputs:s,timeMs:r,inputs:o,extraInfo:i}=t;s.forEach(a=>{Promise.all([a.data(),r,i]).then(l=>{this.logger.logKernelProfile(e,a,l[0],l[1],o,l[2])})})}}function R_(n,t,e){if(t!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${e}'`),!0}return!1}class A_{logKernelProfile(t,e,s,r,o,i){const a=typeof r=="number"?wa(`${r}ms`,9):r.error,l=wa(t,25),u=e.rank,h=e.size,d=wa(e.shape.toString(),14);let f="";for(const m in o){const g=o[m];if(g!=null){const x=g.shape||e.shape,b=x.length;f+=`${m}: ${b}D ${b>0?x:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${d}	%c${h}	%c${f}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D_(n,t,e){const s={},r={};for(let l=0;l<t.length;l++)s[t[l].id]=!0;for(let l=0;l<n.length;l++){const u=n[l],h=u.inputs;for(const d in h){const f=h[d];let m=!1;for(let g=0;g<t.length;g++)if(s[f.id]){u.outputs.forEach(x=>s[x.id]=!0),m=!0,r[u.id]=!0;break}if(m)break}}const o={};o[e.id]=!0;const i={};for(let l=n.length-1;l>=0;l--){const u=n[l],h=u.inputs;for(let d=0;d<u.outputs.length;d++)if(o[u.outputs[d].id]){for(const f in h)o[h[f].id]=!0,i[u.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const u=n[l];if(r[u.id]&&i[u.id]){const h={};for(const f in u.inputs){const m=u.inputs[f];s[m.id]&&(h[f]=m)}const d=Object.assign({},u);d.inputs=h,d.outputs=u.outputs,a.push(d)}}return a}function F_(n,t,e,s){for(let r=t.length-1;r>=0;r--){const o=t[r],i=[];if(o.outputs.forEach(l=>{const u=n[l.id];u!=null?i.push(u):i.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const l in o.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=e(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const h=o.inputs[l];if(!he(u.shape,h.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${h.shape}'`);if(n[h.id]==null)n[h.id]=u;else{const d=n[h.id];n[h.id]=s(d,u),d.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z1=20,Su=3,Hm=7;function O_(n,t,e,s){const r=_t(t),o=L_(n,t,e,r),i=t.length,a=pd(n,t,e,r,o),l=["Tensor"];return s&&(l.push(`  dtype: ${e}`),l.push(`  rank: ${i}`),l.push(`  shape: [${t}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function L_(n,t,e,s){const r=st(t),o=s[s.length-1],i=new Array(o).fill(0),a=t.length,l=e==="complex64"?Tu(n):n;if(a>1)for(let u=0;u<r/o;u++){const h=u*o;for(let d=0;d<o;d++)i[d]=Math.max(i[d],Nu(l[h+d],0,e).length)}return i}function Nu(n,t,e){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(Hm))} + ${parseFloat(n[1].toFixed(Hm))}j`:_l(n)?s=`'${n}'`:e==="bool"?s=J1(n):s=parseFloat(n.toFixed(Hm)).toString(),wa(s,t)}function J1(n){return n===0?"false":"true"}function pd(n,t,e,s,r,o=!0){const i=e==="complex64"?2:1,a=t[0],l=t.length;if(l===0){if(e==="complex64"){const x=Tu(n);return[Nu(x[0],0,e)]}return e==="bool"?[J1(n[0])]:[n[0].toString()]}if(l===1){if(a>Z1){const b=Su*i;let w=Array.from(n.slice(0,b)),v=Array.from(n.slice((a-Su)*i,a*i));return e==="complex64"&&(w=Tu(w),v=Tu(v)),["["+w.map((I,C)=>Nu(I,r[C],e)).join(", ")+", ..., "+v.map((I,C)=>Nu(I,r[a-Su+C],e)).join(", ")+"]"]}return["["+(e==="complex64"?Tu(n):Array.from(n)).map((b,w)=>Nu(b,r[w],e)).join(", ")+"]"]}const u=t.slice(1),h=s.slice(1),d=s[0]*i,f=[];if(a>Z1){for(let x=0;x<Su;x++){const b=x*d,w=b+d;f.push(...pd(n.slice(b,w),u,e,h,r,!1))}f.push("...");for(let x=a-Su;x<a;x++){const b=x*d,w=b+d;f.push(...pd(n.slice(b,w),u,e,h,r,x===a-1))}}else for(let x=0;x<a;x++){const b=x*d,w=b+d;f.push(...pd(n.slice(b,w),u,e,h,r,x===a-1))}const m=l===2?",":"";f[0]="["+(a>0?f[0]+m:"");for(let x=1;x<f.length-1;x++)f[x]=" "+f[x]+m;let g=`,
`;for(let x=2;x<l;x++)g+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(o?"":g),f}function Tu(n){const t=[];for(let e=0;e<n.length;e+=2)t.push([n[e],n[e+1]]);return t}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yn{constructor(t,e,s){if(this.dtype=e,this.shape=t.slice(),this.size=st(t),s!=null){const r=s.length;A(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||He(e,this.size),this.strides=_t(t)}set(t,...e){e.length===0&&(e=[0]),A(e.length===this.rank,()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`);const s=this.locToIndex(e);this.values[s]=t}get(...t){t.length===0&&(t=[0]);let e=0;for(const r of t){if(r<0||r>=this.shape[e]){const o=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(o)}e++}let s=t[t.length-1];for(let r=0;r<t.length-1;++r)s+=this.strides[r]*t[r];return this.values[s]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let e=t[t.length-1];for(let s=0;s<t.length-1;++s)e+=this.strides[s]*t[s];return e}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];const e=new Array(this.shape.length);for(let s=0;s<e.length-1;++s)e[s]=Math.floor(t/this.strides[s]),t-=e[s]*this.strides[s];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return or().makeTensor(this.values,this.shape,this.dtype)}}let or=null,Na=null;function P_(n){or=n}function M_(n){Na=n}class Fe{constructor(t,e,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=st(t),this.strides=_t(t),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return Na.buffer(this.shape,this.dtype,t)}bufferSync(){return Na.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return sr(this.shape,t,this.dtype==="complex64")}arraySync(){return sr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const t=or().read(this.dataId);if(this.dtype==="string"){const e=await t;try{return e.map(s=>To(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),or().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=or().readSync(this.dataId);if(this.dtype==="string")try{return t.map(e=>To(e))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await or().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),or().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return Na.print(this,t)}clone(){return this.throwIfDisposed(),Na.clone(this)}toString(t=!1){const e=this.dataSync();return O_(e,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),Na.cast(this,t)}variable(t=!0,e,s){return this.throwIfDisposed(),or().makeVariable(this,t,e,s)}}Object.defineProperty(Fe,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function nt(){return Zp("Tensor",()=>Fe)}nt();class md extends Fe{constructor(t,e,s,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=s}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!he(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);or().disposeTensor(this),this.dataId=t.dataId,or().incRef(this,null)}dispose(){or().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(md,Symbol.hasInstance,{value:n=>n instanceof Fe&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Q1;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(Q1||(Q1={}));var Km;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(Km||(Km={}));var qm;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(qm||(qm={}));var jm;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(jm||(jm={}));var Xm;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(Xm||(Xm={}));const B_={float32:jm,int32:Km,bool:qm,complex64:Xm};function us(n,t){if(n==="string"||t==="string"){if(n==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${n} with ${t}`)}return B_[n][t]}function Ym(n){return us(n,"int32")}function tw(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function ew(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ke(n,t){if(n.dtype===t.dtype)return[n,t];const e=us(n.dtype,t.dtype);return[n.cast(e),t.cast(e)]}function Zm(n,t){return t.some(e=>e.id===n.id)}function Eo(n){const t=[];return nw(n,t,new Set),t}function nw(n,t,e){if(n==null)return;if(n instanceof Fe){t.push(n);return}if(!z_(n))return;const s=n;for(const r in s){const o=s[r];e.has(o)||(e.add(o),nw(o,t,e))}}function z_(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jm(n){return n.kernelName!=null}class sw{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Ta{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new sw}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const s=t[e];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){const{asyncInit:e}=this.initializeBackend(t);if(e)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,s=1){return t in this.registryFactory?(bs(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:s},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;const{success:e,asyncInit:s}=this.initializeBackend(t);if(!(s?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new __(this.backendInstance),!0}setupRegisteredKernels(){A1(this.backendName).forEach(e=>{e.setupFunc!=null&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){A1(t).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[t])})}initializeBackend(t){const e=this.registryFactory[t];if(e==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const s=e.factory();if(s&&!(s instanceof Gp)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,o=s.then(i=>r<this.pendingBackendInitId?!1:(this.registry[t]=i,this.pendingBackendInit=null,!0)).catch(i=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,bs(`Initialization of backend ${t} failed`),bs(i.stack||i.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[t]=s,{success:!0,asyncInit:!1}}catch(s){return bs(`Initialization of backend ${t} failed`),bs(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const s=t[e],{success:r,asyncInit:o}=this.initializeBackend(s);if(o||r)return{name:s,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const s=this.state.tensorInfo.get(e),r=s.backend,o=this.readSync(e),i=r.refCount(e);r.disposeData(e,!0),s.backend=t,t.move(e,o,s.shape,s.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let s=null;if(e==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");e=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof e!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=t}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=e(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(t,e,s){t();try{const r=s();return e(),r}catch(r){throw e(),r}}nextTensorId(){return Ta.nextTensorId++}nextVariableId(){return Ta.nextVariableId++}clone(t){const e=z.runKernel(Zl,{x:t}),s={x:t},r=i=>({x:()=>{const a="float32",l={x:i},u={dtype:a};return z.runKernel(Ml,l,u)}}),o=[];return this.addTapeNode(this.state.activeScope.name,s,[e],r,o,{}),e}runKernel(t,e,s){if(this.backendName==null&&this.backend,!(_1(t,this.backendName)!=null))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,s){const r=this.backend.numDataIds();let o=0;s.forEach(l=>{o+=l.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-e-o-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${t}'`)}runKernelFunc(t){let e,s=[];const r=this.isTapeOn(),o=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=Jm(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Jm(t)){const{kernelName:g,inputs:x,attrs:b}=t;this.backendName==null&&this.backend;const w=_1(g,this.backendName);A(w!=null,()=>`Cannot find registered kernel '${g}' for backend '${this.backendName}'`),a=()=>{const v=this.backend.numDataIds();l=w.kernelFunc({inputs:x,attrs:b,backend:this.backend});const I=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(g,v,I);const C=I.map(k=>k.rank!=null?k:this.makeTensorFromTensorInfo(k));if(r){const k=this.getTensorsForGradient(g,x,C);s=this.saveTensorsForBackwardMode(k)}return C}}else{const{forwardFunc:g}=t,x=b=>{r&&(s=b.map(w=>this.keep(this.clone(w))))};a=()=>{const b=this.backend.numDataIds();l=this.tidy(()=>g(this.backend,x));const w=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,b,w),w}}const{inputs:h,attrs:d}=t,f=Jm(t)?null:t.backwardsFunc;let m;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?e=a():(m=this.profiler.profileKernel(u,h,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),e=m.outputs)}),r&&this.addTapeNode(u,h,e,f,s,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(h).map(g=>h[g]!=null?h[g].shape:null),outputShapes:e.map(g=>g.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(l)?e:e[0]}saveTensorsForBackwardMode(t){return t.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(t,e,s){const r=R1(t);if(r!=null){const o=r.inputsToSave||[],i=r.outputsToSave||[];let a;r.saveAllInputs?(A(Array.isArray(e),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(e).map(u=>e[u])):a=o.map(u=>e[u]);const l=s.filter((u,h)=>i[h]);return a.concat(l)}return[]}makeTensor(t,e,s,r){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let o=t;s==="string"&&_l(t[0])&&(o=t.map(l=>No(l)));const i=r.write(o,e,s),a=new Fe(e,s,i,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(i),u=i_(o);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(t,e,s,r){s=s||"float32";const o={dataId:t,shape:e,dtype:s};return this.makeTensorFromTensorInfo(o,r)}makeTensorFromTensorInfo(t,e){const{dataId:s,shape:r,dtype:o}=t,i=new Fe(r,o,s,this.nextTensorId());return this.trackTensor(i,e),i}makeVariable(t,e=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==t.dtype&&(t=t.cast(r));const o=new md(t,e,s,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(t,e){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let s=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(s=t.size*oh(t.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:s})),t instanceof md||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){const s=t.size*oh(t.dtype);this.state.numBytes-=s}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,e,s,r,o,i){const a={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:s,saved:o},l=R1(t);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((h,d)=>{if(h==null){const f=s[d],m=Sn(f.size,f.dtype);return this.makeTensor(m,f.shape,f.dtype)}return h}),r(u.length>1?u:u[0],o,i))),this.state.activeTape.push(a)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=Eo(t),s=new Set(e.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const i=this.state.activeScope.track[o];!i.kept&&!s.has(i.id)&&i.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach(o=>{!o.kept&&o.scopeId===r.id&&this.track(o)})}gradients(t,e,s,r=!1){if(A(e.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));A(o instanceof Fe,()=>"The result y returned by f() must be a tensor.");const i=D_(this.state.activeTape,e,o);if(!r&&i.length===0&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[o.id]=s??W_(o.shape),F_(a,i,u=>this.tidy(u),V_);const l=e.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const h of u.saved)h.dispose()}),this.state.activeTape=null),{value:o,grads:l}})}customGrad(t){return A(ih(t),()=>"The f passed in customGrad(f) must be a function."),(...e)=>{A(e.every(a=>a instanceof Fe),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};e.forEach((a,l)=>{r[l]=a});const o=(a,l)=>(s=t(...e,l),A(s.value instanceof Fe,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),A(ih(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),i=(a,l)=>{const u=s.gradFunc(a,l),h=Array.isArray(u)?u:[u];A(h.length===e.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),A(h.every(f=>f instanceof Fe),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return h.forEach((f,m)=>{d[m]=()=>f}),d};return this.runKernelFunc({forwardFunc:o,backwardsFunc:i,inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=Nn(),s=await this.backend.time(t);return s.wallMs=Nn()-e,s}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new sw;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Ta.nextTensorId=0,Ta.nextVariableId=0;function W_(n){const t=Xp(st(n),"float32");return z.makeTensor(t,n,"float32")}function rw(){const n=l1();if(n._tfengine==null){const t=new u_(n);n._tfengine=new Ta(t)}return f_(n._tfengine.ENV),P_(()=>n._tfengine),n._tfengine}const z=rw();function V_(n,t){const e={a:n,b:t};return z.runKernel(Ia,e)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U_(){return typeof navigator<"u"&&navigator!=null}function ow(n){if(n||U_()){if(n||(n=navigator),n.product==="ReactNative")return!0;const t=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!t){const e=n;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function iw(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gn=J();Gn.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Gn.registerFlag("IS_BROWSER",()=>iw()),Gn.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"),Gn.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),Gn.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),Gn.registerFlag("PROD",()=>!1),Gn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Gn.getBool("DEBUG")),Gn.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),Gn.registerFlag("IS_TEST",()=>!1),Gn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Gn.getBool("DEBUG")),Gn.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1),Gn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1),Gn.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gd(n,t){let e=n;if(ys(n))return t==="string"?[]:[n.length];if(tw(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(ew(n))return[n.buffer.size/(t==null?4:oh(t))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(e)||ys(e)&&t!=="string";)s.push(e.length),e=e[0];return Array.isArray(n)&&J().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&aw(n,s,[]),s}function aw(n,t,e){if(e=e||[],!Array.isArray(n)&&!ys(n)){A(t.length===0,()=>`Element arr[${e.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}A(t.length>0,()=>`Element arr[${e.join("][")}] should be a primitive, but is an array of ${n.length} elements`),A(n.length===t[0],()=>`Element arr[${e.join("][")}] should have ${t[0]} elements, but has ${n.length} elements`);const s=t.slice(1);for(let r=0;r<n.length;++r)aw(n[r],s,e.concat(r))}function lw(n,t,e,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==t||n==="numeric"&&t==="string")throw new Error(`Argument '${e}' passed to '${s}' must be ${n} tensor, but got ${t} tensor`)}}function L(n,t,e,s="numeric"){if(n instanceof Fe)return lw(s,n.dtype,t,e),n;let r=va(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),lw(s,r,t,e),n==null||!ys(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${t}' passed to '${e}' must be a Tensor or TensorLike, but got '${l}'`)}const o=gd(n,r);!ys(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?wi(n,r):vi(n,[],!0);return z.makeTensor(a,o,r)}function uw(n,t,e,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${t} passed to ${e} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((o,i)=>L(o,`${t}[${i}]`,e,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G_="__op";function G(n){const t=Object.keys(n);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let e=t[0];const s=n[e];e.endsWith("_")&&(e=e.substring(0,e.length-1)),e=e+G_;const r=(...o)=>{z.startScope(e);try{const i=s(...o);return ah(i)&&console.error("Cannot return a Promise inside of tidy."),z.endScope(i),i}catch(i){throw z.endScope(null),i}};return Object.defineProperty(r,"name",{value:e,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H_(n,t){const e=L(n,"real","complex"),s=L(t,"imag","complex");rh(e.shape,s.shape,`real and imag shapes, ${e.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:e,imag:s};return z.runKernel(om,r)}const Ea=G({complex_:H_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xd(n,t,e,s){if(s==null)s=va(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(ew(n)||tw(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return z.backend.createTensorFromGPUData(n,t||e,s)}if(!ys(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){qr(t);const r=st(t),o=st(e);A(r===o,()=>`Based on the provided shape, [${t}], the tensor should have ${r} values but has ${o}`);for(let i=0;i<e.length;++i){const a=e[i],l=i===e.length-1?a!==st(t.slice(i)):!0;A(e[i]===t[i]||!l,()=>`Error creating a new Tensor. Inferred shape (${e}) does not match the provided shape (${t}). `)}}return!ys(n)&&!Array.isArray(n)&&(n=[n]),t=t||e,n=s!=="string"?wi(n,s):vi(n,[],!0),z.makeTensor(n,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qm(n,t,e){const s=gd(n,e);return xd(n,t,s,e)}class _a{static join(t){return new _a(t).slice()}constructor(t){if(this.shards=[],this.previousShardIndex=0,t==null||(t instanceof Array||(t=[t]),t=t.map(s=>ys(s)?s.buffer:s),t.length===0))return;this.bufferUniformSize=t[0].byteLength;let e=0;for(let s=0;s<t.length;s++){const r=t[s];s!==t.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=e+r.byteLength;this.shards.push({buffer:r,start:e,end:o}),e=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(t=0,e=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(t=isNaN(Number(t))?0:t,e=isNaN(Number(e))?0:e,t=Math.max(0,t),e=Math.min(this.byteLength,e),e<=t)return new ArrayBuffer(0);const s=this.findShardForByte(t);if(s===-1)throw new Error(`Could not find start shard for byte ${t}`);const r=e-t,o=new ArrayBuffer(r),i=new Uint8Array(o);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],d=t+a-u.start,f=a,g=Math.min(e,u.end)-u.start,x=new Uint8Array(u.buffer,d,g-d);if(i.set(x,f),a+=x.length,e<u.end)break}return o}findShardForByte(t){if(this.shards.length===0||t<0||t>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(t/this.bufferUniformSize),this.previousShardIndex;function e(r){return t<r.start?-1:t>=r.end?1:0}if(e(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=K_(this.shards,e);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function K_(n,t){let e=0,s=n.length;for(;e<=s;){const r=Math.floor((s-e)/2)+e,o=t(n[r]);if(o===0)return r;o<0?s=r:e=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cw=4;async function hw(n,t){const e=[],s=[],r=Array.isArray(n)?n.map(i=>i.name):Object.keys(n);for(let i=0;i<r.length;++i){const a=r[i],l=Array.isArray(n)?n[i].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const h=new Promise(async d=>{const f=await l.bytes(),m=f.reduce((b,w)=>b+w.length,0)+cw*f.length,g=new Uint8Array(m);let x=0;for(let b=0;b<f.length;b++){const w=f[b],v=new Uint8Array(new Uint32Array([w.length]).buffer);g.set(v,x),x+=cw,g.set(w,x),x+=w.length}d(g)});s.push(h)}else s.push(l.data());t!=null&&(u.group=t),e.push(u)}const o=await Promise.all(s);return{data:q_(o),specs:e}}function q_(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let t=0;const e=[];n.forEach(o=>{if(t+=o.byteLength,e.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const s=new Uint8Array(t);let r=0;return e.forEach(o=>{s.set(new Uint8Array(o.buffer),r),r+=o.byteLength}),s.buffer}const tg=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function dw(n){return tg?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function j_(n){if(tg)return Buffer.from(n).toString("base64");const t=new Uint8Array(n);let e="";for(let s=0,r=t.length;s<r;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function X_(n){if(tg){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const t=atob(n),e=new Uint8Array(t.length);for(let s=0;s<t.length;++s)e.set([t.charCodeAt(s)],s);return e.buffer}function Y_(n){return _a.join(n)}function fw(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:dw(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:dw(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new _a(n.weightData).byteLength}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Dn.instance==null&&(Dn.instance=new Dn),Dn.instance}static registerSaveRouter(t){Dn.getInstance().saveRouters.push(t)}static registerLoadRouter(t){Dn.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return Dn.getHandlers(t,"save")}static getLoadHandlers(t,e){return Dn.getHandlers(t,"load",e)}static getHandlers(t,e,s){const r=[];return(e==="load"?Dn.getInstance().loadRouters:Dn.getInstance().saveRouters).forEach(i=>{const a=i(t,s);a!==null&&r.push(a)}),r}}const Z_=n=>Dn.getSaveHandlers(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eg="tensorflowjs",ng=1,Ci="models_store",_o="model_info_store";function pw(){if(!J().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,t=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function sg(n){const t=n.result;t.createObjectStore(Ci,{keyPath:"modelPath"}),t.createObjectStore(_o,{keyPath:"modelPath"})}class Ii{constructor(t){if(this.indexedDB=pw(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise((s,r)=>{const o=this.indexedDB.open(eg,ng);o.onupgradeneeded=()=>sg(o),o.onsuccess=()=>{const i=o.result;if(e==null){const a=i.transaction(Ci,"readonly"),u=a.objectStore(Ci).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return i.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=h=>(i.close(),r(u.error)),a.oncomplete=()=>i.close()}else{e.weightData=_a.join(e.weightData);const a=fw(e),l=i.transaction(_o,"readwrite");let u=l.objectStore(_o),h;try{h=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(f){return r(f)}let d;h.onsuccess=()=>{d=i.transaction(Ci,"readwrite");const f=d.objectStore(Ci);let m;try{m=f.put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:a})}catch(g){return r(g)}m.onsuccess=()=>s({modelArtifactsInfo:a}),m.onerror=g=>{u=l.objectStore(_o);const x=u.delete(this.modelPath);x.onsuccess=()=>(i.close(),r(m.error)),x.onerror=b=>(i.close(),r(m.error))}},h.onerror=f=>(i.close(),r(h.error)),l.oncomplete=()=>{d==null?i.close():d.oncomplete=()=>i.close()}}},o.onerror=i=>r(o.error)})}}Ii.URL_SCHEME="indexeddb://";const mw=n=>J().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ii.URL_SCHEME)?J_(n.slice(Ii.URL_SCHEME.length)):null;Dn.registerSaveRouter(mw),Dn.registerLoadRouter(mw);function J_(n){return new Ii(n)}function Q_(n){return n.startsWith(Ii.URL_SCHEME)?n.slice(Ii.URL_SCHEME.length):n}class tR{constructor(){this.indexedDB=pw()}async listModels(){return new Promise((t,e)=>{const s=this.indexedDB.open(eg,ng);s.onupgradeneeded=()=>sg(s),s.onsuccess=()=>{const r=s.result,o=r.transaction(_o,"readonly"),a=o.objectStore(_o).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;t(l)},a.onerror=l=>(r.close(),e(a.error)),o.oncomplete=()=>r.close()},s.onerror=r=>e(s.error)})}async removeModel(t){return t=Q_(t),new Promise((e,s)=>{const r=this.indexedDB.open(eg,ng);r.onupgradeneeded=()=>sg(r),r.onsuccess=()=>{const o=r.result,i=o.transaction(_o,"readwrite"),a=i.objectStore(_o),l=a.get(t);let u;l.onsuccess=()=>{if(l.result==null)return o.close(),s(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const h=a.delete(t),d=()=>{u=o.transaction(Ci,"readwrite");const m=u.objectStore(Ci).delete(t);m.onsuccess=()=>e(l.result.modelArtifactsInfo),m.onerror=g=>s(l.error)};h.onsuccess=d,h.onerror=f=>(d(),o.close(),s(l.error))}},l.onerror=h=>(o.close(),s(l.error)),i.oncomplete=()=>{u==null?o.close():u.oncomplete=()=>o.close()}},r.onerror=o=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jr="/",Ra="tensorflowjs_models",gw="info",eR="model_topology",nR="weight_specs",sR="weight_data",rR="model_metadata";function xw(n){return{info:[Ra,n,gw].join(jr),topology:[Ra,n,eR].join(jr),weightSpecs:[Ra,n,nR].join(jr),weightData:[Ra,n,sR].join(jr),modelMetadata:[Ra,n,rR].join(jr)}}function bw(n){for(const t of Object.values(n))window.localStorage.removeItem(t)}function oR(n){const t=n.split(jr);if(t.length<3)throw new Error(`Invalid key format: ${n}`);return t.slice(1,t.length-1).join(jr)}function iR(n){return n.startsWith($i.URL_SCHEME)?n.slice($i.URL_SCHEME.length):n}class $i{constructor(t){if(!J().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=xw(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),s=JSON.stringify(t.weightSpecs),r=fw(t),o=_a.join(t.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,j_(o));const i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:t.signature!=null?t.signature:void 0,userDefinedMetadata:t.userDefinedMetadata!=null?t.userDefinedMetadata:void 0,modelInitializer:t.modelInitializer!=null?t.modelInitializer:void 0,initializerSignature:t.initializerSignature!=null?t.initializerSignature:void 0,trainingConfig:t.trainingConfig!=null?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch{throw bw(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(t==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const a=JSON.parse(o);e.format=a.format,e.generatedBy=a.generatedBy,e.convertedBy=a.convertedBy,a.signature!=null&&(e.signature=a.signature),a.userDefinedMetadata!=null&&(e.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(e.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(e.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(e.trainingConfig=a.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=X_(i),e}}$i.URL_SCHEME="localstorage://";const yw=n=>J().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith($i.URL_SCHEME)?aR(n.slice($i.URL_SCHEME.length)):null;Dn.registerSaveRouter(yw),Dn.registerLoadRouter(yw);function aR(n){return new $i(n)}class lR{constructor(){A(J().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),A(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const t={},e=Ra+jr,s=jr+gw;for(let r=0;r<this.LS.length;++r){const o=this.LS.key(r);if(o.startsWith(e)&&o.endsWith(s)){const i=oR(o);t[i]=JSON.parse(this.LS.getItem(o))}}return t}async removeModel(t){t=iR(t);const e=xw(t);if(this.LS.getItem(e.info)==null)throw new Error(`Cannot find model at path '${t}'`);const s=JSON.parse(this.LS.getItem(e.info));return bw(e),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ww="://";class Ir{constructor(){this.managers={}}static getInstance(){return Ir.instance==null&&(Ir.instance=new Ir),Ir.instance}static registerManager(t,e){A(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(ww)&&(t=t.slice(0,t.indexOf(ww))),A(t.length>0,()=>"scheme must not be an empty string.");const s=Ir.getInstance();A(s.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),s.managers[t]=e}static getManager(t){const e=Ir.getInstance().managers[t];if(e==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(Ir.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uR{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}setTimeoutCustom(t,e){if(typeof window>"u"||!J().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(t,e);return}this.functionRefs.push(t),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},e),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(t){return O1(t)}}if(J().get("IS_BROWSER")){J().setPlatform("browser",new uR);try{Ir.registerManager($i.URL_SCHEME,new lR)}catch{}try{Ir.registerManager(Ii.URL_SCHEME,new tR)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cR={importFetch:()=>require("node-fetch")};let rg;class hR{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return J().global.fetch!=null?J().global.fetch(t,e):(rg==null&&(rg=cR.importFetch()),rg(t,e))}now(){const t=process.hrtime();return t[0]*1e3+t[1]/1e6}encode(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return t.length===0?"":new this.util.TextDecoder(e).decode(t)}isTypedArray(t){return this.util.types.isFloat32Array(t)||this.util.types.isInt32Array(t)||this.util.types.isUint8Array(t)||this.util.types.isUint8ClampedArray(t)}}J().get("IS_NODE")&&!J().get("IS_BROWSER")&&J().setPlatform("node",new hR);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yt(n,t="float32",e){return t=t||"float32",qr(n),new yn(n,t,e)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dR(n,t){const e=L(n,"x","cast");if(!o_(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&e.dtype!=="string"||t!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:e},r={dtype:t};return z.runKernel(Ml,s,r)}const vt=G({cast_:dR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fR(n){const e={x:L(n,"x","clone","string_or_numeric")};return z.runKernel(Zl,e)}const ki=G({clone_:fR});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pR(n,t=!1){console.log(n.toString(t))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */rw(),M_({buffer:Yt,cast:vt,clone:ki,print:pR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $r(){return z}function og(){return z.memory()}function X(n,t){return z.tidy(n,t)}function qt(n){Eo(n).forEach(e=>e.dispose())}function kr(n){return z.keep(n)}function mR(){return z.ready()}function gR(){return z.backendName}function vw(n,t,e=1){return z.registerBackend(n,t,e)}function xR(){return z.backend}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bR(n,t){let e=L(n,"a","add"),s=L(t,"b","add");[e,s]=Ke(e,s);const r={a:e,b:s};return z.runKernel(Ia,r)}const dt=G({add_:bR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yR(n,t){let e=L(n,"a","floorDiv"),s=L(t,"b","floorDiv");[e,s]=Ke(e,s);const r={a:e,b:s};return z.runKernel(Xl,r)}const Cw=G({floorDiv_:yR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wR(n,t){let e=L(n,"a","div"),s=L(t,"b","div");if([e,s]=Ke(e,s),e.dtype==="int32"&&s.dtype==="int32")return Cw(e,s);const r={a:e,b:s},o={};return z.runKernel(Ul,r,o)}const Dt=G({div_:wR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vR(n,t){let e=L(n,"a","mul"),s=L(t,"b","mul");[e,s]=Ke(e,s);const r={a:e,b:s};return z.runKernel(iu,r)}const W=G({mul_:vR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CR(n){const t=L(n,"x","abs");if(t.dtype==="complex64"){const e={x:t};return z.runKernel(mh,e)}else{const e={x:t};return z.runKernel(lh,e)}}const Fn=G({abs_:CR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IR(n){const e={x:L(n,"x","acos")};return z.runKernel(Rl,e)}const $R=G({acos_:IR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kR(n){const e={x:L(n,"x","acosh")};return z.runKernel(Al,e)}const SR=G({acosh_:kR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NR(n,t=null,e=!1){const r={x:L(n,"x","all","bool")},o={axis:t,keepDims:e};return z.runKernel(Qp,r,o)}const Iw=G({all_:NR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TR(n,t=null,e=!1){const r={x:L(n,"x","any","bool")},o={axis:t,keepDims:e};return z.runKernel(tm,r,o)}const ig=G({any_:TR});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ER(n,t=0){const s={x:L(n,"x","argMax")},r={axis:t};return z.runKernel(uh,s,r)}const Eu=G({argMax_:ER});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _R(n,t=0){const s={x:L(n,"x","argMin")},r={axis:t};return z.runKernel(ch,s,r)}const RR=G({argMin_:_R});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AR(n){const e={x:L(n,"x","asin")};return z.runKernel(Dl,e)}const DR=G({asin_:AR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FR(n){const e={x:L(n,"x","asinh")};return z.runKernel(Fl,e)}const OR=G({asinh_:FR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LR(n){const e={x:L(n,"x","atan")};return z.runKernel(Ol,e)}const PR=G({atan_:LR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MR(n,t){let e=L(n,"a","atan2"),s=L(t,"b","atan2");[e,s]=Ke(e,s);const r={a:e,b:s};return z.runKernel(Pl,r)}const BR=G({atan2_:MR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zR(n){const e={x:L(n,"x","atanh")};return z.runKernel(Ll,e)}const WR=G({atanh_:zR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _u(n,t,e,s,r="NHWC",o){const i=n[3],a=[...t,i],l=Yr(r);return wn(n,a,e,o,s,null,null,l)}function Ps(n,t,e,s,r,o,i="channelsLast"){const[a,l]=Ru(t);let u;if(i==="channelsLast")u=[a,l,n[3],n[3]];else if(i==="channelsFirst")u=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return wn(n,u,e,s,r,o,!1,i)}function Xr(n,t,e,s,r,o,i="NDHWC"){const[a,l,u]=lg(t);let h,d;if(i==="NDHWC")d="channelsLast",h=[a,l,u,n[4],n[4]];else if(i==="NCDHW")d="channelsFirst",h=[a,l,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return Ro(n,h,e,s,r,!1,d,o)}function wn(n,t,e,s,r,o,i=!1,a="channelsLast"){let[l,u,h,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,h,d]=n;else if(a==="channelsFirst")[l,d,u,h]=n;else throw new Error(`Unknown dataFormat ${a}`);const[f,m,,g]=t,[x,b]=Ru(e),[w,v]=Ru(s),I=Aa(f,w),C=Aa(m,v),{padInfo:k,outHeight:N,outWidth:T}=GR(r,u,h,x,b,I,C,o,a),R=i?g*d:g;let E;return a==="channelsFirst"?E=[l,R,N,T]:a==="channelsLast"&&(E=[l,N,T,R]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:h,inChannels:d,outHeight:N,outWidth:T,outChannels:R,padInfo:k,strideHeight:x,strideWidth:b,filterHeight:f,filterWidth:m,effectiveFilterHeight:I,effectiveFilterWidth:C,dilationHeight:w,dilationWidth:v,inShape:n,outShape:E,filterShape:t}}function Ro(n,t,e,s,r,o=!1,i="channelsLast",a){let[l,u,h,d,f]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[l,u,h,d,f]=n;else if(i==="channelsFirst")[l,f,u,h,d]=n;else throw new Error(`Unknown dataFormat ${i}`);const[m,g,x,,b]=t,[w,v,I]=lg(e),[C,k,N]=lg(s),T=Aa(m,C),R=Aa(g,k),E=Aa(x,N),{padInfo:F,outDepth:P,outHeight:q,outWidth:j}=HR(r,u,h,d,w,v,I,T,R,E,a),K=o?b*f:b;let Y;return i==="channelsFirst"?Y=[l,K,P,q,j]:i==="channelsLast"&&(Y=[l,P,q,j,K]),{batchSize:l,dataFormat:i,inDepth:u,inHeight:h,inWidth:d,inChannels:f,outDepth:P,outHeight:q,outWidth:j,outChannels:K,padInfo:F,strideDepth:w,strideHeight:v,strideWidth:I,filterDepth:m,filterHeight:g,filterWidth:x,effectiveFilterDepth:T,effectiveFilterHeight:R,effectiveFilterWidth:E,dilationDepth:C,dilationHeight:k,dilationWidth:N,inShape:n,outShape:Y,filterShape:t}}function VR(n,t,e,s,r){s==null&&(s=ag(n,t,e));const o=n[0],i=n[1],a=Au((o-t+2*s)/e+1,r),l=Au((i-t+2*s)/e+1,r);return[a,l]}function UR(n,t,e,s,r,o){r==null&&(r=ag(n,t[0],s[0]));const i=[0,0,0,e];for(let a=0;a<3;a++)n[a]+2*r>=t[a]&&(i[a]=Au((n[a]-t[a]+2*r)/s[a]+1,o));return i}function ag(n,t,e,s=1){const r=Aa(t,s);return Math.floor((n[0]*(e-1)-e+r)/2)}function Ru(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function lg(n){return typeof n=="number"?[n,n,n]:n}function Aa(n,t){return t<=1?n:n+(n-1)*(t-1)}function GR(n,t,e,s,r,o,i,a,l){let u,h,d;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const m=VR([t,e],o,s,n,a);h=m[0],d=m[1]}else if(n==="same"){h=Math.ceil(t/s),d=Math.ceil(e/r);const f=Math.max(0,(h-1)*s+o-t),m=Math.max(0,(d-1)*r+i-e),g=Math.floor(f/2),x=f-g,b=Math.floor(m/2),w=m-b;u={top:g,bottom:x,left:b,right:w,type:"SAME"}}else if(n==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((t-o+1)/s),d=Math.ceil((e-i+1)/r);else if(typeof n=="object"){const f=l==="channelsLast"?n[1][0]:n[2][0],m=l==="channelsLast"?n[1][1]:n[2][1],g=l==="channelsLast"?n[2][0]:n[3][0],x=l==="channelsLast"?n[2][1]:n[3][1];u={top:f,bottom:m,left:g,right:x,type:f===0&&m===0&&g===0&&x===0?"VALID":"EXPLICIT"},h=Au((t-o+f+m)/s+1,a),d=Au((e-i+g+x)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:u,outHeight:h,outWidth:d}}function HR(n,t,e,s,r,o,i,a,l,u,h){let d,f,m,g;if(n==="valid"&&(n=0),typeof n=="number"){d={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const b=UR([t,e,s,1],[a,l,u],1,[r,o,i],n,h);f=b[0],m=b[1],g=b[2]}else if(n==="same"){f=Math.ceil(t/r),m=Math.ceil(e/o),g=Math.ceil(s/i);const x=(f-1)*r+a-t,b=(m-1)*o+l-e,w=(g-1)*i+u-s,v=Math.floor(x/2),I=x-v,C=Math.floor(b/2),k=b-C,N=Math.floor(w/2),T=w-N;d={top:C,bottom:k,left:N,right:T,front:v,back:I,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:d,outDepth:f,outHeight:m,outWidth:g}}function Au(n,t){if(!t)return Math.trunc(n);switch(t){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${t}`)}}function Si(n){const[t,e,s]=Ru(n);return t===1&&e===1&&s===1}function Tn(n,t){return Si(n)||Si(t)}function Ni(n){return Ru(n).every(t=>t>0)}function Yr(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Hn(n,t,e){if(e!=null){if(typeof t=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${t}.`);if(typeof t=="number")A(ya(t),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${t}.`);else if(typeof t=="object")t.forEach(s=>{s.forEach(r=>{A(ya(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${t}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KR(n,t){const s={x:L(n,"x","reshape","string_or_numeric")},r={shape:t};return z.runKernel(Xh,s,r)}const U=G({reshape_:KR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qR(n,t,e,s,r){const o=L(n,"x","avgPool","float32"),i=1;A(Tn(e,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`);let a=o,l=!1;o.rank===3&&(l=!0,a=U(o,[1,o.shape[0],o.shape[1],o.shape[2]])),A(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Hn("avgPool",s,r);const u={x:a},h={filterSize:t,strides:e,pad:s,dimRoundingMode:r};let d=z.runKernel(hh,u,h);return d=vt(d,o.dtype),l?U(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const ug=G({avgPool_:qR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jR(n,t,e,s,r,o="NDHWC"){const i=L(n,"x","avgPool3d","float32");let a=i,l=!1;i.rank===4&&(l=!0,a=U(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),A(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),A(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),A(typeof e=="number"&&e>0||Array.isArray(e)&&e[0]>0&&e[1]>0&&e[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${e}'`),Hn("avgPool3d",s,r);const u={x:a},h={filterSize:t,strides:e,pad:s,dimRoundingMode:r,dataFormat:o};let d=z.runKernel(dh,u,h);return d=vt(d,a.dtype),l?U(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const XR=G({avgPool3d_:jR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YR(n,t=0){A(n.length>=1,()=>"Pass at least one tensor to concat");const e=uw(n,"tensors","concat","string_or_numeric");if(e[0].dtype==="complex64"&&e.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),e.length===1)return ki(e[0]);const s=e,r={axis:t};return z.runKernel(gh,s,r)}const Kn=G({concat_:YR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZR(n,t,e=!1,s=!1){let r=L(n,"a","matMul"),o=L(t,"b","matMul");[r,o]=Ke(r,o);const i={a:r,b:o},a={transposeA:e,transposeB:s};return z.runKernel(fh,i,a)}const de=G({matMul_:ZR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JR(n){const e={x:L(n,"x","sigmoid","float32")};return z.runKernel(xu,e)}const Da=G({sigmoid_:JR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QR(n,t,e){const s=L(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},o={begin:t,size:e};return z.runKernel(td,r,o)}const Se=G({slice_:QR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tA(n){const e={x:L(n,"x","tanh","float32")};return z.runKernel(Iu,e)}const cg=G({tanh_:tA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eA(n,t,e){const s=L(n,"x","batchToSpaceND"),r=t.reduce((a,l)=>a*l);A(s.rank>=1+t.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${t.length}`),A(e.length===t.length,()=>`crops.length is ${e.length} but should be equal to blockShape.length  ${t.length}`),A(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${r}`);const o={x:s},i={blockShape:t,crops:e};return z.runKernel(ph,o,i)}const hg=G({batchToSpaceND_:eA});function nA(n){let t;return n.rank===0||n.rank===1?t=U(n,[1,1,1,n.size]):n.rank===2?t=U(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?t=U(n,[1,n.shape[0],n.shape[1],n.shape[2]]):t=n,t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sA(n,t,e,s,r,o){o==null&&(o=.001);const i=L(n,"x","batchNorm"),a=L(t,"mean","batchNorm"),l=L(e,"variance","batchNorm");let u;r!=null&&(u=L(r,"scale","batchNorm"));let h;s!=null&&(h=L(s,"offset","batchNorm")),A(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A(h==null||a.rank===h.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:nA(i),scale:u,offset:h,mean:a,variance:l},m={varianceEpsilon:o},g=z.runKernel(kh,f,m);return U(g,i.shape)}const bd=G({batchNorm_:sA});function rA(n,t,e,s,r,o){const i=L(n,"x","batchNorm"),a=L(t,"mean","batchNorm"),l=L(e,"variance","batchNorm");let u;r!=null&&(u=L(r,"scale","batchNorm"));let h;return s!=null&&(h=L(s,"offset","batchNorm")),A(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),A(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),A(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&A(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),h!=null&&A(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${h.rank}.`),bd(i,a,l,h,u,o)}const oA=G({batchNorm2d_:rA});function iA(n,t,e,s,r,o){const i=L(n,"x","batchNorm"),a=L(t,"mean","batchNorm"),l=L(e,"variance","batchNorm");let u;r!=null&&(u=L(r,"scale","batchNorm"));let h;return s!=null&&(h=L(s,"offset","batchNorm")),A(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),A(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),A(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&A(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),h!=null&&A(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${h.rank}.`),bd(i,a,l,h,u,o)}const aA=G({batchNorm3d_:iA});function lA(n,t,e,s,r,o){const i=L(n,"x","batchNorm"),a=L(t,"mean","batchNorm"),l=L(e,"variance","batchNorm");let u;r!=null&&(u=L(r,"scale","batchNorm"));let h;return s!=null&&(h=L(s,"offset","batchNorm")),A(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),A(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),A(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&A(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),h!=null&&A(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${h.rank}.`),bd(i,a,l,h,u,o)}const uA=G({batchNorm4d_:lA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cA(n,t,e){const s=L(n,"x","bincount"),r=L(t,"weights","bincount");A(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),A(e>=0,()=>`size must be non-negative, but got ${e}.`),A(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const o={x:s,weights:r},i={size:e};return z.runKernel(sm,o,i)}const hA=G({bincount_:cA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dA(n,t){let e=L(n,"broadcastTo","x");const s=e.shape;if(qr(t),t.length<e.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${e.rank}.`);if(t.length>e.rank){const u=e.shape.slice();for(;u.length<t.length;)u.unshift(1);e=U(e,u)}const r=e.shape,o=Array.from(t);for(let u=t.length-1;u>=0;u--)if(r[u]===t[u])o[u]=1;else if(e.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${t}].`);if(o.map((u,h)=>u>1?h:-1).filter(u=>u>=0).length===0)return ki(e);const a={x:e},l={reps:o};return z.runKernel($u,a,l)}const Du=G({broadcastTo_:dA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fA(n){const e={x:L(n,"x","ceil","float32")};return z.runKernel(Bl,e)}const pA=G({ceil_:fA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yd(n,t,e){qr(n),e=e||va(t);const s={shape:n,value:t,dtype:e};return z.runKernel(wm,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mA(n,t,e){const s=L(n,"x","clipByValue");if(A(t<=e,()=>`Error in clip: min (${t}) must be less than or equal to max (${e}).`),t===e)return yd(s.shape,t,s.dtype);const r={x:s},o={clipValueMin:t,clipValueMax:e};return z.runKernel(zl,r,o)}const ws=G({clipByValue_:mA});function gA(n){return Kn(n,0)}const xA=G({concat1d_:gA});function bA(n,t){return Kn(n,t)}const yA=G({concat2d_:bA});function wA(n,t){return Kn(n,t)}const vA=G({concat3d_:wA});function CA(n,t){return Kn(n,t)}const IA=G({concat4d_:CA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $A(n,t,e,s,r="NHWC",o=[1,1],i){const a=L(n,"x","conv2d","float32"),l=L(t,"filter","conv2d","float32");let u=a,h=!1;a.rank===3&&(h=!0,u=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),A(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),A(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Hn("conv2d",s,i);const d=r==="NHWC"?u.shape[3]:u.shape[1];A(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),A(Tn(e,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${o}'`),A(Ni(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),A(Ni(e),()=>"Error in conv2D: Strides should be larger than 0.");const f={x:u,filter:l},m={strides:e,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},g=z.runKernel(xh,f,m);return h?U(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const Ti=G({conv2d_:$A});function kA(n,t,e,s,r="NWC",o=1,i){const a=L(n,"x","conv1d"),l=L(t,"filter","conv1d");let u=a,h=!1;a.rank===2&&(h=!0,u=U(a,[1,a.shape[0],a.shape[1]])),A(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),A(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Hn("conv1d",s,i),A(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),A(Tn(e,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${e} and dilation '${o}'`),A(Ni(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),A(Ni(e),()=>"Error in conv1D: Stride should be larger than 0."),A(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const d=U(l,[1,l.shape[0],l.shape[1],l.shape[2]]),f=U(u,[u.shape[0],1,u.shape[1],u.shape[2]]),b=Ti(f,d,[1,e],s,"NHWC",[1,o],i);return h?U(b,[b.shape[2],b.shape[3]]):U(b,[b.shape[0],b.shape[2],b.shape[3]])}const $w=G({conv1d_:kA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SA(n,t,e,s,r,o="NHWC",i){A(n.length===t.rank,()=>`Length of inShape (${n.length}) and rank of dy (${t.rank}) must match`);let a=n,l=t,u=!1;t.rank===3&&(u=!0,l=U(t,[1,t.shape[0],t.shape[1],t.shape[2]]),a=[1,n[0],n[1],n[2]]),A(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),A(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),A(e.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${e.rank}`);const h=o==="NHWC"?a[3]:a[1],d=o==="NHWC"?l.shape[3]:l.shape[1];A(h===e.shape[2],()=>`Error in conv2dDerInput: depth of input (${h}) must match input depth for filter ${e.shape[2]}.`),A(d===e.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${e.shape[3]}.`),Hn("conv2dDerInput",r,i);const f={dy:l,filter:e},m={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,inputShape:a},g=z.runKernel(bh,f,m);return u?U(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const dg=G({conv2DBackpropInput_:SA});function NA(n,t,e,s,r,o){const i=L(n,"x","conv2dTranspose"),a=L(t,"filter","conv2dTranspose");return dg(e,i,a,s,r,"NHWC",o)}const kw=G({conv2dTranspose_:NA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TA(n,t,e,s,r="NDHWC",o=[1,1,1]){const i=L(n,"x","conv3d"),a=L(t,"filter","conv3d");let l=i,u=!1;i.rank===4&&(u=!0,l=U(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),A(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),A(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),A(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),A(Tn(e,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${e} and dilations '${o}'`),A(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),A(Ni(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),A(Ni(e),()=>"Error in conv3D: Strides should be larger than 0.");const h={x:l,filter:a},d={strides:e,pad:s,dataFormat:r,dilations:o},f=z.runKernel(yh,h,d);return u?U(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const EA=G({conv3d_:TA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _A(n,t,e,s,r){A(n.length===t.rank,()=>`Length of inShape (${n.length}) and rank of dy (${t.rank}) must match`);let o=n,i=t,a=!1;t.rank===4&&(a=!0,i=U(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),o=[1,n[0],n[1],n[2],n[3]]);const l=o[4],u=i.shape[4];A(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),A(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),A(e.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${e.rank}`),A(l===e.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${e.shape[3]}.`),A(u===e.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${e.shape[4]}.`);const h={dy:i,filter:e},d={pad:r,strides:s,inputShape:o},f=z.runKernel(lm,h,d);return a?U(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Sw=G({conv3DBackpropInput_:_A});function RA(n,t,e,s,r){const o=L(n,"x","conv3dTranspose"),i=L(t,"filter","conv3dTranspose");return Sw(e,o,i,s,r)}const AA=G({conv3dTranspose_:RA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DA(n){const e={x:L(n,"x","cos","float32")};return z.runKernel(Wl,e)}const fg=G({cos_:DA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FA(n){const e={x:L(n,"x","cosh","float32")};return z.runKernel(Vl,e)}const Nw=G({cosh_:FA});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OA(n,t=0,e=!1,s=!1){const o={x:L(n,"x","cumprod")},i={axis:t,exclusive:e,reverse:s};return z.runKernel(um,o,i)}const pg=G({cumprod_:OA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LA(n,t=0,e=!1,s=!1){const o={x:L(n,"x","cumsum")},i={axis:t,exclusive:e,reverse:s};return z.runKernel(wh,o,i)}const Tw=G({cumsum_:LA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PA(n,t,e,s=!1){const r=L(n,"x","denseBincount"),o=L(t,"weights","denseBincount");A(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),A(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),A(e>=0,()=>`size must be non-negative, but got ${e}.`),A(o.size===r.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${o.shape}.`);const i={x:r,weights:o},a={size:e,binaryOutput:s};return z.runKernel(hm,i,a)}const Ew=G({denseBincount_:PA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MA(n,t,e="NHWC"){const s=L(n,"x","depthToSpace","float32"),r=e==="NHWC"?s.shape[1]:s.shape[2],o=e==="NHWC"?s.shape[2]:s.shape[3],i=e==="NHWC"?s.shape[3]:s.shape[1];A(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),A(r*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${t}  for depthToSpace with input shape
    ${s.shape}`),A(o*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${t} for depthToSpace with input shape
        ${s.shape}`),A(i%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${i} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:t,dataFormat:e};return z.runKernel(dm,a,l)}const BA=G({depthToSpace_:MA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zA(n,t,e,s,r="NHWC",o=[1,1],i){const a=L(n,"x","depthwiseConv2d","float32"),l=L(t,"filter","depthwiseConv2d","float32");let u=a,h=!1;a.rank===3&&(h=!0,u=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),A(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),A(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const d=r==="NHWC"?u.shape[3]:u.shape[1];A(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),Hn("depthwiseConv2d",s,i);const f={x:u,filter:l},m={strides:e,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},g=z.runKernel(vh,f,m);return h?U(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const mg=G({depthwiseConv2d_:zA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WA(n,t,e,s,r=[1,1],o="NHWC"){const i=L(n,"x","dilation2d"),a=L(t,"filter","dilation2d");A(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),A(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),A(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let l=i,u=!1;i.rank===3&&(l=U(i,[1,i.shape[0],i.shape[1],i.shape[2]]),u=!0),A(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const h={x:l,filter:a},d={strides:e,pad:s,dilations:r},f=z.runKernel(Ch,h,d);return u?U(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const VA=G({dilation2d_:WA});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fa(n,t){const e=n.length,s=[];for(let r=0;r<e;r++){const o=e-1-r,i=n[o]||1;(t[t.length-1-r]||1)>1&&i===1&&s.unshift(o)}return s}function nn(n,t){const e=[];for(let s=0;s<t.length;s++){const r=n[n.length-s-1],o=t.length-s-1,i=t[o];(r==null||r===1&&i>1)&&e.unshift(o)}return e}function Vt(n,t){const e=Math.max(n.length,t.length),s=new Array(e);for(let r=0;r<e;r++){let o=n[n.length-r-1];o==null&&(o=1);let i=t[t.length-r-1];if(i==null&&(i=1),o===1)s[e-r-1]=i;else if(i===1)s[e-r-1]=o;else if(o!==i){const a=`Operands could not be broadcast together with shapes ${n} and ${t}.`;throw Error(a)}else s[e-r-1]=o}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UA(n,t){let e=L(n,"a","equal","string_or_numeric"),s=L(t,"b","equal","string_or_numeric");[e,s]=Ke(e,s),Vt(e.shape,s.shape);const r={a:e,b:s};return z.runKernel(Ih,r)}const Sr=G({equal_:UA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GA(n,t,e){const s=L(t,"a","where"),r=L(e,"b","where"),o=L(n,"condition","where","bool"),i=Vt(Vt(o.shape,s.shape),r.shape),a=Du(o,i),l=Du(s,i),u=Du(r,i),h={condition:a,t:l,e:u};return z.runKernel(Qh,h)}const On=G({where_:GA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HA(n){const e={x:L(n,"x","zerosLike")};return z.runKernel(ad,e)}const ne=G({zerosLike_:HA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KA(n,t){let e=L(n,"a","div"),s=L(t,"b","div");[e,s]=Ke(e,s);const r=Dt(e,s),o=ne(r),i=Sr(s,o);return On(i,o,r)}const qA=G({divNoNan_:KA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jA(n,t){const e=L(n,"t1","dot"),s=L(t,"t2","dot");A((e.rank===1||e.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${e.rank} and ${s.rank}.`);const r=e.rank===1?e.size:e.shape[1],o=s.rank===1?s.size:s.shape[0];if(A(r===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${o}.`),e.rank===1&&s.rank===1){const i=U(e,[1,-1]),a=U(s,[-1,1]),l=de(i,a);return U(l,[])}else if(e.rank===1&&s.rank===2){const i=U(e,[1,-1]),a=U(s,[s.shape[0],s.shape[1]]),l=de(i,a);return U(l,[l.size])}else if(e.rank===2&&s.rank===1){const i=U(s,[-1,1]),a=de(e,i);return U(a,[a.size])}else{const i=U(s,[s.shape[0],s.shape[1]]);return de(e,i)}}const XA=G({dot_:jA});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YA(n,...t){const e=t.map((r,o)=>L(r,`tensors${o}`,"einsum")),s={equation:n};return z.runKernel(xm,e,s)}const Fu=G({einsum_:YA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZA(n){const e={x:L(n,"x","elu","float32")};return z.runKernel(Gl,e)}const wd=G({elu_:ZA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JA(n){let t=L(n,"x","erf");A(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=vt(t,"float32"));const e={x:t};return z.runKernel(Hl,e)}const QA=G({erf_:JA});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gg(n,t){for(let e=0;e<n.length;++e)if(n[n.length-e-1]!==t-1-e)return!1;return!0}function _w(n,t,e){const s=n.length+t.length,r=[];let o=0,i=0;for(let a=0;a<s;a++)e.indexOf(a)===-1?r.push(n[o++]):r.push(t[i++]);return r}function dn(n,t){const e=[],s=n.length;for(let o=0;o<s;o++)t.indexOf(o)===-1&&e.push(n[o]);const r=t.map(o=>n[o]);return[e,r]}function Je(n,t){const e=t.map(s=>1);return _w(n,e,t)}function vn(n,t,e){A(gg(t,e),()=>`${n} supports only inner-most axes for now. Got axes ${t} and rank-${e} input.`)}function Be(n,t){if(gg(n,t))return null;const e=[];for(let s=0;s<t;++s)n.indexOf(s)===-1&&e.push(s);return n.forEach(s=>e.push(s)),e}function Ao(n){return n.map((t,e)=>[e,t]).sort((t,e)=>t[1]-e[1]).map(t=>t[0])}function qe(n,t){const e=[];for(let s=t-n;s<t;++s)e.push(s);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tD(n,t=null,e=!1){const r={x:L(n,"x","max")},o={reductionIndices:t,keepDims:e};return z.runKernel(Oh,r,o)}const ir=G({max_:tD});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eD(n,t=null,e=!1){const r={x:L(n,"x","min")},o={axis:t,keepDims:e};return z.runKernel(Bh,r,o)}const vd=G({min_:eD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nD(n,t){let e=L(n,"base","pow"),s=L(t,"exp","pow");[e,s]=Ke(e,s);const r={a:e,b:s};return z.runKernel(au,r)}const Oa=G({pow_:nD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fe(n,t){if((ys(n)&&t!=="string"||Array.isArray(n))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&ys(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return xd(n,[],[],t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sD(n){const e={x:L(n,"x","sqrt","float32")};return z.runKernel(yu,e)}const Ln=G({sqrt_:sD});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rD(n){const t=L(n,"x","square"),e={};return z.runKernel("Square",{x:t},e)}const Ae=G({square_:rD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oD(n,t=null,e=!1){let s=L(n,"x","sum");s.dtype==="bool"&&(s=vt(s,"int32"));const r={x:s},o={axis:t,keepDims:e};return z.runKernel(ed,r,o)}const At=G({sum_:oD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iD(n,t="euclidean",e=null,s=!1){n=L(n,"x","norm");const r=Rw(n,t,e);let o=r.shape;if(s){const i=Xt(e,n.shape);o=Je(r.shape,i)}return U(r,o)}function Rw(n,t,e=null){if(n.rank===0)return Fn(n);if(n.rank!==1&&e===null)return Rw(U(n,[-1]),t,e);if(n.rank===1||typeof e=="number"||Array.isArray(e)&&e.length===1){if(t===1)return At(Fn(n),e);if(t===1/0)return ir(Fn(n),e);if(t===-1/0)return vd(Fn(n),e);if(t==="euclidean"||t===2)return Ln(At(Oa(Fn(n),fe(2,"int32")),e));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(e)&&e.length===2){if(t===1)return ir(At(Fn(n),e[0]),e[1]-1);if(t===1/0)return ir(At(Fn(n),e[1]),e[0]);if(t===-1/0)return vd(At(Fn(n),e[1]),e[0]);if(t==="fro"||t==="euclidean")return Ln(At(Ae(n),e));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${e}`)}const Cd=G({norm_:iD});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aD(n,t=null,e=!1){return Cd(n,"euclidean",t,e)}const lD=G({euclideanNorm_:aD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uD(n){const e={x:L(n,"x","exp")};return z.runKernel(Kl,e)}const Nr=G({exp_:uD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cD(n,t=0){const e=L(n,"x","expandDims","string_or_numeric");A(t<=e.rank,()=>"Axis must be <= rank of the tensor");const s={input:e},r={dim:t};return z.runKernel($h,s,r)}const qn=G({expandDims_:cD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hD(n){const e={x:L(n,"x","expm1")};return z.runKernel(ql,e)}const dD=G({expm1_:hD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fD(n,t){const e=L(n,"x","tile","string_or_numeric");A(e.rank===t.length,()=>`Error in transpose: rank of input ${e.rank} must match length of reps ${t}.`);const s={x:e},r={reps:t};return z.runKernel($u,s,r)}const ar=G({tile_:fD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pD(n,t,e,s="float32"){t==null&&(t=n);const r=Yt([n,t],s),o=n<=t?n:t;for(let a=0;a<o;++a)r.set(1,a,a);const i=U(r.toTensor(),[n,t]);if(e==null)return i;if(e.length===1)return ar(qn(i,0),[e[0],1,1]);if(e.length===2)return ar(qn(qn(i,0),0),[e[0],e[1],1,1]);if(e.length===3)return ar(qn(qn(qn(i,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${e.length}D.`)}const Aw=G({eye_:pD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mD(n){const e={x:L(n,"x","floor","float32")};return z.runKernel(jl,e)}const Id=G({floor_:mD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gD(n,t,e=0,s=0){const r=L(n,"x","gather"),o=L(t,"indices","gather","int32"),i={x:r,indices:o},a={axis:e,batchDims:s};return z.runKernel(Sh,i,a)}const xg=G({gather_:gD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xD(n,t){let e=L(n,"a","greater","string_or_numeric"),s=L(t,"b","greater","string_or_numeric");[e,s]=Ke(e,s),Vt(e.shape,s.shape);const r={a:e,b:s};return z.runKernel(Nh,r)}const vs=G({greater_:xD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bD(n,t){let e=L(n,"a","greaterEqual","string_or_numeric"),s=L(t,"b","greaterEqual","string_or_numeric");[e,s]=Ke(e,s),Vt(e.shape,s.shape);const r={a:e,b:s};return z.runKernel(Yl,r)}const Ei=G({greaterEqual_:bD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yD(n){const e={input:L(n,"input","imag")};return z.runKernel(Im,e)}const bg=G({imag_:yD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wD(n){const e={x:L(n,"x","isFinite")};return z.runKernel(Jl,e)}const vD=G({isFinite_:wD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CD(n){const e={x:L(n,"x","isInf")};return z.runKernel(Ql,e)}const ID=G({isInf_:CD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $D(n){const e={x:L(n,"x","isNaN")};return z.runKernel(tu,e)}const kD=G({isNaN_:$D});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SD(n,t=.2){const s={x:L(n,"x","leakyRelu")},r={alpha:t};return z.runKernel(Th,s,r)}const yg=G({leakyRelu_:SD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ND(n,t){let e=L(n,"a","less","string_or_numeric"),s=L(t,"b","less","string_or_numeric");[e,s]=Ke(e,s),Vt(e.shape,s.shape);const r={a:e,b:s};return z.runKernel(Eh,r)}const $d=G({less_:ND});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TD(n,t){let e=L(n,"a","lessEqual","string_or_numeric"),s=L(t,"b","lessEqual","string_or_numeric");[e,s]=Ke(e,s),Vt(e.shape,s.shape);const r={a:e,b:s};return z.runKernel(_h,r)}const La=G({lessEqual_:TD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ED(n,t=5,e=1,s=1,r=.5){const o=L(n,"x","localResponseNormalization");A(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),A(ya(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let i=o,a=!1;o.rank===3&&(a=!0,i=U(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const l={x:i},u={depthRadius:t,bias:e,alpha:s,beta:r},h=z.runKernel(Fh,l,u);return a?U(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const _D=G({localResponseNormalization_:ED});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RD(n){const e={x:L(n,"x","log","float32")};return z.runKernel(eu,e)}const Tr=G({log_:RD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AD(n){const e={x:L(n,"x","log1p")};return z.runKernel(nu,e)}const Dw=G({log1p_:AD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DD(n){return A(ih(n),()=>"The f passed in grad(f) must be a function"),(t,e)=>{const s=L(t,"x","tf.grad","string_or_numeric"),r=e!=null?L(e,"dy","tf.grad"):null;return z.tidy(()=>{const{value:o,grads:i}=z.gradients(()=>n(s),[s],r);return r!=null&&rh(o.shape,r.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),OD(i),i[0]})}}function FD(n,t){A(ih(n),()=>"The f passed in variableGrads(f) must be a function"),A(t==null||Array.isArray(t)&&t.every(u=>u instanceof md),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const e=t!=null;if(!e){t=[];for(const u in z.registeredVariables)t.push(z.registeredVariables[u])}const s=e?t.filter(u=>!u.trainable):null,r=t.length;t=t.filter(u=>u.trainable),A(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const o=!0,{value:i,grads:a}=z.gradients(n,t,null,o);A(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),A(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const l={};return t.forEach((u,h)=>{a[h]!=null&&(l[u.name]=a[h])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:i,grads:l}}function Pa(n){return z.customGrad(n)}function OD(n){if(n.filter(e=>e==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LD(n){const e={x:L(n,"x","neg")};return z.runKernel(Wh,e)}const je=G({neg_:LD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PD(n){const e={x:L(n,"x","softplus")};return z.runKernel(bu,e)}const Ou=G({softplus_:PD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MD(n){const t=L(n,"x","logSigmoid");return Pa(s=>({value:je(Ou(je(s))),gradFunc:i=>W(i,Da(je(s)))}))(t)}const BD=G({logSigmoid_:MD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zD(n,t){let e=L(n,"a","sub"),s=L(t,"b","sub");[e,s]=Ke(e,s);const r={a:e,b:s};return z.runKernel(vu,r)}const Ot=G({sub_:zD});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WD(n,t=-1){const e=L(n,"logits","logSoftmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and axis was ${t}`);return Pa((r,o)=>{const a=ir(r,t,!0),l=Ot(r,a),u=Ot(vt(l,"float32"),Tr(At(Nr(l),t,!0)));return o([u]),{value:u,gradFunc:(d,f)=>{const[m]=f,g=!0,x=Nr(m);return Ot(d,W(At(d,t,g),x))}}})(e)}const Fw=G({logSoftmax_:WD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VD(n,t=null,e=!1){const s=L(n,"x","logSumExp"),r=Xt(t,s.shape),o=ir(s,r,!0),i=Ot(s,o),a=Nr(i),l=At(a,r),u=Tr(l),h=dt(U(o,u.shape),u);if(e){const d=Je(h.shape,r);return U(h,d)}return h}const Ow=G({logSumExp_:VD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UD(n,t){const e=L(n,"a","logicalAnd","bool"),s=L(t,"b","logicalAnd","bool");Vt(e.shape,s.shape);const r={a:e,b:s};return z.runKernel(Rh,r)}const Zr=G({logicalAnd_:UD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GD(n){const e={x:L(n,"x","logicalNot","bool")};return z.runKernel(Ah,e)}const wg=G({logicalNot_:GD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HD(n,t){const e=L(n,"a","logicalOr","bool"),s=L(t,"b","logicalOr","bool");Vt(e.shape,s.shape);const r={a:e,b:s};return z.runKernel(Dh,r)}const Lw=G({logicalOr_:HD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KD(n,t){const e=L(n,"a","logicalXor","bool"),s=L(t,"b","logicalXor","bool");return Vt(e.shape,s.shape),Zr(Lw(n,t),wg(Zr(n,t)))}const qD=G({logicalXor_:KD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jD(n,t,e,s,r){const o=L(n,"x","maxPool"),i=1;let a=o,l=!1;o.rank===3&&(l=!0,a=U(o,[1,o.shape[0],o.shape[1],o.shape[2]])),A(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),A(Tn(e,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),Hn("maxPool",s,r);const u={x:a},h={filterSize:t,strides:e,pad:s,dimRoundingMode:r},d=z.runKernel(Lh,u,h);return l?U(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const vg=G({maxPool_:jD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XD(n,t=[1,1,1],e,s,r,o="NDHWC"){const i=L(n,"x","maxPool3d");let a=i,l=!1;i.rank===4&&(l=!0,a=U(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),A(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),A(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),Hn("maxPool3d",s,r);const u={x:a},h={filterSize:t,strides:e,pad:s,dimRoundingMode:r,dataFormat:o},d=z.runKernel(Ph,u,h);return l?U(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const YD=G({maxPool3d_:XD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZD(n,t){let e=L(n,"a","maximum"),s=L(t,"b","maximum");[e,s]=Ke(e,s),e.dtype==="bool"&&(e=vt(e,"int32"),s=vt(s,"int32")),Vt(e.shape,s.shape);const r={a:e,b:s};return z.runKernel(su,r)}const Do=G({maximum_:ZD});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JD(n,t=null,e=!1){const r={x:L(n,"x","mean")},o={axis:t,keepDims:e};return z.runKernel(Mh,r,o)}const Qe=G({mean_:JD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fn(n,t="float32"){if(qr(n),t==="complex64"){const s=fn(n,"float32"),r=fn(n,"float32");return Ea(s,r)}const e=Sn(st(n),t);return z.makeTensor(e,n,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fo(n,t="float32"){if(qr(n),t==="complex64"){const s=Fo(n,"float32"),r=fn(n,"float32");return Ea(s,r)}const e=Xp(st(n),t);return z.makeTensor(e,n,t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QD(n,t){let e=L(n,"a","minimum"),s=L(t,"b","minimum");[e,s]=Ke(e,s),e.dtype==="bool"&&(e=vt(e,"int32"),s=vt(s,"int32")),Vt(e.shape,s.shape);const r={a:e,b:s};return z.runKernel(ru,r)}const Lu=G({minimum_:QD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tF(n,t,e){A(e==="reflect"||e==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${e}.`);const s=L(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");A(t.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${t.length}.`);const r=e==="reflect"?1:0;for(let a=0;a<s.rank;a++)A(t[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),A(t[a][0]>=0&&t[a][0]<=s.shape[a]-r&&t[a][1]>=0&&t[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const o={paddings:t,mode:e},i={x:s};return z.runKernel(zh,i,o)}const eF=G({mirrorPad_:tF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nF(n,t){let e=L(n,"a","mod"),s=L(t,"b","mod");[e,s]=Ke(e,s);const r={a:e,b:s};return z.runKernel(ou,r)}const sF=G({mod_:nF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rF(n,t=null,e=!1){n=L(n,"x","moments");const s=Xt(t,n.shape),r=Qe(n,s,e);let o=r.shape;e||(o=Je(r.shape,s));const i=Ae(Ot(vt(n,"float32"),U(r,o))),a=Qe(i,s,e);return{mean:r,variance:a}}const Cg=G({moments_:rF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oF(n,t){let e=L(n,"a","notEqual","string_or_numeric"),s=L(t,"b","notEqual","string_or_numeric");[e,s]=Ke(e,s),Vt(e.shape,s.shape);const r={a:e,b:s};return z.runKernel(Vh,r)}const kd=G({notEqual_:oF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iF(n,t,e=1,s=0,r="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const i={indices:L(n,"indices","oneHot","int32")},a={dtype:r,depth:t,onValue:e,offValue:s};return z.runKernel(Gh,i,a)}const Pw=G({oneHot_:iF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aF(n){const e={x:L(n,"x","onesLike")};return z.runKernel(Uh,e)}const Ms=G({onesLike_:aF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lF(n,t,e=0){const s=L(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:t,constantValue:e},o={x:s};return z.runKernel(Kh,o,r)}const Ig=G({pad_:lF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uF(n,t,e){const s=L(n,"x","spaceToBatchND");A(s.rank>=1+t.length,()=>`input rank ${s.rank} should be > than [blockShape] ${t.length}`),A(e.length===t.length,()=>`paddings.shape[0] ${e.length} must be equal to [blockShape] ${t.length}`),A(s.shape.reduce((i,a,l)=>l>0&&l<=t.length?i&&(a+e[l-1][0]+e[l-1][1])%t[l-1]===0:i,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${e.toString()} must be divisible by blockShapes ${t.toString()}`);const r={x:s},o={blockShape:t,paddings:e};return z.runKernel(nd,r,o)}const $g=G({spaceToBatchND_:uF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cF(n,t,e,s,r,o,i){r==null&&(r=[1,1]),o==null&&(o=1),s===0&&(s="valid");const a=L(n,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),A(Tn(o,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${r}'`);const h=Ps(l.shape,t,o,r,s),d=[h.dilationHeight,h.dilationWidth];let f;s==="same"?f=dF([h.filterHeight,h.filterWidth],d):f=[[0,0],[0,0]];const m=d[0]===1&&d[1]===1,[g,x]=hF([h.inHeight,h.inWidth],d,f),b=m?s:"valid",w=m?l:$g(l,d,g),I=(e==="avg"?()=>ug(w,t,o,b,i):()=>vg(w,t,o,b,i))(),C=m?I:hg(I,d,x);return u?U(C,[C.shape[1],C.shape[2],C.shape[3]]):C}function hF(n,t,e){const s=e.map(h=>h[0]),r=e.map(h=>h[1]),o=n.concat(s,r),i=t.map((h,d)=>(h-o[d]%h)%h),a=r.map((h,d)=>h+i[d]),l=t.map((h,d)=>[s[d],a[d]]),u=t.map((h,d)=>[0,i[d]]);return[l,u]}function dF(n,t){const s=n.map((i,a)=>i+(i-1)*(t[a]-1)).map(i=>i-1),r=s.map(i=>Math.floor(i/2)),o=s.map((i,a)=>i-r[a]);return s.map((i,a)=>[r[a],o[a]])}const fF=G({pool_:cF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pF(n,t){const e=L(n,"x","prelu"),s=L(t,"alpha","prelu"),r={x:e,alpha:s};return z.runKernel(qh,r)}const kg=G({prelu_:pF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mF(n,t=null,e=!1){let s=L(n,"x","prod");s.dtype==="bool"&&(s=vt(s,"int32"));const r={x:s},o={axis:t,keepDims:e};return z.runKernel(jh,r,o)}const gF=G({prod_:mF});var Sg={exports:{}};Sg.exports,function(n){(function(t,e,s){function r(l){var u=this,h=a();u.next=function(){var d=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=d-(u.c=d|0)},u.c=1,u.s0=h(" "),u.s1=h(" "),u.s2=h(" "),u.s0-=h(l),u.s0<0&&(u.s0+=1),u.s1-=h(l),u.s1<0&&(u.s1+=1),u.s2-=h(l),u.s2<0&&(u.s2+=1),h=null}function o(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function i(l,u){var h=new r(l),d=u&&u.state,f=h.next;return f.int32=function(){return h.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,d&&(typeof d=="object"&&o(d,h),f.state=function(){return o(h,{})}),f}function a(){var l=4022871197,u=function(h){h=String(h);for(var d=0;d<h.length;d++){l+=h.charCodeAt(d);var f=.02519603282416938*l;l=f>>>0,f-=l,f*=l,l=f>>>0,f-=l,l+=f*4294967296}return(l>>>0)*23283064365386963e-26};return u}e&&e.exports?e.exports=i:s&&s.amd?s(function(){return i}):this.alea=i})($e,n,!1)}(Sg);var xF=Sg.exports,Ng={exports:{}};Ng.exports,function(n){(function(t,e,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:u+=a;for(var h=0;h<u.length+64;h++)l.x^=u.charCodeAt(h)|0,l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function i(a,l){var u=new r(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var f=u.next()>>>11,m=(u.next()>>>0)/4294967296,g=(f+m)/(1<<21);while(g===0);return g},d.int32=u.next,d.quick=d,h&&(typeof h=="object"&&o(h,u),d.state=function(){return o(u,{})}),d}e&&e.exports?e.exports=i:s&&s.amd?s(function(){return i}):this.xor128=i})($e,n,!1)}(Ng);var bF=Ng.exports,Tg={exports:{}};Tg.exports,function(n){(function(t,e,s){function r(a){var l=this,u="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var h=0;h<u.length+64;h++)l.x^=u.charCodeAt(h)|0,h==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function i(a,l){var u=new r(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var f=u.next()>>>11,m=(u.next()>>>0)/4294967296,g=(f+m)/(1<<21);while(g===0);return g},d.int32=u.next,d.quick=d,h&&(typeof h=="object"&&o(h,u),d.state=function(){return o(u,{})}),d}e&&e.exports?e.exports=i:s&&s.amd?s(function(){return i}):this.xorwow=i})($e,n,!1)}(Tg);var yF=Tg.exports,Eg={exports:{}};Eg.exports,function(n){(function(t,e,s){function r(a){var l=this;l.next=function(){var h=l.x,d=l.i,f,m;return f=h[d],f^=f>>>7,m=f^f<<24,f=h[d+1&7],m^=f^f>>>10,f=h[d+3&7],m^=f^f>>>3,f=h[d+4&7],m^=f^f<<7,f=h[d+7&7],f=f^f<<13,m^=f^f<<9,h[d]=m,l.i=d+1&7,m};function u(h,d){var f,m=[];if(d===(d|0))m[0]=d;else for(d=""+d,f=0;f<d.length;++f)m[f&7]=m[f&7]<<15^d.charCodeAt(f)+m[f+1&7]<<13;for(;m.length<8;)m.push(0);for(f=0;f<8&&m[f]===0;++f);for(f==8?m[7]=-1:m[f],h.x=m,h.i=0,f=256;f>0;--f)h.next()}u(l,a)}function o(a,l){return l.x=a.x.slice(),l.i=a.i,l}function i(a,l){a==null&&(a=+new Date);var u=new r(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var f=u.next()>>>11,m=(u.next()>>>0)/4294967296,g=(f+m)/(1<<21);while(g===0);return g},d.int32=u.next,d.quick=d,h&&(h.x&&o(h,u),d.state=function(){return o(u,{})}),d}e&&e.exports?e.exports=i:s&&s.amd?s(function(){return i}):this.xorshift7=i})($e,n,!1)}(Eg);var wF=Eg.exports,_g={exports:{}};_g.exports,function(n){(function(t,e,s){function r(a){var l=this;l.next=function(){var h=l.w,d=l.X,f=l.i,m,g;return l.w=h=h+1640531527|0,g=d[f+34&127],m=d[f=f+1&127],g^=g<<13,m^=m<<17,g^=g>>>15,m^=m>>>12,g=d[f]=g^m,l.i=f,g+(h^h>>>16)|0};function u(h,d){var f,m,g,x,b,w=[],v=128;for(d===(d|0)?(m=d,d=null):(d=d+"\0",m=0,v=Math.max(v,d.length)),g=0,x=-32;x<v;++x)d&&(m^=d.charCodeAt((x+32)%d.length)),x===0&&(b=m),m^=m<<10,m^=m>>>15,m^=m<<4,m^=m>>>13,x>=0&&(b=b+1640531527|0,f=w[x&127]^=m+b,g=f==0?g+1:0);for(g>=128&&(w[(d&&d.length||0)&127]=-1),g=127,x=4*128;x>0;--x)m=w[g+34&127],f=w[g=g+1&127],m^=m<<13,f^=f<<17,m^=m>>>15,f^=f>>>12,w[g]=m^f;h.w=b,h.X=w,h.i=g}u(l,a)}function o(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function i(a,l){a==null&&(a=+new Date);var u=new r(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var f=u.next()>>>11,m=(u.next()>>>0)/4294967296,g=(f+m)/(1<<21);while(g===0);return g},d.int32=u.next,d.quick=d,h&&(h.X&&o(h,u),d.state=function(){return o(u,{})}),d}e&&e.exports?e.exports=i:s&&s.amd?s(function(){return i}):this.xor4096=i})($e,n,!1)}(_g);var vF=_g.exports,Rg={exports:{}};Rg.exports,function(n){(function(t,e,s){function r(a){var l=this,u="";l.next=function(){var d=l.b,f=l.c,m=l.d,g=l.a;return d=d<<25^d>>>7^f,f=f-m|0,m=m<<24^m>>>8^g,g=g-d|0,l.b=d=d<<20^d>>>12^f,l.c=f=f-m|0,l.d=m<<16^f>>>16^g,l.a=g-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var h=0;h<u.length+20;h++)l.b^=u.charCodeAt(h)|0,l.next()}function o(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function i(a,l){var u=new r(a),h=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var f=u.next()>>>11,m=(u.next()>>>0)/4294967296,g=(f+m)/(1<<21);while(g===0);return g},d.int32=u.next,d.quick=d,h&&(typeof h=="object"&&o(h,u),d.state=function(){return o(u,{})}),d}e&&e.exports?e.exports=i:s&&s.amd?s(function(){return i}):this.tychei=i})($e,n,!1)}(Rg);var CF=Rg.exports,Mw={exports:{}},IF={},$F=Object.freeze({__proto__:null,default:IF}),kF=v_($F);(function(n){(function(t,e,s){var r=256,o=6,i=52,a="random",l=s.pow(r,o),u=s.pow(2,i),h=u*2,d=r-1,f;function m(C,k,N){var T=[];k=k==!0?{entropy:!0}:k||{};var R=w(b(k.entropy?[C,I(e)]:C??v(),3),T),E=new g(T),F=function(){for(var P=E.g(o),q=l,j=0;P<u;)P=(P+j)*r,q*=r,j=E.g(1);for(;P>=h;)P/=2,q/=2,j>>>=1;return(P+j)/q};return F.int32=function(){return E.g(4)|0},F.quick=function(){return E.g(4)/4294967296},F.double=F,w(I(E.S),e),(k.pass||N||function(P,q,j,K){return K&&(K.S&&x(K,E),P.state=function(){return x(E,{})}),j?(s[a]=P,q):P})(F,R,"global"in k?k.global:this==s,k.state)}function g(C){var k,N=C.length,T=this,R=0,E=T.i=T.j=0,F=T.S=[];for(N||(C=[N++]);R<r;)F[R]=R++;for(R=0;R<r;R++)F[R]=F[E=d&E+C[R%N]+(k=F[R])],F[E]=k;(T.g=function(P){for(var q,j=0,K=T.i,Y=T.j,Q=T.S;P--;)q=Q[K=d&K+1],j=j*r+Q[d&(Q[K]=Q[Y=d&Y+q])+(Q[Y]=q)];return T.i=K,T.j=Y,j})(r)}function x(C,k){return k.i=C.i,k.j=C.j,k.S=C.S.slice(),k}function b(C,k){var N=[],T=typeof C,R;if(k&&T=="object")for(R in C)try{N.push(b(C[R],k-1))}catch{}return N.length?N:T=="string"?C:C+"\0"}function w(C,k){for(var N=C+"",T,R=0;R<N.length;)k[d&R]=d&(T^=k[d&R]*19)+N.charCodeAt(R++);return I(k)}function v(){try{var C;return f&&(C=f.randomBytes)?C=C(r):(C=new Uint8Array(r),(t.crypto||t.msCrypto).getRandomValues(C)),I(C)}catch{var k=t.navigator,N=k&&k.plugins;return[+new Date,t,N,t.screen,I(e)]}}function I(C){return String.fromCharCode.apply(0,C)}if(w(s.random(),e),n.exports){n.exports=m;try{f=kF}catch{}}else s["seed"+a]=m})(typeof self<"u"?self:$e,[],Math)})(Mw);var SF=Mw.exports,NF=xF,TF=bF,EF=yF,_F=wF,RF=vF,AF=CF,_i=SF;_i.alea=NF,_i.xor128=TF,_i.xorwow=EF,_i.xorshift7=_F,_i.xor4096=RF,_i.tychei=AF;var Pu=_i;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bw{constructor(t,e,s,r,o){this.mean=t,this.stdDev=e,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=o||Math.random();this.random=Pu.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let t,e,s=!1;for(;!s;){let r,o,i;do r=2*this.random()-1,o=2*this.random()-1,i=r*r+o*o;while(i>=1||i===0);const a=Math.sqrt(-2*Math.log(i)/i);t=this.mean+this.stdDev*r*a,e=this.mean+this.stdDev*o*a,(!this.truncated||this.isValidTruncated(t))&&(s=!0)}return(!this.truncated||this.isValidTruncated(e))&&(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class DF{constructor(t=0,e=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=e-t,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=Pu.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FF(n,t=0,e=1,s,r){if(qr(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const o=new Bw(t,e,s,!1,r),i=Yt(n,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const zw=G({randomNormal_:FF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OF(n,t=0,e=1,s="float32",r){qr(n);const o=Yt(n,s),i=new DF(t,e,null,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const Mu=G({randomUniform_:OF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bu(n,t,e=1,s="float32"){if(e===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:t,step:e,dtype:s};return z.runKernel(_m,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LF(n){const e={input:L(n,"input","real")};return z.runKernel(Rm,e)}const Sd=G({real_:LF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PF(n){const e={x:L(n,"x","reciprocal")};return z.runKernel(lu,e)}const MF=G({reciprocal_:PF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BF(n){const e={x:L(n,"x","relu")};return z.runKernel(uu,e)}const Ri=G({relu_:BF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zF(n){const e={x:L(n,"x","relu6")};return z.runKernel(cu,e)}const Ww=G({relu6_:zF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WF(n,t){const s={x:L(n,"x","reverse")},r={dims:t};return z.runKernel(Jh,s,r)}const Ai=G({reverse_:WF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VF(n){const e={x:L(n,"x","round")};return z.runKernel(hu,e)}const Vw=G({round_:VF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UF(n){const e={x:L(n,"x","rsqrt","float32")};return z.runKernel(du,e)}const Uw=G({rsqrt_:UF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GF(n){const e={x:L(n,"x","selu")};return z.runKernel(fu,e)}const Gw=G({selu_:GF});function HF(n,t,e,s,r,o=[1,1],i="NHWC"){const a=L(n,"x","separableConv2d"),l=L(t,"depthwiseFilter","separableConv2d"),u=L(e,"pointwiseFilter","separableConv2d");let h=a,d=!1;if(a.rank===3&&(d=!0,h=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");A(h.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${h.rank}.`),A(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),A(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),A(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),A(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const f=l.shape[2],m=l.shape[3];A(u.shape[2]===f*m,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*m}, but got ${u.shape[2]}.`);const g=mg(h,l,s,r,i,o),b=Ti(g,u,1,"valid",i);return d?U(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const Hw=G({separableConv2d_:HF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KF(n){const e={x:L(n,"x","sign")};return z.runKernel(gu,e)}const qF=G({sign_:KF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jF(n){const e={x:L(n,"x","sin","float32")};return z.runKernel(pu,e)}const Kw=G({sin_:jF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XF(n){const e={x:L(n,"x","sinh")};return z.runKernel(mu,e)}const qw=G({sinh_:XF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YF(n,t,e){const s=L(n,"x","slice1d");return A(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),Se(s,[t],[e])}const Ag=G({slice1d_:YF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZF(n,t,e){const s=L(n,"x","slice2d");return A(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),Se(s,t,e)}const jw=G({slice2d_:ZF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JF(n,t,e){const s=L(n,"x","slice3d");return A(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),Se(s,t,e)}const Dg=G({slice3d_:JF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QF(n,t,e){const s=L(n,"x","slice4d");return A(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),Se(s,t,e)}const Nd=G({slice4d_:QF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tO(n,t=-1){const e=L(n,"logits","softmax","float32");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and dim was ${t}`);const s={logits:e},r={dim:t};return z.runKernel(rd,s,r)}const Fg=G({softmax_:tO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eO(n){A(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const t={input:n};return z.runKernel(ym,t)}const Xw=G({fft_:eO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nO(n){A(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const t={input:n};return z.runKernel(Cm,t)}const Og=G({ifft_:nO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sO(n){const t=n.shape[n.shape.length-1],e=n.size/t;let s;if(t<=2){const r=U(n,[e,t]);s=Og(r)}else{const r=[e,2*(t-1)],o=U(Sd(n),[e,t]),i=U(bg(n),[e,t]),a=Ai(Se(o,[0,1],[e,t-2]),1),l=W(Ai(Se(i,[0,1],[e,t-2]),1),fe(-1)),u=Kn([o,a],1),h=Kn([i,l],1),d=U(Ea(u,h),[r[0],r[1]]);s=Og(d)}if(s=Sd(s),n.rank===3&&n.shape[0]!==0){const r=s,o=n.shape[0];s=U(s,[o,s.shape[0]/o,s.shape[1]]),r.dispose()}return s}const rO=G({irfft_:sO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oO(n,t,e=0){const r={x:L(n,"x","split")},o={numOrSizeSplits:t,axis:e};return z.runKernel(sd,r,o)}const Cs=G({split_:oO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iO(n,t){A(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let e=n.shape[n.shape.length-1];const s=n.size/e;let r;if(t!=null&&t<e){const g=n.shape.map(b=>0),x=n.shape.map(b=>b);x[n.shape.length-1]=t,r=Se(n,g,x),e=t}else if(t!=null&&t>e){const g=n.shape.map(x=>x);g[n.shape.length-1]=t-e,r=Kn([n,fn(g)],n.shape.length-1),e=t}else r=n;const o=ne(r),i=U(Ea(r,o),[s,e]),a=Xw(i),l=Math.floor(e/2)+1,u=Sd(a),h=bg(a),d=Cs(u,[l,e-l],u.shape.length-1),f=Cs(h,[l,e-l],h.shape.length-1),m=r.shape.slice();return m[r.shape.length-1]=l,U(Ea(d[0],f[0]),m)}const aO=G({rfft_:iO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lO(n,t){let e=L(n,"a","squaredDifference"),s=L(t,"b","squaredDifference");[e,s]=Ke(e,s),Vt(e.shape,s.shape);const r={a:e,b:s},o={};return z.runKernel(wu,r,o)}const uO=G({squaredDifference_:lO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cO(n,t){const e=L(n,"x","squeeze","string_or_numeric");return U(e,$o(e.shape,t).newShape)}const zu=G({squeeze_:cO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hO(n,t=0){const e=uw(n,"tensors","stack","string_or_numeric");A(e.length>=1,()=>"Pass at least one tensor to tf.stack"),e.length>0&&A(t<=e[0].rank,()=>"Axis must be <= rank of the tensor");const s=e,r={axis:t};return z.runKernel(Hh,s,r)}const Er=G({stack_:hO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dO(n,t=0){const s={x:L(n,"x","step")},r={alpha:t};return z.runKernel(ku,s,r)}const Wu=G({step_:dO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fO(n,t,e,s,r=0,o=0,i=0,a=0,l=0){const h={x:L(n,"x","stridedSlice","string_or_numeric")},d={begin:t,end:e,strides:s,beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};return z.runKernel(Lm,h,d)}const pO=G({stridedSlice_:fO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mO(n){const e={x:L(n,"x","tan","float32")};return z.runKernel(Cu,e)}const gO=G({tan_:mO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jn(n,t){t1(n);const e=gd(n,t);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return xd(n,null,e,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vu(n,t,e){if(t1(n),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=gd(n,e);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return xd(n,t,s,e)}function Yw(n,t,e){const s=t.rank>1?t.shape[t.rank-1]:1,r=t.rank>1?t.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${e.shape}, indices.shape: ${t.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(e.rank<r)throw new Error(o+` update.rank < ${r}. `);if(n.length<s+(e.rank-r))throw new Error(o+` Output shape length < ${s+(e.rank-r)}`);if(e.rank!==r+n.length-s)throw new Error(o+` update.rank != ${r+n.length-s}`);for(let i=0;i<r;++i)if(e.shape[i]!==t.shape[i])throw new Error(o+` updates.shape[${i}] (${e.shape[i]}) != indices.shape[${i}] (${t.shape[i]}).`);for(let i=0;i<e.rank-r;++i)if(e.shape[i+r]!==n[i+s])throw new Error(o+` updates.shape[${i+r}] (${e.shape[i+r]}) != shape[${i+r}] (${n[i+r]})`)}function xO(n,t,e){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(e.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${e}`);if(e.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}Yw(e,t,n)}function Di(n,t,e){const s=t.shape.length,r=s>1?t.shape[s-1]:1,o=e.length;let i=1;for(let d=r;d<o;++d)i*=e[d];const a=r<1?1:r,l=st(t.shape)/a,u=[..._t(e.slice(0,r)),1],h=st(e);return{sliceRank:r,numUpdates:l,sliceSize:i,strides:u,outputSize:h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bO(n,t=1,e=!0){const s=L(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${t}`);const o={x:s},i={k:t,sorted:e},[a,l]=z.runKernel(Pm,o,i);return{values:a,indices:l}}const yO=G({topk_:bO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wO(n,t=0,e=1,s,r){if(qr(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new Bw(t,e,s,!0,r),i=Yt(n,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const Zw=G({truncatedNormal_:wO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vO(n,t=0){const e=L(n,"x","unique","string_or_numeric");A(e.rank>0,()=>"The input tensor must be at least 1D");const s={x:e},r={axis:t},[o,i]=z.runKernel(Bm,s,r);return{values:o,indices:i}}const CO=G({unique_:vO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IO(n,t,e){const s=L(n,"x","unsortedSegmentSum"),r=L(t,"segmentIds","unsortedSegmentSum","int32");A(ya(e),()=>"numSegments must be of dtype int");const o={x:s,segmentIds:r},i={numSegments:e};return z.runKernel(id,o,i)}const Jw=G({unsortedSegmentSum_:IO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $O(n,t=0){const e=L(n,"x","unstack","string_or_numeric");A(t>=-e.shape.length&&t<e.shape.length,()=>`Axis = ${t} is not in [-${e.shape.length}, ${e.shape.length})`);const s={value:e},r={axis:t};return z.runKernel(od,s,r)}const Fi=G({unstack_:$O});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kO(n,t=!0,e,s){return z.makeVariable(n,t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qw(n,t){const e=[];for(let o=0;o<t.length;o++)t[o]&&e.push(o);const s=Yt(n,"int32"),r=Yt([e.length,n.length],"int32");for(let o=0;o<e.length;o++){const i=s.indexToLoc(e[o]),a=o*n.length;r.values.set(i,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SO(n,t,e){const s=L(n,"x","transpose");if(t==null&&(t=s.shape.map((i,a)=>a).reverse()),A(s.rank===t.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${t}.`),t.forEach(i=>{A(i>=0&&i<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${t}`)}),s.rank<=1)return s.clone();const r={x:s},o={perm:t};return s.dtype==="complex64"?X(()=>{let i=Sd(s),a=bg(s);return i=z.runKernel($a,{x:i},o),a=z.runKernel($a,{x:a},o),e&&(a=je(a)),Ea(i,a)}):z.runKernel($a,r,o)}const se=G({transpose_:SO});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NO(n,t){if(t==null)return n.shape.slice();if(he(n.shape,t))return t;if(n.shape.length===t.length){const e=[];for(let s=0;s<n.shape.length;s++)t[s]==null&&n.shape[s]!=null?e.push(n.shape[s]):e.push(t[s]);return e}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TO(n,t,e,s){const r=L(n,"x","dropout");if(A(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),A(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return n instanceof Fe?r.clone():r;const o=NO(r,e),i=1-t,a=Dt(Id(dt(Mu(o,0,1,"float32",s),i)),i);return W(r,a)}const Lg=G({dropout_:TO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EO(n,t,e,s,r,o="NHWC",i){let a=n;n.rank===3&&(a=U(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=t;l.rank===3&&(l=U(t,[1,t.shape[0],t.shape[1],t.shape[2]])),A(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),A(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),A(e.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${e}.`);const u=o==="NHWC"?a.shape[3]:a.shape[1],h=o==="NHWC"?l.shape[3]:l.shape[1];A(u===e[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${e[2]}.`),A(h===e[3],()=>`Error in conv2dDerFilter: depth of dy (${h}) must match output depth for filter (${e[3]}).`),Hn("conv2dDerFilter",r,i);const d={x:a,dy:l},f={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,filterShape:e};return z.runKernel(im,d,f)}const Pg=G({conv2DBackpropFilter_:EO});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mg(n,t,e){if(e==null||e==="linear")return n;if(e==="relu")return W(n,Wu(t));throw new Error(`Cannot compute gradient for fused activation ${e}.`)}function Bg(n,t){let e=t;const s=nn(n.shape,t.shape);return s.length>0&&(e=At(e,s)),U(e,n.shape)}function zg(n,t,e,s){if(t==="linear")return n;if(t==="relu")return Ri(n);if(t==="elu")return wd(n);if(t==="relu6")return Ww(n);if(t==="prelu")return kg(n,e);if(t==="leakyrelu")return yg(n,s);if(t==="sigmoid")return Da(n);throw new Error(`Unknown fused activation ${t}.`)}const Wg=(n,t)=>!(n>0)||t==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _O({x:n,filter:t,strides:e,pad:s,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:h}){if(l=l||"linear",Wg(z.state.gradientDepth,l)===!1){A(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let N=Ti(n,t,e,s,r,o,i);return a!=null&&(N=dt(N,a)),zg(N,l,u,h)}const d=L(n,"x","conv2d","float32"),f=L(t,"filter","conv2d","float32");let m=d,g=!1;d.rank===3&&(g=!0,m=U(d,[1,d.shape[0],d.shape[1],d.shape[2]])),A(m.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${m.rank}.`),A(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),Hn("fused conv2d",s,i);const x=r==="NHWC"?m.shape[3]:m.shape[1];A(f.shape[2]===x,()=>`Error in conv2d: depth of input (${x}) must match input depth for filter ${f.shape[2]}.`),A(Tn(e,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${o}'`);const b=wn(m.shape,f.shape,e,o,s,i);let w;a!=null&&(w=L(a,"bias","fused conv2d"),[w]=Ke(w,d),r==="NHWC"?Vt(b.outShape,w.shape):(A(w.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${w.shape.length}.`),A(w.shape.length===0||w.shape[0]===b.outChannels||w.shape[0]===1,()=>`Error in fused conv2d: bias shape (${w.shape}) is not compatible with the number of output channels (${b.outChannels})`)));let v;if(u!=null){const N=u.shape;if(A(N.length<=1||N.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${N.length}.`),N.length===1)A(N[0]===1||N[0]===b.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${N}) is not compatible with the number of output channels (${b.outChannels}).`);else if(N.length===3)try{Vt(N,b.outShape)}catch{const R=`Error in fused conv2d: PReLU activation weights (${N}) is not compatible with the output shape of the conv2d (${b.outShape}).`;throw Error(R)}v=L(u,"prelu weights","fused conv2d")}const I=(N,T)=>{A(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[R,E,F,P]=T,q=Mg(N,F,l);A(Si(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const j=dg(E.shape,q,R,e,s),K=Pg(E,q,R.shape,e,s),Y=[j,K];if(P!=null){const Q=Bg(P,q);Y.push(Q)}return Y},C={x:m,filter:f,bias:w,preluActivationWeights:v},k={strides:e,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i,activation:l,leakyreluAlpha:h};return a==null?Pa((T,R,E)=>{let F=z.runKernel(ud,C,k);return E([R,T,F]),g&&(F=U(F,[F.shape[1],F.shape[2],F.shape[3]])),{value:F,gradFunc:I}})(m,f):Pa((T,R,E,F)=>{let P=z.runKernel(ud,C,k);return F([R,T,P,E]),g&&(P=U(P,[P.shape[1],P.shape[2],P.shape[3]])),{value:P,gradFunc:I}})(m,f,w)}const RO=G({fusedConv2d_:_O});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AO(n,t,e,s,r,o=[1,1],i){let a=n;n.rank===3&&(a=U(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=t;l.rank===3&&(l=U(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const u={x:a,dy:l},h={strides:s,pad:r,dimRoundingMode:i,dilations:o,filterShape:e};return z.runKernel(fm,u,h)}const DO=G({depthwiseConv2dNativeBackpropFilter_:AO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FO(n,t,e,s,r,o=[1,1],i){let a=t,l=!1;t.rank===3&&(l=!0,a=U(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const u={dy:a,filter:e},h={strides:s,pad:r,dimRoundingMode:i,dilations:o,inputShape:n},d=z.runKernel(pm,u,h);return l?U(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const OO=G({depthwiseConv2dNativeBackpropInput_:FO});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LO({a:n,b:t,transposeA:e=!1,transposeB:s=!1,bias:r,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(Wg(z.state.gradientDepth,o)===!1){let P=de(n,t,e,s);return r!=null&&(P=dt(P,r)),zg(P,o,i,a)}let l=L(n,"a","fused matMul"),u=L(t,"b","fused matMul");[l,u]=Ke(l,u);const h=e?l.shape[l.rank-2]:l.shape[l.rank-1],d=s?u.shape[u.rank-1]:u.shape[u.rank-2],f=e?l.shape[l.rank-1]:l.shape[l.rank-2],m=s?u.shape[u.rank-2]:u.shape[u.rank-1],g=l.shape.slice(0,-2),x=u.shape.slice(0,-2),b=st(g),w=st(x);A(h===d,()=>`Error in fused matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${e} and transposeB=${s} must match.`);const I=Vt(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([f,m]),C=e?U(l,[b,h,f]):U(l,[b,f,h]),k=s?U(u,[w,m,d]):U(u,[w,d,m]);let N;r!=null&&(N=L(r,"bias","fused matMul"),[N]=Ke(N,l),Vt(I,N.shape));let T;i!=null&&(T=L(i,"prelu weights","fused matMul"));const R=(P,q)=>{const[j,K,Y,Q]=q,tt=Mg(U(P,Y.shape),Y,o);let Z,rt;if(!e&&!s?(Z=de(tt,K,!1,!0),rt=de(j,tt,!0,!1)):!e&&s?(Z=de(tt,K,!1,!1),rt=de(tt,j,!0,!1)):e&&!s?(Z=de(K,tt,!1,!0),rt=de(j,tt,!1,!1)):(Z=de(K,tt,!0,!0),rt=de(tt,j,!0,!0)),r!=null){const ut=Bg(Q,tt);return[Z,rt,ut]}else return[Z,rt]},E={a:C,b:k,bias:N,preluActivationWeights:T},F={transposeA:e,transposeB:s,activation:o,leakyreluAlpha:a};return r==null?Pa((q,j,K)=>{const Y=z.runKernel(ld,E,F);return K([q,j,Y]),{value:U(Y,I),gradFunc:R}})(C,k):Pa((q,j,K,Y)=>{const Q=z.runKernel(ld,E,F);return Y([q,j,Q,K]),{value:U(Q,I),gradFunc:R}})(C,k,N)}const tv=G({fusedMatMul_:LO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PO(n,t,e,s,r="bilinear",o=0){const i=L(n,"image","cropAndResize"),a=L(t,"boxes","cropAndResize","float32"),l=L(e,"boxInd","cropAndResize","int32"),u=a.shape[0];A(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),A(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),A(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),A(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),A(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),A(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const h={image:i,boxes:a,boxInd:l},d={method:r,extrapolationValue:o,cropSize:s};return z.runKernel(cm,h,d)}const MO=G({cropAndResize_:PO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BO(n){const t=L(n,"image","flipLeftRight","float32");A(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);const e={image:t};return z.runKernel(vm,e,{})}const zO=G({flipLeftRight_:BO});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WO(n){const t=L(n,"image","grayscaleToRGB"),e=t.rank-1,s=t.shape[e];A(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),A(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(t.rank);return r.fill(1,0,e),r[e]=3,ar(t,r)}const VO=G({grayscaleToRGB_:WO});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UO(n){const t=L(n,"image","RGBToGrayscale"),e=t.rank-1,s=t.shape[e];A(t.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${t.rank}.`),A(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=t.dtype,o=vt(t,"float32"),i=jn([.2989,.587,.114]);let a;switch(t.rank){case 2:a=Fu("ij,j->i",o,i);break;case 3:a=Fu("ijk,k->ij",o,i);break;case 4:a=Fu("ijkl,l->ijk",o,i);break;case 5:a=Fu("ijklm,m->ijkl",o,i);break;case 6:a=Fu("ijklmn,n->ijklm",o,i);break;default:throw new Error("Not a valid tensor rank.")}return a=qn(a,-1),vt(a,r)}const GO=G({rgbToGrayscale_:UO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HO(n,t,e=0,s=.5){const r=L(n,"image","rotateWithOffset","float32");A(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const o={image:r},i={radians:t,fillValue:e,center:s};return z.runKernel(zm,o,i)}const KO=G({rotateWithOffset_:HO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ma(n,t,e,s,r,o){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),o==null&&(o=0);const i=n.shape[0];return e=Math.min(e,i),A(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),A(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),A(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),A(t.rank===1,()=>"scores must be a 1D tensor"),A(t.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${t.shape[0]}`),A(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:e,iouThreshold:s,scoreThreshold:r,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qO(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY){const o=L(n,"boxes","nonMaxSuppression","float32"),i=L(t,"scores","nonMaxSuppression","float32"),a=Ma(o,i,e,s,r);e=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:e,iouThreshold:s,scoreThreshold:r};return z.runKernel(Nm,{boxes:o,scores:i},l)}const jO=G({nonMaxSuppression_:qO});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XO(n,t,e){const s=YO(n,t,e),r=s<0?-(s+1):s;n.splice(r,0,t)}function YO(n,t,e){return JO(n,t,e||ZO)}function ZO(n,t){return n>t?1:n<t?-1:0}function JO(n,t,e){let s=0,r=n.length,o=0,i=!1;for(;s<r;){o=s+(r-s>>>1);const a=e(t,n[o]);a>0?s=o+1:(r=o,i=!a)}return i?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vg(n,t,e,s,r){return Hg(n,t,e,s,r,0)}function Ug(n,t,e,s,r,o){return Hg(n,t,e,s,r,0,!1,o,!0)}function Gg(n,t,e,s,r,o){return Hg(n,t,e,s,r,o,!0)}function Hg(n,t,e,s,r,o,i=!1,a=!1,l=!1){const u=[];for(let b=0;b<t.length;b++)t[b]>r&&u.push({score:t[b],boxIndex:b,suppressBeginIndex:0});u.sort(ev);const h=o>0?-.5/o:0,d=[],f=[];for(;d.length<e&&u.length>0;){const b=u.pop(),{score:w,boxIndex:v,suppressBeginIndex:I}=b;if(w<r)break;let C=!1;for(let k=d.length-1;k>=I;--k){const N=QO(n,v,d[k]);if(N>=s){C=!0;break}if(b.score=b.score*tL(s,h,N),b.score<=r)break}b.suppressBeginIndex=d.length,C||(b.score===w?(d.push(v),f.push(b.score)):b.score>r&&XO(u,b,ev))}const m=d.length,g=e-m;a&&g>0&&(d.push(...new Array(g).fill(0)),f.push(...new Array(g).fill(0)));const x={selectedIndices:d};return i&&(x.selectedScores=f),l&&(x.validOutputs=m),x}function QO(n,t,e){const s=n.subarray(t*4,t*4+4),r=n.subarray(e*4,e*4+4),o=Math.min(s[0],s[2]),i=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),h=Math.min(r[1],r[3]),d=Math.max(r[0],r[2]),f=Math.max(r[1],r[3]),m=(a-o)*(l-i),g=(d-u)*(f-h);if(m<=0||g<=0)return 0;const x=Math.max(o,u),b=Math.max(i,h),w=Math.min(a,d),v=Math.min(l,f),I=Math.max(w-x,0)*Math.max(v-b,0);return I/(m+g-I)}function tL(n,t,e){const s=Math.exp(t*e*e);return e<=n?s:0}function ev(n,t){return n.score-t.score||n.score===t.score&&t.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function eL(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY){const o=L(n,"boxes","nonMaxSuppressionAsync"),i=L(t,"scores","nonMaxSuppressionAsync"),a=Ma(o,i,e,s,r);e=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([o.data(),i.data()]),u=l[0],h=l[1],{selectedIndices:d}=Vg(u,h,e,s,r);return o!==n&&o.dispose(),i!==t&&i.dispose(),jn(d,"int32")}const nL=eL;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sL(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=L(n,"boxes","nonMaxSuppression"),a=L(t,"scores","nonMaxSuppression"),l=Ma(i,a,e,s,r,o);e=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const u={boxes:i,scores:a},h={maxOutputSize:e,iouThreshold:s,scoreThreshold:r,softNmsSigma:o},d=z.runKernel(Em,u,h);return{selectedIndices:d[0],selectedScores:d[1]}}const rL=G({nonMaxSuppressionWithScore_:sL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function oL(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=L(n,"boxes","nonMaxSuppressionAsync"),a=L(t,"scores","nonMaxSuppressionAsync"),l=Ma(i,a,e,s,r,o);e=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const u=await Promise.all([i.data(),a.data()]),h=u[0],d=u[1],{selectedIndices:f,selectedScores:m}=Gg(h,d,e,s,r,o);return i!==n&&i.dispose(),a!==t&&a.dispose(),{selectedIndices:jn(f,"int32"),selectedScores:jn(m)}}const iL=oL;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aL(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=L(n,"boxes","nonMaxSuppression"),a=L(t,"scores","nonMaxSuppression"),l=Ma(i,a,e,s,r,null),u=l.maxOutputSize,h=l.iouThreshold,d=l.scoreThreshold,f={boxes:i,scores:a},m={maxOutputSize:u,iouThreshold:h,scoreThreshold:d,padToMaxOutputSize:o},g=z.runKernel(Tm,f,m);return{selectedIndices:g[0],validOutputs:g[1]}}const lL=G({nonMaxSuppressionPadded_:aL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function uL(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=L(n,"boxes","nonMaxSuppressionAsync"),a=L(t,"scores","nonMaxSuppressionAsync"),l=Ma(i,a,e,s,r,null),u=l.maxOutputSize,h=l.iouThreshold,d=l.scoreThreshold,[f,m]=await Promise.all([i.data(),a.data()]),{selectedIndices:g,validOutputs:x}=Ug(f,m,u,h,d,o);return i!==n&&i.dispose(),a!==t&&a.dispose(),{selectedIndices:jn(g,"int32"),validOutputs:fe(x,"int32")}}const cL=uL;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hL(n,t,e=!1,s=!1){const r=L(n,"images","resizeBilinear");A(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),A(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),A(s===!1||e===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=U(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},l={alignCorners:e,halfPixelCenters:s,size:t},u=z.runKernel(Zh,a,l);return i?U(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const nv=G({resizeBilinear_:hL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dL(n,t,e=!1,s=!1){const r=L(n,"images","resizeNearestNeighbor");A(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),A(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),A(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),A(s===!1||e===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=U(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},l={alignCorners:e,halfPixelCenters:s,size:t},u=z.runKernel(Yh,a,l);return i?U(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const sv=G({resizeNearestNeighbor_:dL});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fL(n,t="binary",e=!1,s=.5){const r=L(n,"image","threshold"),o=.2989,i=.587,a=.114,l=r.shape[0]*r.shape[1];let u=W(jn([s]),255),h,d,f,m;if(A(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),A(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),A(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),A(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),r.shape[2]===3){[h,d,f]=Cs(r,[1,1,1],-1);const b=W(h,o),w=W(d,i),v=W(f,a);m=dt(dt(b,w),v)}else m=n;if(t==="otsu"){const b=hA(vt(Vw(m),"int32"),Qm([]),256);u=pL(b,l)}const g=e?La(m,u):vs(m,u);return vt(W(g,255),"int32")}function pL(n,t){let e=jn([-1]),s=jn([0]),r=jn([0]),o,i,a,l,u,h;for(let d=0;d<n.size-1;d++){o=Se(n,0,d+1),i=Se(n,d+1),u=Dt(At(o),t),h=Dt(At(i),t);const f=At(W(o,Bu(0,o.size)));a=Dt(f,At(o));const m=yd(i.shape,o.size),g=dt(Bu(0,i.size),m),x=W(i,g);l=Dt(At(x),At(i));const b=Ot(a,l),w=Ot(a,l),v=W(u,h);r=W(W(v,b),w);const I=vs(r,s);s=On(I,r,s),e=On(I,jn([d]),e)}return e}const mL=G({threshold_:fL});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gL(n,t,e="nearest",s="constant",r=0,o){const i=L(n,"image","transform","float32"),a=L(t,"transforms","transform","float32");A(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),A(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),A(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const l={image:i,transforms:a},u={interpolation:e,fillMode:s,fillValue:r,outputShape:o};return z.runKernel(Mm,l,u)}const xL=G({transform_:gL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bL(n,t,e){const s=L(n,"a","bandPart");A(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[o,i]=s.shape.slice(-2);let a,l;typeof t=="number"?(A(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),A(t<=o,()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${o}).`),a=L(t<0?o:t,"numLower","bandPart")):(A(t.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=On($d(t,0),o,Lu(t,o))),typeof e=="number"?(A(e%1===0,()=>`bandPart(): numUpper must be an integer, got ${e}.`),A(e<=i,()=>`bandPart(): numUpper (${e}) must not be greater than the number of columns (${i}).`),l=L(e<0?i:e,"numUpper","bandPart")):(A(e.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=On($d(e,0),i,Lu(e,i)));const u=U(Bu(0,o,1,"int32"),[-1,1]),h=Bu(0,i,1,"int32"),d=Ot(u,h),f=Zr(La(d,a),Ei(d,je(l))),m=fn([o,i],s.dtype);return U(Er(Fi(U(s,[-1,o,i])).map(g=>On(f,g,m))),r)}const yL=G({bandPart_:bL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wL(n){let t;if(Array.isArray(n)){t=!1,A(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let o=1;o<n.length;++o)A(n[o].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[o].shape[0]} vs. ${r})`)}else t=!0,n=Cs(n,n.shape[0],0).map(r=>zu(r,[0]));A(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const e=[],s=n;for(let r=0;r<n.length;++r)e.push(z.tidy(()=>{let o=s[r];if(r>0)for(let i=0;i<r;++i){const a=W(At(W(e[i],o)),e[i]);o=Ot(o,a)}return Dt(o,Cd(o,"euclidean"))}));return t?Er(e,0):e}const vL=G({gramSchmidt_:wL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CL(n,t=!1){if(A(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return rv(n,t);{const e=n.shape.slice(0,n.shape.length-2).reduce((l,u)=>l*u),s=Fi(U(n,[e,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],o=[];s.forEach(l=>{const[u,h]=rv(l,t);r.push(u),o.push(h)});const i=U(Er(r,0),n.shape),a=U(Er(o,0),n.shape);return[i,a]}}function rv(n,t=!1){return z.tidy(()=>{A(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const e=n.shape[0],s=n.shape[1];let r=Aw(e),o=ki(n);const i=Vu([[1]],[1,1]);let a=ki(i);const l=e>=s?s:e;for(let u=0;u<l;++u){const h=o,d=a,f=r;[a,o,r]=z.tidy(()=>{const m=Se(o,[u,u],[e-u,1]),g=Cd(m),x=Se(o,[u,u],[1,1]),b=On(vs(x,0),Vu([[-1]]),Vu([[1]])),w=Ot(x,W(b,g)),v=Dt(m,w);v.shape[0]===1?a=ki(i):a=Kn([i,Se(v,[1,0],[v.shape[0]-1,v.shape[1]])],0);const I=je(Dt(de(b,w),g)),C=Se(o,[u,0],[e-u,s]),k=W(I,a),N=se(a);if(u===0)o=Ot(C,de(k,de(N,C)));else{const E=Ot(C,de(k,de(N,C)));o=Kn([Se(o,[0,0],[u,s]),E],0)}const T=se(k),R=Se(r,[0,u],[e,r.shape[1]-u]);if(u===0)r=Ot(R,de(de(R,a),T));else{const E=Ot(R,de(de(R,a),T));r=Kn([Se(r,[0,0],[e,u]),E],1)}return[a,o,r]}),qt([h,d,f])}return!t&&e>s&&(r=Se(r,[0,0],[e,s]),o=Se(o,[0,0],[s,s])),[r,o]})}const IL=G({qr_:CL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jr={flipLeftRight:zO,grayscaleToRGB:VO,resizeNearestNeighbor:sv,resizeBilinear:nv,rgbToGrayscale:GO,rotateWithOffset:KO,cropAndResize:MO,nonMaxSuppression:jO,nonMaxSuppressionAsync:nL,nonMaxSuppressionWithScore:rL,nonMaxSuppressionWithScoreAsync:iL,nonMaxSuppressionPadded:lL,nonMaxSuppressionPaddedAsync:cL,threshold:mL,transform:xL},$L={bandPart:yL,gramSchmidt:vL,qr:IL};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kL=new Map,SL=new Map;class Ba{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class Bs{constructor(){this.classNameMap={}}static getMap(){return Bs.instance==null&&(Bs.instance=new Bs),Bs.instance}static register(t){Bs.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function ct(n,t,e){A(n.className!=null,()=>"Class being registered does not have the static className property defined."),A(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),A(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof t>"u"&&(t="Custom"),typeof e>"u"&&(e=n.className);const s=e,r=t+">"+s;return Bs.register(n),kL.set(r,n),SL.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oo extends Ba{minimize(t,e=!1,s){const{value:r,grads:o}=this.computeGradients(t,s);if(s!=null){const i=s.map(a=>({name:a.name,tensor:o[a.name]}));this.applyGradients(i)}else this.applyGradients(o);return qt(o),e?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return FD(t,e)}dispose(){this.iterations_!=null&&qt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:fe(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(Oo,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ov extends Oo{static get className(){return"Adadelta"}constructor(t,e,s=null){super(),this.learningRate=t,this.rho=e,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=z.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const o=z.registeredVariables[s],i=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:X(()=>ne(o).variable(i))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:X(()=>ne(o).variable(i))});const a=Array.isArray(t)?t[r].tensor:t[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;X(()=>{const h=dt(W(l,this.rho),W(Ae(a),1-this.rho)),d=W(Dt(Ln(dt(u,this.epsilon)),Ln(dt(l,this.epsilon))),a),f=dt(W(u,this.rho),W(Ae(d),1-this.rho));l.assign(h),u.assign(f);const m=dt(W(d,-this.learningRate),o);o.assign(m)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(qt(this.accumulatedGrads.map(t=>t.variable)),qt(this.accumulatedUpdates.map(t=>t.variable)))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=t.length/2,s=!1;this.accumulatedGrads=t.slice(0,e).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=t.slice(e,e*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iv extends Oo{static get className(){return"Adagrad"}constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const o=z.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:X(()=>yd(o.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(t)?t[r].tensor:t[s];if(i==null)return;const a=this.accumulatedGrads[r].variable;X(()=>{const l=dt(a,Ae(i));a.assign(l);const u=dt(W(Dt(i,Ln(dt(l,z.backend.epsilon()))),-this.learningRate),o);o.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&qt(this.accumulatedGrads.map(t=>t.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=!1;this.accumulatedGrads=t.map(s=>({originalName:s.name,variable:s.tensor.variable(e)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class av extends Oo{static get className(){return"Adam"}constructor(t,e,s,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],X(()=>{this.accBeta1=fe(e).variable(),this.accBeta2=fe(s).variable()}),r==null&&(this.epsilon=z.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);X(()=>{const s=Ot(1,this.accBeta1),r=Ot(1,this.accBeta2);e.forEach((o,i)=>{const a=z.registeredVariables[o],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:X(()=>ne(a).variable(l))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${o}/v`,variable:X(()=>ne(a).variable(l))});const u=Array.isArray(t)?t[i].tensor:t[o];if(u==null)return;const h=this.accumulatedFirstMoment[i].variable,d=this.accumulatedSecondMoment[i].variable,f=dt(W(h,this.beta1),W(u,1-this.beta1)),m=dt(W(d,this.beta2),W(Ae(u),1-this.beta2)),g=Dt(f,s),x=Dt(m,r);h.assign(f),d.assign(m);const b=dt(W(Dt(g,dt(Ln(x),this.epsilon)),-this.learningRate),a);a.assign(b)}),this.accBeta1.assign(W(this.accBeta1,this.beta1)),this.accBeta2.assign(W(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&qt(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedSecondMoment!=null&&qt(this.accumulatedSecondMoment.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(t){t=await this.extractIterations(t),X(()=>{this.accBeta1.assign(Oa(this.beta1,this.iterations_+1)),this.accBeta2.assign(Oa(this.beta2,this.iterations_+1))});const e=t.length/2,s=!1;this.accumulatedFirstMoment=t.slice(0,e).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=t.slice(e,e*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lv extends Oo{static get className(){return"Adamax"}constructor(t,e,s,r=null,o=0){super(),this.learningRate=t,this.beta1=e,this.beta2=s,this.epsilon=r,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],X(()=>{this.iteration=fe(0).variable(),this.accBeta1=fe(e).variable()}),r==null&&(this.epsilon=z.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);X(()=>{const s=Ot(1,this.accBeta1),r=Dt(-this.learningRate,dt(W(this.iteration,this.decay),1));e.forEach((o,i)=>{const a=z.registeredVariables[o],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:ne(a).variable(l)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${o}/v`,variable:ne(a).variable(l)});const u=Array.isArray(t)?t[i].tensor:t[o];if(u==null)return;const h=this.accumulatedFirstMoment[i].variable,d=this.accumulatedWeightedInfNorm[i].variable,f=dt(W(h,this.beta1),W(u,1-this.beta1)),m=W(d,this.beta2),g=Fn(u),x=Do(m,g);h.assign(f),d.assign(x);const b=dt(W(Dt(r,s),Dt(f,dt(x,this.epsilon))),a);a.assign(b)}),this.iteration.assign(dt(this.iteration,1)),this.accBeta1.assign(W(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&qt(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedWeightedInfNorm!=null&&qt(this.accumulatedWeightedInfNorm.map(t=>t.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kg extends Oo{static get className(){return"SGD"}constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const o=Array.isArray(t)?t[r].tensor:t[s];if(o==null)return;const i=z.registeredVariables[s];X(()=>{const a=dt(W(this.c,o),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=kr(fe(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(t=await this.extractIterations(t),t.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uv extends Kg{static get className(){return"Momentum"}constructor(t,e,s=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=s,this.accumulations=[],this.m=fe(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const o=z.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:X(()=>ne(o).variable(!1))});const i=this.accumulations[r].variable,a=Array.isArray(t)?t[r].tensor:t[s];a!=null&&X(()=>{let l;const u=dt(W(this.m,i),a);this.useNesterov?l=dt(W(this.c,dt(a,W(u,this.m))),o):l=dt(W(this.c,u),o),i.assign(u),o.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&qt(this.accumulations.map(t=>t.variable))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=!1;this.accumulations=t.map(s=>({originalName:s.name,variable:s.tensor.variable(e)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cv extends Oo{static get className(){return"RMSProp"}constructor(t,e=.9,s=0,r=null,o=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,r==null&&(this.epsilon=z.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const o=z.registeredVariables[s],i=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:X(()=>ne(o).variable(i))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:X(()=>ne(o).variable(i))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:X(()=>ne(o).variable(i))});const a=Array.isArray(t)?t[r].tensor:t[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;X(()=>{const h=dt(W(l,this.decay),W(Ae(a),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[r].variable,f=dt(W(d,this.decay),W(a,1-this.decay)),m=Dt(W(a,this.learningRate),Ln(Ot(h,dt(Ae(f),this.epsilon)))),g=dt(W(u,this.momentum),m);l.assign(h),d.assign(f),u.assign(g);const x=Ot(o,g);o.assign(x)}else{const d=dt(W(l,this.decay),W(Ae(a),1-this.decay)),f=dt(W(u,this.momentum),Dt(W(a,this.learningRate),Ln(dt(d,this.epsilon))));l.assign(d),u.assign(f);const m=Ot(o,f);o.assign(m)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&qt(this.accumulatedMeanSquares.map(t=>t.variable)),this.accumulatedMeanGrads!=null&&this.centered&&qt(this.accumulatedMeanGrads.map(t=>t.variable)),this.accumulatedMoments!=null&&qt(this.accumulatedMoments.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,s=!1;this.accumulatedMeanSquares=t.slice(0,e).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=t.slice(e,e*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=t.slice(e*2,e*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NL=[ov,iv,av,lv,uv,cv,Kg];function TL(){for(const n of NL)ct(n)}function qg(n,t){const e=n.shape.length,s=t.shape.length;if(e<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${e}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[s-1]>e)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[s-1]} vs. ${e}`);if(st(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=t.shape,o=r[r.length-1];let i=1;for(let d=0;d<r.length-1;++d)i*=r[d];const a=n.shape,l=r.slice();l.pop();let u=1;for(let d=o;d<e;++d)u*=a[d],l.push(a[d]);const h=[..._t(n.shape).map(d=>d/u),1].slice(0,o);return[l,i,u,h]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jg=-2,EL=-1;function Xg(n,t,e){const s=n.shape.length;A(s===t.length,()=>`Error in slice${s}D: Length of begin ${t} must match the rank of the array (${s}).`),A(s===e.length,()=>`Error in slice${s}D: Length of size ${e} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)A(t[r]+e[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${t[r]+e[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function _L(n){const t=[];let e=0;for(;n>0;)n&1&&t.push(e),n/=2,e++;return t}function Yg(n,t,e){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((t[r]-n[r])/e[r]);return s}function hv(n,t,e,s){const r=[...n];for(let o=r.length;o<s.length;o++)r.push(1);for(let o=0;o<e;o++)o===0?r[t]=1:(r.splice(t,0,1),r.pop());return r}function dv(n,t,e){return e<=n?e:e-(t-1)}function fv(n,t){const e=[];for(let s=0;s<n;s++)e.push(t+s);return e}function RL(n,t,e,s,r,o,i,a,l){const u=n.length;let h=new Array(u),d=new Array(u),f=new Array(u);if(t.length&&e>0){const m=t[0],g=e+1;h=pv(i,m,g,s,n),d=mv(a,m,g,r,n),f=hv(o,m,g,n)}else for(let m=0;m<u;m++)h[m]=xv(i,s,o,n,m,l),d[m]=bv(a,r,o,n,m,l),f[m]=gv(o,m,l);return{begin:h,end:d,strides:f}}function pv(n,t,e,s,r){const o=[...r],i=fv(e,t);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=0;else{const l=dv(t,e,a);let u=s[l];n&1<<l&&(u=0),o[a]=u}return o}function mv(n,t,e,s,r){const o=[...r],i=fv(e,t);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const l=dv(t,e,a);let u=s[l];n&1<<l&&(u=Number.MAX_SAFE_INTEGER),o[a]=u}for(let a=0;a<o.length;a++){const l=r[a];o[a]<0&&(o[a]+=l),o[a]=mi(0,o[a],r[a])}return o}function gv(n,t,e){let s=n[t];return(e&1<<t||s==null)&&(s=1),s}function xv(n,t,e,s,r,o){let i=t[r];const a=e[r]||1;(n&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const l=s[r];return i<0&&(i+=l),i=mi(0,i,l-1),i}function bv(n,t,e,s,r,o){let i=t[r];const a=e[r]||1;(n&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const l=s[r];return i<0&&(i+=l),a>0?i=mi(0,i,l):i=mi(-1,i,l-1),i}function Zg(n,t,e){let s=e.length;for(let r=0;r<e.length;r++)if(e[r]>1){s=r;break}for(let r=s+1;r<e.length;r++)if(t[r]>0||e[r]!==n[r])return!1;return!0}function Jg(n,t){let e=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)e+=n[s]*t[s];return e}function Td(n,t,e){let s;const r=n.shape.length;typeof t=="number"?s=[t,...new Array(r-1).fill(0)]:t.length<r?s=t.concat(new Array(r-t.length).fill(0)):s=t.slice(),s.forEach(i=>{A(i!==-1,()=>"slice() does not support negative begin indexing.")});let o;return e==null?o=new Array(r).fill(-1):typeof e=="number"?o=[e,...new Array(r-1).fill(-1)]:e.length<r?o=e.concat(new Array(r-e.length).fill(-1)):o=e,o=o.map((i,a)=>i>=0?i:(A(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,o]}function Qg(n,t,e,s,r,o,i,a,l){let u;if(s==null?(u=new Array(t.length),u.fill(1)):u=s,i!=null&&i&i-1)throw new Error("Multiple ellipses in slice is not allowed.");let h=!1;const d={dims:u.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:e.slice(),strides:u.slice(),beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};for(let I=0;I<d.dims;I++)h&&1<<I&a&&d.numAddAxisAfterEllipsis++,1<<I&i&&(h=!0);h||(d.ellipsisMask|=1<<d.dims,d.dims++);const f={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};AL(d,f);let m=!0,g=!0,x=!0;const b=[],w=[];for(let I=0;I<n.length;++I){if(f.strides[I]===0)throw Error(`strides[${I}] must be non-zero`);const C=!!(f.shrinkAxisMask&1<<I),k=n[I];if(k===-1){b.push(C?1:-1);continue}const N=[f.beginMask&1<<I,f.endMask&1<<I],T=[f.strides[I]>0?0:-1,f.strides[I]>0?k:k-1];if(C&&f.strides[I]<=0)throw Error("only stride 1 allowed on non-range indexing.");x=x&&f.strides[I]===1;const R=!!(f.beginMask&1<<I&&f.endMask&1<<I);if(f.beginValid&&f.endValid){if(C){const q=f.begin[I]<0?k+f.begin[I]:f.begin[I];if(f.begin[I]=q,f.end[I]=f.begin[I]+1,q<0||q>=k)throw Error(`slice index ${f.begin[I]} of dimension ${I} out of bounds.`)}else f.begin[I]=yv(f.begin[I],0,f.strides[I],k,N,T),f.end[I]=yv(f.end[I],1,f.strides[I],k,N,T);const P=f.strides[I]===1&&f.begin[I]===0&&f.end[I]===k;m=m&&P,g=g&&(I===0&&f.strides[I]===1||P)}else m=m&&f.strides[I]===1&&R,g=g&&(I===0&&f.strides[I]===1||R);let E,F=!1;if(f.beginValid&&f.endValid?(E=f.end[I]-f.begin[I],F=!0):C?(E=1,F=!0):R&&k>=0&&(f.strides[I]<0?E=-k:E=k,F=!0),F){let P;E===0||E<0!=f.strides[I]<0?P=0:P=Math.trunc(E/f.strides[I])+(E%f.strides[I]!==0?1:0),b.push(P)}else b.push(-1)}for(let I=0;I<f.finalShapeGatherIndices.length;++I){const C=f.finalShapeGatherIndices[I];C>=0?w.push(b[C]):C===jg&&w.push(1)}return{finalShapeSparse:w.filter((I,C)=>f.finalShapeGatherIndices[C]!==jg),finalShape:w,isIdentity:m,sliceDim0:g,isSimpleSlice:x,begin:f.begin,end:f.end,strides:f.strides}}function AL(n,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let e=0;t.beginValid=n.begin!=null,t.endValid=n.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(t.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,t.dims);for(;e<r;e++)t.begin[e]=0,t.end[e]=0,t.strides[e]=1,t.beginMask|=1<<e,t.endMask|=1<<e,t.finalShapeGatherIndices.push(e),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[e]=s}else if(1<<s&n.newAxisMask)t.finalShapeGatherIndices.push(jg),t.finalShapeGatherIndicesSparse.push(-1);else{if(e===t.begin.length)throw Error(`Index out of range using input dim ${e}; input has only ${t.dims} dims, ${t.begin.length}.`);n.begin!=null&&(t.begin[e]=n.begin[s]),n.end!=null&&(t.end[e]=n.end[s]),t.strides[e]=n.strides[s],n.beginMask&1<<s&&(t.beginMask|=1<<e),n.endMask&1<<s&&(t.endMask|=1<<e),n.shrinkAxisMask&1<<s?(t.finalShapeGatherIndices.push(EL),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<e):(t.finalShapeGatherIndices.push(e),t.finalShapeGatherIndicesSparse.push(s)),t.inputShapeGatherIndicesSparse[e]=s,e++}}function yv(n,t,e,s,r,o){if(r[t])return e>0?o[t]:o[t+1&1];{const i=n<0?s+n:n;return i<o[0]?o[0]:i>o[1]?o[1]:i}}var DL=Object.freeze({__proto__:null,assertParamsValid:Xg,computeFlatOffset:Jg,computeOutShape:Yg,getNormalizedAxes:RL,isSliceContinous:Zg,maskToAxes:_L,parseSliceParams:Td,sliceInfo:Qg,startForAxis:xv,startIndicesWithElidedDims:pv,stopForAxis:bv,stopIndicesWithElidedDims:mv,stridesForAxis:gv,stridesWithElidedDims:hv});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FL{static sgd(t){return new Kg(t)}static momentum(t,e,s=!1){return new uv(t,e,s)}static rmsprop(t,e=.9,s=0,r=null,o=!1){return new cv(t,e,s,r,o)}static adam(t=.001,e=.9,s=.999,r=null){return new av(t,e,s,r)}static adadelta(t=.001,e=.95,s=null){return new ov(t,e,s)}static adamax(t=.002,e=.9,s=.999,r=null,o=0){return new lv(t,e,s,r,o)}static adagrad(t,e=.1){return new iv(t,e)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oi=FL;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OL=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n())();function wv(){return new Promise(n=>OL(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tx(n,t){const e=n[0].length;n.forEach((r,o)=>{A(r.length===e,()=>`Error in concat${e}D: rank of tensors[${o}] must be the same as the rank of the rest (${e})`)}),A(t>=0&&t<e,()=>`Error in concat${e}D: axis must be between 0 and ${e-1}.`);const s=n[0];n.forEach((r,o)=>{for(let i=0;i<e;i++)A(i===t||r[i]===s[i],()=>`Error in concat${e}D: Shape of tensors[${o}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${o}.`)})}function _r(n,t){const e=n[0].slice();for(let s=1;s<n.length;s++)e[t]+=n[s][t];return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var lr;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(lr||(lr={}));function vv(n,t,e){let s=new Array;if(e==null&&t==null)return s;if(t==null)for(;s.length<n+e.length;)s.push(-1);else s=t.slice();if(e==null)return s;if(n+e.length!==s.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${n+e.length}, but shape.rank = ${s.length}`);for(let r=1;r<e.length;++r){const o=e[r],i=s[s.length-e.length+r],a=s[i];if(o>=0)if(a>=0){if(a!==o)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${r+n}] = ${o} but shape[${r+n}] = ${a}`)}else s[i]=o}return s}function Cv(n){const t={FIRST_DIM_SIZE:lr.FIRST_DIM_SIZE,VALUE_ROWIDS:lr.VALUE_ROWIDS,ROW_LENGTHS:lr.ROW_LENGTHS,ROW_SPLITS:lr.ROW_SPLITS,ROW_LIMITS:lr.ROW_LIMITS,ROW_STARTS:lr.ROW_STARTS},e=[];for(const s of n)if(s in t)e.push(t[s]);else break;return e}function Iv(n){return n.length===0?0:n[0]===lr.FIRST_DIM_SIZE?n.length-1:n.length}function $v(n,t){if(n==null||t==null)return;const e=n.length,s=t.length;if(e>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${e} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(e,s-1);++r){const o=n[r],i=t[r+1];if(o>=0&&i>=0&&o!==1&&o!==i)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${r-n.length}] = ${o} but ragged tensor input.flatValues.shape[${r-n.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ex=30;function Ed(n){return n<=ex?n:jp(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nx(n,t,e){const s=e*(typeof n=="number"?n:n[0]),r=t*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uu(n,t,e,s=!0){let r=[];if(s)r=r.concat(t.slice(0)),r.push(n[0]/e),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const o=t.length;for(let i=0;i<o;++i)r=r.concat([n[i+1]/t[i],t[i]]);r=r.concat(n.slice(o+1))}return r}function Gu(n,t,e=!0){const s=[];if(e){s.push(t);for(let r=t+1;r<n;++r)r<=2*t?(s.push(r),s.push(r-(t+1))):s.push(r)}else{const r=[],o=[];for(let i=1;i<n;++i)i>=t*2+1||i%2===1?o.push(i):r.push(i);s.push(...r),s.push(0),s.push(...o)}return s}function Hu(n,t,e,s=!0){const r=[];s?r.push(n[0]/e):r.push(n[0]*e);for(let o=1;o<n.length;++o)o<=t.length?s?r.push(t[o-1]*n[o]):r.push(n[o]/t[o-1]):r.push(n[o]);return r}function sx(n,t){const e=[0];for(let s=0;s<t;++s)e.push(n[s][0]);return e}function rx(n,t,e){const s=n.slice(0,1);for(let r=0;r<e;++r)s.push(n[r+1]-t[r][0]-t[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _d=1.7580993408473768,Rd=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ox=.3275911,ix=.254829592,ax=-.284496736,lx=1.421413741,ux=-1.453152027,cx=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qr(n,t){if(n.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${t.length}.`);const e=new Float32Array(n.length*2);for(let s=0;s<e.length;s+=2)e[s]=n[s/2],e[s+1]=t[s/2];return e}function kv(n){const t=new Float32Array(n.length/2),e=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)t[s/2]=n[s],e[s/2]=n[s+1];return{real:t,imag:e}}function Sv(n){const t=Math.ceil(n.length/4),e=new Float32Array(t),s=new Float32Array(t);for(let r=0;r<n.length;r+=4)e[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:e,imag:s}}function Nv(n){const t=Math.floor(n.length/4),e=new Float32Array(t),s=new Float32Array(t);for(let r=2;r<n.length;r+=4)e[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:e,imag:s}}function hx(n,t){const e=n[t*2],s=n[t*2+1];return{real:e,imag:s}}function Tv(n,t,e,s){n[s*2]=t,n[s*2+1]=e}function Ev(n,t){const e=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const o=(t?2:-2)*Math.PI*(r/n);e[r]=Math.cos(o),s[r]=Math.sin(o)}return{real:e,imag:s}}function _v(n,t,e){const s=(e?2:-2)*Math.PI*(n/t),r=Math.cos(s),o=Math.sin(s);return{real:r,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dx="->",LL=/->/g,Rv=",",Av="...";function fx(n,t){n=n.replace(/\s/g,"");const e=(n.length-n.replace(LL,"").length)/dx.length;if(e<1)throw new Error("Equations without an arrow are not supported.");if(e>1)throw new Error(`Equation must contain exactly one arrow ("${dx}").`);const[s,r]=n.split(dx);A(s.indexOf(Av)===-1,()=>`The ellipsis notation ("${Av}") is not supported yet.`);const o=s.split(Rv),i=o.length;if(t!==i)throw new Error(`Expected ${i} input tensors, received ${t}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let f=0;f<r.length;++f){const m=r[f];if(!o.some(g=>g.indexOf(m)!==-1))throw new Error(`Output subscripts contain the label ${m} not present in the input subscripts.`);a.indexOf(m)===-1&&a.push(m)}for(let f=0;f<s.length;++f){const m=s[f];a.indexOf(m)===-1&&m!==Rv&&a.push(m)}const l=new Array(o.length);for(let f=0;f<i;++f){if(new Set(o[f].split("")).size!==o[f].length)throw new Error(`Found duplicate axes in input component ${o[f]}. Support for duplicate axes in input is not implemented yet.`);l[f]=[];for(let m=0;m<o[f].length;++m)l[f].push(a.indexOf(o[f][m]))}const u=a.length,h=r.length,d=[];for(let f=h;f<u;++f)d.push(f);return{allDims:a,summedDims:d,idDims:l}}function px(n,t){let e=new Array(n);e.fill(-1);for(let r=0;r<t.length;++r)e[t[r]]=r;const s=[];for(let r=0;r<n;++r)e[r]===-1&&s.push(r);return e=e.filter(r=>r!==-1),{permutationIndices:e,expandDims:s}}function mx(n,t,e){const s=new Array(n);for(let r=0;r<e.length;++r){const o=e[r].shape;for(let i=0;i<t[r].length;++i)s[t[r][i]]===void 0?s[t[r][i]]=o[i]:A(s[t[r][i]]===o[i],()=>`Expected dimension ${s[t[r][i]]} at axis ${i} of input shaped ${JSON.stringify(o)}, but got dimension ${o[i]}`)}}function gx(n,t){const e=n,s=[];let r=0;n.length===0&&e.push(-1),r=n.length+1;for(let i=0;i<r;++i)s.push([]);const o=[];for(let i=0;i<e.length;++i){const a=e[i],l=PL(t,a);for(const u of l)o.indexOf(u)===-1&&(s[i].push(u),o.push(u))}return{path:e,steps:s}}function xx(n){return n.every((t,e)=>t===e)}function PL(n,t){const e=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(t)!==-1||t===-1)&&e.push(s);return e}function bx(n,t,e=0){let s=[];if(typeof t=="number")A(n.shape[e]%t===0,()=>"Number of splits must evenly divide the axis."),s=new Array(t).fill(n.shape[e]/t);else{const r=t.reduce((i,a)=>(a===-1&&(i+=1),i),0);A(r<=1,()=>"There should be only one negative value in split array.");const o=t.indexOf(-1);if(o!==-1){const i=t.reduce((a,l)=>l>0?a+l:a);t[o]=n.shape[e]-i}A(n.shape[e]===t.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),s=t}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dv(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function Fv(n,t){return`indices(${n}, 0) is invalid: ${t} < 0`}function Ov(n,t,e){return`indices(${n}, 0) is invalid: ${t} >= ${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lv(n,t){return`only one output dimension may be -1, not both ${n} and ${t}`}function Pv(n,t){return`size ${n} must be non-negative, not ${t}`}function Mv(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Bv(n,t){const e=st(n),s=st(t);return`Input to reshape is a SparseTensor with ${e}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${t}`}function zv(n,t){const e=st(n),s=st(t);return`Input to reshape is a tensor with ${e} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yx(){return"segment ids must be >= 0"}function Wv(){return"segment ids are not increasing"}function Vv(n,t){return`Segment id ${n} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function Uv(n,t,e){return`Bad: indices[${n}] == ${t} out of range [0, ${e})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gv(n,t){let e=!1,s;for(n<=ex?(s=n,e=!0):s=jp(n,Math.floor(Math.sqrt(n)));!e;)s>t||s===n?e=!0:s=jp(n,s+1);return s}function Hv(n,t,e){const s=[],r=n.length;for(let o=0;o<r;o++)o!==t?s.push(n[o]):s.push(e);return s}function wx(n,t,e,s){const r=t.shape.length,o=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>o)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${o}).`);if(e<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${e}).`);for(let d=0;d<s;++d)if(n.shape[d]!==t.shape[d])throw new Error(`x.shape[${d}]: ${n.shape[d]} should be equal to indices.shape[${d}]: ${t.shape[d]}.`);const i=n.shape[e],a=[];let l=1,u=1,h=1;for(let d=0;d<s;++d)a.push(n.shape[d]),l*=n.shape[d];for(let d=s;d<e;d++)a.push(n.shape[d]),u*=n.shape[d];for(let d=s;d<r;d++)a.push(t.shape[d]);for(let d=e+1;d<o;d++)a.push(n.shape[d]),h*=n.shape[d];return{batchSize:l,sliceSize:h,outerSize:u,dimSize:i,outputShape:a}}var ML=Object.freeze({__proto__:null,collectGatherOpShapeInfo:wx,computeOutShape:Hv,segOpComputeOptimalWindowSize:Gv});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function to(n){try{return n.map(t=>To(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function Kv(n){return n.map(t=>No(t))}var BL=Object.freeze({__proto__:null,ERF_A1:ix,ERF_A2:ax,ERF_A3:lx,ERF_A4:ux,ERF_A5:cx,ERF_P:ox,PARALLELIZE_THRESHOLD:ex,get RowPartitionType(){return lr},SELU_SCALE:Rd,SELU_SCALEALPHA:_d,applyActivation:zg,assertAndGetBroadcastShape:Vt,assertAxesAreInnerMostDims:vn,assertParamsConsistent:tx,assignToTypedArray:Tv,axesAreInnerMostDims:gg,calculateShapes:Di,checkEinsumDimSizes:mx,checkPadOnDimRoundingMode:Hn,combineLocations:_w,combineRaggedTensorToTensorShapes:vv,complexWithEvenIndex:Sv,complexWithOddIndex:Nv,computeConv2DInfo:wn,computeConv3DInfo:Ro,computeDefaultPad:ag,computeDilation2DInfo:_u,computeOptimalWindowSize:Ed,computeOutAndReduceShapes:dn,computeOutShape:_r,computePool2DInfo:Ps,computePool3DInfo:Xr,convertConv2DDataFormat:Yr,decodeEinsumEquation:fx,eitherStridesOrDilationsAreOne:Tn,expandShapeToKeepDim:Je,exponent:_v,exponents:Ev,fromStringArrayToUint8:Kv,fromUint8ToStringArray:to,getAxesPermutation:Be,getBroadcastDims:Fa,getComplexWithIndex:hx,getEinsumComputePath:gx,getEinsumPermutation:px,getFusedBiasGradient:Bg,getFusedDyActivation:Mg,getImageCenter:nx,getInnerMostAxes:qe,getPermuted:Gu,getRaggedRank:Iv,getReductionAxes:nn,getReshaped:Uu,getReshapedPermuted:Hu,getRowPartitionTypesHelper:Cv,getSliceBeginCoords:sx,getSliceSize:rx,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Dv,getSparseFillEmptyRowsNegativeIndexErrorMessage:Fv,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Ov,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Mv,getSparseReshapeInputOutputMismatchErrorMessage:zv,getSparseReshapeInputOutputMultipleErrorMessage:Bv,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Lv,getSparseReshapeNegativeOutputDimErrorMessage:Pv,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Uv,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:yx,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Wv,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Vv,getUndoAxesPermutation:Ao,isIdentityPermutation:xx,log:y_,mergeRealAndImagArrays:Qr,prepareAndValidate:qg,prepareSplitSize:bx,segment_util:ML,shouldFuse:Wg,slice_util:DL,splitRealAndImagArrays:kv,stridesOrDilationsArePositive:Ni,tupleValuesAreOne:Si,upcastType:us,validateDefaultValueShape:$v,validateInput:xO,validateUpdateShape:Yw,warn:bs});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */TL();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qv={kernelName:lh,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>W(n,Wu(vt(e,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zL={kernelName:Rl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=Ae(vt(e,"float32")),r=Ln(Ot(fe(1),s));return je(Dt(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WL={kernelName:Al,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=Ln(Ot(Ae(vt(e,"float32")),1));return Dt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VL={kernelName:Ia,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=Vt(e.shape,s.shape);return{a:()=>{let a=n;const l=nn(e.shape,r);return l.length>0&&(a=At(a,l)),U(a,e.shape)},b:()=>{let a=n;const l=nn(s.shape,r);return l.length>0&&(a=At(a,l)),U(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UL={kernelName:Jp,saveAllInputs:!0,gradFunc:(n,t)=>{const e={};return t.forEach((s,r)=>{e[r]=()=>n.clone()}),e}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GL={kernelName:uh,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ne(e)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HL={kernelName:ch,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>ne(e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KL={kernelName:Dl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Dt(n,Ln(Ot(fe(1),Ae(vt(e,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qL={kernelName:Fl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=Ln(dt(fe(1),Ae(vt(e,"float32"))));return Dt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jL={kernelName:Pl,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=Vt(e.shape,s.shape);return{a:()=>{const a=dt(Ae(e),Ae(s));let l=W(n,Dt(s,a));const u=nn(e.shape,r);return u.length>0&&(l=At(l,u)),U(l,e.shape)},b:()=>{const a=dt(Ae(e),Ae(s));let l=je(W(n,Dt(e,a)));const u=nn(s.shape,r);return u.length>0&&(l=At(l,u)),U(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XL={kernelName:Ol,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Dt(n,dt(Ae(vt(e,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YL={kernelName:Ll,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Dt(n,Ot(fe(1),Ae(vt(e,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZL(n,t,e,s,r,o){const i=L(n,"dy","avgPool3dGrad"),a=L(t,"input","avgPool3dGrad");let l=i,u=a,h=!1;a.rank===4&&(h=!0,l=U(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),u=U(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),A(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),A(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),Hn("avgPool3dGrad",r,o);const d={dy:l,input:u},f={filterSize:e,strides:s,pad:r,dimRoundingMode:o},m=z.runKernel(nm,d,f);return h?U(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const JL=G({avgPool3dGrad_:ZL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QL={kernelName:dh,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{filterSize:r,strides:o,pad:i,dimRoundingMode:a}=e;return{x:()=>JL(n,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tP(n,t,e,s,r){const o=L(n,"dy","avgPoolGrad"),i=L(t,"input","avgPoolGrad");A(i.rank===o.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${o.rank})`);let a=i,l=o,u=!1;i.rank===3&&(u=!0,a=U(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=U(o,[1,o.shape[0],o.shape[1],o.shape[2]])),A(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),A(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const h={dy:l,input:a},d={filterSize:e,strides:s,pad:r},f=z.runKernel(em,h,d);return u?U(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const eP=G({avgPoolGrad_:tP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nP={kernelName:hh,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{filterSize:r,strides:o,pad:i}=e;return{x:()=>eP(n,s,r,o,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sP={kernelName:fh,inputsToSave:["a","b"],gradFunc:(n,t,e)=>{const[s,r]=t,{transposeA:o,transposeB:i}=e;return!o&&!i?{a:()=>de(n,r,!1,!0),b:()=>de(s,n,!0,!1)}:!o&&i?{a:()=>de(n,r,!1,!1),b:()=>de(n,s,!0,!1)}:o&&!i?{a:()=>de(r,n,!1,!0),b:()=>de(s,n,!1,!1)}:{a:()=>de(r,n,!0,!0),b:()=>de(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rP={kernelName:ph,gradFunc:(n,t,e)=>{const{blockShape:s,crops:r}=e;return{x:()=>$g(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oP={kernelName:m_,gradFunc:(n,t,e)=>{const s=e,r=s.inputShape,o=s.shape,i=Array.from(o);for(let l=r.length-1;l>=0;l--)if(r[l]===o[l])i[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${o}].`);const a=[];for(let l=0;l<i.length;l++)i[l]>1&&a.push(l);return{x:()=>At(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iP={kernelName:Ml,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aP={kernelName:Bl,gradFunc:n=>({x:()=>ne(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lP={kernelName:zl,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{clipValueMin:r,clipValueMax:o}=e;return{x:()=>On(Zr(Ei(s,r),La(s,o)),n,ne(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uP={kernelName:mh,inputsToSave:["x"],gradFunc:qv.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cP={kernelName:gh,saveAllInputs:!0,gradFunc:(n,t,e)=>{const s=t.map(l=>l.shape),{axis:r}=e,o=Xt(r,t[0].shape)[0],i=s.map(l=>l[o]);return Cs(n,i,o).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hP={kernelName:xh,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const[s,r]=t,{dilations:o,strides:i,pad:a,dataFormat:l}=e;return A(Si(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>dg(s.shape,n,r,i,a,l),filter:()=>Pg(s,n,r.shape,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dP={kernelName:bh,inputsToSave:["dy","filter"],gradFunc:(n,t,e)=>{const[s,r]=t,{strides:o,pad:i,dataFormat:a,dimRoundingMode:l}=e;return{dy:()=>Ti(n,r,o,i,a,1,l),filter:()=>Pg(n,s,r.shape,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fP(n,t,e,s,r){let o=n;n.rank===4&&(o=U(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let i=t;i.rank===4&&(i=U(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),A(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),A(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),A(e.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${e}.`),A(o.shape[4]===e[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${e[3]}.`),A(i.shape[4]===e[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${e[4]}).`);const a={x:o,dy:i},l={strides:s,pad:r,filterShape:e};return z.runKernel(am,a,l)}const pP=G({conv3DBackpropFilter_:fP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mP={kernelName:yh,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const{dilations:s,strides:r,pad:o}=e;A(Si(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[i,a]=t;return{x:()=>Sw(i.shape,n,a,r,o),filter:()=>pP(i,n,a.shape,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gP={kernelName:Wl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>W(je(Kw(vt(e,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xP={kernelName:Vl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>W(qw(vt(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bP={kernelName:wh,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{axis:r,exclusive:o,reverse:i}=e;return{x:()=>{const a=Be([r],s.rank);let l=Tw(n,r,o,!i);return a!=null&&(l=se(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yP={kernelName:vh,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const{dilations:s,strides:r,pad:o,dimRoundingMode:i}=e,a=s??[1,1];A(Si(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=t;return A(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),A(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),A(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),A(Tn(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Hn("depthwiseConv2d",o,i),{x:()=>OO(l.shape,n,u,r,o,a,i),filter:()=>DO(l,n,u.shape,r,o,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wP={kernelName:Ch,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const[s,r]=t,o={x:s,filter:r,dy:n},i={x:s,filter:r,dy:n};return{x:()=>z.runKernel(mm,o,e),filter:()=>z.runKernel(gm,i,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vP={kernelName:Gl,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t,s={dy:n,y:e};return{x:()=>z.runKernel(bm,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CP={kernelName:Hl,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t,s=W(Nr(je(Ae(e))),2/Math.sqrt(Math.PI));return{x:()=>W(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IP={kernelName:Kl,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>W(n,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $P={kernelName:$h,inputsToSave:["input"],gradFunc:(n,t)=>{const[e]=t;return{input:()=>U(n,e.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kP={kernelName:ql,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>W(n,Nr(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SP={kernelName:jl,gradFunc:n=>({x:()=>ne(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NP={kernelName:Xl,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=Vt(e.shape,s.shape);return{a:()=>{const a=Dt(n,vt(s,"float32")),l=nn(e.shape,r);return l.length>0?U(At(a,l),e.shape):a},b:()=>{let a=W(n,vt(e,"float32"));const l=nn(s.shape,r);l.length>0&&(a=U(At(a,l),s.shape));const u=Ae(s);return je(Dt(a,vt(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TP={kernelName:kh,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,t,e)=>{const{varianceEpsilon:s}=e,[r,o,i,a]=t,l=a??fe(1),u=nn(o.shape,r.shape),h=[];if(o.rank===1){for(let C=0;C<r.shape.length-1;++C)h.push(r.shape[C]);h.push(1)}const d=Ot(r,o),f=W(n,l),m=Uw(dt(i,fe(s))),g=W(W(W(m,m),m),fe(-.5));return{x:()=>o.rank===1?U(W(W(n,ar(U(m,[1,1,1,o.shape[0]]),h)),l),r.shape):U(W(W(n,m),l),r.shape),mean:()=>{let C=W(W(m,fe(-1)),f);return o.rank===1&&(C=At(C,u)),U(C,o.shape)},variance:()=>{let C=W(W(g,d),f);return o.rank===1&&(C=At(C,u)),U(C,o.shape)},scale:()=>{const C=W(d,m);let k=W(n,C);return o.rank===1&&(k=At(k,u)),U(k,o.shape)},offset:()=>{let C=n;return o.rank===1&&(C=At(C,u)),U(C,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EP={kernelName:Sh,inputsToSave:["x","indices"],gradFunc:(n,t,e)=>{const[s,r]=t,{axis:o,batchDims:i}=e,a=Xt(o,s.shape)[0],l=(u,h,d)=>()=>{const f=u.shape,m=h.size,g=f.slice(0,a),x=g.length,b=f.slice(o,f.length).slice(1),w=b.length,v=jv(0,x),I=jv(x+1,x+1+w),C=Xv([g,[m],b]),k=U(d,C),N=U(h,[m]),T=Xv([[x],v,I]),R=se(k,T);let E=Jw(R,N,u.shape[a]);const F=Ao(T);return E=se(E,F),E};if(i===1){const u=s.shape[0],h=s.split(u,0);return{x:()=>Er(h.map((m,g)=>l(m,r.slice(g,1),n.slice(g,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,n),indices:()=>r}}};function jv(n,t){const e=[];for(let s=n;s<t;++s)e.push(s);return e}function Xv(n){const t=[];for(let e=0;e<n.length;++e)for(let s=0;s<n[e].length;++s)t.push(n[e][s]);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _P={kernelName:Yl,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t;return{a:()=>ne(e),b:()=>ne(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RP={kernelName:Zl,gradFunc:n=>({x:()=>vt(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AP={kernelName:Jl,gradFunc:n=>({x:()=>ne(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DP={kernelName:Ql,gradFunc:n=>({x:()=>ne(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FP={kernelName:tu,gradFunc:n=>({x:()=>ne(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OP={kernelName:Th,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{alpha:r}=e,o=vs(s,0);return{x:()=>On(o,n,W(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LP={kernelName:nu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Dt(n,dt(e,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PP={kernelName:eu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Dt(n,vt(e,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MP={kernelName:x_,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s]=t,{axis:r}=e;return{logits:()=>{const i=Nr(s);return Ot(n,W(At(n,r,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BP(n,t,e,s=5,r=1,o=1,i=.5){const a={x:n,y:t,dy:e},l={depthRadius:s,bias:r,alpha:o,beta:i};return z.runKernel($m,a,l)}const zP=G({localResponseNormalizationBackprop_:BP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WP={kernelName:Fh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s,r]=t,{depthRadius:o,bias:i,alpha:a,beta:l}=e;return{x:()=>zP(s,r,n,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yv(n,t,e,s){return t.rank<e.rank&&(t=U(t,Je(t.shape,s))),n.rank<e.rank&&(n=U(n,Je(n.shape,s))),{x:()=>W(n,vt(Sr(e,t),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zv={kernelName:Oh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const s=e,{reductionIndices:r}=s,o=t[0],i=t[1],a=Xt(r,o.shape),l=Yv(n,i,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VP={kernelName:su,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t;return{a:()=>W(n,vt(Ei(e,s),"float32")),b:()=>W(n,vt($d(e,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UP(n,t,e,s,r,o,i){const a=L(n,"dy","maxPool3dGrad"),l=L(t,"input","maxPool3dGrad"),u=L(e,"output","maxPool3dGrad");let h=a,d=l,f=u,m=!1;l.rank===4&&(m=!0,h=U(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=U(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),f=U(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),A(h.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${h.rank}.`),A(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),A(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),Hn("maxPool3dGrad",o,i);const g={dy:h,input:d,output:f},x={filterSize:s,strides:r,pad:o,dimRoundingMode:i},b=z.runKernel(Sm,g,x);return m?U(b,[b.shape[1],b.shape[2],b.shape[3],b.shape[4]]):b}const GP=G({maxPool3dGrad_:UP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HP={kernelName:Ph,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s,r]=t,{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=e;return{x:()=>GP(n,s,r,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KP(n,t,e,s,r,o,i){const a=L(n,"dy","maxPoolGrad"),l=L(t,"input","maxPoolGrad"),u=L(e,"output","maxPoolGrad");A(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),A(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),A(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Hn("maxPoolGrad",o,i);const h={dy:a,input:l,output:u},d={filterSize:s,strides:r,pad:o,dimRoundingMode:i};return z.runKernel(km,h,d)}const qP=G({maxPoolGrad_:KP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jP={kernelName:Lh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s,r]=t,{filterSize:o,strides:i,pad:a}=e;return{x:()=>qP(n,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XP={kernelName:Mh,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{axis:r}=e,o=Xt(r,s.shape),a=dn(s.shape,o)[1],l=st(a);return{x:()=>{const h=s.shape.slice();o.forEach(m=>{h[m]=1});const d=U(n,h);return Dt(W(d,Fo(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YP={kernelName:Bh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const s=e,{axis:r}=s,[o,i]=t,a=Xt(r,o.shape),l=Yv(n,i,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZP={kernelName:ru,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t;return{a:()=>W(n,vt(La(e,s),"float32")),b:()=>W(n,vt(vs(e,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JP={kernelName:zh,inputsToSave:["x"],gradFunc:(n,t,e)=>{const s=t[0],{paddings:r}=e,o=r.map(i=>i[0]);return{x:()=>Se(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QP={kernelName:ou,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=Vt(e.shape,s.shape);return{a:()=>{const a=nn(e.shape,r);return a.length>0?U(At(n,a),e.shape):n},b:()=>{const a=W(n,je(Id(Dt(e,s)))),l=nn(s.shape,r);return l.length>0?U(At(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tM={kernelName:iu,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=Vt(e.shape,s.shape);return{a:()=>{const a=W(n,vt(s,"float32")),l=nn(e.shape,r);return l.length>0?U(At(a,l),e.shape):a},b:()=>{const a=W(n,vt(e,"float32")),l=nn(s.shape,r);return l.length>0?U(At(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eM={kernelName:Wh,gradFunc:n=>({x:()=>je(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nM={kernelName:Gh,inputsToSave:["indices"],gradFunc:(n,t)=>{const e=t[0];return{indices:()=>fn(e.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sM={kernelName:Uh,gradFunc:n=>({x:()=>ne(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rM={kernelName:Hh,saveAllInputs:!0,gradFunc:(n,t,e)=>{const{axis:s}=e;return Fi(n,s).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jv={kernelName:Kh,inputsToSave:["x"],gradFunc:(n,t,e)=>{const s=t[0],{paddings:r}=e,o=r.map(i=>i[0]);return{x:()=>Se(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oM={kernelName:au,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,t)=>{const[e,s,r]=t,o=e,i=s,a=Vt(o.shape,i.shape);return{a:()=>{const h=vt(i,"float32");let d=W(n,W(h,Oa(o,Ot(h,fe(1)))));const f=nn(o.shape,a);return f.length>0&&(d=At(d,f)),U(d,o.shape)},b:()=>{const h=vs(o,0),d=On(h,Tr(o),ne(o));let f=W(n,W(r,d));const m=nn(i.shape,a);return m.length>0&&(f=At(f,m)),U(f,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iM={kernelName:qh,inputsToSave:["x","alpha"],gradFunc:(n,t)=>{const[e,s]=t,r=vs(e,0);return{x:()=>On(r,n,W(n,s)),alpha:()=>{let o=On(r,ne(n),W(n,e));const i=nn(s.shape,n.shape);return i.length>0&&(o=At(o,i)),U(o,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aM(n,t,e){const s=n.shape.slice();s[e]=1;const r=U(t,s),o=pg(n,e,!0,!1),i=pg(n,e,!0,!0),a=W(o,i);return W(r,a)}function lM(n,t,e){const s=n.shape.length,r=s-e.length,o=Be(e,s);let i=n;o!=null&&(i=se(n,o));const a=i.shape.slice(),u=a.splice(s-e.length,e.length).reduce((f,m)=>f*m,1);a.push(u);const h=i.reshape(a);let d=aM(h,t,r);if(d=d.reshape(i.shape),o!=null){const f=Ao(o);d=se(d,f)}return d}const uM={kernelName:jh,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{axis:r}=e;let o=[];return r==null?o=s.shape.map((i,a)=>a):typeof r=="number"?o=[r]:o=r,{x:()=>lM(s,n,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cM={kernelName:Ul,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=Vt(e.shape,s.shape);return{a:()=>{const a=Dt(n,vt(s,"float32")),l=nn(e.shape,r);return l.length>0?U(At(a,l),e.shape):a},b:()=>{let a=W(n,vt(e,"float32"));const l=nn(s.shape,r);l.length>0&&(a=U(At(a,l),s.shape));const u=Ae(s);return je(Dt(a,vt(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hM={kernelName:lu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Dt(n,je(Ae(e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dM={kernelName:cu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t,s=W(La(e,6),Wu(e));return{x:()=>W(n,vt(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fM={kernelName:uu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>W(n,vt(Wu(e),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pM={kernelName:Xh,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>U(n,e.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mM={kernelName:Zh,inputsToSave:["images"],gradFunc:(n,t,e)=>{const[s]=t,r={dy:n,images:s};return{images:()=>z.runKernel(Dm,r,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gM={kernelName:Yh,inputsToSave:["images"],gradFunc:(n,t,e)=>{const[s]=t,r={dy:n,images:s};return{images:()=>z.runKernel(Am,r,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xM={kernelName:Jh,gradFunc:(n,t,e)=>{const{dims:s}=e,r=Xt(s,n.shape);return{x:()=>Ai(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bM={kernelName:hu,gradFunc:n=>({x:()=>ne(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yM={kernelName:du,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>je(Dt(n,W(Oa(e,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wM={kernelName:Qh,inputsToSave:["condition"],gradFunc:(n,t)=>{const[e]=t;return{condition:()=>vt(ne(e),"float32"),t:()=>W(n,vt(e,n.dtype)),e:()=>W(n,vt(wg(e),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vM={kernelName:fu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=vs(e,fe(0)),r=fe(_d),o=fe(Rd),i=W(n,o),a=W(W(n,r),Nr(vt(e,"float32")));return On(s,i,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CM={kernelName:xu,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>W(n,W(e,Ot(fe(1),e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IM={kernelName:gu,gradFunc:n=>({x:()=>ne(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $M={kernelName:pu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>W(fg(vt(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kM={kernelName:mu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>W(Nw(vt(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SM={kernelName:td,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{begin:r,size:o}=e,i=s.shape,[a,l]=Td(s,r,o),u=[];for(let h=0;h<n.rank;h++)u.push([a[h],i[h]-a[h]-l[h]]);return{x:()=>Ig(n,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NM={kernelName:rd,outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s]=t,{dim:r}=e,o=!0,i=W(n,s);return{logits:()=>Ot(i,W(At(i,[r],o),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TM={kernelName:bu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>W(n,Da(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qv={kernelName:nd,gradFunc:(n,t,e)=>{const{blockShape:s,paddings:r}=e;return{x:()=>hg(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tC={kernelName:sd,gradFunc:(n,t,e)=>{const{axis:s}=e;return{x:()=>Kn(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EM={kernelName:yu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Dt(n,W(Ln(vt(e,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _M={kernelName:Fm,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>W(n,W(vt(e,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RM={kernelName:wu,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=fe(2);return{a:()=>W(n,W(r,Ot(e,s))),b:()=>W(n,W(r,Ot(s,e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AM={kernelName:ku,gradFunc:n=>({x:()=>ne(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DM={kernelName:vu,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=Vt(e.shape,s.shape);return{a:()=>{let a=n;const l=nn(e.shape,r);return l.length>0&&(a=At(a,l)),U(a,e.shape)},b:()=>{let a=n;const l=nn(s.shape,r);return l.length>0&&(a=At(a,l)),U(je(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FM={kernelName:ed,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,r=s.shape.slice(),{axis:o}=e;Xt(o,s.shape).forEach(u=>{r[u]=1});const a=U(n,r),l=W(a,Fo(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OM={kernelName:Cu,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Dt(n,Ae(fg(e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LM={kernelName:Iu,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>W(Ot(fe(1),Ae(e)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PM={kernelName:$u,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{reps:r}=e;return{x:()=>{let i=ne(s);if(s.rank===1)for(let a=0;a<r[0];++a)i=dt(i,Se(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)i=dt(i,Se(n,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)i=dt(i,Se(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)for(let h=0;h<r[3];++h)i=dt(i,Se(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2],h*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MM={kernelName:$a,gradFunc:(n,t,e)=>{const s=e,{perm:r}=s,o=Ao(r);return{x:()=>se(n,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BM={kernelName:od,gradFunc:(n,t,e)=>{const s=e,{axis:r}=s;return{value:()=>Er(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zM={kernelName:id,inputsToSave:["segmentIds"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>WM(n,e)}}};function WM(n,t){const e=Do(t,ne(t)),s=xg(n,e);let r=Ei(t,fe(0,"int32"));const o=s.rank-r.rank;for(let a=0;a<o;++a)r=qn(r,a+1);r=Zr(r,Fo(s.shape,"bool"));const i=ne(s);return On(r,s,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VM={kernelName:ad,gradFunc:n=>({x:()=>ne(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UM=[qv,zL,WL,VL,UL,GL,HL,KL,qL,jL,XL,YL,QL,nP,sP,rP,oP,iP,aP,lP,uP,cP,dP,hP,mP,gP,xP,bP,yP,wP,cM,vP,CP,IP,$P,kP,NP,SP,TP,EP,_P,RP,AP,DP,FP,OP,LP,PP,MP,WP,Zv,Zv,VP,HP,jP,XP,YP,ZP,JP,QP,tM,eM,nM,sM,rM,Jv,Jv,oM,iM,uM,hM,dM,fM,pM,mM,gM,xM,bM,yM,wM,vM,CM,IM,$M,kM,SM,NM,TM,Qv,Qv,tC,tC,EM,RM,_M,AM,DM,FM,OM,LM,PM,MM,BM,zM,VM];for(const n of UM)w_(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.abs=function(){return this.throwIfDisposed(),Fn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.acos=function(){return this.throwIfDisposed(),$R(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.acosh=function(){return this.throwIfDisposed(),SR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.add=function(n){return this.throwIfDisposed(),dt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.all=function(n,t){return this.throwIfDisposed(),Iw(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.any=function(n,t){return this.throwIfDisposed(),ig(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.argMax=function(n){return this.throwIfDisposed(),Eu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.argMin=function(n){return this.throwIfDisposed(),RR(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.asScalar=function(){return this.throwIfDisposed(),A(this.size===1,()=>"The array must have only 1 element."),U(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.asType=function(n){return this.throwIfDisposed(),vt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.as1D=function(){return this.throwIfDisposed(),U(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.as2D=function(n,t){return this.throwIfDisposed(),U(this,[n,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.as3D=function(n,t,e){return this.throwIfDisposed(),U(this,[n,t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.as4D=function(n,t,e,s){return this.throwIfDisposed(),U(this,[n,t,e,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.as5D=function(n,t,e,s,r){return this.throwIfDisposed(),U(this,[n,t,e,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.asin=function(){return this.throwIfDisposed(),DR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.asinh=function(){return this.throwIfDisposed(),OR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.atan=function(){return this.throwIfDisposed(),PR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.atan2=function(n){return this.throwIfDisposed(),BR(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.atanh=function(){return this.throwIfDisposed(),WR(this)},nt().prototype.avgPool=function(n,t,e,s){return this.throwIfDisposed(),ug(this,n,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.batchToSpaceND=function(n,t){return this.throwIfDisposed(),hg(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.batchNorm=function(n,t,e,s,r){return this.throwIfDisposed(),bd(this,n,t,e,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Du(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.cast=function(n){return this.throwIfDisposed(),vt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.ceil=function(){return this.throwIfDisposed(),pA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.clipByValue=function(n,t){return this.throwIfDisposed(),ws(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.concat=function(n,t){return this.throwIfDisposed(),n instanceof Fe&&(n=[n]),Kn([this,...n],t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.conv1d=function(n,t,e,s,r,o){return this.throwIfDisposed(),$w(this,n,t,e,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.conv2dTranspose=function(n,t,e,s,r){return this.throwIfDisposed(),kw(this,n,t,e,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.conv2d=function(n,t,e,s,r,o){return this.throwIfDisposed(),Ti(this,n,t,e,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.cos=function(){return this.throwIfDisposed(),fg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.cosh=function(){return this.throwIfDisposed(),Nw(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.cumprod=function(n,t,e){return this.throwIfDisposed(),pg(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.cumsum=function(n,t,e){return this.throwIfDisposed(),Tw(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.depthToSpace=function(n,t){return this.throwIfDisposed(),BA(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.depthwiseConv2d=function(n,t,e,s,r,o){return this.throwIfDisposed(),mg(this,n,t,e,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.dilation2d=function(n,t,e,s,r){return this.throwIfDisposed(),VA(this,n,t,e,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.divNoNan=function(n){return this.throwIfDisposed(),qA(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.div=function(n){return this.throwIfDisposed(),Dt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.dot=function(n){return this.throwIfDisposed(),XA(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.elu=function(){return this.throwIfDisposed(),wd(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.equal=function(n){return this.throwIfDisposed(),Sr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.erf=function(){return this.throwIfDisposed(),QA(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.euclideanNorm=function(n,t){return this.throwIfDisposed(),lD(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.exp=function(){return this.throwIfDisposed(),Nr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.expandDims=function(n){return this.throwIfDisposed(),qn(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.expm1=function(){return this.throwIfDisposed(),dD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.fft=function(){return this.throwIfDisposed(),Xw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.flatten=function(){return this.throwIfDisposed(),U(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.floor=function(){return this.throwIfDisposed(),Id(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.floorDiv=function(n){return this.throwIfDisposed(),Cw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.gather=function(n,t,e){return this.throwIfDisposed(),xg(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Ei(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.greater=function(n){return this.throwIfDisposed(),vs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.ifft=function(){return this.throwIfDisposed(),Og(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.irfft=function(){return this.throwIfDisposed(),rO(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.isFinite=function(){return this.throwIfDisposed(),vD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.isInf=function(){return this.throwIfDisposed(),ID(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.isNaN=function(){return this.throwIfDisposed(),kD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.leakyRelu=function(n){return this.throwIfDisposed(),yg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.lessEqual=function(n){return this.throwIfDisposed(),La(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.less=function(n){return this.throwIfDisposed(),$d(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.localResponseNormalization=function(n,t,e,s){return this.throwIfDisposed(),_D(this,n,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.logSigmoid=function(){return this.throwIfDisposed(),BD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.logSoftmax=function(n){return this.throwIfDisposed(),Fw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.logSumExp=function(n,t){return this.throwIfDisposed(),Ow(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.log=function(){return this.throwIfDisposed(),Tr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.log1p=function(){return this.throwIfDisposed(),Dw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Zr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.logicalNot=function(){return this.throwIfDisposed(),wg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.logicalOr=function(n){return this.throwIfDisposed(),Lw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.logicalXor=function(n){return this.throwIfDisposed(),qD(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.matMul=function(n,t,e){return this.throwIfDisposed(),de(this,n,t,e)},nt().prototype.maxPool=function(n,t,e,s){return this.throwIfDisposed(),vg(this,n,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.max=function(n,t){return this.throwIfDisposed(),ir(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.maximum=function(n){return this.throwIfDisposed(),Do(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.mean=function(n,t){return this.throwIfDisposed(),Qe(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.min=function(n,t){return this.throwIfDisposed(),vd(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.minimum=function(n){return this.throwIfDisposed(),Lu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.mirrorPad=function(n,t){return this.throwIfDisposed(),eF(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.mod=function(n){return this.throwIfDisposed(),sF(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.mul=function(n){return this.throwIfDisposed(),W(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.neg=function(){return this.throwIfDisposed(),je(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.norm=function(n,t,e){return this.throwIfDisposed(),Cd(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.notEqual=function(n){return this.throwIfDisposed(),kd(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.oneHot=function(n,t=1,e=0){return this.throwIfDisposed(),Pw(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.onesLike=function(){return this.throwIfDisposed(),Ms(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.pad=function(n,t){return this.throwIfDisposed(),Ig(this,n,t)},nt().prototype.pool=function(n,t,e,s,r,o){return this.throwIfDisposed(),fF(this,n,t,e,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.pow=function(n){return this.throwIfDisposed(),Oa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.prelu=function(n){return this.throwIfDisposed(),kg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.prod=function(n,t){return this.throwIfDisposed(),gF(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.reciprocal=function(){return this.throwIfDisposed(),MF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.relu=function(){return this.throwIfDisposed(),Ri(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.relu6=function(){return this.throwIfDisposed(),Ww(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.reshapeAs=function(n){return this.throwIfDisposed(),U(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.reshape=function(n){return this.throwIfDisposed(),U(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.resizeBilinear=function(n,t,e){return this.throwIfDisposed(),nv(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.resizeNearestNeighbor=function(n,t,e){return this.throwIfDisposed(),sv(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.reverse=function(n){return this.throwIfDisposed(),Ai(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.rfft=function(){return this.throwIfDisposed(),aO(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.round=function(){return this.throwIfDisposed(),Vw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.rsqrt=function(){return this.throwIfDisposed(),Uw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.selu=function(){return this.throwIfDisposed(),Gw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.separableConv2d=function(n,t,e,s,r,o){return this.throwIfDisposed(),Hw(this,n,t,e,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.sigmoid=function(){return this.throwIfDisposed(),Da(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.sign=function(){return this.throwIfDisposed(),qF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.sin=function(){return this.throwIfDisposed(),Kw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.sinh=function(){return this.throwIfDisposed(),qw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.slice=function(n,t){return this.throwIfDisposed(),Se(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.softmax=function(n){return this.throwIfDisposed(),Fg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.softplus=function(){return this.throwIfDisposed(),Ou(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.spaceToBatchND=function(n,t){return this.throwIfDisposed(),$g(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.split=function(n,t){return this.throwIfDisposed(),Cs(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.sqrt=function(){return this.throwIfDisposed(),Ln(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.square=function(){return this.throwIfDisposed(),Ae(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.squaredDifference=function(n){return this.throwIfDisposed(),uO(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.squeeze=function(n){return this.throwIfDisposed(),zu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.stack=function(n,t){this.throwIfDisposed();const e=n instanceof Fe?[this,n]:[this,...n];return Er(e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.step=function(n){return this.throwIfDisposed(),Wu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.stridedSlice=function(n,t,e,s,r,o,i,a){return this.throwIfDisposed(),pO(this,n,t,e,s,r,o,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.sub=function(n){return this.throwIfDisposed(),Ot(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.sum=function(n,t){return this.throwIfDisposed(),At(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.tan=function(){return this.throwIfDisposed(),gO(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.tanh=function(){return this.throwIfDisposed(),cg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.tile=function(n){return this.throwIfDisposed(),ar(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.toBool=function(){return this.throwIfDisposed(),vt(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.toFloat=function(){return this.throwIfDisposed(),vt(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.toInt=function(){return this.throwIfDisposed(),vt(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.topk=function(n,t){return this.throwIfDisposed(),yO(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.transpose=function(n){return this.throwIfDisposed(),se(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.unique=function(n){return this.throwIfDisposed(),CO(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.unsortedSegmentSum=function(n,t){return this.throwIfDisposed(),Jw(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.unstack=function(n){return this.throwIfDisposed(),Fi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.where=function(n,t){return this.throwIfDisposed(),On(n,this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nt().prototype.zerosLike=function(){return this.throwIfDisposed(),ne(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Rr extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Rr.prototype)}}class zs extends Error{constructor(t){super(t),Object.setPrototypeOf(this,zs.prototype)}}class B extends Error{constructor(t){super(t),Object.setPrototypeOf(this,B.prototype)}}class Ht extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ht.prototype)}}class vx extends Error{constructor(t){super(t),Object.setPrototypeOf(this,vx.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class eC{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let e;return this.cache.has(t)&&(e=this.cache.get(t),this.cache.delete(t),this.cache.set(t,e)),e}put(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(t,e)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let e=0;e<this.maxEntries-t;e++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=t}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Li(n,t){if(Array.isArray(n)){let e=[];for(let s=0;s<t;s++)e=e.concat(n);return e}else{const e=new Array(t);return e.fill(n),e}}function Ar(n,t){if(!n)throw new vx(t)}function nC(n,t){let e=0;for(const s of n)s===t&&e++;return e}function Xn(n){return n.length===1?n[0]:n}function ve(n){return Array.isArray(n)?n:[n]}function eo(n){const e=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function Pi(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(t,e)=>e.toUpperCase())}let Ws={};function Cx(n){if(n==null)return null;const t={};return t.className=n.getClassName(),t.config=n.getConfig(),t}function Ix(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(t=>Ix(t));else{const t=Object.keys(n);for(const e of t){const s=n[e];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[e]=s.value:Ix(s))}}}function Ku(n,t={},e={},s="object",r=!1){if(typeof n=="string"){const o=n;let i;if(o in e)i=e[o];else if(o in Ws)i=Ws[o];else if(i=t[o],i==null)throw new B(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const o=n;if(o.className==null||o.config==null)throw new B(`${s}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const i=o.className;let a,l;if(i in e?[a,l]=e[i]:i in Ws?[a,l]=Ws.className:i in t&&([a,l]=t[i]),a==null)throw new B(`Unknown ${s}: ${i}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const m of Object.keys(Ws))u[m]=Ws[m];for(const m of Object.keys(e))u[m]=e[m];const h=o.config;h.customObjects=u;const d=Object.assign({},Ws);for(const m of Object.keys(e))Ws[m]=e[m];Ix(o.config);const f=l(a,o.config,e,r);return Ws=Object.assign({},d),f}else{const u=Object.assign({},Ws);for(const d of Object.keys(e))Ws[d]=e[d];const h=new a(o.config);return Ws=Object.assign({},u),h}}}function GM(n,t){return n<t?-1:n>t?1:0}function Ad(n,t){return-1*GM(n,t)}function Lo(n){if(n==null)return n;const t=[];for(const e of n)t.indexOf(e)===-1&&t.push(e);return t}function HM(n){if(n==null)throw new B(`Invalid value in obj: ${JSON.stringify(n)}`);for(const t in n)if(n.hasOwnProperty(t))return!1;return!0}function Mi(n,t,e){if(e!=null&&n.indexOf(e)<0)throw new B(`${e} is not a valid ${t}.  Valid values are ${n} or null/undefined.`)}function $x(n,t,e=0,s=1/0){return Ar(e>=0),Ar(s>=e),Array.isArray(n)&&n.length>=e&&n.length<=s&&n.every(r=>typeof r===t)}function pn(n,t){Array.isArray(n)?(A(n.length>0,()=>`${t} is unexpectedly an empty array.`),n.forEach((e,s)=>pn(e,`element ${s+1} of ${t}`))):A(Number.isInteger(n)&&n>0,()=>`Expected ${t} to be a positive integer, but got ${sC(n)}.`)}function sC(n){return n===null?"null":Array.isArray(n)?"["+n.map(t=>sC(t)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function KM(n,t,e){let s=e!=null?e():Nn(),r;return(...i)=>{const a=e!=null?e():Nn();return a-s<t||(s=a,r=n(...i)),r}}function rC(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let qM=0;function oC(){return qM++}const Dd={};function Fd(n=""){return n in Dd||(Dd[n]=0),Dd[n]+=1,n+Dd[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const jM=["channelsFirst","channelsLast"],XM=["nearest","bilinear"],YM=["valid","same","causal"],ZM=["max","avg"],JM=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const za=new Map;function Xe(n){Mi(jM,"DataFormat",n)}function QM(n){Mi(XM,"InterpolationFormat",n)}function Is(n){Mi(YM,"PaddingMode",n)}function iC(n){Mi(ZM,"PoolMode",n)}const qu=[],aC="/";function Bi(n,t){qu.push(n);try{const e=t();return qu.pop(),e}catch(e){throw qu.pop(),e}}function t3(){return qu.length===0?"":qu.join(aC)+aC}function lC(n){if(!cC(n))throw new Error("Not a valid tensor name: '"+n+"'");return t3()+n}function uC(n){if(!cC(n))throw new Error("Not a valid tensor name: '"+n+"'");za.has(n)||za.set(n,0);const t=za.get(n);if(za.set(n,za.get(n)+1),t>0){const e=`${n}_${t}`;return za.set(e,1),e}else return n}const e3=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function cC(n){return!!n.match(e3)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function n3(n){return n===parseInt(n.toString(),10)}function Po(n,t,e){t==null&&(t=0),e==null&&(e=n.length);let s=1;for(let r=t;r<e;++r)s*=n[r];return s}function Wa(n){if(n.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let e=0;e<n.length;e++){const s=n[e];s<t&&(t=s)}return t}function Mo(n){if(n.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let e=0;e<n.length;e++){const s=n[e];s>t&&(t=s)}return t}function ur(n,t){if(t<n)throw new B(`end (${t}) < begin (${n}) is forbidden.`);const e=[];for(let s=n;s<t;++s)e.push(s);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let kx;function sn(){return kx==null&&(kx=xR().epsilon()),kx}function cr(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Dr(n,t){return vt(n,t)}function ju(n,t=-1){const e=n.shape.slice();return t<0&&(t=e.length+t+1),e.splice(t,0,1),U(n,e)}function s3(n,t){return X(()=>{if(n.shape.length!==2)throw new B(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const e=ju(n,1);return Tx(e,[1,t,1])})}function r3(n){const t=[Po(n.shape)];return U(n,t)}function o3(n){if(n.rank<=1)throw new B(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const t=[n.shape[0],Po(n.shape,1)];return U(n,t)}function zi(n,t,e){return X(()=>{switch(n.rank){case 1:return Ag(n,t,e);case 2:return jw(n,[t,0],[e,n.shape[1]]);case 3:return Dg(n,[t,0,0],[e,n.shape[1],n.shape[2]]);case 4:return Nd(n,[t,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3]]);case 5:return Se(n,[t,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return Se(n,[t,0,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new B(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Sx(n,t,e){return X(()=>{switch(n.rank){case 1:return Ag(n,t,e);case 2:return jw(n,[0,t],[n.shape[0],e]);case 3:return Dg(n,[0,0,t],[n.shape[0],n.shape[1],e]);case 4:return Nd(n,[0,0,0,t],[n.shape[0],n.shape[1],n.shape[2],e]);default:throw new B(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Od(n,t,e,s){return X(()=>{switch(n.rank){case 1:return Ag(n,t,e);case 2:switch(s){case 1:return zi(n,t,e);case 2:return Sx(n,t,e);default:throw new B(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return zi(n,t,e);case 2:return Dg(n,[0,t,0],[n.shape[0],e,n.shape[2]]);case 3:return Sx(n,t,e);default:throw new B(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return zi(n,t,e);case 2:return Nd(n,[0,t,0,0],[n.shape[0],e,n.shape[2],n.shape[3]]);case 3:return Nd(n,[0,0,t,0],[n.shape[0],n.shape[1],e,n.shape[3]]);case 4:return Sx(n,t,e);default:throw new B(`The axis is not within the rank of the tensor ${s}`)}default:throw new B(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Nx(n,t=-1){let e;return t<0&&(e=n[0].rank,e!==0?t=e:t=0),t===n[0].rank&&(t=-1),Kn(n,t)}function hC(n,t){switch(n.rank){case 1:return xA([n,t]);case 2:return yA([n,t],0);case 3:return vA([n,t],0);case 4:return IA([n,t],0);default:throw new B(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function Tx(n,t){if(Array.isArray(t)||(t=[t]),n.rank!==t.length)throw new B(`The length of input n (${t.length}) does not match the number of dimensions in input x (${n.rank})`);return ar(n,t)}function Ld(n,t=0,e=1,s,r){return zw(n,t,e,s,r)}function Fr(n,t,e,s){if(n.rank<2||t.rank<2)throw new Ht(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${t.shape}`);if(t.rank>=3){const r=n.shape.slice(-1)[0],o=t.shape.slice(-2)[0];if(r!==o)throw new Ht(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${t.shape}`)}if(n.rank===2&&t.rank===2)return tv({a:n,b:t,transposeA:!1,transposeB:!1,bias:s?Ex(n.rank,s,cr()):null,activation:e});{const r=n.shape.slice(),o=r.pop();n=U(n,[-1,o]);const i=t.shape.slice(),a=i.pop(),l=i.pop(),u=[...i,a],h=Array.from({length:t.rank},(g,x)=>x===0?t.rank-2:x<=t.rank-2?x-1:x);t=U(se(t,h),[l,-1]);const d=[...r,...u];return U(tv({a:n,b:t,transposeA:!1,transposeB:!1,bias:s?Ex(n.rank,s,cr()):null,activation:e}),d)}}function dC(n,t,e){return X(()=>(Array.isArray(t)?t=jn(t,"int32"):t=vt(t,"int32"),xg(n,t,e)))}function Xu(n){return W(n,n)}function Ex(n,t,e){const s=t.shape;if(t.rank!==1&&t.rank!==n)throw new B(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${n}`);if(n===5){if(e==="channelsFirst")return s.length===1?U(t,[1,s[0],1,1,1]):U(t,[1,s[3],s[0],s[1],s[2]]);if(e==="channelsLast")return s.length===1?U(t,[1,1,1,1,s[0]]):U(t,[1].concat(s))}else if(n===4){if(e==="channelsFirst")return s.length===1?U(t,[1,s[0],1,1]):U(t,[1,s[2],s[0],s[1]]);if(e==="channelsLast")return s.length===1?U(t,[1,1,1,s[0]]):U(t,[1].concat(s))}else if(n===3){if(e==="channelsFirst")return s.length===1?U(t,[1,s[0],1]):U(t,[1,s[1],s[0]]);if(e==="channelsLast")return s.length===1?U(t,[1,1,s[0]]):U(t,[1].concat(s))}else if(n<3)return t;throw new B(`Unsupported input rank by biasAdd: ${t.rank}`)}function hr(n,t,e){return X(()=>(e==null&&(e=cr()),Xe(e),dt(n,Ex(n.rank,t,e))))}function i3(n,t=1){if(t!==1)throw new Ht(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return wd(n)}function a3(n){return X(()=>Dt(n,dt(Fn(n),1)))}function fC(n,t,e,s){return X(()=>Lg(n,t,e,s))}function l3(n){return X(()=>{const t=dt(.5,W(.2,n));return ws(t,0,1)})}function Yu(n,t,e=!1){return e?n():t()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const u3=["fanIn","fanOut","fanAvg"],c3=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function h3(n){Mi(u3,"FanMode",n)}function d3(n){Mi(c3,"Distribution",n)}class Vs extends Ba{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class pC extends Vs{apply(t,e){return fn(t,e)}}pC.className="Zeros",ct(pC);class _x extends Vs{apply(t,e){return Fo(t,e)}}_x.className="Ones",ct(_x);class mC extends Vs{constructor(t){if(super(),typeof t!="object")throw new B(`Expected argument of type ConstantConfig but got ${t}`);if(t.value===void 0)throw new B(`config must have value set but got ${t}`);this.value=t.value}apply(t,e){return X(()=>W(fe(this.value),Fo(t,e)))}getConfig(){return{value:this.value}}}mC.className="Constant",ct(mC);class gC extends Vs{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,e){return Mu(t,this.minval,this.maxval,e,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}gC.className="RandomUniform",ct(gC);class xC extends Vs{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if(e=e||"float32",e!=="float32"&&e!=="int32")throw new Ht(`randomNormal does not support dType ${e}.`);return Ld(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}xC.className="RandomNormal",ct(xC);class bC extends Vs{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if(e=e||"float32",e!=="float32"&&e!=="int32")throw new Ht(`truncatedNormal does not support dType ${e}.`);return Zw(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}bC.className="TruncatedNormal",ct(bC);class yC extends Vs{constructor(t){super(),this.gain=t.gain!=null?t.gain:1}apply(t,e){return X(()=>{if(t.length!==2||t[0]!==t[1])throw new B("Identity matrix initializer can only be used for 2D square matrices.");return W(this.gain,Aw(t[0]))})}getConfig(){return{gain:this.gain}}}yC.className="Identity",ct(yC);function f3(n,t="channelsLast"){let e,s;if(Xe(t),n.length===2)e=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(t==="channelsFirst"){const r=Po(n,2);e=n[1]*r,s=n[0]*r}else if(t==="channelsLast"){const r=Po(n,0,n.length-2);e=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=Po(n);e=Math.sqrt(r),s=Math.sqrt(r)}return[e,s]}class cs extends Vs{constructor(t){if(super(),t.scale<0)throw new B(`scale must be a positive float. Got: ${t.scale}`);this.scale=t.scale==null?1:t.scale,this.mode=t.mode==null?"fanIn":t.mode,h3(this.mode),this.distribution=t.distribution==null?"normal":t.distribution,d3(this.distribution),this.seed=t.seed}apply(t,e){const s=f3(t),r=s[0],o=s[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,r):this.mode==="fanOut"?i/=Math.max(1,o):i/=Math.max(1,(r+o)/2),this.distribution==="normal"){const a=Math.sqrt(i);if(e=e||"float32",e!=="float32"&&e!=="int32")throw new Ht(`${this.getClassName()} does not support dType ${e}.`);return Zw(t,0,a,e,this.seed)}else{const a=Math.sqrt(3*i);return Mu(t,-a,a,e,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}cs.className="VarianceScaling",ct(cs);class Rx extends cs{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return cs.className}}Rx.className="GlorotUniform",ct(Rx);class Ax extends cs{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return cs.className}}Ax.className="GlorotNormal",ct(Ax);class Dx extends cs{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return cs.className}}Dx.className="HeNormal",ct(Dx);class Fx extends cs{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return cs.className}}Fx.className="HeUniform",ct(Fx);class Ox extends cs{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return cs.className}}Ox.className="LeCunNormal",ct(Ox);class Lx extends cs{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return cs.className}}Lx.className="LeCunUniform",ct(Lx);class wC extends Vs{constructor(t){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=t.gain==null?this.DEFAULT_GAIN:t.gain,this.seed=t.seed}apply(t,e){return X(()=>{if(t.length<2)throw new Ht("Shape must be at least 2D.");if(e!=="int32"&&e!=="float32"&&e!==void 0)throw new TypeError(`Unsupported data type ${e}.`);e=e;const s=st(t.slice(0,-1)),r=t[t.length-1],o=s*r;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const i=[Math.max(r,s),Math.min(r,s)],a=Ld(i,0,1,e,this.seed),l=$L.qr(a,!1);let u=l[0];const d=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=W(u,d.sign()),s<r&&(u=u.transpose()),W(fe(this.gain),u.reshape(t))})}getConfig(){return{gain:this.gain,seed:this.seed}}}wC.className="Orthogonal",ct(wC);const vC={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function CC(n,t={}){return Ku(n,Bs.getMap().classNameMap,t,"initializer")}function ze(n){return Cx(n)}function Oe(n){if(typeof n=="string"){const t=n in vC?vC[n]:n;if(t==="GlorotNormal")return new Ax;if(t==="GlorotUniform")return new Rx;if(t==="HeNormal")return new Dx;if(t==="HeUniform")return new Fx;if(t==="LeCunNormal")return new Ox;if(t==="LeCunUniform")return new Lx;{const e={};return e.className=t,e.config={},CC(e)}}else return n instanceof Vs?n:CC(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Px(n){return Array.isArray(n)&&Array.isArray(n[0])}function Pd(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function Pt(n){let t;if(Array.isArray(n)){if(n.length!==1)throw new B(`Expected Tensor length to be 1; got ${n.length}`);t=n[0]}else t=n;return t}function le(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new B(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Md(n){let t=0;for(const e of n)e.shape.length===0?t+=1:t+=e.shape.reduce((s,r)=>s*r);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const IC="Variable";class p3{constructor(t,e="float32",s=IC,r=!0,o=null){this.dtype=e??"float32",this.shape=t.shape,this.id=oC(),s=s??IC,this.originalName=lC(s),this.name=uC(this.originalName),this.trainable_=r,this.constraint=o,this.val=kO(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),m3(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function m3(n,t){if(n.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(t.shape))}function Mx(n){return n.map(t=>t.read())}function Bx(n){n.forEach(t=>{t[0].write(t[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class rn{constructor(t){this.dtype=t.dtype,this.shape=t.shape,t.shape!=null?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class Or{constructor(t,e,s,r,o,i,a){this.dtype=t,this.shape=e,this.sourceLayer=s,this.inputs=r,this.callArgs=o,this.outputTensorIndex=a,this.id=oC(),i!=null&&(this.originalName=lC(i),this.name=uC(this.originalName)),this.rank=e.length}}let g3=0;class Bd{constructor(t,e){this.callArgs=e,this.id=g3++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const s of t.inboundLayers)s!=null&&s.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const e of this.inboundLayers)e!=null?t.push(e.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let x3=0;class Zt extends Ba{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=x3++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){const s=this.getClassName();e=eo(s)+"_"+Fd(s)}if(this.name=e,this.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){let s;if(t.batchInputShape!=null)s=t.batchInputShape;else if(t.inputShape!=null){let o=null;t.batchSize!=null&&(o=t.batchSize),s=[o].concat(t.inputShape)}this.batchInputShape=s;let r=t.dtype;r==null&&(r=t.inputDType),r==null&&(r="float32"),this.dtype=r}t.weights!=null?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(this.inboundNodes.length===0)throw new zs(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new B(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return Xn(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return Xn(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Rr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Rr(`Layer ${this.name} is not connected, no input to return.`);return Xn(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Rr(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Rr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Xn(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(e=>e.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){const e=ve(t);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=ve(this.inputSpec);if(e.length!==s.length)throw new B(`Layer ${this.name} expects ${s.length} inputs, but it received ${e.length} input tensors. Input received: ${t}`);for(let r=0;r<e.length;r++){const o=e[r],i=s[r];if(i==null)continue;const a=o.rank;if(i.ndim!=null&&a!==i.ndim)throw new B(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new B(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new B(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new B(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){const l=o.shape;for(const u in i.axes){const h=Number(u),d=i.axes[u],f=h>=0?l[h]:l[l.length+h];if(d!=null&&[d,null].indexOf(f)===-1)throw new B(`Input ${r} is incompatible with layer ${this.name}: expected axis ${h} of input shape to have value ${d} but got shape ${l}.`)}}if(i.shape!=null)for(let l=0;l<i.shape.length;++l){const u=i.shape[l],h=o.shape[l];if(u!=null&&h!=null&&u!==h)throw new B(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){this._callHook!=null&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();const s=ve(t),r=w3(t),o=v3(t);if(r===o)throw new B("Arguments to apply() must be all SymbolicTensors or all Tensors");return Bi(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);const i=[];for(const a of ve(t))i.push(a.shape);this.build(Xn(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(t),o){let i=this.call(t,e);this.supportsMasking&&this.setMaskMetadata(t,i);const a=ve(i),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(i=Xn(l),this.activityRegularizer!=null)throw new Ht("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=b3(t),a=this.computeOutputShape(i);let l;const u=y3(t);if(this.warnOnIncompatibleInputShape(Array.isArray(t)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((h,d)=>new Or(u,h,this,ve(t),e,this.name,d)):l=new Or(u,a,this,ve(t),e,this.name),this.addInboundNode(t,l,null,null,i,a,e),this._refCount++,this.activityRegularizer!=null)throw new Ht("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&t[r]!=null&&t[r]!==s&&(e=!0)}),e&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Rr(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const e of this.inboundNodes){const s=JSON.stringify(e.outputShapes);t.indexOf(s)===-1&&t.push(s)}if(t.length===1){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&e.length===1?e[0]:e}else throw new Rr(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new zs(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Md(this.weights)}build(t){this.built=!0}getWeights(t=!1){return Mx(t?this.trainableWeights:this.weights)}setWeights(t){X(()=>{const e=this.weights;if(e.length!==t.length)throw new B(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(e.length===0)return;const s=[],r=Mx(e);for(let o=0;o<r.length;++o){const i=r[o],a=e[o],l=t[o];if(!he(i.shape,l.shape))throw new B(`Layer weight shape ${i.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}Bx(s)})}addWeight(t,e,s,r,o,i,a,l){if(this._addedWeightNames.indexOf(t)!==-1)throw new B(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():Oe("zeros"));const u=r.apply(e,s),h=new p3(u,s,t,i,a);return u.dispose(),o!=null&&this.addLoss(()=>o.apply(h.read())),i==null&&(i=!0),i?this._trainableWeights.push(h):this._nonTrainableWeights.push(h),h}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){t==null||Array.isArray(t)&&t.length===0||(t=ve(t),this._losses!==void 0&&this._losses!==null&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(e!=null)if(Array.isArray(e))e.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return e}setMaskMetadata(t,e,s){if(!this.supportsMasking)return;const r=this.computeMask(t,s);if(e instanceof Array&&r instanceof Array){if(e.length!==r.length)throw new Error(`${this.name} outputs ${e.length} tensors but ${r.length} masks for those tensors`);for(let o=0;o<e.length;o++)e[o].kerasMask=r[o]}else{if(r instanceof Array)throw new Error(`{this.name} outputs a single tensor but ${r.length} masks`);if(e instanceof Array)throw new Error(`{this.name} outputs ${e.length} tensors but only one mask`);e.kerasMask=r}}addInboundNode(t,e,s,r,o,i,a=null){const l=ve(t);e=ve(e),s=ve(s),r=ve(r),o=Pd(o),i=Pd(i);const u=[],h=[],d=[];for(const f of l)u.push(f.sourceLayer),h.push(f.nodeIndex),d.push(f.tensorIndex);new Bd({outboundLayer:this,inboundLayers:u,nodeIndices:h,tensorIndices:d,inputTensors:l,outputTensors:e,inputMasks:s,outputMasks:r,inputShapes:o,outputShapes:i},a);for(let f=0;f<e.length;f++)e[f].sourceLayer=this,e[f].nodeIndex=this.inboundNodes.length-1,e[f].tensorIndex=f}getConfig(){const t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function b3(n){n=ve(n);const t=[];for(const e of n)t.push(e.shape);return Xn(t)}function y3(n){return"float32"}function $C(n,t,e){if((t==null||e!=null&&e>0)&&(t=n.sourceLayer,e=n.nodeIndex),t.inboundNodes.length===0)return[n];{const s=t.inboundNodes[e];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let o=0;o<s.inboundLayers.length;o++){const i=s.inputTensors[o],a=s.inboundLayers[o],l=s.nodeIndices[o],u=$C(i,a,l);for(const h of u)r.indexOf(h)===-1&&r.push(h)}return r}}}function w3(n){let t=!0;for(const e of ve(n))if(!(e instanceof Or)){t=!1;break}return t}function v3(n){let t=!0;for(const e of ve(n))if(e instanceof Or){t=!1;break}return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Zu extends Zt{constructor(t){if(super({dtype:t.dtype,name:t.name!=null?t.name:Fd("input").toString()}),t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new B("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let e=t.batchInputShape;if(e==null){if(t.inputShape==null)throw new B("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");e=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new B("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=t.dtype||"float32";this.batchInputShape=e,this.dtype=s,this.inputSpec=[{shape:e}];const r=new Or(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Bd({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[e],outputShapes:[e]})}apply(t,e){throw new B(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Zu.className="InputLayer",ct(Zu);function C3(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new B("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=n.batchShape;n.shape!=null&&t==null&&(t=[null].concat(n.shape));let e=n.dtype;return e==null&&(e="float32"),new Zu({batchInputShape:t,name:n.name,dtype:e,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function I3(n,t){if(n.dtype==null||n.dtype===t.dtype)return t;try{return vt(t,n.dtype)}catch{throw new B(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class Bo{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof Bo)for(const e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(t==null)return;for(const e of t)this.add(e.key,e.value)}}add(t,e,s){if(this.id2Value[t.id]==null)this.id2Value[t.id]=I3(t,e),this.name2Id[t.name]=t.id,s!=null&&(this.id2Mask[t.id]=s);else throw new B(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof Or){if(this.id2Value[t.id]==null)throw new B(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{const e=this.name2Id[t];if(e==null)throw new B(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[e]}}getMask(t){if(t instanceof Or){if(this.id2Value[t.id]==null)throw new B(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{const e=this.name2Id[t];if(e==null)throw new B(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[e]}}disposeMasks(){this.id2Mask!=null&&qt(this.id2Mask)}}const zd=new eC,Wd=new eC;function $3(n){zd!=null&&zd.setMaxEntries(n),Wd!=null&&Wd.setMaxEntries(n)}function Ju(n,t,e,s){const r=e==null?!1:e.training,o=Array.isArray(n),i=o?n:[n],a=i.map(g=>g.name),l=[],u=t.names();for(const g of a)u.indexOf(g)!==-1?l.push(t.getValue(g)):l.push(null);s!=null&&(s.maxNumTensors=-1/0,s.minNumTensors=1/0);const h=a.join(",")+"|"+t.names().sort().join(",");let d=zd.get(h),f;if(d==null){const g=k3(i,t);d=g.sorted,f=g.recipientCounts,zd.put(h,d),Wd.put(h,f)}f={},r||Object.assign(f,Wd.get(h));const m=new Bo(t);for(let g=0;g<d.length;++g){if(s!=null){const E=og().numTensors;E>s.maxNumTensors&&(s.maxNumTensors=E),E<s.minNumTensors&&(s.minNumTensors=E)}const x=d[g],b=x.sourceLayer;if(b instanceof Zu)continue;const w=[],v=[],I=[];let C=!1;for(const E of x.inputs){const F=m.getValue(E),P=m.getMask(E);w.push(F),v.push(P),P!=null&&(C=!0),r||(f[E.name]--,f[E.name]===0&&!t.hasKey(E)&&a.indexOf(E.name)===-1&&!F.isDisposed&&E.sourceLayer.stateful!==!0&&I.push(F))}C&&(e=e||{},e.mask=v[0]);const k=ve(b.apply(w,e));let N=null;b.supportsMasking&&(N=b.computeMask(w,v));const T=N3(x),R=Array.isArray(T)?T:[T];for(let E=0;E<R.length;++E){m.hasKey(R[E])||m.add(R[E],k[E],Array.isArray(N)?N[0]:N);const F=a.indexOf(R[E].name);F!==-1&&(l[F]=k[E])}r||qt(I)}return m.disposeMasks(),o?l:l[0]}function k3(n,t){A(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let e=[],s={};if(n.length===1){const r=kC(n[0],t);e=r.sorted,s=r.recipientMap}else{const r=new Set;for(const o of n){const{sorted:i,recipientMap:a}=kC(o,t);for(const l of i)r.has(l.name)||(e.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:e,recipientCounts:S3(s)}}function S3(n){const t={};for(const e in n)t[e]=n[e].size;return t}function kC(n,t){const e=new Set,s=[],r={};for(const a of t.names())e.add(a);const o=[],i=[];for(o.push(n);o.length>0;){const a=o[o.length-1];if(e.has(a.name)){o.pop();continue}const l=i[i.length-1]===o.length-1;if(a.inputs.length===0||l)o.pop(),s.push(a),e.add(a.name),l&&i.pop();else{i.push(o.length-1);for(const u of a.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(a.name),!e.has(u.name)&&o.push(u)}}return{sorted:s,recipientMap:r}}function N3(n){let t;if(n.sourceLayer.inboundNodes.length===1)t=n.sourceLayer.output;else{let e=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){e=s;break}t=n.sourceLayer.getOutputAt(e)}return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,$3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zx(n,t){return X(()=>Ln(At(W(n,n),t,!0)))}class Qu extends Ba{getConfig(){return{}}}class SC extends Qu{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return X(()=>{const e=zx(t,this.axis),s=ws(e,0,this.maxValue);return W(t,Dt(s,dt(sn(),e)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}SC.className="MaxNorm",ct(SC);class NC extends Qu{constructor(t){super(),this.defaultAxis=0,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return X(()=>Dt(t,dt(sn(),zx(t,this.axis))))}getConfig(){return{axis:this.axis}}}NC.className="UnitNorm",ct(NC);class TC extends Qu{apply(t){return Ri(t)}}TC.className="NonNeg",ct(TC);class EC extends Qu{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=t.minValue!=null?t.minValue:this.defaultMinValue,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.rate=t.rate!=null?t.rate:this.defaultRate,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return X(()=>{const e=zx(t,this.axis),s=dt(W(this.rate,ws(e,this.minValue,this.maxValue)),W(1-this.rate,e));return W(t,Dt(s,dt(sn(),e)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}EC.className="MinMaxNorm",ct(EC);const _C={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function on(n){return Cx(n)}function RC(n,t={}){return Ku(n,Bs.getMap().classNameMap,t,"constraint")}function an(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in _C?_C[n]:n,config:{}};return RC(e)}else return n instanceof Qu?n:RC(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Wi(n){if(n==null)return;const t=[],e=[],s=[];for(const r in n){const o=n[r];if(typeof o!="number"){const i=o;t.push(i.data()),e.push(r),s.push(i)}}if(t.length>0){const r=await Promise.all(t);for(let o=0;o<r.length;++o)n[e[o]]=r[o][0];qt(s)}}function AC(n){if(n!=null)for(const t in n){const e=n[t];typeof e!="number"&&e.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var DC;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(DC||(DC={}));const T3=125;class tc{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,e){}async onEpochEnd(t,e){}async onBatchBegin(t,e){}async onBatchEnd(t,e){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class E3{constructor(t,e=10){t==null&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(const e of this.callbacks)e.setParams(t)}setModel(t){for(const e of this.callbacks)e.setModel(t)}async onEpochBegin(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onEpochBegin(t,e)}async onEpochEnd(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onEpochEnd(t,e)}async onBatchBegin(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onBatchBegin(t,e)}async onBatchEnd(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onBatchEnd(t,e)}async onTrainBegin(t){t==null&&(t={});for(const e of this.callbacks)await e.onTrainBegin(t)}async onTrainEnd(t){t==null&&(t={});for(const e of this.callbacks)await e.onTrainEnd(t)}}class _3 extends tc{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,e){e==null&&(e={});const s=e.size==null?0:e.size;this.seen+=s;for(const r in e){const o=e[r];if(typeof o=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+o*s;else{let i;r in this.totals?i=this.totals[r]:this.totals[r]=0;const a=X(()=>dt(this.totals[r],W(o,s)));this.totals[r]=a,i!=null&&i.dispose()}}}async onEpochEnd(t,e){if(e!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?e[s]=this.totals[s]/this.seen:X(()=>{const r=W(Dt(1,this.seen),this.totals[s]);e[s]=r,this.totals[s].dispose(),kr(e[s])}))}}class R3 extends tc{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,e){e==null&&(e={}),this.epoch.push(t);for(const s in e)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(e[s])}async syncData(){const t=[],e=[],s=[];for(const o in this.history){const i=this.history[o];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){const l=i[a];t.push(l.data()),e.push(o),s.push(a)}}const r=await Promise.all(t);for(let o=0;o<r.length;++o)this.history[e[o]][s[o]].dispose(),this.history[e[o]][s[o]]=r[o][0]}}class A3 extends tc{constructor(t,e){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||wv,this.yieldEvery=e||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=T3),this.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");qp(this.yieldEvery)&&(this.maybeWait=KM(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,e,s){const r=[];this.yield!=null&&(await Wi(s),r.push(this.yield(t,e,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(t,e){this.currentEpoch=t,this.epochBegin!=null&&(await Wi(e),await this.epochBegin(t,e))}async onEpochEnd(t,e){const s=[];this.epochEnd!=null&&(await Wi(e),s.push(this.epochEnd(t,e))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(t,e){this.batchBegin!=null&&(await Wi(e),await this.batchBegin(t,e))}async onBatchEnd(t,e){const s=[];this.batchEnd!=null&&(await Wi(e),s.push(this.batchEnd(t,e))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):qp(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,t,e)),await Promise.all(s)}async onTrainBegin(t){this.trainBegin!=null&&(await Wi(t),await this.trainBegin(t))}async onTrainEnd(t){this.trainEnd!=null&&(await Wi(t),await this.trainEnd(t))}}function FC(n,t){return n==null&&(n={}),n instanceof tc?[n]:Array.isArray(n)&&n[0]instanceof tc?n:ve(n).map(s=>new A3(s,t))}class Us{constructor(){}static registerCallbackConstructor(t,e){A(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),Us.checkForDuplicate(e),Us.constructors[t]==null&&(Us.constructors[t]=[]),Us.constructors[t].push(e)}static checkForDuplicate(t){for(const e in Us.constructors)Us.constructors[+e].forEach(r=>{if(r===t)throw new B("Duplicate callback constructor.")})}static clear(){Us.constructors={}}static createCallbacks(t){const e=[];for(const s in Us.constructors){const r=+s;t>=r&&e.push(...Us.constructors[r])}return e.map(s=>new s)}}Us.constructors={};function OC(n,t,e,s,r,o,i,a,l){const u=new R3,h=[new _3,...Us.createCallbacks(t)];n!=null&&h.push(...n),h.push(u);const d=new E3(h);return d.setParams({epochs:e,initialEpoch:s,samples:r,steps:o,batchSize:i,verbose:t,doValidation:a,metrics:l}),{callbackList:d,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function no(n,t={},e=!1){return Ku(n,Bs.getMap().classNameMap,t,"layer",e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vd(n,t){return X(()=>{n.dtype!=="float32"&&(n=vt(n,"float32"));const e=At(Xu(n),t,!0),s=yd(e.shape,sn()),r=Ln(Do(e,s));return Dt(n,r)})}function Ud(n,t){return X(()=>Qe(Xu(Ot(t,n)),-1))}function Wx(n,t){return X(()=>Qe(Fn(Ot(t,n)),-1))}function Vx(n,t){return X(()=>{const e=Ot(n,t),s=ws(Fn(n),sn(),Number.MAX_VALUE),r=Fn(Dt(e,s));return W(100,Qe(r,-1))})}function D3(n,t){return X(()=>{const e=ws(t,sn(),Number.MAX_VALUE),s=Tr(dt(1,e)),r=ws(n,sn(),Number.MAX_VALUE),o=Tr(dt(1,r));return Qe(Xu(Ot(s,o)),-1)})}function F3(n,t){return X(()=>{const e=Do(0,Ot(1,W(n,t)));return Qe(Xu(e),-1)})}function O3(n,t){return X(()=>{const e=Do(0,Ot(1,W(n,t)));return Qe(e,-1)})}function L3(n,t){return X(()=>{const e=At(W(n,t),-1),s=ir(W(Ot(1,n),t),-1);return Do(0,dt(1,Ot(s,e)))})}function P3(n,t){return X(()=>{const e=Math.log(2),s=Ot(t,n),r=Ot(dt(s,Ou(W(-2,s))),e);return Qe(r,-1)})}function ec(n,t,e=!1){return X(()=>{if(e)t=Fg(t);else{const s=At(t,t.shape.length-1,!0);t=Dt(t,s)}return t=ws(t,sn(),1-sn()),je(At(W(vt(n,"float32"),Tr(t)),t.shape.length-1))})}function Gd(n,t,e=!1){return X(()=>{const s=vt(Id(r3(n)),"int32");t=ws(t,sn(),1-sn());const r=t.shape,o=U(Pw(s,r[r.length-1]),r);return ec(o,t,e)})}function M3(n,t){if(!he(n.shape,t.shape))throw new B(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(t.shape)}`);return X(()=>{const e=Ri(t),s=je(Fn(t));return dt(Ot(e,W(t,n)),Dw(Nr(s)))})}function Hd(n,t){return X(()=>{let e;return e=ws(t,sn(),1-sn()),e=Tr(Dt(e,Ot(1,e))),Qe(M3(n,e),-1)})}function B3(n,t){return X(()=>{const e=ws(n,sn(),1),s=ws(t,sn(),1);return At(W(n,Tr(Dt(e,s))),-1)})}function z3(n,t){return X(()=>{const e=Tr(dt(sn(),t));return Qe(Ot(t,W(n,e)),-1)})}function Ux(n,t){return X(()=>{const e=Vd(n,-1),s=Vd(t,-1),r=W(e,s);return je(At(r,-1))})}const Kd={meanSquaredError:Ud,meanAbsoluteError:Wx,meanAbsolutePercentageError:Vx,meanSquaredLogarithmicError:D3,squaredHinge:F3,hinge:O3,categoricalHinge:L3,logcosh:P3,categoricalCrossentropy:ec,sparseCategoricalCrossentropy:Gd,binaryCrossentropy:Hd,kullbackLeiblerDivergence:B3,poisson:z3,cosineProximity:Ux};function Gx(n){if(typeof n=="string"){if(n in Kd)return Kd[n];let t=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new B(t)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function LC(n,t){return X(()=>{const e=W(.5,Ms(t)),s=Dr(vs(t,e),n.dtype);return Qe(Sr(n,s),-1)})}function PC(n,t){return X(()=>Dr(Sr(Eu(n,-1),Eu(t,-1)),"float32"))}function W3(n,t){return X(()=>vt(At(Zr(Sr(n,1),Sr(t,1))),"float32"))}function V3(n,t){return X(()=>vt(At(Zr(Sr(n,0),Sr(t,1))),"float32"))}function U3(n,t){return X(()=>{const e=W3(n,t),s=V3(n,t),r=dt(e,s);return vt(On(vs(r,0),Dt(e,r),0),"float32")})}function G3(n,t){return Hd(n,t)}function H3(n,t){return n.rank===t.rank&&(n=zu(n,[n.rank-1])),t=Eu(t,-1),t.dtype!==n.dtype&&(t=vt(t,n.dtype)),vt(Sr(n,t),"float32")}const K3=Ud,q3=Ud,j3=Wx,X3=Wx,Y3=Vx,Z3=Vx,MC=ec,J3=Ux,BC=Gd,qd={binaryAccuracy:LC,categoricalAccuracy:PC,precision:U3,categoricalCrossentropy:MC,sparseCategoricalCrossentropy:BC,mse:K3,MSE:q3,mae:j3,MAE:X3,mape:Y3,MAPE:Z3,cosine:J3};function Q3(n){if(typeof n=="string"&&n in qd)return qd[n];if(typeof n!="string"&&n!=null)return n;throw new B(`Unknown metric ${n}`)}function jd(n){if(Ar(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let t;for(const e of Object.keys(Kd))if(Kd[e]===n){t=e;break}if(t!==void 0)return t;for(const e of Object.keys(qd))if(qd[e]===n){t=e;break}return t!==void 0?t:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tB(n){const t={Adagrad:()=>Oi.adagrad(.01),Adadelta:()=>Oi.adadelta(1,.95,sn()),Adam:()=>Oi.adam(.001,.9,.999,sn()),Adamax:()=>Oi.adamax(.002,.9,.999,sn(),0),RMSProp:()=>Oi.rmsprop(.001,.9,0,sn()),SGD:()=>Oi.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,n in t)return t[n]();throw new B(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const zC=1*1024*1024;function WC(n,t,e=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!Hx(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(e){const s=JSON.stringify(n);s.length>zC&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${zC}.`)}}function Hx(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const t=Object.keys(n);for(const e of t)if(typeof e!="string"||!Hx(n[e]))return!1;return!0}else if(Array.isArray(n)){for(const t of n)if(!Hx(t))return!1;return!0}else return!1;else{const t=typeof n;return t==="string"||t==="number"||t==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eB(n,t,e,s=console.log){const r=sB(n),o=["Layer (type)","Input Shape","Output shape","Param #"];r?(t=t||90,e=e||[.32,.61,.89,1]):(t=t||115,e=e||[.24,.48,.7,.8,1]),e[e.length-1]<=1&&(e=e.map(h=>Math.floor(t*h)));let i;if(!r){o.push("Receives inputs"),i=[];for(const h in n.nodesByDepth)i.push(...n.nodesByDepth[h])}s("_".repeat(t)),Xd(o,e,s),s("=".repeat(t));const a=n.layers;for(let h=0;h<a.length;++h)r?rB(a[h],e,s):oB(a[h],e,i,s),s((h===a.length-1?"=":"_").repeat(t));n.checkTrainableWeightsConsistency();const l=nB(n),u=Md(n.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(t))}function nB(n){let t;return n.collectedTrainableWeights!=null?t=Md(n.collectedTrainableWeights):t=Md(n.trainableWeights),t}function sB(n){let t=!0;const e=[],s=[];for(const r in n.nodesByDepth)e.push(n.nodesByDepth[r]);for(const r of e){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){t=!1;break}s.push(...r)}if(t)for(const r of n.layers){let o=!1;for(const i of r.inboundNodes)if(s.indexOf(i)!==-1)if(o){t=!1;break}else o=!0;if(!t)break}return t}function Xd(n,t,e=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,t[r]),s+=" ".repeat(t[r]-s.length);e(s)}function rB(n,t,e){let s,r;try{r=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const o=n.name,i=n.getClassName(),a=[`${o} (${i})`,r,s,n.countParams().toString()];Xd(a,t,e)}function oB(n,t,e,s){let r,o;try{o=n.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const i=[];for(const d of n.inboundNodes)if(!(e!=null&&e.length>0&&e.indexOf(d)===-1))for(let f=0;f<d.inboundLayers.length;++f){const m=d.inboundLayers[f].name,g=d.nodeIndices[f],x=d.tensorIndices[f];i.push(`${m}[${g}][${x}]`)}const a=n.name,l=n.getClassName(),u=i.length===0?"":i[0],h=[`${a} (${l})`,o,r,n.countParams().toString(),u];Xd(h,t,s);for(let d=1;d<i.length;++d)Xd(["","","","",i[d]],t,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function VC(n,t,e){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&t===0&&typeof e=="string"}function Kx(n,t){if(n===null)return null;if(typeof n=="string")return Pi(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const e=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];VC(t,r,o)?e.push(o):e.push(Kx(o,t))}return e}else{const e={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")e[s]=r;else{const o=Pi(s);e[o]=Kx(r,o)}}return e}}function qx(n,t){if(n==null)return null;if(typeof n=="string")return eo(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const e=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];VC(t,r,o)?e.push(o):e.push(qx(o,t))}return e}else{const e={};for(const s of Object.keys(n)){const r=n[s],o=eo(s);(s==="name"||s==="className")&&typeof r=="string"?e[o]=r:e[o]=qx(r,s)}return e}}/** @license See the LICENSE file. */const UC="4.11.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const iB=n=>{const t=Object.keys(n);if(t.length===0)return!1;const e=t[0].split("/");return!isNaN(parseInt(e[e.length-1],10))};class dr extends Zt{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){const v=this.getClassName().toLowerCase();this.name=Fd(v)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],Lo(this.inputs).length!==this.inputs.length)throw new B(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(v=>v.name)}`);Lo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(v=>v.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const v of this.outputs){const I=v.sourceLayer,C=v.nodeIndex,k=v.tensorIndex;this.outputLayers.push(I),this.outputLayersNodeIndices.push(C),this.outputLayersTensorIndices.push(k)}for(const v of this.inputs){const I=v.sourceLayer,C=v.nodeIndex,k=v.tensorIndex;Ar(C===0,"input layer has >1 nodes"),Ar(k===0,"input layer has >1 tensors"),this.inputLayers.push(I),this.inputLayersNodeIndices.push(C),this.inputLayersTensorIndices.push(k)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let v=0;v<this.inputLayers.length;v++){const I=this.inputLayers[v];if(!(I instanceof Zu))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${v} (0-based) originates from layer type ${I.getClassName()}.`);this.inputNames.push(I.name),this.feedInputShapes.push(I.batchInputShape),this.feedInputNames.push(I.name)}for(const v of this.outputLayers)this.outputNames.push(v.name);this.internalInputShapes=this.inputs.map(v=>v.shape),this.internalOutputShapes=this.outputs.map(v=>v.shape);const e={},s={},r={},o={},i={},a=[],l=(v,I,C,k,N,T)=>{(k==null||N==null||T==null)&&(k=v.sourceLayer,N=v.nodeIndex,T=v.tensorIndex);const R=k.inboundNodes[N];if(C.indexOf(R)!==-1)throw new zs(`The tensor ${v.name} at layer "${k.name}" is part of a cycle.`);if(I.indexOf(R)!==-1)return;this.containerNodes.add(dr.nodeKey(k,N)),k.id in i||(i[k.id]=Object.keys(i).length),C.indexOf(R)===-1&&C.push(R);const E=R.inboundLayers.length;for(let F=0;F<E;F++){const P=R.inputTensors[F],q=R.inboundLayers[F],j=R.nodeIndices[F],K=R.tensorIndices[F];l(P,I,C,q,j,K)}for(I.push(R);C.indexOf(R)>=0;)C.splice(C.indexOf(R),1);a.push(R)},u=[],h=[];for(const v of this.outputs)l(v,u,h);const d=a.slice().reverse();for(const v of d){s[v.id]=v,v.id in e||(e[v.id]=0);let I=e[v.id];const C=r[v.outboundLayer.id]==null?0:r[v.outboundLayer.id];I=Math.max(I,C),r[v.outboundLayer.id]=I,o[v.outboundLayer.id]=v.outboundLayer,e[v.id]=I;for(let k=0;k<v.inboundLayers.length;k++){const N=v.inboundLayers[k],T=v.nodeIndices[k],R=N.inboundNodes[T],E=e[R.id]==null?0:e[R.id];e[R.id]=Math.max(I+1,E),s[R.id]=R}}const f={};for(const v in e){const I=e[v];I in f||(f[I]=[]),f[I].push(s[v])}const m={};for(const v in r){const I=r[v];I in m||(m[I]=[]),m[I].push(o[v])}let g=Object.keys(m).map(v=>parseInt(v,10)).sort(Ad);this.layers=[];for(const v of g){const I=m[v];I.sort((C,k)=>{const N=i[C.id],T=i[k.id];return N<T?-1:N>T?1:0});for(const C of I)C instanceof dr&&this.internalContainerRefs.push(C),this.layers.push(C)}this.layersByDepth=m,g=Object.keys(f).map(v=>parseInt(v,10)).sort(Ad);const x=this.inputs.slice(),b=[];for(const v of g)for(const I of f[v]){const C=I.outboundLayer;if(C!=null){for(const k of I.inputTensors)if(x.indexOf(k)===-1)throw new zs(`Graph disconnected: cannot obtain value for tensor ${k} at layer "${C.name}". The following previous layers were accessed without issue: ${b}`);for(const k of I.outputTensors)x.push(k);b.push(C.name)}}this.nodesByDepth=f;const w=this.layers.map(v=>v.name);for(const v of w){const I=w.filter(C=>C===v).length;if(I!==1)throw new zs(`The name "${v}" is used ${I} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(w))}this.outboundNodes=[],this.inboundNodes=[],new Bd({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(v=>null),outputMasks:this.outputs.map(v=>null),inputShapes:this.inputs.map(v=>v.shape),outputShapes:this.outputs.map(v=>v.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(const e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(e=>{e._trainableWeights.forEach(s=>s.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new B("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const s of this.layers)e.push(...s.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){const s={};let r=0;const o=iB(t);o&&this.parseWeights(t);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const h=o?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[h]!=null)throw new B(`Duplicate weight name: ${h}`);s[h]=u,r++}const i=[];for(const a in t){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)i.push([s[l],t[a]]);else if(e)throw new B(`Provided weight data has no target variable: ${a}`);delete s[l]}if(e){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new B(`${a.length} of ${r} weights are not set: ${a}`)}Bx(i)}parseWeights(t){for(const e in Object.keys(t)){const s=e.split("/"),r=["vars","layer_checkpoint_dependencies"],o=s.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!r.includes(i)).join("/");o!==e&&(t[o]=t[e],delete t[e])}}updatedConfig(){const t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion=`tfjs-layers ${UC}`,e.backend="TensorFlow.js",e}toJSON(t,e=!0){const s=qx(this.updatedConfig());return e?JSON.stringify(s):s}call(t,e){return X(()=>{t=ve(t);const s=new Bo;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],t[r]);return Ju(this.outputs,s,e)})}computeMask(t,e){return X(()=>{t=ve(t);let s;return e==null?s=Li(null,t.length):s=ve(e),this.runInternalGraph(t,s)[1]})}computeOutputShape(t){const e=Pd(t);if(e.length!==this.inputLayers.length)throw new B(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<e.length;a++){const l=this.inputLayers[a],u=e[a],h=l.name+"_0_0";s[h]=u}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Ad);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const u of l){const h=u.outboundLayer;if(this.inputLayers.map(x=>x.id).indexOf(h.id)!==-1)continue;const d=[];for(let x=0;x<u.inboundLayers.length;x++){const b=u.inboundLayers[x],w=u.nodeIndices[x],v=u.tensorIndices[x],I=`${b.name}_${w}_${v}`,C=s[I];d.push(C)}const f=h.computeOutputShape(Xn(d)),m=Pd(f),g=h.inboundNodes.indexOf(u);for(let x=0;x<m.length;x++){const b=`${h.name}_${g}_${x}`;s[b]=m[x]}}}const o=[],i=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],h=this.outputLayersTensorIndices[a],d=`${l.name}_${u}_${h}`;i.push(d)}for(let a=0;a<i.length;a++){const l=i[a];Ar(l in s),o.push(s[l])}return Xn(o)}runInternalGraph(t,e){e==null&&(e=Li(null,t.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],h=t[l],d=e[l];s[u.id]=[h,d]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Ad);for(const l of r){const u=this.nodesByDepth[l];for(const h of u){const d=h.outboundLayer,f=h.inputTensors,m=h.outputTensors,g=new Array;for(const x of f)x.id in s&&g.push(s[x.id]);if(g.length===f.length){let x={},b,w,v,I;if(h.callArgs!=null&&(x=h.callArgs),g.length===1){const[C,k]=g[0];x.mask==null&&(x.mask=k),v=ve(d.call(C,x)),I=ve(d.computeMask(C,k)),b=[C],w=[k]}else b=g.map(C=>C[0]),w=g.map(C=>C[1]),x.mask==null&&(x.mask=w),v=ve(d.call(b,x)),I=ve(d.computeMask(b,w));if(d.activityRegularizer)throw new Ht("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let C=0;C<m.length;++C){const k=m[C],N=v[C],T=I[C];s[k.id]=[N,T]}}}}const o=[],i=[],a=[];for(const l of this.outputs){Ar(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,h]=s[l.id];a.push(u.shape),o.push(u),i.push(h)}return[o,i,a]}buildNodeConversionMap(t){const e={};let s;for(const r of this.layers){s=r instanceof dr?1:0;for(let o=0;o<r.inboundNodes.length;o++){const i=dr.nodeKey(r,o);this.containerNodes.has(i)&&(e[i]=s,s+=1)}}return e}getLayer(t,e){if(e!=null)return this.findLayer(e);if(t==null)throw new B("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);for(const s of this.layers)if(s.name===t)return s;throw new B(`No such layer: ${t}`)}findLayer(t){if(this.layers.length<=t)throw new B(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}calculateLosses(){return X(()=>{const t=[];for(const e of this.layers)for(let s=0;s<e.inboundNodes.length;++s){const r=dr.nodeKey(e,s);this.containerNodes.has(r)&&t.push(...e.calculateLosses())}return t})}getConfig(){const t={name:this.name},e=this.buildNodeConversionMap(this.layers),s=[];for(const i of this.layers){const a=i.getClassName(),l=i.getConfig(),u=[];for(let d=0;d<i.inboundNodes.length;d++){const f=i.inboundNodes[d],m=dr.nodeKey(i,d);let g={};if(this.containerNodes.has(m)){if(f.callArgs)try{JSON.stringify(f.callArgs),g=f.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),g={}}if(f.inboundLayers.length>0){const x=[];for(let b=0;b<f.inboundLayers.length;b++){const w=f.inboundLayers[b],v=f.nodeIndices[b],I=f.tensorIndices[b],C=dr.nodeKey(w,v);let k=e[C];k==null&&(k=0),x.push([w.name,k,I,g])}u.push(x)}}}const h={};h.name=i.name,h.className=a,h.config=l,h.inboundNodes=u,s.push(h)}t.layers=s;const r=[];for(let i=0;i<this.inputLayers.length;i++){const a=this.inputLayers[i],l=this.inputLayersNodeIndices[i],u=dr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let h=e[u];h==null&&(h=0);const d=this.inputLayersTensorIndices[i];r.push([a.name,h,d])}t.inputLayers=r;const o=[];for(let i=0;i<this.outputLayers.length;i++){const a=this.outputLayers[i],l=this.outputLayersNodeIndices[i],u=dr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let h=e[u];h==null&&(h=0);const d=this.outputLayersTensorIndices[i];o.push([a.name,h,d])}return t.outputLayers=o,t}static fromConfig(t,e,s={},r=!1){const o={},i={};function a(b,w){b.name in i?i[b.name].push(w):i[b.name]=[w]}function l(b,w){const v=[];let I;for(const C of w){const k=C[0],N=C[1],T=C[2];if(I=C[3]==null?{}:C[3],!(k in o)){a(b,w);return}const R=o[k];if(R.inboundNodes.length<=N){a(b,w);return}const E=R.inboundNodes[N];v.push(E.outputTensors[T])}v.length>0&&b.apply(Xn(v),I)}function u(b){const w=b.name,v=no(b,e.customObjects!=null?e.customObjects:{});v.setFastWeightInitDuringBuild(r),o[w]=v,b.inboundNodes.forEach(C=>{if(!(C instanceof Array))throw new B(`Corrupted configuration, expected array for nodeData: ${C}`);a(v,C)})}const h=e.name,d=e.layers;for(const b of d)u(b);for(;!HM(i);)for(const b of d){const w=o[b.name];if(w.name in i){const v=i[w.name];delete i[w.name];for(const I of v)l(w,I)}}const f=[],m=[],g=e.inputLayers;for(const b of g){const w=b[0],v=b[1],I=b[2];Ar(w in o);const k=o[w].inboundNodes[v].outputTensors;f.push(k[I])}const x=e.outputLayers;for(const b of x){const w=b[0],v=b[1],I=b[2];Ar(w in o);const k=o[w].inboundNodes[v].outputTensors;m.push(k[I])}return new t({inputs:f,outputs:m,name:h})}get stateful(){if(this._stateful)throw new B("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){X(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function aB(n,t,e){const s=t.length;if(n==null||Array.isArray(n)&&n.length===0)return t.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&t[0]in n?[n[t[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${e} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return t.forEach(o=>{o in n?r.push(n[o]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${e} must be either an array with ${s} elements or an object with ${t} keys. Provided ${e} not understood: ${JSON.stringify(n)}`)}function GC(n,t){return aB(n,t,"classWeight")}async function HC(n,t,e,s){if(t!=null||s!=null)throw new Error("Support sampleWeight is not implemented yet");if(e!=null){const r=X(()=>{if(n.shape.length===1)return ki(n);if(n.shape.length===2){if(n.shape[1]>1)return Eu(n,1);if(n.shape[1]===1)return U(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await r.data());qt(r);const i=[];return o.forEach(a=>{if(e[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(e[a])}),jn(i,"float32")}else return null}function lB(n,t){return W(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const uB=32;function KC(n,t){let e,s;const r=t;e=r.xs,s=r.ys,A(e!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);const o=qC("input",n.inputNames,e),i=qC("output",n.outputNames,s),a=o[0].shape[0];A(o.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),A(i.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<o.length;l++)A(o[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<i.length;l++)A(i[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:o,ys:i}}function qC(n,t,e){if(e instanceof Fe)return[e];if(Array.isArray(e))return A(e.length===t.length,()=>`Received an array of ${e.length} Tensors, but expected ${t.length} to match the ${n} keys ${t}.`),e;{const s=[];for(const r of t){if(e[r]==null)throw new B(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(e[r])}return s}}function cB(n){if(n.length===3)throw new Ht("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function hB(n,t,e){const s=e.batchesPerEpoch!=null;if(A(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),A(e!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),A(e.epochs!=null&&e.epochs>0&&Number.isInteger(e.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${e.epochs}`),A(!s||e.batchesPerEpoch>0&&Number.isInteger(e.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${e.batchesPerEpoch}`),A(e.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=e.validationData!=null;let o,i;if(r)if(jC(e.validationData))A(e.validationBatches==null||e.validationBatches>0&&Number.isInteger(e.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${e.validationBatches}`);else{const b=cB(e.validationData);o=b.xs,i=b.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let u;r?u=l.slice().concat(l.map(b=>"val_"+b)):u=l.slice();const h=FC(e.callbacks,e.yieldEvery),d=e.verbose==null?1:e.verbose,{callbackList:f,history:m}=OC(h,d,e.epochs,null,null,dB(t,e),null,r,u);f.setModel(n),n.history=m,await f.onTrainBegin(),n.stopTraining_=!1;let g=e.initialEpoch==null?0:e.initialEpoch,x=await t.iterator();for(;g<e.epochs;){const b={};await f.onEpochBegin(g);let w=0,v=0;for(s||(x=await t.iterator());!s||w<e.batchesPerEpoch;){const I=await x.next();if(s&&I.done){console.warn(`You provided \`batchesPerEpoch\` as ${e.batchesPerEpoch}, but your dataset iterator ran out of data after ${w} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${e.batchesPerEpoch*e.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(I.value!=null){const{xs:C,ys:k}=KC(n,I.value),N={};N.batch=v,N.size=C[0].shape[0],await f.onBatchBegin(v,N);const T=[];if(e.classWeight!=null){const F=GC(e.classWeight,n.outputNames);for(let P=0;P<F.length;++P)T.push(await HC(k[P],null,F[P]))}const R=C.concat(k).concat(T),E=a(R);qt(R);for(let F=0;F<l.length;++F){const P=l[F],q=E[F];N[P]=q,kr(q)}await f.onBatchEnd(v,N),AC(N),v++,w++}if(s?w>=e.batchesPerEpoch:I.done){if(r){let C;jC(e.validationData)?C=ve(await n.evaluateDataset(e.validationData,{batches:e.validationBatches})):C=ve(n.evaluate(o,i,{batchSize:e.validationBatchSize==null?uB:e.validationBatchSize,verbose:0}));for(let k=0;k<n.metricsNames.length;++k)b[`val_${n.metricsNames[k]}`]=C[k]}break}if(n.stopTraining_)break}if(await f.onEpochEnd(g,b),g++,n.stopTraining_)break}return await f.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function dB(n,t){let e=null;return t.batchesPerEpoch!=null?e=t.batchesPerEpoch:Number.isFinite(n.size)&&(e=n.size),e}function jC(n){return typeof n.iterator=="function"}function fB(n){return typeof n.next=="function"}async function pB(n,t,e){e=e||{};const s=e.batches!=null,r=n.testFunction;let o=[];if(e.verbose>0)throw new Ht("Verbose mode is not implemented yet.");A(!s||e.batches>0&&Number.isInteger(e.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(e.batches)}`);const i=fB(t)?t:await t.iterator();let a=0,l=0;for(;!s||l<e.batches;){const u=await i.next();if(o=X(()=>{if(u.value){const{xs:h,ys:d}=KC(n,u.value),f=h.concat(d),m=X(()=>r(f));if(qt(f),l===0)for(let x=0;x<m.length;++x)o.push(fe(0));const g=f[0].shape[0];for(let x=0;x<m.length;++x){const b=m[x],w=o[x];o[x]=X(()=>dt(o[x],W(g,b))),l>0&&qt(w)}qt(m),a+=g,++l}return o}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${e.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<o.length;++u){const h=o[u];o[u]=Dt(o[u],a),qt(h)}return Xn(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jx(n){A(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function nc(n,t,e){return n==null?[null]:Array.isArray(n)?n.map(s=>zi(s,t,e-t)):zi(n,t,e-t)}function Xx(n,t){return X(()=>n==null?null:Array.isArray(n)?n.map(e=>Xx(e,t)):dC(n,t.dtype==="int32"?t:vt(t,"int32")))}function Yx(n,t){const e=[];let s=0,r=null;for(;s<n;)r=s+t,r>=n&&(r=n),e.push([s,r]),s=r;return e}function XC(n){const t=[];n instanceof Fe&&(n=[n]);for(let e=0;e<n.length;++e){const s=n[e];if(s.rank===1)t.push(ju(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(s)}}return t}function fr(n,t){if(n==null)return;const e=[];if(t instanceof Fe)e.push(t.id);else if(Array.isArray(t))t.forEach(r=>e.push(r.id));else if(t!=null)for(const r in t){const o=t[r];e.push(o.id)}const s=[];if(n instanceof Fe)e.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{e.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const o=n[r];e.indexOf(o.id)===-1&&s.push(o)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mB(n){return n instanceof Fe}function Zx(n){return Array.isArray(n)}function YC(n){return!mB(n)&&!Zx(n)}function ZC(n,t,e,s=!0,r=""){if(t==null||t.length===0){if(n!=null){let i=!1;if(Zx(n)&&n.length>0)i=!0;else if(YC(n)){for(const a in n)if(n.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new B(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return t.map(i=>null);let o;if(YC(n)){n=n,o=[];for(const i of t){if(n[i]==null)throw new B(`No data provided for "${i}". Need data for each key in: ${t}`);o.push(n[i])}}else if(Zx(n)){if(n=n,n.length!==t.length)throw new B(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);o=n}else{if(n=n,t.length>1)throw new B(`The model ${r} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);o=[n]}if(o=XC(o),e!=null)for(let i=0;i<t.length;++i){if(e[i]==null)continue;const a=o[i];if(a.shape.length!==e[i].length)throw new B(`Error when checking ${r}: expected ${t[i]} to have ${e[i].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<e[i].length;++l){if(l===0&&!s)continue;const u=a.shape[l],h=e[i][l];if(h!=null&&h>=0&&u!==h)throw new B(`${r} expected a batch of elements where each example has shape [${e[i].slice(1,e[i].length)}] (i.e.,tensor shape [*,${e[i].slice(1,e[i].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return o}function gB(n,t,e){const s=Lo(n.map(o=>o.shape[0]));s.sort();const r=Lo(t.map(o=>o.shape[0]));if(r.sort(),s.length>1)throw new B(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(o=>o.shape))}`);if(r.length>1)throw new B(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(o=>o.shape))}`);if(s.length>0&&r.length>0&&!he(s,r))throw new B(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function xB(n,t,e){const s=[Ud,Hd,ec];for(let r=0;r<n.length;++r){const o=n[r],i=t[r],a=e[r];if(i!=null){if(i===ec&&o.shape[o.shape.length-1]===1)throw new B(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(i)!==-1){const l=o.shape.slice(1),u=a.slice(1);for(let h=0;h<l.length;++h){const d=l[h],f=u[h];if(f!=null&&d!==f)throw new B(`A target Tensor with shape ${o.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function JC(n,t,e,s=!0,r=""){let o;if(Array.isArray(n)){if(n.length!==t.length)throw new B(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${n.length} Tensors(s).`);o=n}else{if(t.length>1)throw new B(`The model expects ${t.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);o=[n]}if(e!=null)for(let i=0;i<t.length;++i){if(e[i]==null)continue;const a=o[i];if(a.shape.length!==e[i].length)throw new B(`Error when checking ${r}: expected ${t[i]} to have ${e[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<e[i].length;++l){if(l===0&&!s)continue;const u=a.shape[l],h=e[i][l];if(h!=null&&h!==u)throw new B(`Error when checking ${r}: expected ${t[i]} to have shape ${JSON.stringify(e[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function bB(n,t){if(n==null||Array.isArray(n)&&n.length===0)return t.map(s=>[]);let e;if(typeof n=="string"||typeof n=="function")e=[n];else if(Array.isArray(n)||typeof n=="object")e=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(e))return t.map(s=>e);{const s=[];for(const r of t){let o=e.hasOwnProperty(r)?e[r]:[];Array.isArray(o)||(o=[o]),s.push(o)}return s}}const yB="layers-model";class Va extends dr{constructor(t){super(t),this.isTraining=!1}summary(t,e,s=console.log){if(!this.built)throw new B("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");eB(this,t,e,s)}compile(t){if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=tB(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof Oo))throw new B("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let e=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(const i in t.loss)if(this.outputNames.indexOf(i)===-1)throw new B(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)t.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),e.push(Gx(t.loss[i]))}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new B(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);e=t.loss.map(a=>Gx(a))}else{const i=Gx(t.loss);this.outputs.forEach(a=>{e.push(i)})}this.lossFunctions=e,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const a=this.internalOutputShapes[i],l=this.outputNames[i];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}const s=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Bi("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const r=bB(t.metrics,this.outputNames),o=(i,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,i])};Bi("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=r[i];(u=>{const h="";let d,f,m;for(const g of u){if(typeof g=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(g)!==-1){const b=this.internalOutputShapes[i];b[b.length-1]===1||this.lossFunctions[i]===Hd?["accuracy","acc"].indexOf(g)!==-1?f=LC:["crossentropy","ce"].indexOf(g)!==-1&&(f=G3):this.lossFunctions[i]===Gd?["accuracy","acc"].indexOf(g)!==-1?f=H3:["crossentropy","ce"].indexOf(g)!==-1&&(f=BC):["accuracy","acc"].indexOf(g)!==-1?f=PC:["crossentropy","ce"].indexOf(g)!==-1&&(f=MC);let w;["accuracy","acc"].indexOf(g)!==-1?w="acc":["crossentropy","ce"].indexOf(g)!==-1&&(w="ce"),m=f,d=h+w}else m=Q3(g),d=h+jd(g);let x;Bi(d,()=>{x=m}),o(i,d,x)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,e,s={}){const r=s.batchSize==null?32:s.batchSize;jx(r);const o=!0,i=this.standardizeUserDataXY(t,e,o,r);try{const a=i[0].concat(i[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,r,s.verbose,s.steps);return Xn(u)}finally{fr(i[0],t),fr(i[1],e)}}async evaluateDataset(t,e){return this.makeTestFunction(),pB(this,t,e)}checkNumSamples(t,e,s,r="steps"){let o;if(s!=null){if(o=null,e!=null)throw new B(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${e}`)}else if(t!=null)Array.isArray(t)?o=t[0].shape[0]:o=t.shape[0];else throw new B(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return o}execute(t,e){if(Array.isArray(e)&&e.length===0)throw new B("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(e),r=s?e:[e],o=this.retrieveSymbolicTensors(r),i=new Bo;if(t instanceof Fe&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new B(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)i.add(this.inputs[l],t[l])}else for(const l of this.inputs){const u=t[l.name];if(u==null)throw new B(`No value is provided for the model's input ${l.name}`);i.add(l,u)}const a=Ju(o,i);return s?a:a[0]}retrieveSymbolicTensors(t){const e=Li(null,t.length);let s=t.length;for(const r of this.layers){const o=Array.isArray(r.output)?r.output:[r.output],i=o.map(a=>a.name);for(let a=0;a<t.length;++a){const l=i.indexOf(t[a]);if(l!==-1&&(e[a]=o[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw e.forEach((o,i)=>{o==null&&r.push(t[i])}),new B(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return e}predictLoop(t,e=32,s=!1){return X(()=>{const r=this.checkNumSamples(t);if(s)throw new Ht("Verbose predictLoop() is not implemented yet.");const o=Yx(r,e),i=this.outputs.map(a=>[]);for(let a=0;a<o.length;++a)X(()=>{const u=o[a][0],h=o[a][1],d=nc(t,u,h),f=[];if(Array.isArray(d))for(let g=0;g<d.length;++g)f.push({key:this.inputs[g],value:d[g]});else f.push({key:this.inputs[0],value:d});const m=new Bo(f);return Ju(this.outputs,m)}).forEach((u,h)=>i[h].push(u));return Xn(i.map(a=>Kn(a,0)))})}predict(t,e={}){const s=XC(t);JC(s,this.inputNames,this.feedInputShapes,!1);try{const r=e.batchSize==null?32:e.batchSize;return jx(r),this.predictLoop(s,r)}finally{fr(s,t)}}predictOnBatch(t){JC(t,this.inputNames,this.feedInputShapes,!0);const e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)}standardizeUserDataXY(t,e,s=!0,r){if(this.optimizer_==null)throw new zs("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let i=0;i<this.feedOutputShapes.length;++i){const a=this.feedOutputShapes[i];this.feedLossFns[i]===Gd?o.push(a.slice(0,a.length-1).concat([1])):o.push(a)}if(t=ZC(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=ZC(e,this.feedOutputNames,o,!1,"target"),gB(t,e),xB(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&t[0].shape[0]%r!==0)throw new B(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${t[0].shape[0]} sample(s).`);return[t,e]}async standardizeUserData(t,e,s,r,o=!0,i){const[a,l]=this.standardizeUserDataXY(t,e,o,i);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const h=GC(r,this.outputNames);u=[];for(let d=0;d<h.length;++d)u.push(await HC(l[d],null,h[d]))}return[a,l,u]}testLoop(t,e,s,r=0,o){return X(()=>{const i=this.checkNumSamples(e,s,o,"steps"),a=[];if(r>0)throw new Ht("Verbose mode is not implemented yet.");if(o!=null)throw new Ht("steps mode in testLoop() is not implemented yet");{const l=Yx(i,s),u=jn(ur(0,i));for(let h=0;h<l.length;++h){const d=l[h][0],f=l[h][1],m=zi(u,d,f-d),g=Xx(e,m),x=t(g);if(h===0)for(let b=0;b<x.length;++b)a.push(fe(0));for(let b=0;b<x.length;++b){const w=x[b];a[b]=dt(a[b],W(f-d,w))}}for(let h=0;h<a.length;++h)a[h]=Dt(a[h],i)}return a})}getDedupedMetricsNames(){const t=this.metricsNames,e=[];for(let s=0;s<t.length;++s){const r=t[s];let o=r;if(nC(t,r)>1){const i=nC(t.slice(0,s),r);o+=`_${i}`}e.push(o)}return e}makeTrainFunction(){return t=>{const e=[],s=t.slice(0,this.inputs.length),r=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{const d=[];for(let x=0;x<this.inputs.length;++x)d.push({key:this.inputs[x],value:s[x]});const f=new Bo(d),m=Ju(this.outputs,f,{training:!0});let g;for(let x=0;x<this.lossFunctions.length;++x){const b=this.lossFunctions[x];let w=b(r[x],m[x]);o[x]!=null&&(w=lB(w,o[x]));const v=Qe(w);e.push(v),x===0?g=w:g=dt(g,w)}for(let x=0;x<this.metricsTensors.length;++x){let b;if(this.outputs.length>1&&x<this.outputs.length)b=e[x];else{const w=this.metricsTensors[x][0],v=this.metricsTensors[x][1];b=Qe(w(r[v],m[v]))}kr(b),i.push(b)}return g=Qe(g),this.calculateLosses().forEach(x=>{g=dt(g,x)}),g},l=this.collectedTrainableWeights.map(d=>d.read()),u=!0;return[this.optimizer_.minimize(a,u,l)].concat(i)}}makeTestFunction(){this.testFunction=t=>X(()=>{const e=[];let s;const r=t.slice(0,this.inputs.length),o=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let u=0;u<this.inputs.length;++u)i.push({key:this.inputs[u],value:r[u]});const a=new Bo(i),l=Ju(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const h=this.lossFunctions[u],d=Qe(h(o[u],l[u]));u===0?s=d:s=dt(s,d),e.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const h=this.metricsTensors[u][0],d=this.metricsTensors[u][1],f=Qe(h(o[d],l[d]));e.push(f)}return e})}async fit(t,e,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,o,i,a,l,u,h,d,f;try{const m=s.batchSize==null?32:s.batchSize;jx(m);const g=!1,x=await this.standardizeUserData(t,e,s.sampleWeight,s.classWeight,g,m);r=x[0],o=x[1],f=x[2];let b=!1,w;if(s.validationData!=null&&s.validationData.length>0){if(b=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new Ht("validationData including sample weights is not supported yet."):new B(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const E=!0,F=await this.standardizeUserData(l,u,null,null,E,m);h=F[0],d=F[1],w=h.concat(d)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){b=!0;const E=Math.floor(r[0].shape[0]*(1-s.validationSplit)),F=r[0].shape[0];h=nc(r,E,F),i=r,r=nc(r,0,E),d=nc(o,E,F),a=o,o=nc(o,0,E),w=h.concat(d)}else s.validationSteps!=null&&(b=!0);const v=r.concat(o).concat(f);this.checkTrainableWeightsConsistency();const I=this.makeTrainFunction(),C=this.getDedupedMetricsNames();let k,N;b?(this.makeTestFunction(),k=this.testFunction,N=C.slice().concat(C.map(E=>"val_"+E))):(k=null,w=[],N=C.slice());const T=FC(s.callbacks,s.yieldEvery);return await this.fitLoop(I,v,C,m,s.epochs,s.verbose,T,k,w,s.shuffle,N,s.initialEpoch,null,null)}finally{this.isTraining=!1,fr(r,t),fr(o,e),fr(i,t),fr(a,e),fr(h,l),fr(d,u),f!=null&&qt(f)}}async fitLoop(t,e,s,r,o,i,a,l,u,h,d,f,m,g){r==null&&(r=32),o==null&&(o=1),h==null&&(h=!0),f==null&&(f=0);let x=!1;if(l!=null&&u!=null&&(x=!0),g!=null&&(x=!0,m==null))throw new B("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const b=this.checkNumSamples(e,r,m,"steps_per_epoch");let w;b!=null&&(w=ur(0,b)),i==null&&(i=1);const{callbackList:v,history:I}=OC(a,i,o,f,b,m,r,x,d);v.setModel(this),this.history=I,await v.onTrainBegin(),this.stopTraining_=!1;for(let C=f;C<o;++C){await v.onEpochBegin(C);const k={};if(m!=null)throw new Ht("stepsPerEpoch mode is not implemented yet.");{if(h==="batch")throw new Ht("batch shuffling is not implemneted yet");h&&n_(w);const N=jn(w),T=Yx(b,r);for(let R=0;R<T.length;++R){const E={};if(await v.onBatchBegin(R,E),X(()=>{const F=T[R][0],P=T[R][1],q=zi(N,F,P-F);E.batch=R,E.size=P-F;const j=Xx(e,q),K=t(j);for(let Y=0;Y<s.length;++Y){const Q=s[Y],tt=K[Y];E[Q]=tt,kr(tt)}if(R===T.length-1&&x){const Y=this.testLoop(l,u,r);for(let Q=0;Q<s.length;++Q){const tt=s[Q],Z=Y[Q];kr(Z),k["val_"+tt]=Z}}}),await v.onBatchEnd(R,E),AC(E),this.stopTraining_)break}N.dispose()}if(await v.onEpochEnd(C,k),this.stopTraining_)break}return await v.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(t,e){return hB(this,t,e)}async trainOnBatch(t,e){const s=await this.standardizeUserData(t,e),r=s[0],o=s[1],a=this.makeTrainFunction()(r.concat(o)),l=[];for(const u of a){const h=await u.data();l.push(h[0])}return qt(a),fr(s[0],t),fr(s[1],e),Xn(l)}getNamedWeights(t){const e=[],s=t!=null&&t.trainableOnly,r=s?this.trainableWeights:this.weights,o=this.getWeights(s);for(let i=0;i<r.length;++i)s&&!r[i].trainable||e.push({name:r[i].originalName,tensor:o[i]});return e}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const e=og().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=e-og().numTensors}return t}getLossIdentifiers(){let t;if(typeof this.loss=="string")t=eo(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if(typeof e!="string")throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(e=>eo(e))}else{const e=Object.keys(this.loss);t={};const s=this.loss;for(const r of e)if(typeof s[r]=="string")t[r]=eo(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return t}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[eo(jd(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(t=>eo(jd(t)));{const t={};for(const e in this.metrics)t[e]=eo(jd(this.metrics[e]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const e=Kx(t.optimizer_config),s=no(e);let r;if(typeof t.loss=="string")r=Pi(t.loss);else if(Array.isArray(t.loss))r=t.loss.map(i=>Pi(i));else if(t.loss!=null){r={};for(const i in t.loss)r[i]=Pi(t.loss[i])}let o;if(Array.isArray(t.metrics))o=t.metrics.map(i=>Pi(i));else if(t.metrics!=null){o={};for(const i in t.metrics)o[i]=Pi(t.metrics[i])}this.compile({loss:r,metrics:o,optimizer:s})}async save(t,e){if(typeof t=="string"){const u=Z_(t);if(u.length===0)throw new B(`Cannot find any save handlers for URL '${t}'`);if(u.length>1)throw new B(`Found more than one (${u.length}) save handlers for URL '${t}'`);t=u[0]}if(t.save==null)throw new B("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await hw(this.getNamedWeights(e)),r=!1,o=null,a={modelTopology:this.toJSON(o,r),format:yB,generatedBy:`TensorFlow.js tfjs-layers v${UC}`,convertedBy:null};if((e==null?!1:e.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:h,specs:d}=await hw(await this.optimizer.getWeights(),u);s.specs.push(...d),s.data=Y_([s.data,h])}return this.userDefinedMetadata!=null&&(WC(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,t.save(a)}setUserDefinedMetadata(t){WC(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}Va.className="Model",ct(Va);class QC extends Va{}QC.className="Functional",ct(QC);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class sc extends Va{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:Fd("sequential_"),t.layers!=null)for(const e of t.layers)this.add(e)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new B(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const e=t instanceof sc||t instanceof Va;let s;if(e){if(s=t,s.outputs.length!==1)throw new B("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new B("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new B("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=C3({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(r)}if(e)this.outputs=s.outputs,this.inputs=s.inputs;else{if(t.inboundNodes.length!==1)throw new B(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new B("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=$C(this.outputs[0])}this.inboundNodes=[],new Bd({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Li(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=t.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,e){return this.model==null&&this.build(),this.model.call(t,e)}build(t){if(le(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Va({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,e,s=console.log){this.built||this.build(),super.summary(t,e,s)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,e,s={}){if(!this.built)throw new zs("The model needs to be compiled before being used.");return this.model.evaluate(t,e,s)}async evaluateDataset(t,e){if(!this.built)throw new zs("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,e)}predict(t,e={}){return this.model==null&&this.build(),this.model.predict(t,e)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,e,s={}){if(!this.built)throw new zs("The model needs to be compiled before being used.");return this.model.fit(t,e,s)}async fitDataset(t,e){if(!this.built)throw new zs("The model needs to be compiled before being used.");return this.model.fitDataset(t,e)}async trainOnBatch(t,e){return this.model.trainOnBatch(t,e)}static fromConfig(t,e,s={},r=!1){let o,i={};if(e instanceof Array){if(e[0].className==null||e[0].className==="Merge")throw new B("Legacy serialization format not supported yet.");o=e}else A(e.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=e.layers,delete e.layers,i=e;const a=new t(i);if(!(a instanceof sc))throw new Ht(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of o){const h=no(l,void 0,r);r&&h.setFastWeightInitDuringBuild(!0),a.add(h)}return a}set stopTraining(t){if(this.model==null)throw new B("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new B("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const e of this.layers){const s={};s.className=e.getClassName(),s.config=e.getConfig(),t.push(s)}return{name:this.name,layers:t}}}sc.className="Sequential",ct(sc);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Yn=class extends Ba{getConfig(){return{}}};class tI extends Yn{apply(t,e=1){return i3(t,e)}}tI.className="elu",ct(tI);class eI extends Yn{apply(t){return Gw(t)}}eI.className="selu",ct(eI);class nI extends Yn{apply(t){return Ri(t)}}nI.className="relu",ct(nI);class sI extends Yn{apply(t){return X(()=>Lu(6,Ri(t)))}}sI.className="relu6",ct(sI);class rI extends Yn{apply(t){return t}}rI.className="linear",ct(rI);class oI extends Yn{apply(t){return Da(t)}}oI.className="sigmoid",ct(oI);class iI extends Yn{apply(t){return l3(t)}}iI.className="hardSigmoid",ct(iI);class aI extends Yn{apply(t){return Ou(t)}}aI.className="softplus",ct(aI);class lI extends Yn{apply(t){return a3(t)}}lI.className="softsign",ct(lI);class uI extends Yn{apply(t){return cg(t)}}uI.className="tanh",ct(uI);let Jx=class extends Yn{apply(t,e=-1){return Fg(t,e)}};Jx.className="softmax",ct(Jx);class cI extends Yn{apply(t,e=-1){return Fw(t,e)}}cI.className="logSoftmax",ct(cI);class hI extends Yn{apply(t,e=1){return X(()=>W(Da(W(t,e)),t))}}hI.className="swish",ct(hI);class dI extends Yn{apply(t){return X(()=>W(t,cg(Ou(t))))}}dI.className="mish",ct(dI);function zo(n){return n.getClassName()}function Qx(n,t={}){return Ku(n,Bs.getMap().classNameMap,t,"activation")}function Wo(n){if(n==null){const t={};return t.className="linear",t.config={},Qx(t)}if(typeof n=="string"){const t={};return t.className=n,t.config={},Qx(t)}else return n instanceof Yn?n:Qx(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wB(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class fI extends Ba{}class pI extends fI{constructor(t){super(),wB(t),this.l1=t==null||t.l1==null?.01:t.l1,this.l2=t==null||t.l2==null?.01:t.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(t){return X(()=>{let e=fn([1]);return this.hasL1&&(e=dt(e,At(W(this.l1,Fn(t))))),this.hasL2&&(e=dt(e,At(W(this.l2,Xu(t))))),U(e,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,e){return new t({l1:e.l1,l2:e.l2})}}pI.className="L1L2",ct(pI);const mI={l1l2:"L1L2"};function Ce(n){return Cx(n)}function gI(n,t={}){return Ku(n,Bs.getMap().classNameMap,t,"regularizer")}function Le(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in mI?mI[n]:n,config:{}};return gI(e)}else return n instanceof fI?n:gI(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class xI extends Zt{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null&&(this.maxValue=t.maxValue)}call(t,e){t=Pt(t);let s=Ri(t);return this.maxValue!=null&&(s=ws(s,0,this.maxValue)),s}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},e=super.getConfig();return Object.assign(t,e),t}}xI.className="ReLU",ct(xI);class bI extends Zt{constructor(t){super(t??{}),this.DEFAULT_ALPHA=.3,t==null&&(t={}),this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,e){const s=Pt(t);return yg(s,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}bI.className="LeakyReLU",ct(bI);class yI extends Zt{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),this.supportsMasking=!0,this.alphaInitializer=Oe(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Le(t.alphaRegularizer),this.alphaConstraint=an(t.alphaConstraint),t.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")this.sharedAxes=[t.sharedAxes];else throw new B(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`)}build(t){t=le(t);const e=t.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)e[r-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<t.length;++r)s[r]=t[r];this.inputSpec=[new rn({ndim:t.length,axes:s})],this.built=!0}call(t,e){return t=Pt(t),kg(t,this.alpha.read())}getConfig(){const t={alphaInitializer:ze(this.alphaInitializer),alphaRegularizer:Ce(this.alphaRegularizer),alphaConstraint:on(this.alphaConstraint),sharedAxes:this.sharedAxes},e=super.getConfig();return Object.assign(t,e),t}}yI.className="PReLU",ct(yI);let wI=class extends Zt{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==this.DEFAULT_ALPHA)throw new Ht(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,e){const s=Pt(t);return wd(s)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}};wI.className="ELU",ct(wI);class vI extends Zt{constructor(t){super(t??{}),this.DEFAULT_THETA=1,t==null&&(t={}),this.theta=t.theta==null?this.DEFAULT_THETA:t.theta}call(t,e){const s=Pt(t);return W(s,vt(vs(s,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},e=super.getConfig();return Object.assign(t,e),t}}vI.className="ThresholdedReLU",ct(vI);class CI extends Zt{constructor(t){super(t??{}),this.DEFAULT_AXIS=1,t==null&&(t={}),this.softmax=new Jx().apply,this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis}call(t,e){return X(()=>{let s=Pt(t);const r=e.mask;if(r!=null){const o=W(Ot(Fo(s.shape),vt(r,s.dtype)),fe(-1e9));s=dt(s,o)}return this.axis instanceof Array?this.axis.length>1?Nr(Ot(s,Ow(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}CI.className="Softmax",ct(CI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ua(n,t,e){if(typeof n=="number")return Li(n,t);if(n.length!==t)throw new B(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${n.length} elements.`);for(let s=0;s<t;++s){const r=n[s];if(!n3(r))throw new B(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function pr(n,t,e,s,r=1){if(n==null)return n;const o=t+(t-1)*(r-1);let i;return e==="same"?i=n:i=n-o+1,Math.floor((i+s-1)/s)}function Lr(n,t,e,s){if(n==null)return null;if(s==="valid")n=n*t+Mo([e-t,0]);else if(s==="same")n=n*t;else throw new B(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tb(n,t){return X(()=>(Xe(t),t==="channelsFirst"?se(n,[0,2,3,1]):n))}function II(n,t){return X(()=>(Xe(t),t==="channelsFirst"?se(n,[0,2,3,4,1]):n))}function vB(n,t,e,s=1,r="valid",o,i=1){return X(()=>{if(o==null&&(o=cr()),Xe(o),n.shape.length!==3)throw new B(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(t.shape.length!==3)throw new B(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(e!=null&&e.shape.length!==1)throw new B(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(o==="channelsFirst"&&(n=se(n,[0,2,1])),r==="causal")throw new Ht("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=$w(n,t,s,r==="same"?"same":"valid","NWC",i);return e!=null&&(a=hr(a,e)),a})}function $I(n,t,e,s=[1,1],r="valid",o,i,a=null){return X(()=>{if(o==null&&(o=cr()),Xe(o),n.rank!==3&&n.rank!==4)throw new B(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(t.rank!==3&&t.rank!==4)throw new B(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=tb(n,o);if(r==="causal")throw new Ht("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=RO({x:l,filter:t,strides:s,pad:r==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:e,activation:a}),o==="channelsFirst"&&(l=se(l,[0,3,1,2])),l})}function CB(n,t,e,s=[1,1,1],r="valid",o,i){return X(()=>{if(o==null&&(o=cr()),Xe(o),n.rank!==4&&n.rank!==5)throw new B(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(t.rank!==4&&t.rank!==5)throw new B(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=II(n,o);if(r==="causal")throw new Ht("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=EA(a,t,s,r==="same"?"same":"valid","NDHWC",i),e!=null&&(a=hr(a,e)),o==="channelsFirst"&&(a=se(a,[0,4,1,2,3])),a})}class Yd extends Zt{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Yd.verifyArgs(e),this.rank=t,pn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ht(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Ua(e.kernelSize,t,"kernelSize"),this.strides=Ua(e.strides==null?1:e.strides,t,"strides"),this.padding=e.padding==null?"valid":e.padding,Is(this.padding),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Xe(this.dataFormat),this.activation=Wo(e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.biasInitializer=Oe(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=an(e.biasConstraint),this.biasRegularizer=Le(e.biasRegularizer),this.activityRegularizer=Le(e.activityRegularizer),this.dilationRate=Ua(e.dilationRate==null?1:e.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new B(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new B(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new B(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(Ar("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!$x(t.kernelSize,"number",1,3))throw new B(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:zo(this.activation),useBias:this.useBias,biasInitializer:ze(this.biasInitializer),biasRegularizer:Ce(this.biasRegularizer),activityRegularizer:Ce(this.activityRegularizer),biasConstraint:on(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}class Ga extends Yd{constructor(t,e){super(t,e),this.kernel=null,Ga.verifyArgs(e),this.filters=e.filters,pn(this.filters,"filters"),this.kernelInitializer=Oe(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=an(e.kernelConstraint),this.kernelRegularizer=Le(e.kernelRegularizer)}build(t){t=le(t);const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new B(`The channel dimension of the input should be defined. Found ${t[e]}`);const s=t[e],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:s}}],this.built=!0}call(t,e){return X(()=>{t=Pt(t);let s;const r=this.bias==null?null:this.bias.read(),o=rC(this.activation.getClassName());if(o!=null&&this.rank===2)s=$I(t,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)s=vB(t,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=$I(t,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=CB(t,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ht("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(t){t=le(t);const e=[],s=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let o=0;o<s.length;++o){const i=pr(s[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);e.push(i)}let r=[t[0]];return this.dataFormat==="channelsLast"?(r=r.concat(e),r.push(this.filters)):(r.push(this.filters),r=r.concat(e)),r}getConfig(){const t={filters:this.filters,kernelInitializer:ze(this.kernelInitializer),kernelRegularizer:Ce(this.kernelRegularizer),kernelConstraint:on(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new B(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class rc extends Ga{constructor(t){super(2,t),rc.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!$x(t.kernelSize,"number",1,2))throw new B(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}rc.className="Conv2D",ct(rc);class oc extends Ga{constructor(t){super(3,t),oc.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new B(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}oc.className="Conv3D",ct(oc);class kI extends rc{constructor(t){if(super(t),this.inputSpec=[new rn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new B(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=le(t),t.length!==4)throw new B("Input should have rank 4; Received input shape: "+JSON.stringify(t));const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new B("The channel dimension of the inputs should be defined. Found `None`.");const s=t[e],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new rn({ndim:4,axes:{[e]:s}})],this.built=!0}call(t,e){return X(()=>{let s=Pt(t);if(s.shape.length!==4)throw new B(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);const l=r[i],u=r[a],h=this.kernelSize[0],d=this.kernelSize[1],f=this.strides[0],m=this.strides[1],g=Lr(l,f,h,this.padding),x=Lr(u,m,d,this.padding),b=[o,g,x,this.filters];this.dataFormat!=="channelsLast"&&(s=se(s,[0,2,3,1]));let w=kw(s,this.kernel.read(),b,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(w=se(w,[0,3,1,2])),this.bias!=null&&(w=hr(w,this.bias.read(),this.dataFormat)),this.activation!=null&&(w=this.activation.apply(w)),w})}computeOutputShape(t){t=le(t);const e=t.slice();let s,r,o;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3):(s=3,r=1,o=2);const i=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return e[s]=this.filters,e[r]=Lr(e[r],l,i,this.padding),e[o]=Lr(e[o],u,a,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}kI.className="Conv2DTranspose",ct(kI);class SI extends oc{constructor(t){if(super(t),this.inputSpec=[new rn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new B(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=le(t),t.length!==5)throw new B("Input should have rank 5; Received input shape: "+JSON.stringify(t));const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new B("The channel dimension of the inputs should be defined. Found `None`.");const s=t[e],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new rn({ndim:5,axes:{[e]:s}})],this.built=!0}call(t,e){return X(()=>{let s=Pt(t);if(s.shape.length!==5)throw new B(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a,l;this.dataFormat==="channelsFirst"?(l=2,i=3,a=4):(l=1,i=2,a=3);const u=r[l],h=r[i],d=r[a],f=this.kernelSize[0],m=this.kernelSize[1],g=this.kernelSize[2],x=this.strides[0],b=this.strides[1],w=this.strides[2],v=Lr(u,x,f,this.padding),I=Lr(h,b,m,this.padding),C=Lr(d,w,g,this.padding),k=[o,v,I,C,this.filters];this.dataFormat!=="channelsLast"&&(s=se(s,[0,2,3,4,1]));let N=AA(s,this.kernel.read(),k,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(N=se(N,[0,4,1,2,3])),this.bias!==null&&(N=hr(N,this.bias.read(),this.dataFormat)),this.activation!==null&&(N=this.activation.apply(N)),N})}computeOutputShape(t){t=le(t);const e=t.slice();let s,r,o,i;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3,i=4):(s=4,r=1,o=2,i=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],h=this.strides[0],d=this.strides[1],f=this.strides[2];return e[s]=this.filters,e[r]=Lr(e[r],h,a,this.padding),e[o]=Lr(e[o],d,l,this.padding),e[i]=Lr(e[i],f,u,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}SI.className="Conv3DTranspose",ct(SI);class NI extends Ga{constructor(t,e){if(super(t,e),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,e.filters==null)throw new B("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(e.kernelInitializer!=null||e.kernelRegularizer!=null||e.kernelConstraint!=null)throw new B("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(e.padding!=null&&e.padding!=="same"&&e.padding!=="valid")throw new B(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(e.padding)}`);this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Oe(e.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Le(e.depthwiseRegularizer),this.depthwiseConstraint=an(e.depthwiseConstraint),this.pointwiseInitializer=Oe(e.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Le(e.pointwiseRegularizer),this.pointwiseConstraint=an(e.pointwiseConstraint)}build(t){if(t=le(t),t.length<this.rank+2)throw new B(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null||t[e]<0)throw new B(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[e])}`);const s=t[e],r=this.kernelSize.concat([s,this.depthMultiplier]),o=[];for(let a=0;a<this.rank;++a)o.push(1);o.push(s*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new rn({ndim:this.rank+2,axes:{[e]:s}})],this.built=!0}call(t,e){return X(()=>{t=Pt(t);let s;if(this.rank===1)throw new Ht("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(t=se(t,[0,2,3,1])),s=Hw(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=hr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=se(s,[0,3,1,2])),s})}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=ze(this.depthwiseInitializer),t.pointwiseInitializer=ze(this.pointwiseInitializer),t.depthwiseRegularizer=Ce(this.depthwiseRegularizer),t.pointwiseRegularizer=Ce(this.pointwiseRegularizer),t.depthwiseConstraint=on(this.depthwiseConstraint),t.pointwiseConstraint=on(this.pointwiseConstraint),t}}NI.className="SeparableConv";class TI extends NI{constructor(t){super(2,t)}}TI.className="SeparableConv2D",ct(TI);class Zd extends Ga{constructor(t){super(1,t),Zd.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!$x(t.kernelSize,"number",1,1))throw new B(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}Zd.className="Conv1D",ct(Zd);class EI extends Zt{constructor(t){super(t),typeof t.cropping=="number"?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,e){return X(()=>{if(t=Pt(t),this.dataFormat==="channelsLast"){const s=Od(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Od(s,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Od(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Od(s,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}EI.className="Cropping2D",ct(EI);class _I extends Zt{constructor(t){super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=t.size==null?this.DEFAULT_SIZE:t.size,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Xe(this.dataFormat),this.interpolation=t.interpolation==null?"nearest":t.interpolation,QM(this.interpolation)}computeOutputShape(t){if(this.dataFormat==="channelsFirst"){const e=t[2]==null?null:this.size[0]*t[2],s=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],e,s]}else{const e=t[1]==null?null:this.size[0]*t[1],s=t[2]==null?null:this.size[1]*t[2];return[t[0],e,s,t[3]]}}call(t,e){return X(()=>{let s=Pt(t);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=se(s,[0,2,3,1]);const o=this.size[0]*r[2],i=this.size[1]*r[3],a=this.interpolation==="nearest"?Jr.resizeNearestNeighbor(s,[o,i]):Jr.resizeBilinear(s,[o,i]);return se(a,[0,3,1,2])}else{const o=this.size[0]*r[1],i=this.size[1]*r[2];return this.interpolation==="nearest"?Jr.resizeNearestNeighbor(s,[o,i]):Jr.resizeBilinear(s,[o,i])}})}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}}_I.className="UpSampling2D",ct(_I);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function IB(n,t,e=[1,1],s="valid",r,o){return X(()=>{r==null&&(r=cr()),Xe(r);let i=tb(n,r);if(n.rank!==4)throw new B(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(t.rank!==4)throw new B(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return i=mg(i,t,e,s==="same"?"same":"valid","NHWC",o),r==="channelsFirst"&&(i=se(i,[0,3,1,2])),i})}class RI extends Yd{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Oe(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=an(t.depthwiseConstraint),this.depthwiseRegularizer=Le(t.depthwiseRegularizer)}build(t){if(t=le(t),t.length<4)throw new B(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const e=this.dataFormat==="channelsFirst"?1:3;if(t[e]==null||t[e]<0)throw new B(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[e]}).`);const s=t[e],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return X(()=>{t=Pt(t);let s=IB(t,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=hr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(t){t=le(t);const e=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],r=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,o=pr(e,this.kernelSize[0],this.padding,this.strides[0]),i=pr(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],r,o,i]:[t[0],o,i,r]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=ze(this.depthwiseInitializer),t.depthwiseRegularizer=Ce(this.depthwiseRegularizer),t.depthwiseConstraint=on(this.depthwiseRegularizer),t}}RI.className="DepthwiseConv2D",ct(RI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function AI(n,t,e,s){if(Array.isArray(n)){if(t!=null||e!=null)throw new B("When inputs is an array, neither initialState or constants should be provided");s!=null&&(e=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(t=n.slice(1,n.length)),n=n[0]}function r(o){return o==null||Array.isArray(o)?o:[o]}return t=r(t),e=r(e),{inputs:n,initialState:t,constants:e}}function DI(n,t,e,s=!1,r,o,i=!1,a=!1){return X(()=>{const l=t.shape.length;if(l<3)throw new B(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(ur(2,l));if(t=se(t,u),o!=null)throw new Ht("The rnn() functoin of the deeplearn.js backend does not support constants yet.");i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=vt(vt(r,"bool"),"float32"),r.rank===l-1&&(r=qn(r,-1)),r=se(r,u)),s&&(t=Ai(t,0),r!=null&&(r=Ai(r,0)));const h=[];let d,f=e;const m=t.shape[0],g=Fi(t);let x;r!=null&&(x=Fi(r));for(let w=0;w<m;++w){const v=g[w],I=X(()=>n(v,f));if(r==null)d=I[0],f=I[1];else{const C=X(()=>{const k=x[w],N=Ot(Ms(k),k),T=dt(W(I[0],k),W(f[0],N)),R=f.map((E,F)=>dt(W(I[1][F],k),W(E,N)));return{output:T,newStates:R}});d=C.output,f=C.newStates}a&&h.push(d)}let b;return a&&(b=Er(h,1)),[d,b,f]})}class Vo extends Zt{constructor(t){super(t);let e;if(t.cell==null)throw new B("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?e=new sb({cells:t.cell}):e=t.cell,e.stateSize==null)throw new B("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=e,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new rn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return ur(0,t).map(e=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){Px(t)&&(t=t[0]),t=t;let e=this.cell.stateSize;Array.isArray(e)||(e=[e]);const s=e[0];let r;if(this.returnSequences?r=[t[0],t[1],s]:r=[t[0],s],this.returnState){const o=[];for(const i of e)o.push([t[0],i]);return[r].concat(o)}else return r}computeMask(t,e){return X(()=>{Array.isArray(e)&&(e=e[0]);const s=this.returnSequences?e:null;if(this.returnState){const r=this.states.map(o=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[];for(let s=0;s<t;++s)e.push(null);return e}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new Ht("Constants support is not implemented in RNN yet.");Px(t)&&(t=t[0]),t=t;const e=this.stateful?t[0]:null,s=t.slice(2);this.inputSpec[0]=new rn({shape:[e,null,...s]});const r=[t[0]].concat(t.slice(2));this.cell.build(r);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!he(this.stateSpec.map(i=>i.shape[i.shape.length-1]),o))throw new B(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(i=>new rn({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(t,e=!1){X(()=>{if(!this.stateful)throw new Rr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new B("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>fn([s,r])):this.states_=[fn([s,this.cell.stateSize])];else if(t==null)qt(this.states_),this.keptStates!=null&&(qt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>fn([s,r])):this.states_[0]=fn([s,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new B(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e===!0?this.keptStates.push(this.states_.slice()):qt(this.states_);for(let r=0;r<this.states_.length;++r){const o=t[r],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,i];if(!he(o.shape,a))throw new B(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${o.shape}`);this.states_[r]=o}}this.states_=this.states_.map(r=>kr(r.clone()))})}apply(t,e){let s=e==null?null:e.initialState,r=e==null?null:e.constants;e==null&&(e={});const o=AI(t,s,r,this.numConstants);t=o.inputs,s=o.initialState,r=o.constants;let i=[],a=[];if(s!=null){e.initialState=s,i=i.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new rn({shape:u.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(e.constants=r,i=i.concat(r),this.numConstants=r.length),i[0]instanceof Or){const u=[t].concat(i),h=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=h;const f=super.apply(u,e);return this.inputSpec=d,f}else return super.apply(t,e)}call(t,e){return X(()=>{const s=e==null?null:e.mask,r=e==null?null:e.training;let o=e==null?null:e.initialState;t=Pt(t),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(t));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==i)throw new B(`RNN Layer has ${i} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},u=DI((g,x)=>{const b=this.cell.call([g].concat(x),a);return[b[0],b.slice(1)]},t,o,this.goBackwards,s,null,this.unroll,this.returnSequences),h=u[0],d=u[1],f=u[2];this.stateful&&this.resetStates(f,r);const m=this.returnSequences?d:h;return this.returnState?[m].concat(f):m})}getInitialState(t){return X(()=>{let e=fn(t.shape);return e=At(e,[1,2]),e=ju(e),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?Tx(e,[1,s]):e):this.cell.stateSize>1?[Tx(e,[1,this.cell.stateSize])]:[e]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(e.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Vo.className&&(e.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),t),e)}static fromConfig(t,e,s={}){const r=e.cell,o=no(r,s);return new t(Object.assign(e,{cell:o}))}}Vo.className="RNN",ct(Vo);class Jd extends Zt{}class eb extends Jd{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,pn(this.units,"units"),this.activation=Wo(t.activation==null?this.DEFAULT_ACTIVATION:t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=Oe(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Oe(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Oe(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Le(t.kernelRegularizer),this.recurrentRegularizer=Le(t.recurrentRegularizer),this.biasRegularizer=Le(t.biasRegularizer),this.kernelConstraint=an(t.kernelConstraint),this.recurrentConstraint=an(t.recurrentConstraint),this.biasConstraint=an(t.biasConstraint),this.dropout=Wa([1,Mo([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Wa([1,Mo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=le(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return X(()=>{if(t=t,t.length!==2)throw new B(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let s=t[1];t=t[0];const r=e.training==null?!1:e.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Uo({ones:()=>Ms(t),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Uo({ones:()=>Ms(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let o;const i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?o=Fr(W(t,i),this.kernel.read()):o=Fr(t,this.kernel.read()),this.bias!=null&&(o=hr(o,this.bias.read())),a!=null&&(s=W(s,a));let l=dt(o,Fr(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:zo(this.activation),useBias:this.useBias,kernelInitializer:ze(this.kernelInitializer),recurrentInitializer:ze(this.recurrentInitializer),biasInitializer:ze(this.biasInitializer),kernelRegularizer:Ce(this.kernelRegularizer),recurrentRegularizer:Ce(this.recurrentRegularizer),biasRegularizer:Ce(this.biasRegularizer),activityRegularizer:Ce(this.activityRegularizer),kernelConstraint:on(this.kernelConstraint),recurrentConstraint:on(this.recurrentConstraint),biasConstraint:on(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),e)}}eb.className="SimpleRNNCell",ct(eb);class FI extends Vo{constructor(t){t.cell=new eb(t),super(t)}call(t,e){return X(()=>{this.cell.dropoutMask!=null&&(qt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(qt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=e==null?null:e.mask,r=e==null?null:e.training,o=e==null?null:e.initialState;return super.call(t,{mask:s,training:r,initialState:o})})}static fromConfig(t,e){return new t(e)}}FI.className="SimpleRNN",ct(FI);class nb extends Jd{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new B("GRUCell does not support reset_after parameter set to true.");this.units=t.units,pn(this.units,"units"),this.activation=Wo(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=Wo(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=Oe(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Oe(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Oe(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Le(t.kernelRegularizer),this.recurrentRegularizer=Le(t.recurrentRegularizer),this.biasRegularizer=Le(t.biasRegularizer),this.kernelConstraint=an(t.kernelConstraint),this.recurrentConstraint=an(t.recurrentConstraint),this.biasConstraint=an(t.biasConstraint),this.dropout=Wa([1,Mo([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Wa([1,Mo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=le(t);const e=t[t.length-1];this.kernel=this.addWeight("kernel",[e,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return X(()=>{if(t=t,t.length!==2)throw new B(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const s=e.training==null?!1:e.training;let r=t[1];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Uo({ones:()=>Ms(t),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Uo({ones:()=>Ms(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,i=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(t=W(t,o[0]));let h=Fr(t,this.kernel.read());this.useBias&&(h=hr(h,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=W(r,i[0]));const d=this.recurrentKernel.read(),[f,m]=Cs(d,[2*this.units,this.units],d.rank-1),g=Fr(r,f),[x,b,w]=Cs(h,3,h.rank-1),[v,I]=Cs(g,2,g.rank-1);a=this.recurrentActivation.apply(dt(x,v)),l=this.recurrentActivation.apply(dt(b,I));const C=Fr(W(l,r),m);u=this.activation.apply(dt(w,C));const k=dt(W(a,r),W(dt(1,je(a)),u));return[k,k]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:zo(this.activation),recurrentActivation:zo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ze(this.kernelInitializer),recurrentInitializer:ze(this.recurrentInitializer),biasInitializer:ze(this.biasInitializer),kernelRegularizer:Ce(this.kernelRegularizer),recurrentRegularizer:Ce(this.recurrentRegularizer),biasRegularizer:Ce(this.biasRegularizer),activityRegularizer:Ce(this.activityRegularizer),kernelConstraint:on(this.kernelConstraint),recurrentConstraint:on(this.recurrentConstraint),biasConstraint:on(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),e)}}nb.className="GRUCell",ct(nb);class OI extends Vo{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new nb(t),super(t)}call(t,e){return X(()=>{this.cell.dropoutMask!=null&&(qt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(qt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=e==null?null:e.mask,r=e==null?null:e.training,o=e==null?null:e.initialState;return super.call(t,{mask:s,training:r,initialState:o})})}static fromConfig(t,e){return e.implmentation===0&&(e.implementation=1),new t(e)}}OI.className="GRU",ct(OI);class Qd extends Jd{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,pn(this.units,"units"),this.activation=Wo(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=Wo(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=Oe(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Oe(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Oe(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=Le(t.kernelRegularizer),this.recurrentRegularizer=Le(t.recurrentRegularizer),this.biasRegularizer=Le(t.biasRegularizer),this.kernelConstraint=an(t.kernelConstraint),this.recurrentConstraint=an(t.recurrentConstraint),this.biasConstraint=an(t.biasConstraint),this.dropout=Wa([1,Mo([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Wa([1,Mo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var e;t=le(t);const s=t[t.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,i=this.units;r=new(e=class extends Vs{apply(l,u){const h=o.apply([i]),d=new _x().apply([i]),f=o.apply([i*2]);return hC(hC(h,d),f)}},e.className="CustomInit",e)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,e){return X(()=>{const s=e.training==null?!1:e.training;if(t=t,t.length!==3)throw new B(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let r=t[1];const o=t[2];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Uo({ones:()=>Ms(t),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Uo({ones:()=>Ms(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,h,d;0<this.dropout&&this.dropout<1&&(t=W(t,i[0]));let f=Fr(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=W(r,a[0])),f=dt(f,Fr(r,this.recurrentKernel.read())),this.useBias&&(f=hr(f,this.bias.read()));const[m,g,x,b]=Cs(f,4,f.rank-1);l=this.recurrentActivation.apply(m),u=this.recurrentActivation.apply(g),h=dt(W(u,o),W(l,this.activation.apply(x))),d=this.recurrentActivation.apply(b);const w=W(d,this.activation.apply(h));return[w,w,h]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:zo(this.activation),recurrentActivation:zo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ze(this.kernelInitializer),recurrentInitializer:ze(this.recurrentInitializer),biasInitializer:ze(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Ce(this.kernelRegularizer),recurrentRegularizer:Ce(this.recurrentRegularizer),biasRegularizer:Ce(this.biasRegularizer),activityRegularizer:Ce(this.activityRegularizer),kernelConstraint:on(this.kernelConstraint),recurrentConstraint:on(this.recurrentConstraint),biasConstraint:on(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),e)}}Qd.className="LSTMCell",ct(Qd);class LI extends Vo{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Qd(t),super(t)}call(t,e){return X(()=>{this.cell.dropoutMask!=null&&(qt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(qt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=e==null?null:e.mask,r=e==null?null:e.training,o=e==null?null:e.initialState;return super.call(t,{mask:s,training:r,initialState:o})})}static fromConfig(t,e){return e.implmentation===0&&(e.implementation=1),new t(e)}}LI.className="LSTM",ct(LI);class sb extends Jd{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?t.push(...e.stateSize):t.push(e.stateSize);return t}call(t,e){return X(()=>{t=t;let s=t.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const o=[];let i;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?i=[t[0]].concat(s):i=[i[0]].concat(s),i=l.call(i,e),o.push(i.slice(1))}s=[];for(const a of o.slice().reverse())s.push(...a);return[i[0]].concat(s)})}build(t){Px(t)&&(t=t[0]),t=t;let e;this.cells.forEach((s,r)=>{Bi(`RNNCell_${r}`,()=>{s.build(t),Array.isArray(s.stateSize)?e=s.stateSize[0]:e=s.stateSize,t=[t[0],e]})}),this.built=!0}getConfig(){const t=super.getConfig(),e=o=>({className:o.getClassName(),config:o.getConfig()}),r={cells:this.cells.map(e)};return Object.assign(Object.assign({},t),r)}static fromConfig(t,e,s={}){const r=[];for(const o of e.cells)r.push(no(o,s));return new t({cells:r})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.cells)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const s of this.cells)e.push(...s.trainableWeights);return e.concat(t)}return t}getWeights(){const t=[];for(const e of this.cells)t.push(...e.weights);return Mx(t)}setWeights(t){const e=[];for(const s of this.cells){const r=s.weights.length,o=t.splice(r);for(let i=0;i<s.weights.length;++i)e.push([s.weights[i],o[i]])}Bx(e)}}sb.className="StackedRNNCells",ct(sb);function Uo(n){const{ones:t,rate:e,training:s=!1,count:r=1,dropoutFunc:o}=n,i=()=>o!=null?o(t(),e):fC(t(),e),a=()=>Yu(i,t,s);return!r||r<=1?kr(a().clone()):Array(r).fill(void 0).map(a).map(u=>kr(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var $B=function(n,t){var e={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.indexOf(s)<0&&(e[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(e[s[r]]=n[s[r]]);return e};class PI extends Vo{constructor(t){if(t.unroll)throw new Ht("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new Ht("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new rn({ndim:5})]}call(t,e){return X(()=>{if(this.cell.dropoutMask!=null&&(qt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(qt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),e&&e.constants)throw new B("ConvRNN2D cell does not support constants");const s=e==null?null:e.mask,r=e==null?null:e.training,o=e==null?null:e.initialState;return super.call(t,{mask:s,training:r,initialState:o})})}computeOutputShape(t){let e=this.computeSingleOutputShape(t);return this.returnSequences||(e=[e[0],...e.slice(2)]),this.returnState&&(e=[e,...Array(2).fill([t[0],...e.slice(-3)])]),e}getInitialState(t){return X(()=>{const{stateSize:e}=this.cell,s=t.shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)],i=fn(o);return Array.isArray(e)?Array(e.length).fill(i):[i]})}resetStates(t,e=!1){X(()=>{if(!this.stateful)throw new Rr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)];if(s[0]==null)throw new B("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>fn(o)):this.states_=[fn(o)];else if(t==null)qt(this.states_),this.keptStates!=null&&(qt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>fn(o)):this.states_[0]=fn(o);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new B(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e?this.keptStates.push(this.states_.slice()):qt(this.states_);for(let a=0;a<this.states_.length;++a){const l=t[a],u=o;if(!he(l.shape,u))throw new B(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>kr(a.clone()))})}computeSingleOutputShape(t){const{dataFormat:e,filters:s,kernelSize:r,padding:o,strides:i,dilationRate:a}=this.cell,l=e==="channelsFirst",u=t[l?3:2],h=t[l?4:3],d=pr(u,r[0],o,i[0],a[0]),f=pr(h,r[1],o,i[1],a[1]);return[...t.slice(0,2),...l?[s,d,f]:[d,f,s]]}}PI.className="ConvRNN2D";class rb extends Qd{constructor(t){const{filters:e,kernelSize:s,strides:r,padding:o,dataFormat:i,dilationRate:a}=t;super(Object.assign(Object.assign({},t),{units:e})),this.filters=e,pn(this.filters,"filters"),this.kernelSize=Ua(s,2,"kernelSize"),this.kernelSize.forEach(l=>pn(l,"kernelSize")),this.strides=Ua(r||1,2,"strides"),this.strides.forEach(l=>pn(l,"strides")),this.padding=o||"valid",Is(this.padding),this.dataFormat=i||"channelsLast",Xe(this.dataFormat),this.dilationRate=Ua(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>pn(l,"dilationRate"))}build(t){var e;t=le(t);const s=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[s]==null)throw new B(`The channel dimension of the input should be defined. Found ${t[s]}`);const r=t[s],o=4,i=this.kernelSize.concat([r,this.filters*o]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,h=this.filters;l=new(e=class extends Vs{apply(f,m){const g=u.apply([h]),x=Fo([h]),b=u.apply([h*2]);return Nx([g,x,b])}},e.className="CustomInit",e)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,e){return X(()=>{if(t.length!==3)throw new B(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const s=e.training||!1,r=t[0],o=t[1],i=t[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Uo({ones:()=>Ms(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(ut,lt,mt)=>!lt||!lt[mt]?ut:W(lt[mt],ut);let h=u(r,l,0),d=u(r,l,1),f=u(r,l,2),m=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Uo({ones:()=>Ms(o),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const g=this.recurrentDropoutMask;let x=u(o,g,0),b=u(o,g,1),w=u(o,g,2),v=u(o,g,3);const I=3,[C,k,N,T]=Cs(this.kernel.read(),a,I),[R,E,F,P]=this.useBias?Cs(this.bias.read(),a):[null,null,null,null];h=this.inputConv(h,C,R,this.padding),d=this.inputConv(d,k,E,this.padding),f=this.inputConv(f,N,F,this.padding),m=this.inputConv(m,T,P,this.padding);const[q,j,K,Y]=Cs(this.recurrentKernel.read(),a,I);x=this.recurrentConv(x,q),b=this.recurrentConv(b,j),w=this.recurrentConv(w,K),v=this.recurrentConv(v,Y);const Q=this.recurrentActivation.apply(dt(h,x)),tt=this.recurrentActivation.apply(dt(d,b)),Z=dt(W(tt,i),W(Q,this.activation.apply(dt(f,w)))),rt=W(this.recurrentActivation.apply(dt(m,v)),this.activation.apply(Z));return[rt,rt,Z]})}getConfig(){const t=super.getConfig(),e=$B(t,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},e),s)}inputConv(t,e,s,r){const o=Ti(t,e,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?hr(o,s,this.dataFormat):o}recurrentConv(t,e){return Ti(t,e,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}rb.className="ConvLSTM2DCell",ct(rb);class MI extends PI{constructor(t){const e=new rb(t);super(Object.assign(Object.assign({},t),{cell:e}))}static fromConfig(t,e){return new t(e)}}MI.className="ConvLSTM2D",ct(MI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ob extends Zt{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(this.noiseShape==null)return this.noiseShape;const e=t.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?e[r]:this.noiseShape[r]);return s}call(t,e){return X(()=>{this.invokeCallHook(t,e);const s=Pt(t);if(0<this.rate&&this.rate<1){const r=e.training==null?!1:e.training,o=this.getNoiseShape(s);return Yu(()=>fC(s,this.rate,o,this.seed),()=>s,r)}return t})}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},e=super.getConfig();return Object.assign(t,e),t}dispose(){return super.dispose()}}ob.className="Dropout",ct(ob);class BI extends ob{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const e=t.shape;return[e[0],1,e[2]]}}BI.className="SpatialDropout1D",ct(BI);class zI extends Zt{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){let e=null;t.batchSize!=null&&(e=t.batchSize),this.batchInputShape=[e,t.inputDim]}this.units=t.units,pn(this.units,"units"),this.activation=Wo(t.activation),t.useBias!=null&&(this.useBias=t.useBias),this.kernelInitializer=Oe(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Oe(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=an(t.kernelConstraint),this.biasConstraint=an(t.biasConstraint),this.kernelRegularizer=Le(t.kernelRegularizer),this.biasRegularizer=Le(t.biasRegularizer),this.activityRegularizer=Le(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){t=le(t);const e=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[e,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:e}}],this.built=!0}computeOutputShape(t){t=le(t);const e=t.slice();return e[e.length-1]=this.units,e}call(t,e){return X(()=>{this.invokeCallHook(t,e);const s=Pt(t),r=rC(this.activation.getClassName());let o;return r!=null?o=Fr(s,this.kernel.read(),r,this.bias?this.bias.read():null):(o=Fr(s,this.kernel.read()),this.bias!=null&&(o=hr(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const t={units:this.units,activation:zo(this.activation),useBias:this.useBias,kernelInitializer:ze(this.kernelInitializer),biasInitializer:ze(this.biasInitializer),kernelRegularizer:Ce(this.kernelRegularizer),biasRegularizer:Ce(this.biasRegularizer),activityRegularizer:Ce(this.activityRegularizer),kernelConstraint:on(this.kernelConstraint),biasConstraint:on(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}zI.className="Dense",ct(zI);class WI extends Zt{constructor(t){t=t||{},super(t),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=le(t);for(const e of t.slice(1))if(e==null)throw new B(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],Po(t,1)]}call(t,e){return X(()=>{this.invokeCallHook(t,e);let s=Pt(t);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let o=2;o<s.rank;++o)r.push(o);r.push(1),s=se(s,r)}return o3(s)})}getConfig(){const t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);const e=super.getConfig();return Object.assign(t,e),t}}WI.className="Flatten",ct(WI);class VI extends Zt{constructor(t){super(t),this.supportsMasking=!0,this.activation=Wo(t.activation)}call(t,e){return X(()=>{this.invokeCallHook(t,e);const s=Pt(t);return this.activation.apply(s)})}getConfig(){const t={activation:zo(this.activation)},e=super.getConfig();return Object.assign(t,e),t}}VI.className="Activation",ct(VI);class UI extends Zt{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,e){return X(()=>(t=Pt(t),s3(t,this.n)))}getConfig(){const t={n:this.n},e=super.getConfig();return Object.assign(t,e),t}}UI.className="RepeatVector",ct(UI);class GI extends Zt{constructor(t){super(t),this.targetShape=t.targetShape;for(let e=0;e<this.targetShape.length;++e)this.isUnknown(this.targetShape[e])&&(this.targetShape[e]=null)}isUnknown(t){return t<0||t==null}fixUnknownDimension(t,e){const s="Total size of new array must be unchanged.",r=e.slice();let o=1,i=null;for(let l=0;l<r.length;++l){const u=r[l];if(this.isUnknown(u))if(i===null)i=l;else throw new B("Can only specifiy one unknown dimension.");else o*=u}const a=Po(t);if(i!==null){if(o===0||a%o!==0)throw new B(s);r[i]=a/o}else if(a!==o)throw new B(s);return r}computeOutputShape(t){let e=!1;for(let s=0;s<t.length;++s)if(this.isUnknown(t[s])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,e){return X(()=>{this.invokeCallHook(t,e);const s=Pt(t),r=s.shape,o=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return U(s,o)})}getConfig(){const t={targetShape:this.targetShape},e=super.getConfig();return Object.assign(t,e),t}}GI.className="Reshape",ct(GI);class HI extends Zt{constructor(t){if(super(t),t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const e=ur(1,t.dims.length+1);if(!he(t.dims.slice().sort(),e))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new rn({ndim:this.dims.length+1})]}computeOutputShape(t){t=le(t);const e=t.slice();return this.dims.forEach((s,r)=>{e[r+1]=t[s]}),e}call(t,e){return se(Pt(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},e=super.getConfig();return Object.assign(t,e),t}}HI.className="Permute",ct(HI);class KI extends Zt{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null?this.maskValue=t.maskValue==null?0:t.maskValue:this.maskValue=0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={maskValue:this.maskValue};return Object.assign(e,t),e}computeMask(t,e){const s=Pt(t),r=-1;return ig(kd(s,this.maskValue),r)}call(t,e){return X(()=>{this.invokeCallHook(t,e);const s=Pt(t),r=-1,o=!0,i=ig(kd(s,this.maskValue),r,o);return W(s,vt(i,s.dtype))})}}KI.className="Masking",ct(KI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class qI extends Zt{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){let e=null;t.batchSize!=null&&(e=t.batchSize),t.inputLength==null?this.batchInputShape=[e,null]:this.batchInputShape=[e].concat(ve(t.inputLength))}this.inputDim=t.inputDim,pn(this.inputDim,"inputDim"),this.outputDim=t.outputDim,pn(this.outputDim,"outputDim"),this.embeddingsInitializer=Oe(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Le(t.embeddingsRegularizer),this.activityRegularizer=Le(t.activityRegularizer),this.embeddingsConstraint=an(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,e){return X(()=>this.maskZero?(t=Pt(t),kd(t,ne(t))):null)}computeOutputShape(t){if(t=le(t),this.inputLength==null)return[...t,this.outputDim];const e=ve(this.inputLength);if(e.length!==t.length-1)throw new B(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let s=0;for(let r=0;r<e.length;++r){const o=e[r],i=t[r+1];if(o!=null&&i!=null&&o!==i)throw new B(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);o==null&&(e[s]=i),s++}}return[t[0],...e,this.outputDim]}call(t,e){return X(()=>{this.invokeCallHook(t,e);let s=Pt(t);s.dtype!=="int32"&&(s=Dr(s,"int32"));const r=dC(this.embeddings.read(),U(s,[s.size]));return U(r,le(this.computeOutputShape(s.shape)))})}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:ze(this.embeddingsInitializer),embeddingsRegularizer:Ce(this.embeddingsRegularizer),activityRegularizer:Ce(this.activityRegularizer),embeddingsConstraint:on(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},e=super.getConfig();return Object.assign(t,e),t}}qI.className="Embedding",ct(qI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Vi extends Zt{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new Ht}computeElementwiseOpOutputShape(t,e){if(t==null||e==null)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(e.length===0)return t;const s=t.slice(0,t.length-e.length);for(let r=0;r<e.length;++r){const o=t[t.length-e.length+r],i=e[r];if(o==null||i==null||o<0||i<0)s.push(null);else if(o===1)s.push(i);else if(i===1)s.push(o);else{if(o!==i)throw new B("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));s.push(o)}}return s}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[le(t)]),t=t,t.length<2)throw new B(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(const o of t)o!=null&&o[0]!==null&&e.push(o[0]);if(e=Lo(e),e.length>1)throw new B(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let s=t[0]==null?null:t[0].slice(1);for(let o=1;o<t.length;++o){const i=t[o]==null?null:t[o].slice(1);s=this.computeElementwiseOpOutputShape(s,i)}const r=t.map(o=>o.length);t.indexOf(null)===-1&&Lo(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,e){return X(()=>{if(t=t,this.reshapeRequired){const s=[],r=t.map(o=>o.rank);if(r.indexOf(null)===-1){const o=Mo(r);for(let i of t){const a=i.rank;for(let l=0;l<o-a;++l)i=ju(i,1);s.push(i)}return this.mergeFunction(s)}else{let o=!1;for(const l of t){const u=l.rank;if(u==null){const h=l.shape,d=h[0],f=h.slice(1).concat([d]);let m=U(l,[d].concat(Po(h.slice(1))));m=se(m,[1,0]),m=U(m,f),s.push(m),o=!0}else if(u>1){const h=ur(1,u).concat([0]);s.push(se(l,h)),o=!0}else s.push(l)}let i=this.mergeFunction(s);const a=i.rank;if(o){if(a==null){const l=i.shape,u=l.length,h=l[u-1],d=[h].concat(l.slice(0,l.length-1));i=U(se(U(i,[-1,h]),[1,0]),d)}else if(a>1){const l=[a-1].concat(ur(0,a-1));i=se(i,l)}}return i}}else return this.mergeFunction(t)})}computeOutputShape(t){t=t;let e;t[0]==null?e=null:e=t[0].slice(1);for(let r=1;r<t.length;++r){const o=t[r]==null?null:t[r].slice(1);e=this.computeElementwiseOpOutputShape(e,o)}let s=[];for(const r of t)r!=null&&r[0]!==null&&s.push(r[0]);return s=Lo(s),s.length===1?e=s.concat(e):e=[null].concat(e),e}computeMask(t,e){return X(()=>{if(e==null)return null;if(!Array.isArray(e))throw new B("`mask` should be an Array");if(!Array.isArray(t))throw new B("`inputs` should be an Array");if(e.length!==t.length)throw new B(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every(r=>r==null))return null;e=e.map(r=>r==null?r:qn(r,0));let s=e[0];for(let r=1;r<e.length-1;++r)s=Zr(s,e[r]);return s})}}class jI extends Vi{constructor(t){super(t)}mergeFunction(t){return X(()=>{let e=t[0].clone();for(let s=1;s<t.length;++s)e=dt(e,t[s]);return e})}}jI.className="Add",ct(jI);class XI extends Vi{constructor(t){super(t)}mergeFunction(t){return X(()=>{let e=t[0].clone();for(let s=1;s<t.length;++s)e=W(e,t[s]);return e})}}XI.className="Multiply",ct(XI);class YI extends Vi{constructor(t){super(t)}mergeFunction(t){return X(()=>{let e=t[0].clone();for(let s=1;s<t.length;++s)e=dt(e,t[s]);return W(1/t.length,e)})}}YI.className="Average",ct(YI);class ZI extends Vi{constructor(t){super(t)}mergeFunction(t){return X(()=>{let e=t[0];for(let s=1;s<t.length;++s)e=Do(e,t[s]);return e})}}ZI.className="Maximum",ct(ZI);class JI extends Vi{constructor(t){super(t)}mergeFunction(t){return X(()=>{let e=t[0];for(let s=1;s<t.length;++s)e=Lu(e,t[s]);return e})}}JI.className="Minimum",ct(JI);class QI extends Vi{constructor(t){super(t),this.DEFAULT_AXIS=-1,t==null&&(t={}),this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new B("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let e=!0;for(const r of t)if(r!=null){e=!1;break}if(e)return;const s=[];for(let r=0;r<t.length;++r){const o=t[r].slice();o.splice(this.axis,1);let i=!1;for(const a of s)if(he(a,o)){i=!0;break}i||s.push(o)}if(s.length>1)throw new B("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return X(()=>Nx(t,this.axis))}computeOutputShape(t){if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new B("A `Concatenate` layer should be called on a list of inputs.");const e=t,s=e[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const o of e.slice(1)){if(s[r]==null||o[r]==null){s[r]=null;break}s[r]+=o[r]}return s}computeMask(t,e){if(e==null)return null;if(!Array.isArray(e))throw new B("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new B("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new B(`Mismatch in the length of mask (${e.length}) and the legnth of inputs (${t.length})`);return X(()=>{let s=!0;if(e.forEach(i=>{if(i!=null){s=!1;return}}),s)return null;const r=[];for(let i=0;i<t.length;++i)e[i]==null?r.push(vt(Ms(t[i]),"bool")):e[i].rank<t[i].rank?r.push(qn(e[i],-1)):r.push(e[i]);const o=Kn(r,this.axis);return Iw(o,-1,!1)})}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}QI.className="Concatenate",ct(QI);function ic(n,t){for(;n<0;)n+=t;return n}function kB(n,t,e){if(n.shape.length>3||t.shape.length>3)throw new Ht("batchDot is not implemented for tensors of 4D or higher rank yet");if(A(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),A(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof e=="number"&&(e=[e,e]),n.dtype==="complex64"||t.dtype==="complex64")throw new Ht("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=t.shape.length;e==null&&(e=[s-1,r-2]);const o=e;return X(()=>{let i;if(s>r){i=s-r;const l=[];for(let u=0;u<i;++u)l.push(1);t=U(t,t.shape.concat(l))}else if(r>s){i=r-s;const l=[];for(let u=0;u<i;++u)l.push(1);n=U(n,n.shape.concat(l))}else i=0;let a;if(n.shape.length===2&&t.shape.length===2)o[0]===o[1]?a=At(W(n,t),o[0]):a=At(W(se(n,[1,0]),t),o[1]);else{const l=o[0]!==n.shape.length-1,u=o[1]===t.shape.length-1;a=de(n,t,l,u)}if(i>0){let l;s>r?l=s+r-3:l=s-1;const u=[];for(let h=l;h<l+i;++h)u.push(h);a=zu(a,u)}return a.shape.length===1&&(a=qn(a,1)),a})}class t$ extends Vi{constructor(t){super(t),this.axes=t.axes,this.normalize=t.normalize==null?!1:t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){A(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const e=t[0],s=t[1];if(e.length>3||s.length>3)throw new Ht("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,s);if(e[r[0]]!==s[r[1]])throw new B(`Dimension incompatibility: ${e[r[0]]} !== ${s[r[1]]}`)}mergeFunction(t){if(t.length!==2)throw new B(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let e=t[0],s=t[1],r;return Array.isArray(this.axes)?r=this.axes.map((o,i)=>ic(o,t[i].shape.length)):r=[ic(this.axes,e.shape.length),ic(this.axes,s.shape.length)],this.normalize&&(e=Vd(e,r[0]),s=Vd(s,r[1])),kB(e,s,r)}interpretAxes(t,e){let s;return Array.isArray(this.axes)?s=this.axes:s=[ic(this.axes,t.length),ic(this.axes,e.length)],s}computeOutputShape(t){A(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const e=t[0].slice(),s=t[1].slice();if(e.length>3||s.length>3)throw new Ht("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,s);e.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const o=e.concat(s);return o.length===1&&o.push(1),o}computeMask(t,e){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},e=super.getConfig();return Object.assign(t,e),t}}t$.className="Dot",ct(t$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class e$ extends Zt{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={stddev:this.stddev};return Object.assign(e,t),e}call(t,e){return X(()=>{this.invokeCallHook(t,e);const s=Pt(t);return Yu(()=>dt(Ld(s.shape,0,this.stddev),s),()=>s,e.training||!1)})}}e$.className="GaussianNoise",ct(e$);class n$ extends Zt{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return X(()=>{this.invokeCallHook(t,e);const s=Pt(t);return this.rate>0&&this.rate<1?Yu(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return W(s,Ld(s.shape,1,o))},()=>s,e.training||!1):s})}}n$.className="GaussianDropout",ct(n$);class s$ extends Zt{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||Pt(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return X(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(t);return Yu(()=>{const o=Pt(t),i=1.6732632423543772,a=1.0507009873554805,l=-i*a;let u=Ei(Mu(s),this.rate);u=Dr(u,"float32");const h=((1-this.rate)*(1+this.rate*l**2))**-.5,d=-h*l*this.rate,f=dt(W(o,u),W(dt(u,-1),l));return dt(W(f,h),d)},()=>Pt(t),e.training||!1)}return t})}}s$.className="AlphaDropout",ct(s$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ac(n,t,e,s,r,o=.001){let i;if(n.rank===2)i=oA(n,t,e,s,r,o);else if(n.rank===3)i=aA(n,t,e,s,r,o);else if(n.rank===4)i=uA(n,t,e,s,r,o);else throw new Ht(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return i}function SB(n,t,e,s,r=.001){return X(()=>{const o=Cg(n,s),i=o.mean,a=o.variance;return[ac(n,i,a,e,t,r),i,a]})}function NB(n,t,e,s,r=.001){return X(()=>{const o=Cg(n,s),i=o.mean,a=o.variance,l=[];for(const g of ur(0,n.rank))s.indexOf(g)!==-1?l.push(1):l.push(n.shape[g]);const u=U(i,l),h=U(a,l),d=t==null?null:U(t,l),f=e==null?null:U(e,l);return[ac(n,u,h,f,d,r),i,a]})}function TB(n,t,e,s,r=.001){return he(s.slice().sort(),ur(0,n.rank-1))?SB(n,t,e,s,r):NB(n,t,e,s,r)}class r$ extends Zt{constructor(t){t==null&&(t={}),super(t),this.supportsMasking=!0,this.axis=t.axis==null?-1:t.axis,this.momentum=t.momentum==null?.99:t.momentum,this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=Oe(t.betaInitializer||"zeros"),this.gammaInitializer=Oe(t.gammaInitializer||"ones"),this.movingMeanInitializer=Oe(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Oe(t.movingVarianceInitializer||"ones"),this.betaConstraint=an(t.betaConstraint),this.gammaConstraint=an(t.gammaConstraint),this.betaRegularizer=Le(t.betaRegularizer),this.gammaRegularizer=Le(t.gammaRegularizer)}build(t){t=le(t);const e=this.axis>=0?this.axis:this.axis+t.length,s=t[e];if(s==null)throw new B(`Axis ${e} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new rn({ndim:t.length,axes:{[e]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,e){return X(()=>{const s=e.training==null?!1:e.training,r=Pt(t),o=r.shape,i=o.length,a=ur(0,i),l=this.axis>=0?this.axis:this.axis+i;a.splice(l,1);const u=Li(1,i);u[l]=o[l];const h=a.slice();h.sort();const d=!he(h,ur(0,i).slice(0,i-1)),f=()=>{if(d){const v=U(this.movingMean.read(),u),I=U(this.movingVariance.read(),u),C=this.center?U(this.beta.read(),u):null,k=this.scale?U(this.gamma.read(),u):null;return ac(r,v,I,C,k,this.epsilon)}else return ac(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return f();const[m,g,x]=TB(r,this.gamma.read(),this.beta.read(),a,this.epsilon),b=(v,I,C)=>{X(()=>{const k=1-C,N=v.read(),T=W(Ot(N,I),k);v.write(Ot(N,T))})};return(()=>{b(this.movingMean,g,this.momentum),b(this.movingVariance,x,this.momentum)})(),m})}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ze(this.betaInitializer),gammaInitializer:ze(this.gammaInitializer),movingMeanInitializer:ze(this.movingMeanInitializer),movingVarianceInitializer:ze(this.movingVarianceInitializer),betaRegularizer:Ce(this.betaRegularizer),gammaRegularizer:Ce(this.gammaRegularizer),betaConstraint:on(this.betaConstraint),gammaConstraint:on(this.gammaConstraint)},e=super.getConfig();return Object.assign(t,e),t}}r$.className="BatchNormalization",ct(r$);class o$ extends Zt{constructor(t){if(t==null&&(t={}),super(t),this.axis=t.axis==null?-1:t.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const e of this.axis)if(!Number.isInteger(e))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=Oe(t.betaInitializer||"zeros"),this.gammaInitializer=Oe(t.gammaInitializer||"ones"),this.betaRegularizer=Le(t.betaRegularizer),this.gammaRegularizer=Le(t.gammaRegularizer),this.supportsMasking=!0}build(t){t=le(t);const e=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=e);for(const o of this.axis)if(o<0||o>=e)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==Lo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(o=>t[o]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(t,e){const s=Pt(t),r=s.shape,o=r.length;return X(()=>{let{mean:a,variance:l}=Cg(s,this.axis,!0);const u=Li(1,o);for(const x of this.axis)u[x]=r[x];const h=x=>x!=null&&x.shape.length!==o?U(x,u):x;let d=this.scale?h(this.gamma.read()):null,f=this.center?h(this.beta.read()):null;const m=[],g=[];for(let x=0;x<o;++x)this.axis.indexOf(x)!==-1?(m.push(r[x]),g.push(1)):(m.push(1),g.push(r[x]));return a=ar(a,m),l=ar(l,m),d!=null&&(d=ar(d,g)),f!=null&&(f=ar(f,g)),ac(s,a,l,f,d,this.epsilon)})}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ze(this.betaInitializer),gammaInitializer:ze(this.gammaInitializer),betaRegularizer:Ce(this.betaRegularizer),gammaRegularizer:Ce(this.gammaRegularizer)},e=super.getConfig();return Object.assign(t,e),t}}o$.className="LayerNormalization",ct(o$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function EB(n,t,e){return X(()=>{if(n.rank!==4)throw new B(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new B("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(e==null&&(e=cr()),e!=="channelsLast"&&e!=="channelsFirst")throw new B(`Unknown data format: ${e}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return e==="channelsFirst"?s=[[0,0],[0,0],t[0],t[1]]:s=[[0,0],t[0],t[1],[0,0]],Ig(n,s)})}class i$ extends Zt{constructor(t){if(t==null&&(t={}),super(t),this.dataFormat=t.dataFormat==null?cr():t.dataFormat,t.padding==null)this.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new B(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let e,s;if(typeof t.padding[0]=="number")e=[t.padding[0],t.padding[0]],s=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new B(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(e=t.padding[0],t.padding[1].length!==2)throw new B(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);s=t.padding[1]}this.padding=[e,s]}this.inputSpec=[new rn({ndim:4})]}computeOutputShape(t){t=le(t);let e,s;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?e=t[2]+this.padding[0][0]+this.padding[0][1]:e=null,t[3]!=null&&t[3]>=0?s=t[3]+this.padding[1][0]+this.padding[1][1]:s=null,[t[0],t[1],e,s]):(t[1]!=null&&t[1]>=0?e=t[1]+this.padding[0][0]+this.padding[0][1]:e=null,t[2]!=null&&t[2]>=0?s=t[2]+this.padding[1][0]+this.padding[1][1]:s=null,[t[0],e,s,t[3]])}call(t,e){return X(()=>EB(Pt(t),this.padding,this.dataFormat))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}i$.className="ZeroPadding2D",ct(i$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tf(n,t,e,s,r,o){return X(()=>{Xe(r),iC(o),Is(s),e==null&&(e=[1,1]),s==null&&(s="valid"),r==null&&(r=cr()),o==null&&(o="max"),n=tb(n,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=vg(n,t,e,a):i=ug(n,t,e,a),r==="channelsFirst"&&(i=se(i,[0,3,1,2])),i})}function a$(n,t,e,s,r,o){return X(()=>{Xe(r),iC(o),Is(s),e==null&&(e=[1,1,1]),s==null&&(s="valid"),r==null&&(r=cr()),o==null&&(o="max"),n=II(n,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=YD(n,t,e,a):i=XR(n,t,e,a),r==="channelsFirst"&&(i=se(i,[0,4,1,2,3])),i})}class l$ extends Zt{constructor(t){if(t.poolSize==null&&(t.poolSize=2),super(t),typeof t.poolSize=="number")this.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")this.poolSize=t.poolSize;else throw new B(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);if(pn(this.poolSize,"poolSize"),t.strides==null)this.strides=this.poolSize;else if(typeof t.strides=="number")this.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")this.strides=t.strides;else throw new B(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);pn(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,Is(this.padding),this.inputSpec=[new rn({ndim:3})]}computeOutputShape(t){t=le(t);const e=pr(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return X(()=>{this.invokeCallHook(t,e),t=ju(Pt(t),2);const s=this.poolingFunction(Pt(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return zu(s,[2])})}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}}class u$ extends l${constructor(t){super(t)}poolingFunction(t,e,s,r,o){return Xe(o),Is(r),tf(t,e,s,r,o,"max")}}u$.className="MaxPooling1D",ct(u$);class c$ extends l${constructor(t){super(t)}poolingFunction(t,e,s,r,o){return Xe(o),Is(r),tf(t,e,s,r,o,"avg")}}c$.className="AveragePooling1D",ct(c$);class h$ extends Zt{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new B(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];pn(this.poolSize,"poolSize"),pn(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Xe(this.dataFormat),Is(this.padding),this.inputSpec=[new rn({ndim:4})]}computeOutputShape(t){t=le(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2];return e=pr(e,this.poolSize[0],this.padding,this.strides[0]),s=pr(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,s]:[t[0],e,s,t[3]]}call(t,e){return X(()=>(this.invokeCallHook(t,e),this.poolingFunction(Pt(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class d$ extends h${constructor(t){super(t)}poolingFunction(t,e,s,r,o){return Xe(o),Is(r),tf(t,e,s,r,o,"max")}}d$.className="MaxPooling2D",ct(d$);class f$ extends h${constructor(t){super(t)}poolingFunction(t,e,s,r,o){return Xe(o),Is(r),tf(t,e,s,r,o,"avg")}}f$.className="AveragePooling2D",ct(f$);class p$ extends Zt{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new B(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];pn(this.poolSize,"poolSize"),pn(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Xe(this.dataFormat),Is(this.padding),this.inputSpec=[new rn({ndim:5})]}computeOutputShape(t){t=le(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],r=this.dataFormat==="channelsFirst"?t[4]:t[3];return e=pr(e,this.poolSize[0],this.padding,this.strides[0]),s=pr(s,this.poolSize[1],this.padding,this.strides[1]),r=pr(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,s,r]:[t[0],e,s,r,t[4]]}call(t,e){return X(()=>(this.invokeCallHook(t,e),this.poolingFunction(Pt(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class m$ extends p${constructor(t){super(t)}poolingFunction(t,e,s,r,o){return Xe(o),Is(r),a$(t,e,s,r,o,"max")}}m$.className="MaxPooling3D",ct(m$);class g$ extends p${constructor(t){super(t)}poolingFunction(t,e,s,r,o){return Xe(o),Is(r),a$(t,e,s,r,o,"avg")}}g$.className="AveragePooling3D",ct(g$);class x$ extends Zt{constructor(t){super(t),this.inputSpec=[new rn({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new Ht}}class b$ extends x${constructor(t){super(t||{})}call(t,e){return X(()=>{const s=Pt(t);return Qe(s,1)})}}b$.className="GlobalAveragePooling1D",ct(b$);class y$ extends x${constructor(t){super(t||{})}call(t,e){return X(()=>{const s=Pt(t);return ir(s,1)})}}y$.className="GlobalMaxPooling1D",ct(y$);class w$ extends Zt{constructor(t){super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Xe(this.dataFormat),this.inputSpec=[new rn({ndim:4})]}computeOutputShape(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new Ht}getConfig(){const t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class v$ extends w${call(t,e){return X(()=>{const s=Pt(t);return this.dataFormat==="channelsLast"?Qe(s,[1,2]):Qe(s,[2,3])})}}v$.className="GlobalAveragePooling2D",ct(v$);class C$ extends w${call(t,e){return X(()=>{const s=Pt(t);return this.dataFormat==="channelsLast"?ir(s,[1,2]):ir(s,[2,3])})}}C$.className="GlobalMaxPooling2D",ct(C$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class I$ extends Zt{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(t){this.layer!=null&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,s={}){const r=e.layer,o=no(r,s);delete e.layer;const i={layer:o};return Object.assign(i,e),new t(i)}}class $$ extends I${constructor(t){super(t),this.supportsMasking=!0}build(t){if(t=le(t),t.length<3)throw new B(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const e=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(e),this.layer.built=!0),super.build(t)}computeOutputShape(t){t=le(t);const e=[t[0]].concat(t.slice(2)),s=this.layer.computeOutputShape(e),r=t[1];return[s[0],r].concat(s.slice(1))}call(t,e){return X(()=>(t=Pt(t),DI((i,a)=>[Pt(this.layer.call(i,e)),[]],t,[],!1,null,null,!1,!0)[1]))}}$$.className="TimeDistributed",ct($$);function _B(n){Mi(JM,"BidirectionalMergeMode",n)}const RB="concat";class k$ extends I${constructor(t){super(t);const e=t.layer.getConfig(),s={};s.className=t.layer.getClassName(),s.config=e,this.forwardLayer=no(s),e.goBackwards=e.goBackwards!==!0;const r={};if(r.className=t.layer.getClassName(),r.config=e,this.backwardLayer=no(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=t.mergeMode===void 0?RB:t.mergeMode,_B(this.mergeMode),t.weights)throw new Ht("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const e=t.length,s=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,s)),this.backwardLayer.setWeights(t.slice(s))}computeOutputShape(t){let e=this.forwardLayer.computeOutputShape(t);Array.isArray(e)&&Array.isArray(e[0])||(e=[e]),e=e;let s,r,o;return this.returnState&&(o=e.slice(1)),s=e[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(o).concat(o.slice()):[s].concat(o).concat(o.slice()):Xn(r)}apply(t,e){let s=e==null?null:e.initialState,r=e==null?null:e.constants;e==null&&(e={});const o=AI(t,s,r,this.numConstants);if(t=o.inputs,s=o.initialState,r=o.constants,Array.isArray(t)&&(s=t.slice(1),t=t[0]),(s==null||s.length===0)&&r==null)return super.apply(t,e);const i=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new B("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");e.initialState=s,i.push(...s);const h=s.map(d=>new rn({shape:d.shape}));this.forwardLayer.stateSpec=h.slice(0,u/2),this.backwardLayer.stateSpec=h.slice(u/2),a.push(...h)}if(r!=null)throw new Ht("Support for constants in Bidirectional layers is not implemented yet.");const l=i[0]instanceof Or;for(const u of i)if(u instanceof Or!==l)throw new B("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[t].concat(i),h=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=h;const f=super.apply(u,e);return this.inputSpec=d,f}else return super.apply(t,e)}call(t,e){return X(()=>{const s=e.initialState;let r,o;if(s==null)r=this.forwardLayer.call(t,e),o=this.backwardLayer.call(t,e);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(t,Object.assign(e,{initialState:l})),o=this.backwardLayer.call(t,Object.assign(e,{initialState:u}))}let i;this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),this.returnSequences&&(o=Ai(o,1));let a;return this.mergeMode==="concat"?a=Nx([r,o]):this.mergeMode==="sum"?a=dt(r,o):this.mergeMode==="ave"?a=W(.5,dt(r,o)):this.mergeMode==="mul"?a=W(r,o):this.mergeMode==null&&(a=[r,o]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){Bi(this.forwardLayer.name,()=>{this.forwardLayer.build(t)}),Bi(this.backwardLayer.name,()=>{this.backwardLayer.build(t)}),this.built=!0}computeMask(t,e){Array.isArray(e)&&(e=e[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[e,e]:s=e:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const o=this.forwardLayer.states.map(i=>null);return Array.isArray(s)?s.concat(o).concat(o):[s].concat(o).concat(o)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},e=super.getConfig();return Object.assign(t,e),t}static fromConfig(t,e){const s=no(e.layer);if(delete e.layer,e.numConstants!=null)throw new Ht("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=e;return r.layer=s,new t(r)}}k$.className="Bidirectional",ct(k$);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class S$ extends Zt{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){const t={scale:this.scale,offset:this.offset},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return X(()=>(t=Pt(t),t.dtype!=="float32"&&(t=Dr(t,"float32")),dt(W(t,this.scale),this.offset)))}}S$.className="Rescaling",ct(S$);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:AB,cropAndResize:DB}=Jr;class N$ extends Zt{constructor(t){super(t),this.height=t.height,this.width=t.width}centerCrop(t,e,s,r,o,i,a,l){return X(()=>{let u,h=!1;const d=e/i,f=s/a,m=(r+e)/i,g=(o+s)/a,x=[d,f,m,g],b=[];t.rank===3?(h=!0,u=Er([t])):u=t;for(let k=0;k<u.shape[0];k++)b.push(x);const w=Qm(b,[b.length,4]),v=Bu(0,b.length,1,"int32"),C=DB(u,w,v,[r,o],"nearest");return Dr(h?Pt(Fi(C)):C,l)})}upsize(t,e,s,r){return X(()=>{const o=AB(t,[e,s]);return Dr(o,r)})}call(t,e){return X(()=>{const s=Pt(t),r=s.dtype,o=s.shape,i=o[o.length-3],a=o[o.length-2];let l=0;i!==this.height&&(l=Math.floor((i-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,i,a,r):this.upsize(t,this.height,this.width,r)})}getConfig(){const t={height:this.height,width:this.width},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){t=le(t);const e=t.length-3,s=t.length-2;return t[e]=this.height,t[s]=this.width,t}}N$.className="CenterCrop",ct(N$);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function FB(n,t,e,s){let r=Pt(n);if(r.dtype!=="int32"&&(r=Dr(r,"int32")),t==="int")return r;const o=r.shape;if(r.rank===0&&(r=qn(r,-1)),t==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=qn(r,-1)),r.rank>2)throw new B(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${o} which would result in output rank ${r.rank}.`);const i=["multiHot","oneHot"].includes(t),a=r;let l;if(typeof s<"u"&&t==="count"?l=Ew(a,s,e,i):l=Ew(a,[],e,i),t!=="tfIdf")return l;if(s)return W(l,s);throw new B("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class T$ extends Zt{constructor(t){super(t),this.numTokens=t.numTokens,t.outputMode?this.outputMode=t.outputMode:this.outputMode="multiHot"}getConfig(){const t={numTokens:this.numTokens,outputMode:this.outputMode},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){return t=le(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)}call(t,e){return X(()=>{t=Pt(t),t.dtype!=="int32"&&(t=Dr(t,"int32"));let s;if(typeof e.countWeights<"u"){if(this.outputMode!=="count")throw new B(`countWeights is not used when outputMode !== count.
              Received countWeights=${e.countWeights}`);s=Pt(e.countWeights)}const r=ir(t),o=vd(t),i=vs(this.numTokens,r).bufferSync().get(0),a=Ei(o,0).bufferSync().get(0);if(!(i&&a))throw new B(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return FB(t,this.outputMode,this.numTokens,s)})}}T$.className="CategoryEncoding",ct(T$);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const OB=["bilinear","nearest"],E$=new Set(OB);class _$ extends Zt{constructor(t){if(super(t),this.height=t.height,this.width=t.width,t.interpolation)if(E$.has(t.interpolation))this.interpolation=t.interpolation;else throw new B(`Invalid interpolation parameter: ${t.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!t.cropToAspectRatio}computeOutputShape(t){t=le(t);const e=t[2];return[this.height,this.width,e]}getConfig(){const t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return X(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Jr.resizeBilinear(t,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Jr.resizeNearestNeighbor(t,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...E$]} are supported`)})}}_$.className="Resizing",ct(_$);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class R${constructor(t){this.seed=t}next(){if(this.seed!==void 0)return this.seed++}}R$.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class A$ extends Zt{constructor(t){super(t),this.randomGenerator=new R$(t.seed)}getConfig(){const t={seed:this.randomGenerator.seed},e=super.getConfig();return Object.assign(t,e),t}}A$.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const LB=["bilinear","nearest"],D$=new Set(LB);class F$ extends A${constructor(t){super(t);const{factor:e,interpolation:s="bilinear"}=t;if(this.factor=e,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new B(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new B(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new B(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(D$.has(s))this.interpolation=s;else throw new B(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const t={factor:this.factor,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){t=le(t);const e=t[2];return[this.imgHeight,-1,e]}call(t,e){return X(()=>{const s=Pt(t);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=Mu([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*r;o=Math.round(o);const i=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return Jr.resizeBilinear(t,i);case"nearest":return Jr.resizeNearestNeighbor(t,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...D$]} are supported`)}})}}F$.className="RandomWidth",ct(F$);function O$(n,t){return Ux(n,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J().registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var L$;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(L$||(L$={}));var P$;(function(n){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(P$||(P$={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function PB(n,t){return ef(n,t)}function ef(n,t,e=new Map,s=new Set){if(n==null)return null;if(typeof Blob=="function"&&n instanceof Blob)return n.slice();if(s.has(n))throw new Error("Circular references are not supported.");if(e.has(n))return e.get(n);const r=t(n);if(r.recurse&&r.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(r.recurse)if(Ha(n)){const o=Array.isArray(n)?[]:{};s.add(n);for(const i in n){const a=n[i],l=ef(a,t,e,s);o[i]=l}return s.delete(n),n.__proto__&&(o.__proto__=n.__proto__),o}else throw new Error(`Can't recurse into non-iterable type: ${n}`);else return e.set(n,r.value),r.value}function MB(n,t=B$){return M$(n,t)}function M$(n,t,e=new Set){const s=n[0];if(e.has(s))throw new Error("Circular references are not supported.");const r=t(n);if(r.recurse&&r.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(r.recurse)if(Ha(s)){const o=Array.isArray(s)?[]:{};e.add(s);for(const i in s){const a=n.map(u=>u[i]),l=M$(a,t,e);o[i]=l}return e.delete(s),o}else throw new Error(`Can't recurse into non-iterable type: ${s}`);else return r.value}function B$(n){return n===null?null:Ha(n[0])?{value:null,recurse:!0}:{value:n,recurse:!1}}async function z$(n,t){const e=new Map;ef(n,t,e);for(const r of Array.from(e.keys())){const o=e.get(r);if(ah(o)){const i=await o;e.set(r,i)}}return ef(n,t,e)}function Ha(n){let t=!1;if(J().get("IS_BROWSER"))t=n instanceof TextDecoder;else{const{StringDecoder:e}=require("string_decoder");t=n instanceof e}return n!=null&&!ArrayBuffer.isView(n)&&(Array.isArray(n)||typeof n=="object"&&!(n instanceof Fe)&&!(n instanceof Promise)&&!t)}function BB(n){return n==null||zB(n)||Array.isArray(n)||typeof n=="object"&&n instanceof Fe||ys(n)}function zB(n){return n===null||typeof n!="object"&&typeof n!="function"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function WB(n){return PB(n,VB)}function VB(n){return n instanceof Fe?{value:n.clone(),recurse:!1}:Ha(n)?{value:null,recurse:!0}:{value:n,recurse:!1}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class W${constructor(t){if(this.capacity=t,this.begin=0,this.end=0,t==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}wrap(t){for(;t<0;)t+=this.doubledCapacity;return t%this.doubledCapacity}get(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]}set(t,e){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=e}length(){let t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t}isFull(){return this.length()===this.capacity}isEmpty(){return this.length()===0}push(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)}pushAll(t){for(const e of t)this.push(e)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const t=this.get(this.end);return this.set(this.end,void 0),t}unshift(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t}shuffleExcise(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.wrap(this.begin+t),s=this.get(e);return this.set(e,this.pop()),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class nf extends W${constructor(){super(nf.INITIAL_CAPACITY)}isFull(){return!1}push(t){super.isFull()&&this.expand(),super.push(t)}unshift(t){super.isFull()&&this.expand(),super.unshift(t)}expand(){const t=this.capacity*2,e=new Array(t),s=this.length();for(let r=0;r<s;r++)e[r]=this.get(this.wrap(this.begin+r));this.data=e,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=s}}nf.INITIAL_CAPACITY=32;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function V$(n){return new KB(n)}function UB(n){return new qB(n)}function GB(n,t){return new G$(n,t)}function HB(n,t=Go.FAIL){return new sz(n,t)}class Zn{async toArray(){const t=[];let e=await this.next();for(;!e.done;)t.push(e.value),e=await this.next();return t}async toArrayForTest(){const t=this.prefetch(100),e=[];let s=await t.next();for(;!s.done;)e.push(s.value),s=await t.next();return e}async resolveFully(){let t=await this.next();for(;!t.done;)t=await this.next()}async resolveWhile(t){let e=await this.next(),s=t(e.value);for(;!e.done&&s;)e=await this.next(),s=t(e.value)}handleErrors(t){return new tz(this,t)}filter(t){return new JB(this,t)}map(t){return new QB(this,t)}mapAsync(t){return new U$(this,t)}serialMapAsync(t){return new U$(this,t).serial()}flatmap(t){return new nz(this,t)}async forEachAsync(t){return this.map(t).resolveFully()}async serialForEach(t){return this.serialMapAsync(t).resolveWhile(e=>e===!0)}rowMajorBatch(t,e=!0){return new ZB(this,t,e)}columnMajorBatch(t,e=!0,s=B$){return this.rowMajorBatch(t,e).map(o=>MB(o,s))}concatenate(t,e){return new G$(V$([this,t]),e)}take(t){return t<0||t==null?this:new YB(this,t)}skip(t){return t<0||t==null?this:new XB(this,t)}prefetch(t){return new H$(this,t)}shuffle(t,e){return new rz(this,t,e)}serial(){return new jB(this)}}class KB extends Zn{constructor(t){super(),this.items=t,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const t=this.items[this.trav];return this.trav++,{value:WB(t),done:!1}}}class qB extends Zn{constructor(t){super(),this.nextFn=t}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(t){throw t.message=`Error thrown while iterating through a dataset: ${t.message}`,t}}}class jB extends Zn{constructor(t){super(),this.upstream=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class XB extends Zn{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const t=await this.upstream.next();if(t.done)return t;qt(t.value)}return this.upstream.next()}}class YB extends Zn{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class ZB extends Zn{constructor(t,e,s=!0){super(),this.upstream=t,this.batchSize=e,this.enableSmallLastBatch=s,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){const t=[];for(;t.length<this.batchSize;){const e=await this.upstream.next();if(e.done)return this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0};t.push(e.value)}return{value:t,done:!1}}}class JB extends Zn{constructor(t,e){super(),this.upstream=t,this.predicate=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){const t=await this.upstream.next();if(t.done||this.predicate(t.value))return t;qt(t.value)}}}class QB extends Zn{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> Map`}async next(){const t=await this.upstream.next();if(t.done)return{value:null,done:!0};const e=Eo(t.value),s=this.transform(t.value),r=Eo(s);for(const o of e)Zm(o,r)||o.dispose();return{value:s,done:!1}}}class tz extends Zn{constructor(t,e){super(),this.upstream=t,this.handler=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(t){if(!this.handler(t))return{value:null,done:!0}}}}class U$ extends Zn{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){const t=await this.upstream.next();if(t.done)return{value:null,done:!0};const e=Eo(t.value),s=await this.transform(t.value),r=Eo(s);for(const o of e)Zm(o,r)||o.dispose();return{value:s,done:!1}}}class ez extends Zn{constructor(){super(),this.outputQueue=new nf,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.outputQueue.length()===0;)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class nz extends ez{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){const t=await this.upstream.next();if(t.done)return!1;const e=Eo(t.value),s=this.transform(t.value),r=Eo(s);this.outputQueue.pushAll(s);for(const o of e)Zm(o,r)||o.dispose();return!0}}class G$ extends Zn{constructor(t,e){super(),this.baseErrorHandler=e,this.lastRead=null,this.iterator=null,this.moreIterators=t}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(t){if(await t,this.iterator==null){const s=await this.moreIterators.next();if(s.done)return{value:null,done:!0};this.iterator=s.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const e=await this.iterator.next();return e.done?(this.iterator=null,this.readFromChain(t)):e}}var Go;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(Go||(Go={}));class sz extends Zn{constructor(t,e=Go.FAIL){super(),this.iterators=t,this.mismatchMode=e,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(t){await t;let e=0,s=0;function r(i){return i instanceof Zn?{value:i.next().then(l=>(e++,l.done&&s++,l.value)),recurse:!1}:{value:null,recurse:!0}}const o=await z$(this.iterators,r);if(e===s)return{value:null,done:!0};if(s>0)switch(this.mismatchMode){case Go.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case Go.SHORTEST:return{value:null,done:!0};case Go.LONGEST:}return this.count++,{value:o,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}}class H$ extends Zn{constructor(t,e){super(),this.upstream=t,this.bufferSize=e,this.buffer=new W$(e)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){const t=this.upstream.next();this.buffer.push(t)}}next(){return this.refill(),this.buffer.shift()}}class rz extends H${constructor(t,e,s){super(t,e),this.upstream=t,this.windowSize=e,this.upstreamExhausted=!1,this.random=Pu.alea(s||Nn().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(t){return Math.floor(this.random()*t)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const t=this.chooseIndex(),e=await this.buffer.shuffleExcise(t);if(e.done)this.upstreamExhausted=!0;else return this.refill(),e}return{value:null,done:!0}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class ib{constructor(){this.size=null}batch(t,e=!0){const s=this;A(t>0,()=>`batchSize needs to be positive, but it is
      ${t}`);let r;return this.size===1/0||this.size==null?r=this.size:e?r=Math.ceil(this.size/t):r=Math.floor(this.size/t),Gs(async()=>(await s.iterator()).columnMajorBatch(t,e,iz),r)}concatenate(t){const e=this;let s;return this.size===1/0||t.size===1/0?s=1/0:this.size!=null&&t.size!=null?s=this.size+t.size:s=null,Gs(async()=>(await e.iterator()).concatenate(await t.iterator()),s)}filter(t){const e=this;let s;return this.size===1/0?s=1/0:s=null,Gs(async()=>(await e.iterator()).filter(r=>X(()=>t(r))),s)}async forEachAsync(t){return(await this.iterator()).forEachAsync(t)}map(t){const e=this;return Gs(async()=>(await e.iterator()).map(s=>X(()=>t(s))),this.size)}mapAsync(t){const e=this;return Gs(async()=>(await e.iterator()).mapAsync(t),this.size)}prefetch(t){if(t==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const e=this;return Gs(async()=>(await e.iterator()).prefetch(t),this.size)}repeat(t){const e=this;let s;return this.size!=null&&t>0?s=this.size*t:t===0?s=0:this.size!=null&&(t===void 0||t<0)?s=1/0:s=null,Gs(async()=>{const r=UB(async()=>({value:await e.iterator(),done:!1}));return GB(r.take(t))},s)}skip(t){const e=this;let s;return this.size!=null&&t>=0&&this.size>=t?s=this.size-t:this.size!=null&&(this.size<t||t===void 0||t<0)?s=0:s=null,Gs(async()=>(await e.iterator()).skip(t),s)}shuffle(t,e,s=!0){if(t==null||t<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const r=this,o=Pu.alea(e||Nn().toString());return Gs(async()=>{let i=o.int32();return s&&(i+=o.int32()),(await r.iterator()).shuffle(t,i.toString())},this.size)}take(t){const e=this;let s;return this.size!=null&&this.size>t?s=t:this.size!=null&&this.size<=t?s=this.size:s=null,Gs(async()=>(await e.iterator()).take(t),s)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}ib.MAX_BUFFER_SIZE=1e4;function Gs(n,t=null){return new class extends ib{constructor(){super(...arguments),this.size=t}async iterator(){return n()}}}function ab(n){return Gs(async()=>V$(n),n.length)}function oz(n){if(!Ha(n))throw new Error("The argument to zip() must be an object or array.");let t;if(Array.isArray(n))for(let e=0;e<n.length;e++)t=t==null?n[e].size:Math.min(t,n[e].size);else if(n instanceof Object)for(const e in n)t=t==null?n[e].size:Math.min(t,n[e].size);return Gs(async()=>{const e=await z$(n,s=>{if(s instanceof ib)return{value:s.iterator(),recurse:!1};if(Ha(s))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")});return HB(e,Go.SHORTEST)},t)}function iz(n){if(n===null)return null;const t=n[0];return BB(t)?{value:az(n),recurse:!1}:{value:null,recurse:!0}}function az(n){if(n.length===0)throw new Error("Can't make a batch of zero elements.");return n[0]instanceof Fe?Er(n):Qm(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kt(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>{e!=null&&A(e.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lz=Qw;class sf extends Gp{nextDataId(){return sf.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new Q0(this,$r())}write(t,e,s){this.firstUse&&(this.firstUse=!1,J().get("IS_NODE")&&bs(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:t,dtype:s,refCount:1}),r}makeTensorInfo(t,e,s){let r;if(e==="string"&&s!=null&&s.length>0&&_l(s[0])){const o=s.map(i=>No(i));r=this.write(o,t,e)}else r=this.write(s,t,e);return{dataId:r,shape:t,dtype:e}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){const e=this.data.get(t);e.refCount++}decRef(t){if(this.data.has(t)){const e=this.data.get(t);e.refCount--}}move(t,e,s,r,o){this.data.set(t,{values:e,dtype:r,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:e,complexTensorInfos:s}=this.data.get(t);if(e==="complex64"){const r=this.readSync(s.real.dataId),o=this.readSync(s.imag.dataId);return Qr(r,o)}return l_(this.data.get(t).values,e)}bufferSync(t){const e=this.readSync(t.dataId);if(t.dtype==="string")try{const s=e.map(r=>To(r));return Yt(t.shape,t.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Yt(t.shape,t.dtype,e)}makeOutput(t,e,s){return $r().makeTensorFromTensorInfo(this.makeTensorInfo(e,s,t),this)}disposeData(t,e=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!e&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(t);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const e=Nn();return t(),{kernelMs:Nn()-e}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){kt([t],"where");const e=this.readSync(t.dataId);return lz(t.shape,e)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}sf.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K$(n){const t=new Float32Array(n.length);for(let e=0;e<n.length;++e)t[e]=Math.abs(n[e]);return t}const uz={kernelName:lh,backendName:"cpu",kernelFunc:n=>{const{x:t}=n.inputs,e=n.backend;kt(t,"abs");let s=new Float32Array(st(t.shape));const r=e.data.get(t.dataId).values;return s=K$(r),e.makeOutput(s,t.shape,t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ye(n){return(t,e,s,r,o)=>{const i=Vt(t,e),a=i.length,l=_t(i),u=st(i),h=kn(o,u),d=t.length,f=e.length,m=_t(t),g=_t(e),x=Fa(t,i),b=Fa(e,i);if(x.length+b.length===0)for(let w=0;w<h.length;++w)h[w]=n(s[w%s.length],r[w%r.length]);else for(let w=0;w<h.length;++w){const v=Ca(w,a,l),I=v.slice(-d);x.forEach(T=>I[T]=0);const C=Cr(I,d,m),k=v.slice(-f);b.forEach(T=>k[T]=0);const N=Cr(k,f,g);h[w]=n(s[C],r[N])}return[h,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hs(n){const{inputs:t,backend:e}=n,{real:s,imag:r}=t,o=e.data.get(s.dataId).values,i=e.data.get(r.dataId).values,a=e.makeTensorInfo(s.shape,"complex64"),l=e.data.get(a.dataId);return l.complexTensorInfos={real:e.makeTensorInfo(s.shape,"float32",o),imag:e.makeTensorInfo(r.shape,"float32",i)},a}const cz={kernelName:om,backendName:"cpu",kernelFunc:hs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rf(n,t,e="float32"){if(e==="complex64"){const r=rf(n,t,"float32"),o=rf(n,t,"float32");return hs({inputs:{real:r,imag:o},backend:n})}const s=Sn(st(t),e);return n.makeTensorInfo(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pr(n){const{inputs:t,backend:e}=n,{x:s}=t;return e.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const hz={kernelName:Zl,backendName:"cpu",kernelFunc:Pr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ui(n){const{inputs:t,backend:e}=n,{input:s}=t,r=e.data.get(s.dataId).complexTensorInfos.real,o=e.data.get(r.dataId).values;return e.makeTensorInfo(r.shape,r.dtype,o)}const dz={kernelName:Rm,backendName:"cpu",kernelFunc:Ui};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q$(n,t,e,s){if(s==="int32"){const r=Int32Array.from(n);return[t,"int32",r]}if(s==="bool"){const r=wi([0],e),[o,i]=Ye((a,l)=>a!==l?1:0)(t,[],n,r,"bool");return[i,"bool",o]}throw new Error(`Error in Cast: failed to cast ${e} to ${s}`)}function Ho(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return Pr({inputs:{x:r},backend:e});const h=rf(e,r.shape,r.dtype),d=Ho({inputs:{x:r},backend:e,attrs:{dtype:"float32"}}),f=hs({inputs:{real:d,imag:h},backend:e});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(d),f}if(r.dtype==="complex64"){const h=Ui({inputs:{input:r},backend:e}),d=Ho({inputs:{x:h},backend:e,attrs:{dtype:o}});return e.disposeIntermediateTensorInfo(h),d}if(!s1(r.dtype,o)){const h=Pr({inputs:{x:r},backend:e});return{dataId:h.dataId,shape:h.shape,dtype:o}}const i=e.data.get(r.dataId).values,[a,l,u]=q$(i,r.shape,r.dtype,o);return e.makeTensorInfo(a,l,u)}const fz={kernelName:Ml,backendName:"cpu",kernelFunc:Ho};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ln(n,t,e,s){return e==null?({inputs:r,backend:o})=>{const{a:i,b:a}=r,l=o;kt([i,a],n);const u=l.data.get(i.dataId).values,h=l.data.get(a.dataId).values,d=i.dtype==="string"?to(u):u,f=i.dtype==="string"?to(h):h,m=s||i.dtype,[g,x]=t(i.shape,a.shape,d,f,m);return l.makeTensorInfo(x,m,g)}:({inputs:r,backend:o})=>{const{a:i,b:a}=r,l=o;if(i.dtype==="complex64"||a.dtype==="complex64"){const u=Ho({inputs:{x:i},backend:l,attrs:{dtype:"complex64"}}),h=l.data.get(u.dataId),d=h.complexTensorInfos.real,f=h.complexTensorInfos.imag,m=l.data.get(d.dataId).values,g=l.data.get(f.dataId).values,x=Ho({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),b=l.data.get(x.dataId),w=b.complexTensorInfos.real,v=b.complexTensorInfos.imag,I=l.data.get(w.dataId).values,C=l.data.get(v.dataId).values,[k,N,T]=e(i.shape,a.shape,m,g,I,C),R=l.makeTensorInfo(T,"float32",k),E=l.makeTensorInfo(T,"float32",N),F=hs({inputs:{real:R,imag:E},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(x),l.disposeIntermediateTensorInfo(R),l.disposeIntermediateTensorInfo(E),F}else{const u=l.data.get(i.dataId).values,h=l.data.get(a.dataId).values,d=s||i.dtype,[f,m]=t(i.shape,a.shape,u,h,d);return l.makeTensorInfo(m,d,f)}}}function lb(n){return(t,e,s,r,o,i)=>{const a=Vt(t,e),l=st(a),u=a.length,h=_t(a),d=kn("float32",l),f=kn("float32",l),m=Fa(t,a),g=Fa(e,a),x=Qr(s,r),b=Qr(o,i),w=t.length,v=_t(t),I=e.length,C=_t(e);if(m.length+g.length===0)for(let k=0;k<d.length;k++){const N=k%x.length,T=k%b.length,R=n(x[N*2],x[N*2+1],b[T*2],b[T*2+1]);d[k]=R.real,f[k]=R.imag}else for(let k=0;k<d.length;k++){const N=Ca(k,u,h),T=N.slice(-w);m.forEach(q=>T[q]=0);const R=Cr(T,w,v),E=N.slice(-I);g.forEach(q=>E[q]=0);const F=Cr(E,I,C),P=n(x[R*2],x[R*2+1],b[F*2],b[F*2+1]);d[k]=P.real,f[k]=P.imag}return[d,f,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j$=Ye((n,t)=>n+t),pz=lb((n,t,e,s)=>({real:n+e,imag:t+s})),Ka=ln(Ia,j$,pz),mz={kernelName:Ia,backendName:"cpu",kernelFunc:Ka};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ub(n,t,e,s,r){const o=st(s),i=Sn(r,e);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(o>0?i[l]+=t[a]:i[l]+=1)}return i}function X$(n,t,e,s=!1){const r=n.shape[0],o=n.shape[1],i=Yt([r,e],t.dtype);for(let a=0;a<r;a++)for(let l=0;l<o;l++){const u=n.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=e||(s?i.set(1,a,u):t.size>0?i.set(i.get(a,u)+t.get(a,l),a,u):i.set(i.get(a,u)+1,a,u))}return i}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y$=Ye((n,t)=>n&t),gz=ln(rm,Y$),xz={kernelName:rm,backendName:"cpu",kernelFunc:gz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mr(n){return(t,e,s)=>{const r=He(e,t.length);for(let o=0;o<t.length;++o)r[o]=n(t[o],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ge(n,t,e){const s=Mr(t);return Ko(n,s,e)}function Ko(n,t,e){return({inputs:s,attrs:r,backend:o})=>{const{x:i}=s;kt(i,n);const a=o,l=a.data.get(i.dataId).values;let u;if(i.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=to(l)}else u=l;const h=e||i.dtype,d=t(u,h,r);return a.makeTensorInfo(i.shape,h,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z$=Mr(n=>Math.ceil(n)),bz=Ko(Bl,Z$),yz={kernelName:Bl,backendName:"cpu",kernelFunc:bz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J$(n,t,e,s){const r=He(e,st(t));if(s&&e!=="string"){let o=0;n.forEach(i=>{const a=st(i.shape);r.set(i.vals,o),o+=a})}else{let o=0;n.forEach(i=>{const a=e==="string"?to(i.vals):i.vals;let l=0;for(let u=0;u<i.shape[0];++u){const h=u*t[1]+o;for(let d=0;d<i.shape[1];++d)r[h+d]=a[l++]}o+=i.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q$=Ye((n,t)=>n===t?1:0),tk=ln(Ih,Q$,null,"bool"),wz={kernelName:Ih,backendName:"cpu",kernelFunc:tk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ek=Mr(n=>Math.exp(n)),nk=Ko(Kl,ek,"float32"),vz={kernelName:Kl,backendName:"cpu",kernelFunc:nk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sk=Mr(n=>Math.expm1(n)),Cz=Ko(ql,sk),Iz={kernelName:ql,backendName:"cpu",kernelFunc:Cz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rk=Mr(n=>Math.floor(n)),$z=Ko(jl,rk),kz={kernelName:jl,backendName:"cpu",kernelFunc:$z};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ok=Ye((n,t)=>Math.floor(n/t)),Sz=ln(Xl,ok,null,"int32"),Nz={kernelName:Xl,backendName:"cpu",kernelFunc:Sz};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ik(n,t,e,s,r,o,i,a,l){const u=Yt([s,o],e);for(let h=0;h<s;h++){const d=[];let f=0;for(let m=0;m<r;m++){const g=n[h*r+m];f+=g*i[m],d.push(g)}if(f<0||f>=l/o)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let m=0;m<o;m++)u.values[h*o+m]=t.get(...t.indexToLoc(f*o+m))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ak(n,t,e){const s=Yt(e,n.dtype);for(let r=0;r<s.size;++r){const i=s.indexToLoc(r).slice(),a=i[0],l=i[2],u=t.locToIndex([a,l]);i[2]=t.values[u];const h=n.locToIndex(i);0<=h&&h<n.values.length&&(s.values[r]=n.values[h])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lk=Ye((n,t)=>n>t?1:0),Tz=ln(Nh,lk,null,"bool"),Ez={kernelName:Nh,backendName:"cpu",kernelFunc:Tz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uk=Ye((n,t)=>n>=t?1:0),_z=ln(Yl,uk,null,"bool"),Rz={kernelName:Yl,backendName:"cpu",kernelFunc:_z};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ck=Ye((n,t)=>n<t?1:0),Az=ln(Eh,ck,null,"bool"),Dz={kernelName:Eh,backendName:"cpu",kernelFunc:Az};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hk=Ye((n,t)=>n<=t?1:0),Fz=ln(_h,hk,null,"bool"),Oz={kernelName:_h,backendName:"cpu",kernelFunc:Fz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dk(n,t,e){const s=(t-n)/(e-1),r=Sn(e,"float32");r[0]=n;for(let o=1;o<r.length;o++)r[o]=r[o-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fk=Mr(n=>Math.log(n)),Lz=Ko(eu,fk),Pz={kernelName:eu,backendName:"cpu",kernelFunc:Lz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pk(n,t,e,s){const r=kn(s,st(e));for(let o=0;o<r.length;++o){const i=o*t;let a=n[i];for(let l=0;l<t;++l){const u=n[i+l];(Number.isNaN(u)||u>a)&&(a=u)}r[o]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mk=Ye((n,t)=>Math.max(n,t)),Mz=ln(su,mk),Bz={kernelName:su,backendName:"cpu",kernelFunc:Mz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gk=Ye((n,t)=>Math.min(n,t)),zz=ln(ru,gk),Wz={kernelName:ru,backendName:"cpu",kernelFunc:zz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cb=Ye((n,t)=>n*t),Vz=lb((n,t,e,s)=>({real:n*e-t*s,imag:n*s+t*e})),of=ln(iu,cb,Vz),Uz={kernelName:iu,backendName:"cpu",kernelFunc:of};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xk(n,t,e){const s=So(-1,e);return cb([],t,s,n,e)}function Gz(n){const{inputs:t,backend:e}=n,{x:s}=t;kt(s,"neg");const r=e.data.get(s.dataId).values,[o,i]=xk(r,s.shape,s.dtype);return e.makeTensorInfo(i,s.dtype,o)}const Hz={kernelName:Wh,backendName:"cpu",kernelFunc:Gz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bk=Ye((n,t)=>n!==t?1:0),Kz=ln(Vh,bk,null,"bool"),qz={kernelName:Vh,backendName:"cpu",kernelFunc:Kz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hb(n,t,e,s,r){const o=t.length,i=st(t),a=_t(t),l=_t(r),u=kn(e,st(r));for(let h=0;h<i;++h){const d=Ca(h,o,a),f=new Array(d.length);for(let g=0;g<f.length;g++)f[g]=d[s[g]];const m=Cr(f,o,l);u[m]=n[h]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jn(n){const{inputs:t,attrs:e,backend:s}=n,{x:r}=t,{perm:o}=e;kt(r,"transpose");const i=r.shape.length,a=new Array(i);for(let d=0;d<a.length;d++)a[d]=r.shape[o[d]];const l=s.data.get(r.dataId).values,u=hb(l,r.shape,r.dtype,o,a);return{dataId:s.write(u,a,r.dtype),shape:a,dtype:r.dtype}}const jz={kernelName:$a,backendName:"cpu",kernelFunc:Jn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yk(n,t,e,s){const[r,o]=dn(n,s),i=us(t,"int32"),a=Sn(st(r),i),l=st(o);for(let u=0;u<a.length;++u){const h=u*l;let d=1;for(let f=0;f<l;++f)d*=e[h+f];a[u]=d}return{outVals:a,outShape:r,outDtype:i}}function Xz(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o,keepDims:i}=s;kt(r,"prod");const a=r.shape.length,l=Xt(o,r.shape),u=Be(l,a);let h=l,d=r;const f=[];u!=null&&(d=Jn({inputs:{x:r},backend:e,attrs:{perm:u}}),f.push(d),h=qe(h.length,a));const m=e.data.get(d.dataId).values,{outVals:g,outShape:x,outDtype:b}=yk(d.shape,d.dtype,m,h);let w=x;return i&&(w=Je(x,l)),f.forEach(v=>e.disposeIntermediateTensorInfo(v)),e.makeTensorInfo(w,b,g)}const Yz={kernelName:jh,backendName:"cpu",kernelFunc:Xz};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zz(n,t,e){n.forEach((s,r)=>{if(s<0||s>=e){const o=Ca(r,t.length,_t(t)).join(",");throw new Error(`indices[${o}] = ${s} is not in [0, ${e})`)}})}function Jz(n,t){for(let e=0;e<n.length;++e){const s=n[e],r=e===n.length-1?t:n[e+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let o=1;o<s.length;++o)if(s[o-1]>s[o])throw new Error("Ragged splits must be sorted in ascending order")}}function Qz(n,t,e,s){const r=[];let o=0;const i=t.length-1+e.length,a=new Array(i).fill(null).map(()=>[0]);Jz(e,s);let l=1;for(let u=0;u<t.length-1;++u){l*=t[u];const h=t[u+1];for(let d=1;d<l+1;++d)a[u].push(d*h)}for(let u=0;u<n.length;++u){let h=n[u],d=n[u]+1;for(let f=0;f<e.length;++f){const m=e[f],g=f+t.length-1;if(g>=0){const x=a[g],b=x[x.length-1]-m[h];for(let w=h;w<d;++w)a[g].push(m[w+1]+b)}h=m[h],d=m[d]}d!==h&&(r.push([h,d]),o+=d-h)}return{outSplits:a,valueSlices:r,numValues:o}}function tW(n){const t=[];for(let e=0;e<n.length;++e){const s=n[e].length,r=He("int32",s);t.push(r),n[e].forEach((o,i)=>r[i]=o)}return t}function wk(n,t){const e=n.slice(0,t);for(;e.length<t;)e.push(1);for(let s=t;s<n.length;s++)e[t-1]*=n[s];return e}function eW(n,t,e,s,r,o){const i=wk(t,2)[1],a=wk(o,2)[1];let l=0;for(const u of e)for(let h=u[0];h<u[1];++h){for(let d=0;d<s;++d)r[l*a+d]=n[h*i+d];++l}}function nW(n,t,e,s,r){const o=t.slice();o[0]=r;const i=He(e,st(o)),a=n.length,l=a===0?0:a/t[0];return eW(n,t,s,l,i,o),[i,o]}function vk(n,t,e,s,r,o,i,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(t[0].length===0)throw new Error("Split tensors must not be scalars");const l=t[0][0]-1;if(Zz(o,i,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:h,valueSlices:d,numValues:f}=Qz(o,i,n,u),m=tW(h),g=nW(e,s,r,d,f);return[m,g[0],g[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ck=2147483647;function Ik(n,t,e,s,r,o,i){if(t.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const a=t.length===0,l=r.length===0,u=i.length===0,h=[];a||h.push(t[0]),l||h.push(r[0]),u||h.push(i[0]);for(let b=1;b<h.length;++b)if(h[b]!==h[b-1])throw new Error("starts, limits, and deltas must have the same shape");const d=h.length===0?1:h[0],f=He("int32",d+1);f[0]=0;for(let b=0;b<d;++b){const w=a?n[0]:n[b],v=l?s[0]:s[b],I=u?o[0]:o[b];if(I===0)throw new Error("Requires delta != 0");let C;if(I>0&&v<w||I<0&&v>w)C=0;else if(C=Math.ceil(Math.abs((v-w)/I)),C>Ck)throw new Error(`Requires ((limit - start) / delta) <= ${Ck}`);f[b+1]=f[b]+C}const m=f[d],g=He(e,m);let x=0;for(let b=0;b<d;++b){const w=f[b+1]-f[b];let v=a?n[0]:n[b];const I=u?o[0]:o[b];for(let C=0;C<w;++C)g[x++]=v,v+=I}return[f,g]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Hs=lr;class af{constructor(t,e,s,r,o,i,a,l,u,h){this.shape=t,this.shapeShape=e,this.values=s,this.valuesShape=r,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=Cv(h),this.raggedRank=Iv(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===Hs.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===Hs.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){const e=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case Hs.VALUE_ROWIDS:return af.getMaxWidthValueRowID(e);case Hs.ROW_SPLITS:return af.getMaxWidthRowSplit(e);default:throw new Error(`Cannot handle partition type ${Hs[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){const e=t.length;if(e===0||e===1)return 0;let s=0;for(let r=0;r<e-1;++r){const o=t[r+1]-t[r];o>s&&(s=o)}return s}static getMaxWidthValueRowID(t){const e=t.length;if(e===0)return 0;let s=0,r=t[0],o=0;for(let i=1;i<e;++i){const a=t[i];a!==r&&(r=a,o=Math.max(i-s,o),s=i)}return Math.max(e-s,o)}tensorShapeFromTensor(t,e,s=!0){if(e.length===0){if(t[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return kk(t,s)}calculateOutputSize(t){const e=this.valuesShape,s=this.defaultValueShape;$v(s,e);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=vv(this.raggedRank,r,e);i[0]<0&&(i[0]=t);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(t,e,s){const r=Math.min(t,s),o=[];let i=0;for(let a=0;a<r;++a,i+=e)o.push(i);for(let a=r;a<t;++a)o.push(-1);return A(o.length===t,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(t,e,s,r){const o=t.length,i=[];for(let a=0;a<o-1;++a){const l=t[a+1]-t[a];let u=Math.min(r,l),h=e[a];h===-1&&(u=0);for(let d=0;d<u;++d)i.push(h),h+=s;for(let d=0;d<l-u;++d)i.push(-1)}if(o>0&&i.length!==t[o-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(t,e,s,r){const o=t.length,i=[];if(o===0)return[];let a=0,l=t[0];if(l>=e.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${e.length}`);let u=e[l];i.push(u);for(let h=1;h<o;++h){const d=t[h];if(d===l)u>=0&&(++a,a<r?u+=s:u=-1);else{if(a=0,l=d,d>=e.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${e.length}`);u=e[d]}i.push(u)}if(i.length!==t.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(t,e,s,r){const o=this.getRowPartitionTensor(t),i=this.getRowPartitionTypeByDimension(t);switch(i){case Hs.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,e,s,r);case Hs.ROW_SPLITS:if(o.length-1>e.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${e.length}`);return this.calculateOutputIndexRowSplit(o,e,s,r);default:throw new Error(`Unsupported partition type: ${Hs[i]}`)}}getFirstDimensionSize(){const t=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const e=this.rowPartitionTypes[0];switch(e){case Hs.FIRST_DIM_SIZE:return t[0];case Hs.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Hs.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Hs[e]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),s=this.calculateOutputSize(e),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const o=kk(s,!1),i=He(this.valuesDType,st(o));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(e,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],s[u]);this.setOutput(this.raggedRank,l,i,o)}return[o,i]}setOutput(t,e,s,r){if(s.length===0)return;const o=this.values,i=s;let a=r.slice();a=a.slice(t+1);const l=st(a),u=e.length;let h=this.defaultValue;if(h.length!==l&&h.length!==1){const g=this.defaultValueShape;X(()=>{const x=U(h,g);h=Du(x,a).dataSync()})}let d=0,f=0,m=0;for(let g=0;g<=u;++g){let x=g<u?e[g]:-1;if(x===m){++m;continue}if(f<m){const b=o.subarray(d*l),w=i.subarray(f*l),v=(m-f)*l;$k(w,b,v)}if(g>=u){const b=s.length;x=Math.floor(b/l)}if(x>m)if(this.defaultValue.length===1)i.subarray(m*l,x*l).fill(this.defaultValue[0]),m=x;else for(;x>m;){const b=i.slice(m*l);$k(b,h,l),++m}x<0?(d=g+1,f=m):(d=g,f=m,m=f+1)}}}function $k(n,t,e){for(let s=0;s<e;s++)n[s]=t[s]}function kk(n,t){const e=[];for(let s of n){if(s<0){if(!t)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}e.push(s)}return e}function Sk(n,t,e,s,r,o,i,a,l,u){return new af(n,t,e,s,r,o,i,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nk(n,t,e,s){const r=n===t,o=n<t&&e<0,i=t<n&&e>1;if(r||o||i)return Sn(0,s);const a=Math.abs(Math.ceil((t-n)/e)),l=Sn(a,s);t<n&&e===1&&(e=-1),l[0]=n;for(let u=1;u<l.length;u++)l[u]=l[u-1]+e;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tk=Mr(n=>1/Math.sqrt(n)),sW=Ko(du,Tk),rW={kernelName:du,backendName:"cpu",kernelFunc:sW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gi(n,t,e,s,r,o,i,a,l,u){const h=[s/r,r],d=n.values,f=t.values;if(s===0)return Yt(e,t.dtype);const m=l instanceof yn?l:Yt(h,t.dtype);typeof l=="string"||typeof l=="number"?m.values.fill(l):typeof l=="boolean"&&m.values.fill(+l);for(let g=0;g<o;g++){const x=[];let b=0;for(let w=0;w<i;w++){const v=d[g*i+w];x.push(v),b+=v*a[w]}if(b<0||b>=s/r)throw new Error(`Invalid indices: ${x} does not index into ${e}`);for(let w=0;w<r;w++)u?m.values[b*r+w]+=f[g*r+w]:m.values[b*r+w]=t.rank===0?f[0]:f[g*r+w]}return m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oW=Mr(n=>1/(1+Math.exp(-n))),Ek=ge(xu,n=>1/(1+Math.exp(-n))),iW={kernelName:xu,backendName:"cpu",kernelFunc:Ek};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _k(n,t,e,s,r){const o=Zg(s,t,e),i=st(e),a=_t(s);if(o){const d=Jg(t,a);return r==="string"?n.slice(d,d+i):n.subarray(d,d+i)}const l=r==="string"?to(n):n,u=Yt(s,r,l),h=Yt(e,r);for(let d=0;d<h.size;++d){const f=h.indexToLoc(d),m=f.map((g,x)=>g+t[x]);h.set(u.get(...m),...f)}return r==="string"?Kv(h.values):h.values}function Hi(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{begin:o,size:i}=s;kt(r,"slice");const[a,l]=Td(r,o,i);Xg(r,a,l);const u=e.data.get(r.dataId).values,h=_k(u,a,l,r.shape,r.dtype);return e.makeTensorInfo(l,r.dtype,h)}const aW={kernelName:td,backendName:"cpu",kernelFunc:Hi};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rk(n,t,e,s,r,o,i){const a=t[0],l=o[0],u=new Array(l),h=new Array(a),d=t[1];if(l===0){if(a!==0)throw new Error(Dv(a));const b=He(e,0),w=He(r,0);return[b,[0,d],w,u,h]}let f=!0,m=0;const g=new Array(l).fill(0);for(let b=0;b<a;++b){const w=n[b*d];if(w<0)throw new Error(Fv(b,w));if(w>=l)throw new Error(Ov(b,w,l));++g[w],f=f&&w>=m,m=w}let x=!0;for(let b=0;b<l;++b){const w=g[b]===0;u[b]=w,x=x&&!w,g[b]=Math.max(g[b],1),b>0&&(g[b]+=g[b-1])}if(x&&f){const b=n,w=s;for(let v=0;v<a;++v)h[v]=v;return[b,[a,d],w,u,h]}else{const b=g[l-1],w=He(e,b*d),v=He(r,b),I=new Array(l).fill(0);for(let C=0;C<a;++C){const k=n[C*d],N=I[k],T=(k===0?0:g[k-1])+N;I[k]++;for(let R=0;R<d;++R)w[T*d+R]=n[C*d+R];v[T]=s[C],h[C]=T}for(let C=0;C<l;++C)if(I[C]===0){const N=C===0?0:g[C-1];w[N*d+0]=C;for(let T=1;T<d;++T)w[N*d+T]=0;v[N]=i}return[w,[b,d],v,u,h]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ak(n,t,e,s,r){const o=st(s),i=t[0],a=r.length,l=[];let u=1,h=-1;for(let b=0;b<a;++b){const w=r[b];if(w===-1){if(h!==-1)throw new Error(Lv(h,b));h=b,l.push(1)}else{if(w<0)throw new Error(Pv(b,w));u*=w,l.push(w)}}if(h!==-1){if(u<=0)throw new Error(Mv());const b=Math.trunc(o/u);if(u*b!==o)throw new Error(Bv(s,l));l[h]=b}if(st(l)!==o)throw new Error(zv(s,l));const f=s.length,m=[];if(f>0){m[f-1]=1;for(let b=f-2;b>=0;--b)m[b]=m[b+1]*s[b+1]}const g=[];if(a>0){g[a-1]=1;for(let b=a-2;b>=0;--b)g[b]=g[b+1]*l[b+1]}const x=He(e,i*a);for(let b=0;b<i;++b){let w=0;for(let v=0;v<f;++v)w+=n[b*f+v]*m[v];for(let v=0;v<a;++v)x[b*a+v]=Math.trunc(w/g[v]),w%=g[v]}return[x,[i,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function db(n,t,e,s,r,o=!1,i=0){const a=s.length,l=[t[0],n.length/t[0]],u=l[1],d=a>0?r[a-1]+1:0;if(d<0)throw new Error(yx());const f=t.slice();f[0]=d;const m=f.reduce((I,C)=>I*C,1),g=He(e,m);if(a===0)return d>0&&g.fill(i),[g,f];if(d<=0)throw new Error(yx());let x=0,b=1,w=0,v=r[x];for(;;){let I=0;if(b<a){if(I=r[b],v===I){++b;continue}if(v>=I)throw new Error(Wv())}if(v<0||v>=d)throw new Error(Vv(v,d));v>w&&g.fill(i,w*u,v*u);for(let C=x;C<b;++C){const k=s[C];if(k<0||k>=l[0])throw new Error(Uv(C,s[C],l[0]));for(let N=0;N<u;N++)g[v*u+N]+=n[k*u+N]}if(o)for(let C=0;C<u;C++)g[v*u+C]/=b-x;if(x=b,++b,w=v+1,v=I,b>a)break}return w<d&&g.fill(i,w*u,d*u),[g,f]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lW=Mr(n=>Math.sqrt(n)),uW=ge(yu,n=>Math.sqrt(n)),cW={kernelName:yu,backendName:"cpu",kernelFunc:uW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dk=Ye((n,t)=>{const e=n-t;return e*e}),hW=ln(wu,Dk),dW={kernelName:wu,backendName:"cpu",kernelFunc:hW};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fk=Mr((n,t)=>{const{pattern:e,replaceGlobal:s,rewrite:r}=t;return n.replace(new RegExp(e,s?"g":""),r)}),fW=Ko(Om,Fk),pW={kernelName:Om,backendName:"cpu",kernelFunc:fW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ok(n,t,e,s){const r=Yt(n,t.dtype);for(let o=0;o<r.size;o++){const i=r.indexToLoc(o),a=new Array(i.length);for(let l=0;l<a.length;l++)a[l]=i[l]*e[l]+s[l];r.set(t.get(...a),...i)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mW{constructor(t,e,s,r,o,i){this.separator=No(t),this.nGramWidths=e,this.leftPad=No(s),this.rightPad=No(r),this.padWidth=o,this.preserveShort=i}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,e){const s=this.getPadWidth(e);return Math.max(0,t+2*s-e+1)}createNGrams(t,e,s,r,o,i){for(let a=0;a<o;++a){const l=this.getPadWidth(i),u=Math.max(0,l-a),h=Math.max(0,l-(o-(a+1))),d=i-(u+h),f=e+(u>0?0:a-l);let m=0;m+=u*this.leftPad.length;for(let v=0;v<d;++v)m+=t[f+v].length;m+=h*this.rightPad.length;const g=u+h+d-1;m+=g*this.separator.length,s[r+a]=new Uint8Array(m);const x=s[r+a];let b=0;const w=v=>v.forEach(I=>x[b++]=I);for(let v=0;v<u;++v)w(this.leftPad),w(this.separator);for(let v=0;v<d-1;++v)w(t[f+v]),w(this.separator);if(d>0){w(t[f+d-1]);for(let v=0;v<h;++v)w(this.separator),w(this.rightPad)}else{for(let v=0;v<h-1;++v)w(this.rightPad),w(this.separator);w(this.rightPad)}}}compute(t,e){const s=t.length,r=e.length;if(r>0){let l=e[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let h=e[u]>=l;if(h=h&&e[u]<=s,!h)throw new Error(`Invalid split value ${e[u]}, must be in [${l}, ${s}]`);l=e[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const o=r-1,i=He("int32",r);if(s===0||r===0){const l=new Array(s);for(let u=0;u<=o;++u)i[u]=0;return[l,i]}i[0]=0;for(let l=1;l<=o;++l){const u=e[l]-e[l-1];let h=0;this.nGramWidths.forEach(d=>{h+=this.getNumNGrams(u,d)}),this.preserveShort&&u>0&&h===0&&(h=1),i[l]=i[l-1]+h}const a=new Array(i[o]);for(let l=0;l<o;++l){const u=e[l];let h=i[l];if(this.nGramWidths.forEach(d=>{const f=e[l+1]-e[l],m=this.getNumNGrams(f,d);this.createNGrams(t,u,a,h,m,d),h+=m}),this.preserveShort&&h===i[l]){const d=e[l+1]-e[l];if(d===0)continue;const f=d+2*this.padWidth,m=1;this.createNGrams(t,u,a,h,m,f)}}return[a,i]}}function Lk(n,t,e,s,r,o,i,a){return new mW(e,s,r,o,i,a).compute(n,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gW(n,t,e,s){if(!n.length)return;if(t.length===0){for(let o=0;o<n.length;++o)s.push(n.subarray(o,o+1));return}if(t.length===1){const o=t[0];let i=n.indexOf(o);for(;i!==-1;){const a=n.subarray(0,i);(!e||a.length!==0)&&s.push(a),n=n.subarray(i+1),i=n.indexOf(o)}(!e||n.length!==0)&&s.push(n);return}let r=0;for(let o=0;o<n.length+1;o++)if(o===n.length||t.indexOf(n[o])!==-1){const i=n.subarray(r,o);(!e||i.length!==0)&&s.push(i),r=o+1}}function Pk(n,t,e){const s=n.length,r=[];let o=0,i=0;const a=new Array(s);for(let f=0;f<s;++f){const m=r.length;gW(n[f],t,e,r);const g=r.length-m;a[f]=g,o+=g,i=Math.max(i,g)}const l=He("int32",o*2),u=new Array(o),h=[s,i];let d=0;for(let f=0;f<s;++f)for(let m=0;m<a[f];++m)l[d*2]=f,l[d*2+1]=m,u[d]=r[d],++d;return[l,u,h]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mk(n,t){const e=He("int32",n.length);for(let s=0;s<n.length;++s)e[s]=T_(n[s]).modulo(t).getLowBitsUnsigned();return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bk=Ye((n,t)=>n-t),xW=lb((n,t,e,s)=>({real:n-e,imag:t-s})),fb=ln(vu,Bk,xW),bW={kernelName:vu,backendName:"cpu",kernelFunc:fb};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zk(n,t){const e=new Array(n.rank);for(let r=0;r<e.length;r++)e[r]=n.shape[r]*t[r];const s=Yt(e,n.dtype);for(let r=0;r<s.values.length;++r){const o=s.indexToLoc(r),i=new Array(n.rank);for(let l=0;l<i.length;l++)i[l]=o[l]%n.shape[l];const a=n.locToIndex(i);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lc=(n,t)=>{const e=t.value-n.value;return e===0?n.index-t.index:e};function Wk(n,t,e=0,s=n.length-1){for(;s>e;){if(s-e>600){const a=s-e+1,l=t-e+1,u=Math.log(a),h=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*h*(a-h)/a)*Math.sign(l-a/2),f=Math.max(e,Math.floor(t-l*h/a+d)),m=Math.min(s,Math.floor(t+(a-l)*h/a+d));Wk(n,t,f,m)}const r=n[t];let o=e,i=s;for(ba(n,e,t),lc(n[s],r)>0&&ba(n,e,s);o<i;){for(ba(n,o,i),o++,i--;lc(n[o],r)<0;)o=o+1;for(;lc(n[i],r)>0;)i=i-1}lc(n[e],r)===0?ba(n,e,i):(i=i+1,ba(n,i,s)),i<=t&&(e=i+1),t<=i&&(s=i-1)}}function Vk(n,t,e,s,r){const o=t[t.length-1],[i,a]=[n.length/o,o],l=kn(e,i*s),u=kn("int32",i*s);for(let d=0;d<i;d++){const f=d*a,m=n.subarray(f,f+a);let g=new Array(m.length);m.forEach((v,I)=>g[I]={value:v,index:I}),s<g.length&&(Wk(g,s),g=g.slice(0,s)),r&&g.sort(lc);const x=d*s,b=l.subarray(x,x+s),w=u.subarray(x,x+s);for(let v=0;v<s;v++)b[v]=g[v].value,w[v]=g[v].index}const h=t.slice();return h[h.length-1]=s,[Yt(h,e,l),Yt(h,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uk(n,t,e,s){const r=Xt(t,e)[0],o=[1,e[0],1];for(let g=0;g<r;g++)o[0]*=e[g];o[1]=e[r];for(let g=r+1;g<e.length;g++)o[2]*=e[g];const i=new Map,a=new Int32Array(e[r]),l=new yn(o,s,n),u=[],h=o[0]===1&&o[2]===1;for(let g=0;g<e[r];g++){let x;if(h)x=n[g].toString();else{const w=[];for(let v=0;v<o[0];v++)for(let I=0;I<o[2];I++)w.push(l.get(v,g,I));x=w.join(",")}const b=i.get(x);if(b!=null)a[g]=b;else{const w=i.size;i.set(x,w),a[g]=w,u.push(g)}}const d=o.slice();d[1]=i.size;const f=new yn(d,s);u.forEach((g,x)=>{for(let b=0;b<o[0];b++)for(let w=0;w<o[2];w++)f.set(l.get(b,g,w),b,x,w)});const m=e.slice();return m[r]=d[1],{outputValues:f.values,outputShape:m,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var yW=Object.freeze({__proto__:null,addImpl:j$,bincountImpl:ub,bincountReduceImpl:X$,bitwiseAndImpl:Y$,castImpl:q$,ceilImpl:Z$,concatImpl:J$,equalImpl:Q$,expImpl:ek,expm1Impl:sk,floorDivImpl:ok,floorImpl:rk,gatherNdImpl:ik,gatherV2Impl:ak,greaterEqualImpl:uk,greaterImpl:lk,lessEqualImpl:hk,lessImpl:ck,linSpaceImpl:dk,logImpl:fk,maxImpl:pk,maximumImpl:mk,minimumImpl:gk,multiplyImpl:cb,negImpl:xk,notEqualImpl:bk,prodImpl:yk,raggedGatherImpl:vk,raggedRangeImpl:Ik,raggedTensorToTensorImpl:Sk,rangeImpl:Nk,rsqrtImpl:Tk,scatterImpl:Gi,sigmoidImpl:oW,simpleAbsImpl:K$,sliceImpl:_k,sparseFillEmptyRowsImpl:Rk,sparseReshapeImpl:Ak,sparseSegmentReductionImpl:db,sqrtImpl:lW,squaredDifferenceImpl:Dk,staticRegexReplaceImpl:Fk,stridedSliceImpl:Ok,stringNGramsImpl:Lk,stringSplitImpl:Pk,stringToHashBucketFastImpl:Mk,subImpl:Bk,tileImpl:zk,topKImpl:Vk,transposeImpl:hb,uniqueImpl:Uk});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */vw("cpu",()=>new sf,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gk=ge(Gl,n=>n>=0?n:Math.exp(n)-1),wW={kernelName:Gl,backendName:"cpu",kernelFunc:Gk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hk(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{alpha:o}=s;kt([r],"leakyRelu");const i=st(r.shape),a=e.data.get(r.dataId).values,l=kn("float32",i);for(let u=0;u<a.length;u++)l[u]=a[u]<0?o*a[u]:a[u];return e.makeTensorInfo(r.shape,"float32",l)}const vW={kernelName:Th,backendName:"cpu",kernelFunc:Hk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CW=Ye((n,t)=>n<0?t*n:n);function Kk(n){const{inputs:t,backend:e}=n,{x:s,alpha:r}=t;kt([s,r],"prelu");const o=e.data.get(s.dataId).values,i=e.data.get(r.dataId).values,[a,l]=CW(s.shape,r.shape,o,i,"float32");return e.makeTensorInfo(l,"float32",a)}const IW={kernelName:qh,backendName:"cpu",kernelFunc:Kk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qk=ge(uu,n=>Math.max(0,n)),$W={kernelName:uu,backendName:"cpu",kernelFunc:qk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jk=ge(cu,n=>Math.min(Math.max(0,n),6)),kW={kernelName:cu,backendName:"cpu",kernelFunc:jk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lf(n,t,e,s,r){if(e==="linear")return Pr({inputs:{x:t},backend:n});if(e==="relu")return qk({inputs:{x:t},backend:n});if(e==="elu")return Gk({inputs:{x:t},backend:n});if(e==="relu6")return jk({inputs:{x:t},backend:n});if(e==="prelu")return Kk({inputs:{x:t,alpha:s},backend:n});if(e==="leakyrelu")return Hk({inputs:{x:t},backend:n,attrs:{alpha:r}});if(e==="sigmoid")return Ek({inputs:{x:t},backend:n});throw new Error(`Activation ${e} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ne(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{shape:o}=s,i=st(r.shape),a=n1(o,i),l=st(a);A(i===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),e.incRef(r.dataId);const u=e.data.get(r.dataId);if(u.complexTensorInfos!=null){const h=u.complexTensorInfos.real,d=u.complexTensorInfos.imag;h.shape=a,d.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const SW={kernelName:Xh,backendName:"cpu",kernelFunc:Ne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xk(n){const{inputs:t,backend:e,attrs:s}=n,{a:r,b:o}=t,{transposeA:i,transposeB:a}=s;kt([r,o],"matMul");const l=r.shape.length,u=o.shape.length,h=i?r.shape[l-2]:r.shape[l-1],d=a?o.shape[u-1]:o.shape[u-2],f=i?r.shape[l-1]:r.shape[l-2],m=a?o.shape[u-2]:o.shape[u-1],g=r.shape.slice(0,-2),x=o.shape.slice(0,-2),b=st(g),w=st(x),I=Vt(r.shape.slice(0,-2),o.shape.slice(0,-2)).concat([f,m]);A(h===d,()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${r.shape} and ${o.shape} and transposeA=${i} and transposeB=${a} must match.`);const C=i?[b,h,f]:[b,f,h],k=a?[w,m,d]:[w,d,m],N=Ne({inputs:{x:r},backend:e,attrs:{shape:C}}),T=Ne({inputs:{x:o},backend:e,attrs:{shape:k}}),R=i?N.shape[1]:N.shape[2],E=i?N.shape[2]:N.shape[1],F=a?T.shape[1]:T.shape[2],P=Math.max(b,w),q=e.data.get(N.dataId).values,j=e.data.get(T.dataId).values,K=_t(N.shape),Y=_t(T.shape),[Q,tt,Z]=i?[K[0],1,K[1]]:[K[0],K[1],1],[rt,ut,lt]=a?[1,Y[1],Y[0]]:[Y[1],1,Y[0]],mt=E*F,ft=Yt([P,E,F],N.dtype),bt=ft.values,pt=e.blockSize;for(let yt=0;yt<P;yt++){const Nt=yt%b,Rt=yt%w;for(let Et=0;Et<E;Et+=pt){const Ut=Math.min(Et+pt,E);for(let Wt=0;Wt<F;Wt+=pt){const oe=Math.min(Wt+pt,F);for(let xe=0;xe<R;xe+=pt){const ie=Math.min(xe+pt,R);for(let ce=Et;ce<Ut;ce++)for(let pe=Wt;pe<oe;pe++){let ue=0;for(let Ie=xe;Ie<ie;Ie++){const xr=q[Nt*Q+ce*tt+Ie*Z],Ve=j[Ie*rt+pe*ut+Rt*lt];ue+=xr*Ve}bt[yt*mt+(ce*F+pe)]+=ue}}}}}return e.disposeIntermediateTensorInfo(N),e.disposeIntermediateTensorInfo(T),e.makeTensorInfo(I,ft.dtype,ft.values)}const NW={kernelName:fh,backendName:"cpu",kernelFunc:Xk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TW(n){const{inputs:t,backend:e,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:a}=t,{transposeA:l,transposeB:u,activation:h,leakyreluAlpha:d}=s;let f,m,g;const x=[];f=Xk({inputs:{a:r,b:o},attrs:{transposeA:l,transposeB:u},backend:e}),i&&(m=Ka({inputs:{a:f,b:i},backend:e}),x.push(f),f=m),h&&(g=lf(e,f,h,a,d),x.push(f),f=g);for(const w of x)e.disposeIntermediateTensorInfo(w);return f}const EW={kernelName:ld,backendName:"cpu",kernelFunc:TW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _W=ge(Rl,n=>Math.acos(n)),RW={kernelName:Rl,backendName:"cpu",kernelFunc:_W};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AW=ge(Al,n=>Math.acosh(n)),DW={kernelName:Al,backendName:"cpu",kernelFunc:AW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FW(n){const{inputs:t,backend:e}=n,s=t;kt(t,"addN");const r=s.map(a=>e.data.get(a.dataId).values),o=Yt(s[0].shape,s[0].dtype),i=o.values;for(let a=0;a<s.length;a++){const l=r[a];for(let u=0;u<i.length;u++)i[u]+=l[u]}return e.makeTensorInfo(o.shape,o.dtype,o.values)}const OW={kernelName:Jp,backendName:"cpu",kernelFunc:FW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LW(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o,keepDims:i}=s;kt(r,"all");const a=Xt(o,r.shape);let l=a;const u=Be(l,r.shape.length);let h=r;u!=null&&(h=Jn({inputs:{x:r},backend:e,attrs:{perm:u}}),l=qe(l.length,r.shape.length)),vn("all",l,h.shape.length);const[d,f]=dn(h.shape,l),m=st(f),g=Sn(st(d),h.dtype),x=e.data.get(h.dataId).values;for(let w=0;w<g.length;++w){const v=w*m;let I=x[v];for(let C=0;C<m;++C){const k=x[v+C];I=I&&k}g[w]=I}u!=null&&e.disposeIntermediateTensorInfo(h);const b=e.makeTensorInfo(d,h.dtype,g);if(i){const w=Je(d,a),v=Ne({inputs:{x:b},backend:e,attrs:{shape:w}});return e.disposeIntermediateTensorInfo(b),v}return b}const PW={kernelName:Qp,backendName:"cpu",kernelFunc:LW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MW(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o,keepDims:i}=s;kt(r,"any");const a=Xt(o,r.shape);let l=a;const u=Be(l,r.shape.length);let h=r;u!=null&&(h=Jn({inputs:{x:r},backend:e,attrs:{perm:u}}),l=qe(l.length,r.shape.length)),vn("any",l,h.shape.length);const[d,f]=dn(h.shape,l),m=st(f),g=Sn(st(d),h.dtype),x=e.data.get(h.dataId).values;for(let w=0;w<g.length;++w){const v=w*m;let I=x[v];for(let C=0;C<m;++C){const k=x[v+C];I=I||k}g[w]=I}u!=null&&e.disposeIntermediateTensorInfo(h);const b=e.makeTensorInfo(d,h.dtype,g);if(i){const w=Je(d,a),v=Ne({inputs:{x:b},backend:e,attrs:{shape:w}});return e.disposeIntermediateTensorInfo(b),v}return b}const BW={kernelName:tm,backendName:"cpu",kernelFunc:MW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zW(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o}=s;kt(r,"argMax");let i=Xt(o,r.shape);const a=Be(i,r.shape.length);let l=r;const u=[];a!=null&&(l=Jn({inputs:{x:r},backend:e,attrs:{perm:a}}),u.push(l),i=qe(i.length,l.shape.length)),i=[i[0]],vn("argMax",i,l.shape.length);const[h,d]=dn(l.shape,i),f=st(h),m=Sn(f,"int32"),g=st(d),x=e.data.get(l.dataId).values;for(let b=0;b<m.length;++b){const w=b*g;let v=x[w],I=0;for(let C=0;C<g;++C){const k=x[w+C];k>v&&(v=k,I=C)}m[b]=I}return u.forEach(b=>e.disposeIntermediateTensorInfo(b)),e.makeTensorInfo(h,"int32",m)}const WW={kernelName:uh,backendName:"cpu",kernelFunc:zW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VW(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o}=s;kt(r,"argMin");let i=Xt(o,r.shape);const a=Be(i,r.shape.length);let l=r;const u=[];a!=null&&(l=Jn({inputs:{x:r},backend:e,attrs:{perm:a}}),u.push(l),i=qe(i.length,l.shape.length)),i=[i[0]],vn("argMin",i,l.shape.length);const[h,d]=dn(l.shape,i),f=st(h),m=Sn(f,"int32"),g=st(d),x=e.data.get(l.dataId).values;for(let b=0;b<m.length;++b){const w=b*g;let v=x[w],I=0;for(let C=0;C<g;++C){const k=x[w+C];k<v&&(v=k,I=C)}m[b]=I}return u.forEach(b=>e.disposeIntermediateTensorInfo(b)),e.makeTensorInfo(h,"int32",m)}const UW={kernelName:ch,backendName:"cpu",kernelFunc:VW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GW=ge(Dl,n=>Math.asin(n)),HW={kernelName:Dl,backendName:"cpu",kernelFunc:GW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KW=ge(Fl,n=>Math.asinh(n)),qW={kernelName:Fl,backendName:"cpu",kernelFunc:KW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jW=ge(Ol,n=>Math.atan(n)),XW={kernelName:Ol,backendName:"cpu",kernelFunc:jW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YW=Ye((n,t)=>Math.atan2(n,t)),ZW=ln(Pl,YW),JW={kernelName:Pl,backendName:"cpu",kernelFunc:ZW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QW=ge(Ll,n=>Math.atanh(n)),tV={kernelName:Ll,backendName:"cpu",kernelFunc:QW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pb(n,t,e,s,r,o){const i=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,f=r.padInfo.top,m=r.padInfo.left,g=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=Yt(r.outShape,e),b=x.values,w=r.outShape[1]*r.outShape[2]*r.outShape[3],v=r.outShape[2]*r.outShape[3],I=r.outShape[3];for(let C=0;C<r.batchSize;++C){const k=C*w,N=C*s[0];for(let T=0;T<r.inChannels;++T)for(let R=0;R<r.outHeight;++R){const E=R*i-f,F=Math.max(0,E),P=Math.min(r.inHeight,h+E),q=k+R*v;for(let j=0;j<r.outWidth;++j){const K=j*a-m,Y=Math.max(0,K),Q=Math.min(r.inWidth,d+K);let tt=g,Z=0,rt=0;for(let lt=F;lt<P;lt+=l){const mt=N+lt*s[1];for(let ft=Y;ft<Q;ft+=u){const bt=mt+ft*s[2],pt=n[bt+T];o==="max"&&pt>tt?tt=pt:o==="avg"&&(Z+=pt,rt++)}if(isNaN(tt))break}const ut=q+j*I+T;b[ut]=o==="avg"?Z/rt:tt}}}return x}function Yk(n,t,e,s,r=!1,o=!1){const i=Yt(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,h=s.dilationWidth,d=s.effectiveFilterHeight,f=s.effectiveFilterWidth,m=s.padInfo.top,g=s.padInfo.left,x=Yt(t,e,n);for(let b=0;b<s.batchSize;++b)for(let w=0;w<s.inChannels;++w)for(let v=0;v<s.outHeight;++v){const I=v*a-m;let C=I;for(;C<0;)C+=u;const k=Math.min(s.inHeight,d+I);for(let N=0;N<s.outWidth;++N){const T=N*l-g;let R=T;for(;R<0;)R+=h;const E=Math.min(s.inWidth,f+T);let F=Number.NEGATIVE_INFINITY,P=-1;for(let q=C;q<k;q+=u){const j=q-I;for(let K=R;K<E;K+=h){const Y=K-T,Q=x.get(b,q,K,w);Q>F&&(F=Q,r?P=o?((b*s.inHeight+q)*s.inWidth+K)*s.inChannels+w:(q*s.inWidth+K)*s.inChannels+w:P=j*f+Y)}}i.set(P,b,v,N,w)}}return i}function Zk(n,t,e,s,r,o){const i=r.strideDepth,a=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,h=r.dilationHeight,d=r.dilationWidth,f=r.effectiveFilterDepth,m=r.effectiveFilterHeight,g=r.effectiveFilterWidth,x=r.padInfo.front,b=r.padInfo.top,w=r.padInfo.left,v=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,I=Yt(r.outShape,e),C=I.values,k=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],N=r.outShape[2]*r.outShape[3]*r.outShape[4],T=r.outShape[3]*r.outShape[4],R=r.outShape[4];for(let E=0;E<r.batchSize;++E){const F=E*k,P=E*s[0];for(let q=0;q<r.inChannels;++q)for(let j=0;j<r.outDepth;++j){const K=j*i-x;let Y=K;for(;Y<0;)Y+=u;const Q=Math.min(r.inDepth,f+K),tt=F+j*N;for(let Z=0;Z<r.outHeight;++Z){const rt=Z*a-b;let ut=rt;for(;ut<0;)ut+=h;const lt=Math.min(r.inHeight,m+rt),mt=tt+Z*T;for(let ft=0;ft<r.outWidth;++ft){const bt=ft*l-w;let pt=bt;for(;pt<0;)pt+=d;const yt=Math.min(r.inWidth,g+bt),Nt=mt+ft*R;let Rt=v,Et=0,Ut=0;for(let oe=Y;oe<Q;oe+=u){const xe=P+oe*s[1];for(let ie=ut;ie<lt;ie+=h){const ce=xe+ie*s[2];for(let pe=pt;pe<yt;pe+=d){const ue=ce+pe*s[3],Ie=n[ue+q];if(o==="max"&&Ie>Rt?Rt=Ie:o==="avg"&&(Et+=Ie,Ut++),isNaN(Rt))break}if(isNaN(Rt))break}if(isNaN(Rt))break}const Wt=Nt+q;C[Wt]=o==="avg"?Et/Math.max(Ut,1):Rt}}}}return I}function eV(n,t){const e=Yt(t.outShape,"int32"),s=t.strideDepth,r=t.strideHeight,o=t.strideWidth,i=t.dilationDepth,a=t.dilationHeight,l=t.dilationWidth,u=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=t.padInfo.front,m=t.padInfo.top,g=t.padInfo.left;for(let x=0;x<t.batchSize;++x)for(let b=0;b<t.inChannels;++b)for(let w=0;w<t.outDepth;++w){const v=w*s-f;let I=v;for(;I<0;)I+=i;const C=Math.min(t.inDepth,u+v);for(let k=0;k<t.outHeight;++k){const N=k*r-m;let T=N;for(;T<0;)T+=a;const R=Math.min(t.inHeight,h+N);for(let E=0;E<t.outWidth;++E){const F=E*o-g;let P=F;for(;P<0;)P+=l;const q=Math.min(t.inWidth,d+F);let j=Number.NEGATIVE_INFINITY,K=-1;for(let Y=I;Y<C;Y+=i){const Q=Y-v;for(let tt=T;tt<R;tt+=a){const Z=tt-N;for(let rt=P;rt<q;rt+=l){const ut=rt-F,lt=n.get(x,Y,tt,rt,b);lt>=j&&(j=lt,K=Q*h*d+Z*h+ut)}}}e.set(K,x,w,k,E,b)}}}return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nV(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t;kt(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;A(Tn(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const h=Ps(r.shape,o,i,u,a,l);let d;if(h.filterWidth===1&&h.filterHeight===1&&he(h.inShape,h.outShape))d=Pr({inputs:{x:r},backend:e});else{const f=e.data.get(r.dataId).values,m=_t(r.shape),g=pb(f,r.shape,r.dtype,m,h,"avg");d=e.makeTensorInfo(h.outShape,r.dtype,g.values)}return d}const sV={kernelName:hh,backendName:"cpu",kernelFunc:nV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rV(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s;kt(r,"avgPool3d");const h=Xr(r.shape,o,i,1,a,l,u),d=e.data.get(r.dataId).values,f=Zk(d,r.shape,r.dtype,_t(r.shape),h,"avg");return e.makeTensorInfo(f.shape,"float32",f.values)}const oV={kernelName:dh,backendName:"cpu",kernelFunc:rV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iV(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:o}=t,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=s;kt([r,o],"avgPool3DGrad");const h=Xr(o.shape,i,a,1,l,u),d=h.strideDepth,f=h.strideHeight,m=h.strideWidth,g=h.filterDepth,x=h.filterHeight,b=h.filterWidth,w=h.dilationDepth,v=h.dilationHeight,I=h.dilationWidth,C=h.effectiveFilterDepth,k=h.effectiveFilterHeight,N=h.effectiveFilterWidth,T=C-1-h.padInfo.front,R=N-1-h.padInfo.left,E=k-1-h.padInfo.top,F=Yt(o.shape,"float32"),P=1/(g*x*b),q=e.bufferSync(r);for(let j=0;j<h.batchSize;++j)for(let K=0;K<h.inChannels;++K)for(let Y=0;Y<h.inDepth;++Y)for(let Q=0;Q<h.inHeight;++Q)for(let tt=0;tt<h.inWidth;++tt){const Z=Y-T,rt=Q-E,ut=tt-R;let lt=0;for(let mt=0;mt<C;mt+=w){const ft=(Z+mt)/d;if(!(ft<0||ft>=h.outDepth||Math.floor(ft)!==ft))for(let bt=0;bt<k;bt+=v){const pt=(rt+bt)/f;if(!(pt<0||pt>=h.outHeight||Math.floor(pt)!==pt))for(let yt=0;yt<N;yt+=I){const Nt=(ut+yt)/m;if(Nt<0||Nt>=h.outWidth||Math.floor(Nt)!==Nt)continue;const Rt=q.get(j,ft,pt,Nt,K);lt+=Rt}}}F.set(lt*P,j,Y,Q,tt,K)}return e.makeTensorInfo(F.shape,F.dtype,F.values)}const aV={kernelName:nm,backendName:"cpu",kernelFunc:iV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lV(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:o}=t,i=o;kt([r,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,h=Ps(i.shape,a,l,1,u),d=h.strideHeight,f=h.strideWidth,m=h.filterHeight,g=h.filterWidth,x=h.dilationHeight,b=h.dilationWidth,w=h.effectiveFilterHeight,v=h.effectiveFilterWidth,I=v-1-h.padInfo.left,C=w-1-h.padInfo.top,k=Yt(i.shape,"float32"),N=1/(m*g),T=e.data.get(r.dataId).values,R=Yt(r.shape,"float32",T);for(let E=0;E<h.batchSize;++E)for(let F=0;F<h.inChannels;++F)for(let P=0;P<h.inHeight;++P)for(let q=0;q<h.inWidth;++q){const j=P-C,K=q-I;let Y=0;for(let Q=0;Q<w;Q+=x){const tt=(j+Q)/d;if(!(tt<0||tt>=h.outHeight||Math.floor(tt)!==tt))for(let Z=0;Z<v;Z+=b){const rt=(K+Z)/f;if(rt<0||rt>=h.outWidth||Math.floor(rt)!==rt)continue;const ut=R.get(E,tt,rt,F);Y+=ut}}k.set(Y*N,E,P,q,F)}return e.makeTensorInfo(k.shape,k.dtype,k.values)}const uV={kernelName:em,backendName:"cpu",kernelFunc:lV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cV(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,scale:o,offset:i,mean:a,variance:l}=t;A(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),kt([r,a,l,o,i],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const h=e.data.get(r.dataId).values,d=e.data.get(a.dataId).values,f=e.data.get(l.dataId).values,m=o?e.data.get(o.dataId).values:new Float32Array([1]),g=i?e.data.get(i.dataId).values:new Float32Array([0]),x=new Float32Array(h.length),b=g.length,w=m.length,v=f.length,I=d.length;let C=0,k=0,N=0,T=0;for(let R=0;R<h.length;++R)x[R]=g[C++]+(h[R]-d[k++])*m[N++]/Math.sqrt(f[T++]+u),C>=b&&(C=0),k>=I&&(k=0),N>=w&&(N=0),T>=v&&(T=0);return e.makeTensorInfo(r.shape,r.dtype,x)}const hV={kernelName:kh,backendName:"cpu",kernelFunc:cV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dV(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockShape:o,crops:i}=s;kt([r],"batchToSpaceND");const a=o.reduce((w,v)=>w*v),l=Uu(r.shape,o,a),u=Gu(l.length,o.length),h=Hu(r.shape,o,a),d=sx(i,o.length),f=rx(h,i,o.length),m=Ne({inputs:{x:r},backend:e,attrs:{shape:l}}),g=Jn({inputs:{x:m},backend:e,attrs:{perm:u}}),x=Ne({inputs:{x:g},backend:e,attrs:{shape:h}}),b=Hi({inputs:{x},backend:e,attrs:{begin:d,size:f}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(x),b}const fV={kernelName:ph,backendName:"cpu",kernelFunc:dV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pV(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,weights:o}=t,{size:i}=s,a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,u=ub(a,l,o.dtype,o.shape,i);return e.makeTensorInfo([i],o.dtype,u)}const mV={kernelName:sm,backendName:"cpu",kernelFunc:pV};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gV(n){const{inputs:t,backend:e}=n,{s0:s,s1:r}=t,o=e.data.get(s.dataId).values,i=e.data.get(r.dataId).values,a=Vt(Array.from(o),Array.from(i));return e.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const xV={kernelName:u1,backendName:"cpu",kernelFunc:gV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bV=ge(zl,(n,t)=>{const e=t;return n>e.clipValueMax?e.clipValueMax:n<e.clipValueMin?e.clipValueMin:n}),yV={kernelName:zl,backendName:"cpu",kernelFunc:bV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wV={kernelName:mh,backendName:"cpu",kernelFunc:n=>{const{x:t}=n.inputs,e=n.backend,s=new Float32Array(st(t.shape)),r=e.data.get(t.dataId),o=r.complexTensorInfos.real,i=r.complexTensorInfos.imag,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values;for(let u=0;u<a.length;u++){const h=a[u],d=l[u];s[u]=Math.hypot(h,d)}return e.makeOutput(s,t.shape,"float32")}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qa(n){const{inputs:t,backend:e}=n,{input:s}=t,r=e.data.get(s.dataId).complexTensorInfos.imag,o=e.data.get(r.dataId).values;return e.makeTensorInfo(r.shape,r.dtype,o)}const vV={kernelName:Im,backendName:"cpu",kernelFunc:qa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ja(n){const{inputs:t,backend:e,attrs:s}=n,{axis:r}=s,o=Xt(r,t[0].shape)[0],i=t.map(x=>x.shape);tx(i,o);let a=_r(t.map(x=>x.shape),o);if(st(a)===0)return e.makeTensorInfo(a,t[0].dtype,[]);const l=t.filter(x=>st(x.shape)>0);if(l.length===1)return Pr({inputs:{x:l[0]},backend:e});if(l[0].dtype==="complex64"){const x=l.map(C=>Ui({inputs:{input:C},backend:e})),b=l.map(C=>qa({inputs:{input:C},backend:e})),w=ja({inputs:x,backend:e,attrs:{axis:o}}),v=ja({inputs:b,backend:e,attrs:{axis:o}}),I=hs({inputs:{real:w,imag:v},backend:e});return x.forEach(C=>e.disposeIntermediateTensorInfo(C)),b.forEach(C=>e.disposeIntermediateTensorInfo(C)),e.disposeIntermediateTensorInfo(w),e.disposeIntermediateTensorInfo(v),I}const u=l.map(x=>{const w=[-1,st(x.shape.slice(o))];return Ne({inputs:{x},backend:e,attrs:{shape:w}})}),h=u.map(x=>({vals:e.data.get(x.dataId).values,shape:x.shape}));a=_r(u.map(x=>x.shape),1);const d=u[0].shape[0]===1,f=J$(h,a,t[0].dtype,d),m=_r(l.map(x=>x.shape),o),g=e.makeTensorInfo(m,t[0].dtype,f);return u.forEach(x=>e.disposeIntermediateTensorInfo(x)),g}const CV={kernelName:gh,backendName:"cpu",kernelFunc:ja};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jk(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:o}=t,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:h}=s;kt([r,o],"conv2d");const d=Yr(l),f=wn(r.shape,o.shape,i,u,a,h,!1,d),m=f.filterHeight,g=f.filterWidth,x=f.dilationHeight,b=f.dilationWidth,w=f.padInfo.left,v=f.padInfo.top,I=f.dataFormat==="channelsLast",C=new yn(f.outShape,r.dtype),k=_t(r.shape),N=_t(o.shape),T=k[0],R=I?k[1]:k[2],E=I?k[2]:1,F=I?1:k[1],P=C.strides[0],q=I?C.strides[1]:C.strides[2],j=I?C.strides[2]:1,K=I?1:C.strides[1],Y=e.data.get(r.dataId).values,Q=e.data.get(o.dataId).values,tt=C.values;for(let Z=0;Z<f.batchSize;++Z){const rt=Z*T,ut=Z*P;for(let lt=0;lt<f.outHeight;++lt){const mt=ut+lt*q,ft=lt*f.strideHeight-v;for(let bt=0;bt<m;++bt){const pt=ft+bt*x;if(pt<0||pt>=f.inHeight)continue;const yt=bt*N[0],Nt=rt+pt*R;for(let Rt=0;Rt<f.outWidth;++Rt){const Et=mt+Rt*j,Ut=Rt*f.strideWidth-w;for(let Wt=0;Wt<g;++Wt){const oe=Ut+Wt*b;if(oe<0||oe>=f.inWidth)continue;const xe=yt+Wt*N[1],ie=Nt+oe*E;let ce=xe;for(let pe=0;pe<f.inChannels;++pe){const ue=Y[ie+pe*F];for(let Ie=0;Ie<f.outChannels;++Ie)tt[Et+Ie*K]+=ue*Q[ce+Ie];ce+=f.outChannels}}}}}}return e.makeTensorInfo(C.shape,C.dtype,tt)}const IV={kernelName:xh,backendName:"cpu",kernelFunc:Jk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $V(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:o}=t,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:h}=s;kt([r,o],"conv2dBackpropFilter");const d=Yr(l),f=wn(r.shape,h,i,1,a,u,!1,d),{strideHeight:m,strideWidth:g,filterHeight:x,filterWidth:b}=f,w=f.dataFormat==="channelsLast",v=new yn(f.filterShape,"float32"),I=f.padInfo.left,C=f.padInfo.top,k=e.data.get(r.dataId).values,N=e.data.get(o.dataId).values,T=new yn(r.shape,r.dtype,k),R=new yn(o.shape,o.dtype,N);for(let E=0;E<x;++E){const F=Math.max(0,Math.ceil((C-E)/m)),P=Math.min(f.outHeight,(f.inHeight+C-E)/m);for(let q=0;q<b;++q){const j=Math.max(0,Math.ceil((I-q)/g)),K=Math.min(f.outWidth,(f.inWidth+I-q)/g);for(let Y=0;Y<f.inChannels;++Y)for(let Q=0;Q<f.outChannels;++Q){let tt=0;for(let Z=0;Z<f.batchSize;++Z)for(let rt=F;rt<P;++rt){const ut=E+rt*m-C;for(let lt=j;lt<K;++lt){const mt=q+lt*g-I;w?tt+=T.get(Z,ut,mt,Y)*R.get(Z,rt,lt,Q):tt+=T.get(Z,Y,ut,mt)*R.get(Z,Q,rt,lt)}}v.set(tt,E,q,Y,Q)}}}return e.makeTensorInfo(v.shape,v.dtype,v.values)}const kV={kernelName:im,backendName:"cpu",kernelFunc:$V};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SV(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:o}=t,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:h}=s;kt([r,o],"conv2dBackpropInput");const d=_t(o.shape),f=_t(r.shape);let m=Yr(u);const g=wn(i,o.shape,a,1,l,h,!1,m),x=new yn(g.inShape,"float32"),b=x.values,w=e.data.get(r.dataId).values,v=e.data.get(o.dataId).values,[I,C,k]=d,{batchSize:N,filterHeight:T,filterWidth:R,inChannels:E,inHeight:F,inWidth:P,outChannels:q,outHeight:j,outWidth:K,strideHeight:Y,strideWidth:Q}=g;m=g.dataFormat;const tt=T-1-g.padInfo.top,Z=R-1-g.padInfo.left,rt=m==="channelsLast",ut=x.strides[0],lt=rt?x.strides[1]:x.strides[2],mt=rt?x.strides[2]:1,ft=rt?1:x.strides[1],bt=f[0],pt=rt?f[1]:f[2],yt=rt?f[2]:1,Nt=rt?1:f[1];for(let Rt=0;Rt<N;++Rt)for(let Et=0;Et<E;++Et)for(let Ut=0;Ut<F;++Ut){const Wt=Ut-tt,oe=Math.max(0,Math.ceil(Wt/Y)),xe=Math.min(j,(T+Wt)/Y);for(let ie=0;ie<P;++ie){const ce=ie-Z,pe=Math.max(0,Math.ceil(ce/Q)),ue=Math.min(K,(R+ce)/Q);let Ie=0;for(let Ve=oe;Ve<xe;++Ve){const cn=Ve*Y-Wt;for(let gn=pe;gn<ue;++gn){const js=gn*Q-ce,Ns=bt*Rt+pt*Ve+yt*gn,es=I*(T-1-cn)+C*(R-1-js)+k*Et;for(let Vr=0;Vr<q;++Vr){const fs=w[Ns+Nt*Vr],ns=v[es+Vr];Ie+=fs*ns}}}const xr=ut*Rt+lt*Ut+mt*ie+ft*Et;b[xr]=Ie}}return e.makeTensorInfo(x.shape,x.dtype,x.values)}const NV={kernelName:bh,backendName:"cpu",kernelFunc:SV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TV(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:o}=t,{strides:i,pad:a,dilations:l}=s;kt([r,o],"conv3d");const u=Ro(r.shape,o.shape,i,l,a),{filterDepth:h,filterHeight:d,filterWidth:f,dilationDepth:m,dilationHeight:g,dilationWidth:x,padInfo:b}=u,w=b.front,v=b.left,I=b.top,C=new yn(u.outShape,r.dtype),k=e.data.get(r.dataId).values,N=e.data.get(o.dataId).values,T=C.values,R=_t(r.shape),E=_t(o.shape);for(let F=0;F<u.batchSize;++F){const P=F*R[0],q=F*C.strides[0];for(let j=0;j<u.outDepth;++j){const K=q+j*C.strides[1],Y=j*u.strideDepth-w;for(let Q=0;Q<h;++Q){const tt=Y+Q*m;if(tt<0||tt>=u.inDepth)continue;const Z=Q*E[0],rt=P+tt*R[1];for(let ut=0;ut<u.outHeight;++ut){const lt=K+ut*C.strides[2],mt=ut*u.strideHeight-I;for(let ft=0;ft<d;++ft){const bt=mt+ft*g;if(bt<0||bt>=u.inHeight)continue;const pt=Z+ft*E[1],yt=rt+bt*R[2];for(let Nt=0;Nt<u.outWidth;++Nt){const Rt=lt+Nt*u.outChannels,Et=Nt*u.strideWidth-v;for(let Ut=0;Ut<f;++Ut){const Wt=Et+Ut*x;if(Wt<0||Wt>=u.inWidth)continue;const oe=pt+Ut*E[2],xe=yt+Wt*u.inChannels;let ie=oe;for(let ce=0;ce<u.inChannels;++ce){const pe=k[xe+ce];for(let ue=0;ue<u.outChannels;++ue)T[Rt+ue]+=pe*N[ie+ue];ie+=u.outChannels}}}}}}}}return e.makeTensorInfo(C.shape,C.dtype,C.values)}const EV={kernelName:yh,backendName:"cpu",kernelFunc:TV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _V(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:o}=t,{strides:i,pad:a,filterShape:l}=s;kt([r,o],"conv3dBackpropFilterV2");const u=_t(r.shape),h=_t(o.shape),d=Ro(r.shape,l,i,1,a),f=d.strideDepth,m=d.strideHeight,g=d.strideWidth,x=d.filterDepth,b=d.filterHeight,w=d.filterWidth,v=new yn(d.filterShape,"float32"),I=v.values,[C,k,N,T]=v.strides,R=e.data.get(o.dataId).values,[E,F,P,q]=h,j=e.data.get(r.dataId).values,[K,Y,Q,tt]=u,Z=d.padInfo.front,rt=d.padInfo.left,ut=d.padInfo.top;for(let lt=0;lt<x;++lt){const mt=Math.max(0,Math.ceil((Z-lt)/f)),ft=Math.min(d.outDepth,(d.inDepth+Z-lt)/f),bt=lt*C;for(let pt=0;pt<b;++pt){const yt=Math.max(0,Math.ceil((ut-pt)/m)),Nt=Math.min(d.outHeight,(d.inHeight+ut-pt)/m),Rt=pt*k+bt;for(let Et=0;Et<w;++Et){const Ut=Math.max(0,Math.ceil((rt-Et)/g)),Wt=Math.min(d.outWidth,(d.inWidth+rt-Et)/g),oe=Et*N+Rt;for(let xe=0;xe<d.inChannels;++xe){const ie=xe*T+oe;for(let ce=0;ce<d.outChannels;++ce){let pe=0;for(let ue=0;ue<d.batchSize;++ue){const Ie=ue*K,xr=ue*E;for(let Ve=mt;Ve<ft;++Ve){const gn=(lt+Ve*f-Z)*Y+Ie,js=Ve*F+xr;for(let Ns=yt;Ns<Nt;++Ns){const Vr=(pt+Ns*m-ut)*Q+gn,fs=Ns*P+js;for(let ns=Ut;ns<Wt;++ns){const aa=(Et+ns*g-rt)*tt+Vr,la=ns*q+fs;pe+=j[aa+xe]*R[la+ce]}}}}I[ie+ce]=pe}}}}}return e.makeTensorInfo(v.shape,v.dtype,v.values)}const RV={kernelName:am,backendName:"cpu",kernelFunc:_V};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AV(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:o}=t,{pad:i,strides:a,inputShape:l}=s;kt([r],"conv3dBackpropInputV2");const u=_t(r.shape),h=_t(o.shape),d=Ro(l,o.shape,a,1,i),f=new yn(d.inShape,"float32"),m=f.values,[g,x,b,w]=f.strides,v=e.data.get(r.dataId).values,[I,C,k,N]=u,T=e.data.get(o.dataId).values,[R,E,F,P]=h,{batchSize:q,filterDepth:j,filterHeight:K,filterWidth:Y,inChannels:Q,inDepth:tt,inHeight:Z,inWidth:rt,outChannels:ut,outDepth:lt,outHeight:mt,outWidth:ft,strideDepth:bt,strideHeight:pt,strideWidth:yt}=d,Nt=j-1-d.padInfo.front,Rt=K-1-d.padInfo.top,Et=Y-1-d.padInfo.left;for(let Ut=0;Ut<q;++Ut)for(let Wt=0;Wt<Q;++Wt)for(let oe=0;oe<tt;++oe){const xe=oe-Nt,ie=Math.max(0,Math.ceil(xe/bt)),ce=Math.min(lt,(j+xe)/bt);for(let pe=0;pe<Z;++pe){const ue=pe-Rt,Ie=Math.max(0,Math.ceil(ue/pt)),xr=Math.min(mt,(K+ue)/pt);for(let Ve=0;Ve<rt;++Ve){const cn=Ve-Et,gn=Math.max(0,Math.ceil(cn/yt)),js=Math.min(ft,(Y+cn)/yt);let Ns=0;for(let es=ie;es<ce;++es){const Vr=es*bt-xe;for(let fs=Ie;fs<xr;++fs){const ns=fs*pt-ue;for(let fo=gn;fo<js;++fo){const aa=fo*yt-cn,la=I*Ut+C*es+k*fs+N*fo,zc=R*(j-1-Vr)+E*(K-1-ns)+F*(Y-1-aa)+P*Wt;for(let si=0;si<ut;++si){const Wc=v[la+si],Vc=T[zc+si];Ns+=Wc*Vc}}}}m[g*Ut+x*oe+b*pe+w*Ve+Wt]=Ns}}}return e.makeTensorInfo(f.shape,f.dtype,f.values)}const DV={kernelName:lm,backendName:"cpu",kernelFunc:AV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FV=ge(Wl,n=>Math.cos(n)),OV={kernelName:Wl,backendName:"cpu",kernelFunc:FV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LV=ge(Vl,n=>Math.cosh(n)),PV={kernelName:Vl,backendName:"cpu",kernelFunc:LV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MV(n){const{inputs:t,backend:e,attrs:s}=n,{image:r,boxes:o,boxInd:i}=t,{cropSize:a,method:l,extrapolationValue:u}=s,[h,d,f,m]=r.shape,g=o.shape[0],[x,b]=a,w=Yt([g,x,b,m],"float32"),v=e.data.get(o.dataId).values,I=e.data.get(i.dataId).values,C=e.data.get(r.dataId).values,k=_t(r.shape),N=_t(w.shape);for(let T=0;T<g;T++){const R=T*4,E=v[R],F=v[R+1],P=v[R+2],q=v[R+3],j=I[T];if(j>=h)continue;const K=x>1?(P-E)*(d-1)/(x-1):0,Y=b>1?(q-F)*(f-1)/(b-1):0;for(let Q=0;Q<x;Q++){const tt=x>1?E*(d-1)+Q*K:.5*(E+P)*(d-1);if(tt<0||tt>d-1){for(let Z=0;Z<b;Z++)for(let rt=0;rt<m;rt++){const ut=rt+Z*N[2]+Q*N[1]+T*N[0];w.values[ut]=u}continue}if(l==="bilinear"){const Z=Math.floor(tt),rt=Math.ceil(tt),ut=tt-Z;for(let lt=0;lt<b;lt++){const mt=b>1?F*(f-1)+lt*Y:.5*(F+q)*(f-1);if(mt<0||mt>f-1){for(let yt=0;yt<m;yt++){const Nt=yt+lt*N[2]+Q*N[1]+T*N[0];w.values[Nt]=u}continue}const ft=Math.floor(mt),bt=Math.ceil(mt),pt=mt-ft;for(let yt=0;yt<m;yt++){let Nt=yt+ft*k[2]+Z*k[1]+j*k[0];const Rt=C[Nt];Nt=yt+bt*k[2]+Z*k[1]+j*k[0];const Et=C[Nt];Nt=yt+ft*k[2]+rt*k[1]+j*k[0];const Ut=C[Nt];Nt=yt+bt*k[2]+rt*k[1]+j*k[0];const Wt=C[Nt],oe=Rt+(Et-Rt)*pt,xe=Ut+(Wt-Ut)*pt;Nt=yt+lt*N[2]+Q*N[1]+T*N[0],w.values[Nt]=oe+(xe-oe)*ut}}}else for(let Z=0;Z<b;++Z){const rt=b>1?F*(f-1)+Z*Y:.5*(F+q)*(f-1);if(rt<0||rt>f-1){for(let mt=0;mt<m;mt++){const ft=mt+Z*N[2]+Q*N[1]+T*N[0];w.values[ft]=u}continue}const ut=Math.round(rt),lt=Math.round(tt);for(let mt=0;mt<m;mt++){const ft=mt+ut*k[2]+lt*k[1]+j*k[0],bt=mt+Z*N[2]+Q*N[1]+T*N[0];w.values[bt]=C[ft]}}}}return e.makeTensorInfo(w.shape,w.dtype,w.values)}const BV={kernelName:cm,backendName:"cpu",kernelFunc:MV};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zV(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o,exclusive:i,reverse:a}=s;kt(r,"cumprod");const l=Be([o],r.shape.length);let u=r;l!=null&&(u=Jn({inputs:{x:r},backend:e,attrs:{perm:l}}));const h=qe(1,r.shape.length)[0];if(h!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${h}`);const d=us(u.dtype,"int32"),f=Xp(st(u.shape),d),m=e.data.get(u.dataId).values,g=u.shape[u.shape.length-1],x=a?(w,v)=>w+g-v-1:(w,v)=>w+v;for(let w=0;w<m.length;w+=g)for(let v=0;v<g;v++){const I=x(w,v);if(v===0)f[I]=i?1:m[I];else{const C=x(w,v-1);f[I]=i?m[C]*f[C]:m[I]*f[C]}}const b=e.makeTensorInfo(u.shape,d,f);if(l!=null){const w=Ao(l),v=Jn({inputs:{x:b},backend:e,attrs:{perm:w}});return e.disposeIntermediateTensorInfo(b),e.disposeIntermediateTensorInfo(u),v}return b}const WV={kernelName:um,backendName:"cpu",kernelFunc:zV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VV(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o,exclusive:i,reverse:a}=s;kt(r,"cumsum");const l=Be([o],r.shape.length);let u=r;l!=null&&(u=Jn({inputs:{x:r},backend:e,attrs:{perm:l}}));const h=qe(1,r.shape.length)[0];if(h!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${h}`);const d=us(u.dtype,"int32"),f=Sn(st(u.shape),d),m=e.data.get(u.dataId).values,g=u.shape[u.shape.length-1],x=a?(w,v)=>w+g-v-1:(w,v)=>w+v;for(let w=0;w<m.length;w+=g)for(let v=0;v<g;v++){const I=x(w,v);if(v===0)f[I]=i?0:m[I];else{const C=x(w,v-1);f[I]=i?m[C]+f[C]:m[I]+f[C]}}const b=e.makeTensorInfo(u.shape,d,f);if(l!=null){const w=Ao(l),v=Jn({inputs:{x:b},backend:e,attrs:{perm:w}});return e.disposeIntermediateTensorInfo(b),e.disposeIntermediateTensorInfo(u),v}return b}const UV={kernelName:wh,backendName:"cpu",kernelFunc:VV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GV(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,weights:o}=t,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const l=e.data.get(r.dataId).values,u=e.data.get(o.dataId).values,h=ub(l,u,o.dtype,o.shape,i);return e.makeTensorInfo([i],o.dtype,h)}else if(r.shape.length===2){const l=e.bufferSync(r),u=e.bufferSync(o),h=X$(l,u,i,a);return e.makeTensorInfo(h.shape,o.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const HV={kernelName:hm,backendName:"cpu",kernelFunc:GV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KV(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockSize:o,dataFormat:i}=s;A(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const a=r.shape[0],l=r.shape[1],u=r.shape[2],h=r.shape[3],d=l*o,f=u*o,m=h/(o*o),g=e.data.get(r.dataId).values,x=new Float32Array(a*d*f*m);let b=0;for(let w=0;w<a;++w)for(let v=0;v<d;++v){const I=Math.floor(v/o),C=v%o;for(let k=0;k<f;++k){const N=Math.floor(k/o),T=k%o,R=(C*o+T)*m;for(let E=0;E<m;++E){const P=E+R+h*(N+u*(I+l*w));x[b++]=g[P]}}}return e.makeTensorInfo([a,d,f,m],r.dtype,x)}const qV={kernelName:dm,backendName:"cpu",kernelFunc:KV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qk(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:o}=t,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=s;kt([r,o],"depthwiseConv2DNative");const h=_t(r.shape),d=_t(o.shape);let f=l;f==null&&(f=[1,1]),A(Tn(i,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${f}'`);const m=wn(r.shape,o.shape,i,f,a,u,!0),{filterHeight:g,filterWidth:x,dilationHeight:b,dilationWidth:w,padInfo:v}=m,I=v.left,C=v.top,k=m.outChannels/m.inChannels,N=new yn(m.outShape,r.dtype),T=e.data.get(r.dataId).values,R=e.data.get(o.dataId).values,E=N.values;for(let F=0;F<m.batchSize;++F){const P=F*h[0],q=F*N.strides[0];for(let j=0;j<m.outHeight;++j){const K=q+j*N.strides[1],Y=j*m.strideHeight-C;for(let Q=0;Q<g;++Q){const tt=Y+Q*b;if(tt<0||tt>=m.inHeight)continue;const Z=Q*d[0],rt=P+tt*h[1];for(let ut=0;ut<m.outWidth;++ut){const lt=K+ut*N.strides[2],mt=ut*m.strideWidth-I;for(let ft=0;ft<x;++ft){const bt=mt+ft*w;if(bt<0||bt>=m.inWidth)continue;const pt=Z+ft*d[1],yt=rt+bt*m.inChannels;let Nt=lt,Rt=pt;for(let Et=0;Et<m.inChannels;++Et){const Ut=T[yt+Et];for(let Wt=0;Wt<k;++Wt)E[Nt+Wt]+=Ut*R[Rt+Wt];Nt+=k,Rt+=k}}}}}}return e.makeTensorInfo(N.shape,N.dtype,N.values)}const jV={kernelName:vh,backendName:"cpu",kernelFunc:Qk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XV(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:o}=t,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:h}=s;kt([r,o],"depthwiseConv2dNativeBackpropFilter");const d=wn(r.shape,h,i,a,l,u,!0),{strideHeight:f,strideWidth:m,filterHeight:g,filterWidth:x}=d,b=new yn(d.filterShape,"float32"),w=d.padInfo.left,v=d.padInfo.top,I=d.outChannels/d.inChannels,C=e.data.get(r.dataId).values,k=new yn(r.shape,r.dtype,C),N=e.data.get(o.dataId).values,T=new yn(o.shape,o.dtype,N);for(let R=0;R<g;++R){const E=Math.max(0,Math.ceil((v-R)/f)),F=Math.min(d.outHeight,(d.inHeight+v-R)/f);for(let P=0;P<x;++P){const q=Math.max(0,Math.ceil((w-P)/m)),j=Math.min(d.outWidth,(d.inWidth+w-P)/m);for(let K=0;K<d.outChannels;++K){const Y=Math.trunc(K/I),Q=K%I;let tt=0;for(let Z=0;Z<d.batchSize;++Z)for(let rt=E;rt<F;++rt){const ut=R+rt*f-v;for(let lt=q;lt<j;++lt){const mt=P+lt*m-w;tt+=k.get(Z,ut,mt,Y)*T.get(Z,rt,lt,K)}}b.set(tt,R,P,Y,Q)}}}return e.makeTensorInfo(b.shape,b.dtype,b.values)}const YV={kernelName:fm,backendName:"cpu",kernelFunc:XV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZV(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:o}=t,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:h}=s;kt([r,o],"depthwiseConv2DNativeBackpropInput");const d=_t(r.shape),f=_t(o.shape),m=wn(h,o.shape,i,a,l,u,!0),g=new yn(m.inShape,"float32"),x=g.values,[b,w,v]=g.strides,I=e.data.get(r.dataId).values,[C,k,N]=d,T=e.data.get(o.dataId).values,[R,E,F]=f,{batchSize:P,filterHeight:q,filterWidth:j,inChannels:K,inHeight:Y,inWidth:Q,outChannels:tt,outHeight:Z,outWidth:rt,strideHeight:ut,strideWidth:lt}=m,mt=q-1-m.padInfo.top,ft=j-1-m.padInfo.left,bt=tt/K;for(let pt=0;pt<P;++pt)for(let yt=0;yt<K;++yt)for(let Nt=0;Nt<Y;++Nt){const Rt=Nt-mt,Et=Math.max(0,Math.ceil(Rt/ut)),Ut=Math.min(Z,(q+Rt)/ut);for(let Wt=0;Wt<Q;++Wt){const oe=Wt-ft,xe=Math.max(0,Math.ceil(oe/lt)),ie=Math.min(rt,(j+oe)/lt);let ce=0;for(let pe=Et;pe<Ut;++pe){const ue=pe*ut-Rt;for(let Ie=xe;Ie<ie;++Ie){const xr=Ie*lt-oe,Ve=C*pt+k*pe+N*Ie,cn=R*(q-1-ue)+E*(j-1-xr)+F*yt;for(let gn=0;gn<bt;++gn){const js=yt*bt+gn,Ns=I[Ve+js],es=T[cn+gn];ce+=Ns*es}}}x[b*pt+w*Nt+v*Wt+yt]=ce}}return e.makeTensorInfo(g.shape,g.dtype,g.values)}const JV={kernelName:pm,backendName:"cpu",kernelFunc:ZV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QV(n){const{inputs:t,backend:e}=n,{x:s}=t,r=st(s.shape),o=e.data.get(s.dataId).values,i=Yt([r,r],s.dtype),a=i.values;for(let u=0;u<o.length;u++)a[u*r+u]=o[u];const l=[...s.shape,...s.shape];return e.makeTensorInfo(l,i.dtype,i.values)}const t4={kernelName:c1,backendName:"cpu",kernelFunc:QV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e4={kernelName:Ch,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,filter:r}=n,{strides:o,pad:i,dilations:a}=e,l=t,u=l.data.get(s.dataId).values,h=s.shape.length,d=l.data.get(r.dataId).values,f=r.shape.length,{batchSize:m,inHeight:g,inWidth:x,inChannels:b,outHeight:w,outWidth:v,padInfo:I,strideHeight:C,strideWidth:k,filterHeight:N,filterWidth:T,dilationHeight:R,dilationWidth:E,outShape:F}=_u(s.shape,r.shape,o,i,"NHWC",a),P=st(F),q=F.length,j=He(s.dtype,P);for(let Y=0;Y<m;++Y)for(let Q=0;Q<w;++Q){const tt=Q*C-I.top;for(let Z=0;Z<v;++Z){const rt=Z*k-I.left;for(let ut=0;ut<b;++ut){let lt=Number.MIN_SAFE_INTEGER;for(let ft=0;ft<N;++ft){const bt=tt+ft*R;if(bt>=0&&bt<g)for(let pt=0;pt<T;++pt){const yt=rt+pt*E;if(yt>=0&&yt<x){const Nt=Cr([Y,bt,yt,ut],h,_t(s.shape)),Rt=Cr([ft,pt,ut],f,_t(r.shape)),Et=u[Nt]+d[Rt];Et>lt&&(lt=Et)}}}const mt=Cr([Y,Q,Z,ut],q,_t(F));j[mt]=lt}}}return{dataId:l.write(wi(j,s.dtype),F,s.dtype),shape:F,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n4={kernelName:gm,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:a,dilations:l}=e,u=t,h=sr(s.shape,u.data.get(s.dataId).values),d=sr(r.shape,u.data.get(r.dataId).values),{batchSize:f,inHeight:m,inWidth:g,inChannels:x,outHeight:b,outWidth:w,padInfo:v,strideHeight:I,strideWidth:C,filterHeight:k,filterWidth:N,dilationHeight:T,dilationWidth:R,outShape:E}=_u(s.shape,r.shape,i,a,"NHWC",l);A(o.rank===E.length,()=>`Error in ${gm}, dy must have the same rank as output ${E.length}, but got ${o.rank}`);const F=sr(E,u.data.get(o.dataId).values),P=o1(r.shape,r.dtype);for(let j=0;j<f;++j)for(let K=0;K<b;++K){const Y=K*I-v.top;for(let Q=0;Q<w;++Q){const tt=Q*C-v.left;for(let Z=0;Z<x;++Z){let rt=Number.MIN_SAFE_INTEGER,ut=0,lt=0;for(let mt=0;mt<k;++mt){const ft=Y+mt*T;if(ft>=0&&ft<m)for(let bt=0;bt<N;++bt){const pt=tt+bt*R;if(pt>=0&&pt<g){const yt=h[j][ft][pt][Z]+d[mt][bt][Z];yt>rt&&(rt=yt,ut=mt,lt=bt)}}}P[ut][lt][Z]+=F[j][K][Q][Z]}}}return{dataId:u.write(wi(P,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s4={kernelName:mm,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:a,dilations:l}=e,u=t,h=sr(s.shape,u.data.get(s.dataId).values),d=sr(r.shape,u.data.get(r.dataId).values),{batchSize:f,inHeight:m,inWidth:g,inChannels:x,outHeight:b,outWidth:w,padInfo:v,strideHeight:I,strideWidth:C,filterHeight:k,filterWidth:N,dilationHeight:T,dilationWidth:R,outShape:E}=_u(s.shape,r.shape,i,a,"NHWC",l);A(o.rank===E.length,()=>`Error in ${mm}, dy must have the same rank as output ${E.length}, but got ${o.rank}`);const F=sr(E,u.data.get(o.dataId).values),P=o1(s.shape,s.dtype);for(let j=0;j<f;++j)for(let K=0;K<b;++K){const Y=K*I-v.top;for(let Q=0;Q<w;++Q){const tt=Q*C-v.left;for(let Z=0;Z<x;++Z){let rt=Number.MIN_SAFE_INTEGER,ut=Y<0?0:Y,lt=tt<0?0:tt;for(let mt=0;mt<k;++mt){const ft=Y+mt*T;if(ft>=0&&ft<m)for(let bt=0;bt<N;++bt){const pt=tt+bt*R;if(pt>=0&&pt<g){const yt=h[j][ft][pt][Z]+d[mt][bt][Z];yt>rt&&(rt=yt,ut=ft,lt=pt)}}}P[j][ut][lt][Z]+=F[j][K][Q][Z]}}}return{dataId:u.write(wi(P,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r4(n){const{inputs:t,backend:e,attrs:s}=n,{image:r}=t,{canvas:o,options:i}=s,{contextOptions:a,imageOptions:l}=i||{},u=(l==null?void 0:l.alpha)||1,h=(a==null?void 0:a.contextType)||"2d";if(h!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const d=o.getContext(h,(a==null?void 0:a.contextAttributes)||{});if(d==null)throw new Error(`Could not get the context with ${h} type.`);const[f,m]=r.shape.slice(0,2),g=r.shape.length===2?1:r.shape[2],x=e.data.get(r.dataId).values,b=r.dtype==="float32"?255:1,w=new Uint8ClampedArray(m*f*4);for(let I=0;I<f*m;++I){const C=[0,0,0,255*u];for(let N=0;N<g;N++){const T=x[I*g+N];if(r.dtype==="float32"){if(T<0||T>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${T}.`)}else if(r.dtype==="int32"&&(T<0||T>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${T}.`);g===1?(C[0]=T*b,C[1]=T*b,C[2]=T*b):C[N]=T*b}const k=I*4;w[k+0]=Math.round(C[0]),w[k+1]=Math.round(C[1]),w[k+2]=Math.round(C[2]),w[k+3]=Math.round(C[3])}o.width=m,o.height=f;const v=new ImageData(w,m,f);return d.putImageData(v,0,0),r}const o4={kernelName:g_,backendName:"cpu",kernelFunc:r4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uc(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o,keepDims:i}=s;kt(r,"sum");let a;r.dtype==="bool"?a=Ho({inputs:{x:r},backend:e,attrs:{dtype:"int32"}}):a=Pr({inputs:{x:r},backend:e});const l=a.shape.length,u=Xt(o,a.shape),h=Be(u,l);let d=u,f=a;h!=null&&(f=Jn({inputs:{x:a},backend:e,attrs:{perm:h}}),d=qe(d.length,l)),vn("sum",d,f.shape.length);const[m,g]=dn(f.shape,d),x=us(f.dtype,"int32");let b=rf(e,m,x);const w=st(g),v=e.data.get(b.dataId).values,I=e.data.get(f.dataId).values;for(let C=0;C<v.length;++C){const k=C*w;let N=0;for(let T=0;T<w;++T)N+=I[k+T];v[C]=N}if(i){const C=Je(b.shape,u),k=b;b=Ne({inputs:{x:b},backend:e,attrs:{shape:C}}),e.disposeIntermediateTensorInfo(k)}return e.disposeIntermediateTensorInfo(a),h!=null&&e.disposeIntermediateTensorInfo(f),b}const i4={kernelName:ed,backendName:"cpu",kernelFunc:uc};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a4(n){const{inputs:t,backend:e,attrs:s}=n,{equation:r}=s,o=t,{allDims:i,summedDims:a,idDims:l}=fx(r,o.length);mx(i.length,l,o);const{path:u,steps:h}=gx(a,l),d=h.length;let f=null,m=i.length;const g=[];for(let x=0;x<d;++x){for(const b of h[x]){const{permutationIndices:w,expandDims:v}=px(m,l[b]);let I;xx(w)?I=o[b]:(I=Jn({inputs:{x:o[b]},backend:e,attrs:{perm:w}}),g.push(I));const C=I.shape.slice();for(let k=0;k<v.length;++k)C.splice(v[k],0,1);he(I.shape,C)||(I=Ne({inputs:{x:I},backend:e,attrs:{shape:C}}),g.push(I)),f===null?f=I:(f=of({inputs:{a:I,b:f},backend:e}),g.push(f))}x<d-1&&(u[x]>=0&&(f=uc({inputs:{x:f},backend:e,attrs:{axis:u[x]-(i.length-m),keepDims:!1}}),g.push(f)),m--)}for(const x of g)x!==f&&e.disposeIntermediateTensorInfo(x);return f}const l4={kernelName:xm,backendName:"cpu",kernelFunc:a4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u4(n){const{inputs:t,backend:e}=n,{dy:s,y:r}=t;kt([s,r],"eluGrad");const o=new Float32Array(st(r.shape)),i=e.data.get(r.dataId).values,a=e.data.get(s.dataId).values;for(let l=0;l<i.length;++l){const u=i[l];u>=0?o[l]=a[l]:o[l]=a[l]*(u+1)}return e.makeTensorInfo(r.shape,"float32",o)}const c4={kernelName:bm,backendName:"cpu",kernelFunc:u4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h4=ox,d4=ix,f4=ax,p4=lx,m4=ux,g4=cx,x4=ge(Hl,n=>{const t=Math.sign(n),e=Math.abs(n),s=1/(1+h4*e);return t*(1-((((g4*s+m4)*s+p4)*s+f4)*s+d4)*s*Math.exp(-e*e))}),b4={kernelName:Hl,backendName:"cpu",kernelFunc:x4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uf(n){const{inputs:t,backend:e,attrs:s}=n,{input:r}=t,{dim:o}=s,i=r.shape.length,a=r.shape.slice();let l=o;return o<0&&(A(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+o+1),a.splice(l,0,1),Ne({inputs:{x:r},backend:e,attrs:{shape:a}})}const y4={kernelName:$h,backendName:"cpu",kernelFunc:uf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w4=Ye((n,t)=>n/t),mb=ln(Ul,w4),gb={kernelName:Ul,backendName:"cpu",kernelFunc:mb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tS(n,t,e){const s=n.shape,r=s[0],o=s[1],i=e.data.get(n.dataId),a=i.complexTensorInfos.real,l=i.complexTensorInfos.imag,u=[r,o],h=st(u),d=kn("float32",h),f=kn("float32",h);for(let b=0;b<r;b++){const w=Hi({inputs:{x:a},backend:e,attrs:{begin:[b,0],size:[1,o]}}),v=Hi({inputs:{x:l},backend:e,attrs:{begin:[b,0],size:[1,o]}}),I=hs({inputs:{real:w,imag:v},backend:e}),{real:C,imag:k}=v4(I,t,e),N=Qr(C,k);for(let T=0;T<o;T++){const R=hx(N,T);d[b*o+T]=R.real,f[b*o+T]=R.imag}e.disposeIntermediateTensorInfo(w),e.disposeIntermediateTensorInfo(v),e.disposeIntermediateTensorInfo(I)}const m=e.makeTensorInfo(u,"float32",d),g=e.makeTensorInfo(u,"float32",f),x=hs({inputs:{real:m,imag:g},backend:e});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),x}function v4(n,t,e){const s=st(n.shape),r=e.data.get(n.dataId),o=e.data.get(r.complexTensorInfos.real.dataId).values,i=e.data.get(r.complexTensorInfos.imag.dataId).values;if(C4(s)){const a=xb(o,i,s,t,e),l=[n.shape[0],n.shape[1]];if(t){const u=e.makeTensorInfo(l,"float32",a.real),h=e.makeTensorInfo(l,"float32",a.imag),d=e.makeTensorInfo([],"float32",So(s,"float32")),f=Pr({inputs:{x:d},backend:e}),m=gb.kernelFunc({inputs:{a:u,b:d},backend:e}),g=gb.kernelFunc({inputs:{a:h,b:f},backend:e}),x=e.data.get(m.dataId).values,b=e.data.get(g.dataId).values;return e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),{real:x,imag:b}}return a}else{const a=Qr(o,i),l=I4(a,s,t);return kv(l)}}function C4(n){return(n&n-1)===0}function xb(n,t,e,s,r){if(e===1)return{real:n,imag:t};const o=Qr(n,t),i=e/2,a=Sv(o),l=a.real,u=a.imag,h=[l.length],d=r.makeTensorInfo(h,"float32",l),f=r.makeTensorInfo(h,"float32",u),m=hs({inputs:{real:d,imag:f},backend:r}),g=Nv(o),x=g.real,b=g.imag,w=[x.length],v=r.makeTensorInfo(w,"float32",x),I=r.makeTensorInfo(w,"float32",b),C=hs({inputs:{real:v,imag:I},backend:r}),k=xb(l,u,i,s,r),N=k.real,T=k.imag,R=[N.length],E=r.makeTensorInfo(R,"float32",N),F=r.makeTensorInfo(R,"float32",T),P=hs({inputs:{real:E,imag:F},backend:r}),q=xb(x,b,i,s,r),j=q.real,K=q.imag,Y=[j.length],Q=r.makeTensorInfo(Y,"float32",j),tt=r.makeTensorInfo(Y,"float32",K),Z=hs({inputs:{real:Q,imag:tt},backend:r}),rt=Ev(e,s),ut=[rt.real.length],lt=r.makeTensorInfo(ut,"float32",rt.real),mt=r.makeTensorInfo(ut,"float32",rt.imag),ft=hs({inputs:{real:lt,imag:mt},backend:r}),bt=of({inputs:{a:ft,b:Z},backend:r}),pt=Ka({inputs:{a:P,b:bt},backend:r}),yt=fb({inputs:{a:P,b:bt},backend:r}),Nt=Ui({inputs:{input:pt},backend:r}),Rt=Ui({inputs:{input:yt},backend:r}),Et=qa({inputs:{input:pt},backend:r}),Ut=qa({inputs:{input:yt},backend:r}),Wt=ja({inputs:[Nt,Rt],backend:r,attrs:{axis:0}}),oe=ja({inputs:[Et,Ut],backend:r,attrs:{axis:0}}),xe=r.data.get(Wt.dataId).values,ie=r.data.get(oe.dataId).values;return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(I),r.disposeIntermediateTensorInfo(C),r.disposeIntermediateTensorInfo(E),r.disposeIntermediateTensorInfo(F),r.disposeIntermediateTensorInfo(P),r.disposeIntermediateTensorInfo(Q),r.disposeIntermediateTensorInfo(tt),r.disposeIntermediateTensorInfo(Z),r.disposeIntermediateTensorInfo(lt),r.disposeIntermediateTensorInfo(mt),r.disposeIntermediateTensorInfo(ft),r.disposeIntermediateTensorInfo(bt),r.disposeIntermediateTensorInfo(pt),r.disposeIntermediateTensorInfo(yt),r.disposeIntermediateTensorInfo(Nt),r.disposeIntermediateTensorInfo(Et),r.disposeIntermediateTensorInfo(Rt),r.disposeIntermediateTensorInfo(Ut),r.disposeIntermediateTensorInfo(Wt),r.disposeIntermediateTensorInfo(oe),{real:xe,imag:ie}}function I4(n,t,e){const s=new Float32Array(t*2);for(let r=0;r<t;r++){let o=0,i=0;for(let a=0;a<t;a++){const l=_v(r*a,t,e),u=hx(n,a);o+=u.real*l.real-u.imag*l.imag,i+=u.real*l.imag+u.imag*l.real}e&&(o/=t,i/=t),Tv(s,o,i,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $4(n){const{inputs:t,backend:e}=n,{input:s}=t,r=st(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=Ne({inputs:{x:s},backend:e,attrs:{shape:[i,o]}}),l=tS(a,!1,e),u=Ne({inputs:{x:l},backend:e,attrs:{shape:s.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),u}const k4={kernelName:ym,backendName:"cpu",kernelFunc:$4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bb(n){const{backend:t,attrs:e}=n,{shape:s,value:r,dtype:o}=e,i=o||va(r),a=He(i,st(s));return N4(a,r,i),t.makeTensorInfo(s,i,a)}const S4={kernelName:wm,backendName:"cpu",kernelFunc:bb};function N4(n,t,e){n.fill(t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T4={kernelName:vm,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:s}=n,r=e,o=kn(s.dtype,st(s.shape)),[i,a,l,u]=s.shape,h=r.data.get(s.dataId).values;for(let f=0;f<i;f++){const m=f*l*a*u;for(let g=0;g<a;g++){const x=g*(l*u);for(let b=0;b<l;b++){const w=b*u;for(let v=0;v<u;v++){const I=Math.round(l-b-1),C=m+x+w+v;let k=h[C];if(I>=0&&I<l){const N=I*u,T=m+x+N+v;k=h[T]}o[C]=k}}}}return{dataId:r.write(o,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E4(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=t,{strides:l,pad:u,dataFormat:h,dilations:d,dimRoundingMode:f,activation:m,leakyreluAlpha:g}=s;let x=Jk({inputs:{x:r,filter:o},backend:e,attrs:{strides:l,pad:u,dataFormat:h,dilations:d,dimRoundingMode:f}});if(i){const b=x;if(h==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const w=Ne({inputs:{x:i},backend:e,attrs:{shape:[i.shape[0],1,1]}});x=Ka({inputs:{a:x,b:w},backend:e}),e.disposeIntermediateTensorInfo(w)}else x=Ka({inputs:{a:x,b:i},backend:e});e.disposeIntermediateTensorInfo(b)}if(m){const b=x;if(h==="NCHW"&&m==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const w=Ne({inputs:{x:a},backend:e,attrs:{shape:[a.shape[0],1,1]}});x=lf(e,x,m,w,g),e.disposeIntermediateTensorInfo(w)}else x=lf(e,x,m,a,g);e.disposeIntermediateTensorInfo(b)}return x}const _4={kernelName:ud,backendName:"cpu",kernelFunc:E4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R4(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=t,{strides:l,pad:u,dataFormat:h,dilations:d,dimRoundingMode:f,activation:m,leakyreluAlpha:g}=s;let x=Qk({inputs:{x:r,filter:o},backend:e,attrs:{strides:l,pad:u,dataFormat:h,dilations:d,dimRoundingMode:f}});if(i){const b=x;x=Ka({inputs:{a:x,b:i},backend:e}),e.disposeIntermediateTensorInfo(b)}if(m){const b=x;x=lf(e,x,m,a,g),e.disposeIntermediateTensorInfo(b)}return x}const A4={kernelName:E1,backendName:"cpu",kernelFunc:R4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D4(n){const{inputs:t,backend:e}=n,{params:s,indices:r}=t,o=st(s.shape),i=r.shape,a=i[i.length-1],[l,u,h,d]=qg(s,r);if(u===0)return e.makeTensorInfo(l,s.dtype,[]);const f=e.data.get(r.dataId).values,m=e.bufferSync(s),g=ik(f,m,s.dtype,u,a,h,d,s.shape,o);return e.makeTensorInfo(l,s.dtype,g.values)}const F4={kernelName:h1,backendName:"cpu",kernelFunc:D4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O4(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,indices:o}=t,{axis:i,batchDims:a}=s;kt([r,o],"gatherV2");const l=Xt(i,r.shape)[0],u=e.data.get(o.dataId).values,h=r.shape[l];for(let C=0;C<u.length;++C){const k=u[C];A(k<=h-1&&k>=0,()=>`GatherV2: the index value ${k} is not in [0, ${h-1}]`)}let d=a;a==null&&(d=0);const f=st(o.shape),m=wx(r,o,l,d),g=Ne({inputs:{x:r},backend:e,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),x=Ne({inputs:{x:o},backend:e,attrs:{shape:[m.batchSize,f/m.batchSize]}}),b=[m.batchSize,m.outerSize,f/m.batchSize,m.sliceSize],w=e.bufferSync(x),v=e.bufferSync(g),I=ak(v,w,b);return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(x),e.makeTensorInfo(m.outputShape,I.dtype,I.values)}const L4={kernelName:Sh,backendName:"cpu",kernelFunc:O4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P4(n){const{inputs:t,backend:e}=n,{input:s}=t,r=st(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=Ne({inputs:{x:s},backend:e,attrs:{shape:[i,o]}}),l=tS(a,!0,e),u=Ne({inputs:{x:l},backend:e,attrs:{shape:s.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),u}const M4={kernelName:Cm,backendName:"cpu",kernelFunc:P4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B4=ge(Jl,n=>Number.isFinite(n)?1:0,"bool"),z4={kernelName:Jl,backendName:"cpu",kernelFunc:B4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W4=ge(Ql,n=>Math.abs(n)===1/0?1:0,"bool"),V4={kernelName:Ql,backendName:"cpu",kernelFunc:W4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U4=ge(tu,n=>Number.isNaN(n)?1:0,"bool"),G4={kernelName:tu,backendName:"cpu",kernelFunc:U4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H4(n){const{backend:t,attrs:e}=n,{start:s,stop:r,num:o}=e,i=dk(s,r,o);return t.makeTensorInfo([i.length],"float32",i)}const K4={kernelName:d1,backendName:"cpu",kernelFunc:H4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q4=ge(nu,n=>Math.log1p(n)),j4={kernelName:nu,backendName:"cpu",kernelFunc:q4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X4=Ye((n,t)=>n&&t),Y4=ln(Rh,X4,null,"bool"),Z4={kernelName:Rh,backendName:"cpu",kernelFunc:Y4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J4=ge(Ah,n=>n?0:1,"bool"),Q4={kernelName:Ah,backendName:"cpu",kernelFunc:J4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tU=Ye((n,t)=>n||t),eU=ln(Dh,tU,null,"bool"),nU={kernelName:Dh,backendName:"cpu",kernelFunc:eU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sU(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{depthRadius:o,bias:i,alpha:a,beta:l}=s;kt(r,"LRN");const u=r.shape[3],h=u-1,d=e.data.get(r.dataId).values,f=st(r.shape),m=new Float32Array(f);function g(x){const b=x%u;let w=x-b+Math.max(0,b-o);const v=x-b+Math.min(b+o,h);let I=0;for(;w<=v;w++){const C=d[w];I+=C*C}return I}for(let x=0;x<f;x++){const b=g(x),w=d[x]*Math.pow(i+a*b,-l);m[x]=w}return e.makeTensorInfo(r.shape,r.dtype,m)}const rU={kernelName:Fh,backendName:"cpu",kernelFunc:sU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oU(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,y:o,dy:i}=t,{depthRadius:a,bias:l,alpha:u,beta:h}=s;kt(i,"LRNGrad");const d=st(i.shape),f=i.shape[3],m=e.data.get(i.dataId).values,g=e.data.get(r.dataId).values,x=e.data.get(o.dataId).values,b=new Float32Array(d),w=d;for(let v=0;v<w;v++){const I=v%f,C=v-I+Math.max(0,I-a),k=v-I+Math.min(f,I+a+1);let N=0;for(let T=C;T<k;T++)N+=Math.pow(g[T],2);N=u*N+l;for(let T=C;T<k;T++){let R=-2*u*h*g[T]*x[v]/N;v===T&&(R+=Math.pow(N,-h)),R*=m[v],b[T]+=R}}return e.makeTensorInfo(i.shape,r.dtype,b)}const iU={kernelName:$m,backendName:"cpu",kernelFunc:oU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eS(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{reductionIndices:o,keepDims:i}=s,a=e;let l=r.shape;const u=l.length,h=Xt(o,l);let d=h;const f=Be(d,u);let m=a.data.get(r.dataId).values;if(f!=null){const C=new Array(u);for(let k=0;k<C.length;k++)C[k]=l[f[k]];m=hb(m,l,r.dtype,f,C),d=qe(d.length,u),l=C}kt(r,"max"),vn("max",d,u);const[g,x]=dn(l,d),b=st(x),w=pk(m,b,g,r.dtype),v=a.write(w,g,r.dtype);let I=g;return i&&(I=Je(g,h)),{dataId:v,shape:I,dtype:r.dtype}}const aU={kernelName:Oh,backendName:"cpu",kernelFunc:eS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lU(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t;kt(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;A(Tn(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const h=Ps(r.shape,o,i,u,a,l);let d;if(h.filterWidth===1&&h.filterHeight===1&&he(h.inShape,h.outShape))d=Pr({inputs:{x:r},backend:e});else{const f=e.data.get(r.dataId).values,m=_t(r.shape),g=pb(f,r.shape,r.dtype,m,h,"max");d=e.makeTensorInfo(h.outShape,r.dtype,g.values)}return d}const uU={kernelName:Lh,backendName:"cpu",kernelFunc:lU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cU(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s;kt(r,"maxPool3d");const h=Xr(r.shape,o,i,1,a,l,u),d=e.data.get(r.dataId).values,f=Zk(d,r.shape,r.dtype,_t(r.shape),h,"max");return e.makeTensorInfo(f.shape,"float32",f.values)}const hU={kernelName:Ph,backendName:"cpu",kernelFunc:cU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dU(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:o}=t,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=s;kt([r,o],"maxPool3DGrad");const h=Xr(o.shape,i,a,1,l,u),d=e.bufferSync(o),f=eV(d,h),m=h.strideDepth,g=h.strideHeight,x=h.strideWidth,b=h.dilationDepth,w=h.dilationHeight,v=h.dilationWidth,I=h.effectiveFilterDepth,C=h.effectiveFilterHeight,k=h.effectiveFilterWidth,N=I-1-h.padInfo.front,T=k-1-h.padInfo.left,R=C-1-h.padInfo.top,E=Yt(o.shape,"float32"),F=e.bufferSync(r);for(let P=0;P<h.batchSize;++P)for(let q=0;q<h.inChannels;++q)for(let j=0;j<h.inDepth;++j)for(let K=0;K<h.inHeight;++K)for(let Y=0;Y<h.inWidth;++Y){const Q=j-N,tt=K-R,Z=Y-T;let rt=0;for(let ut=0;ut<I;ut+=b){const lt=(Q+ut)/m;if(!(lt<0||lt>=h.outDepth||Math.floor(lt)!==lt))for(let mt=0;mt<C;mt+=w){const ft=(tt+mt)/g;if(!(ft<0||ft>=h.outHeight||Math.floor(ft)!==ft))for(let bt=0;bt<k;bt+=v){const pt=(Z+bt)/x;if(pt<0||pt>=h.outWidth||Math.floor(pt)!==pt)continue;const yt=I*C*k-1-f.get(P,lt,ft,pt,q),Nt=ut*C*k+mt*k+bt,Rt=yt===Nt?1:0;if(Rt===0)continue;const Et=F.get(P,lt,ft,pt,q);rt+=Et*Rt}}}E.set(rt,P,j,K,Y,q)}return e.makeTensorInfo(E.shape,E.dtype,E.values)}const fU={kernelName:Sm,backendName:"cpu",kernelFunc:dU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pU(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:o,output:i}=t,a=o;kt([o,i],"maxPoolGrad");const{filterSize:l,strides:u,pad:h,dimRoundingMode:d}=s,f=Ps(a.shape,l,u,1,h,d),m=e.data.get(a.dataId).values,g=Yt(f.outShape,a.dtype,Yk(m,a.shape,a.dtype,f).values),x=f.strideHeight,b=f.strideWidth,w=f.dilationHeight,v=f.dilationWidth,I=f.effectiveFilterHeight,C=f.effectiveFilterWidth,k=C-1-f.padInfo.left,N=I-1-f.padInfo.top,T=Yt(a.shape,"float32"),R=e.data.get(r.dataId).values,E=Yt(r.shape,"float32",R);for(let F=0;F<f.batchSize;++F)for(let P=0;P<f.inChannels;++P)for(let q=0;q<f.inHeight;++q)for(let j=0;j<f.inWidth;++j){const K=q-N,Y=j-k;let Q=0;for(let tt=0;tt<I;tt+=w){const Z=(K+tt)/x;if(!(Z<0||Z>=f.outHeight||Math.floor(Z)!==Z))for(let rt=0;rt<C;rt+=v){const ut=(Y+rt)/b;if(ut<0||ut>=f.outWidth||Math.floor(ut)!==ut)continue;const lt=I*C-1-g.get(F,Z,ut,P),mt=tt*C+rt,ft=lt===mt?1:0;if(ft===0)continue;const bt=E.get(F,Z,ut,P);Q+=bt*ft}}T.set(Q,F,q,j,P)}return e.makeTensorInfo(T.shape,T.dtype,T.values)}const mU={kernelName:km,backendName:"cpu",kernelFunc:pU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gU(n,t,e,s,r){const o=_t(t),i=pb(n,t,e,o,r,"max"),a=Yk(n,t,e,r,!0,s);return[i.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xU={kernelName:f1,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=t,l=e;kt(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,h=Ps(s.shape,r,o,[1,1],i),[d,f]=gU(u,s.shape,s.dtype,a,h),m=l.write(d,h.outShape,s.dtype),g=l.write(f,h.outShape,s.dtype);return[{dataId:m,shape:h.outShape,dtype:s.dtype},{dataId:g,shape:h.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bU(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o,keepDims:i}=s,a=Xt(o,r.shape),u=dn(r.shape,a)[1],h=st(u),d=[],f=e.makeTensorInfo([],"float32",new Float32Array([h]));d.push(f);const m=Ho({inputs:{x:r},backend:e,attrs:{dtype:"float32"}});d.push(m);const g=mb({inputs:{a:m,b:f},backend:e});d.push(g);const x=uc({inputs:{x:g},backend:e,attrs:{axis:o,keepDims:i}});return d.forEach(b=>e.disposeIntermediateTensorInfo(b)),x}const yU={kernelName:Mh,backendName:"cpu",kernelFunc:bU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wU(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o,keepDims:i}=s;kt(r,"min");const a=Xt(o,r.shape);let l=a;const u=Be(l,r.shape.length);let h=r;u!=null&&(h=Jn({inputs:{x:r},backend:e,attrs:{perm:u}}),l=qe(l.length,r.shape.length)),vn("min",l,h.shape.length);const[d,f]=dn(h.shape,l),m=st(f),g=Sn(st(d),h.dtype),x=e.data.get(h.dataId).values;for(let w=0;w<g.length;++w){const v=w*m;let I=x[v];for(let C=0;C<m;++C){const k=x[v+C];(Number.isNaN(k)||k<I)&&(I=k)}g[w]=I}u!=null&&e.disposeIntermediateTensorInfo(h);const b=e.makeTensorInfo(d,h.dtype,g);if(i){const w=Je(d,a),v=Ne({inputs:{x:b},backend:e,attrs:{shape:w}});return e.disposeIntermediateTensorInfo(b),v}return b}const vU={kernelName:Bh,backendName:"cpu",kernelFunc:wU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CU(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{paddings:o,mode:i}=s;kt(r,"mirrorPad");const a=o.map((I,C)=>I[0]+r.shape[C]+I[1]),l=o.map(I=>I[0]),u=o.map((I,C)=>I[0]+r.shape[C]),h=i==="reflect"?0:1,d=e.data.get(r.dataId).values,f=r.shape.length,m=_t(r.shape),g=st(a),x=a.length,b=_t(a),w=kn(r.dtype,g);for(let I=0;I<g;I++){let C=Ca(I,x,b);for(let N=0;N<x;N++)C[N]<l[N]?C[N]=l[N]*2-C[N]-h:C[N]>=u[N]&&(C[N]=(u[N]-1)*2-C[N]+h);C=C.map((N,T)=>N-l[T]);const k=Cr(C,f,m);w[I]=d[k]}return{dataId:e.write(w,a,r.dtype),shape:a,dtype:r.dtype}}const IU={kernelName:zh,backendName:"cpu",kernelFunc:CU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $U=Ye((n,t)=>{const e=n%t;return n<0&&t<0||n>=0&&t>=0?e:(e+t)%t}),kU=ln(ou,$U),SU={kernelName:ou,backendName:"cpu",kernelFunc:kU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nS(n){const{inputs:t,backend:e,attrs:s}=n,{logits:r}=t,{dim:o}=s,i=r.shape.length;let a=o;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);const l=Xt([a],r.shape),u=eS({inputs:{x:r},backend:e,attrs:{reductionIndices:l,keepDims:!1}}),h=Je(u.shape,l),d=Ne({inputs:{x:u},backend:e,attrs:{shape:h}}),f=fb({inputs:{a:r,b:d},backend:e}),m=nk({inputs:{x:f},backend:e}),g=uc({inputs:{x:m},backend:e,attrs:{axis:l,keepDims:!1}}),x=Ne({inputs:{x:g},backend:e,attrs:{shape:h}}),b=mb({inputs:{a:m,b:x},backend:e});return e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(x),b}const NU={kernelName:rd,backendName:"cpu",kernelFunc:nS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TU(n){const{inputs:t,backend:e,attrs:s}=n,{logits:r}=t,{numSamples:o,seed:i,normalized:a}=s;kt(r,"multinomial");const l=a?r:nS({inputs:{logits:r},backend:e,attrs:{dim:-1}}),u=l.shape[0],h=l.shape[1],d=e.data.get(l.dataId).values,f=[u,o],m=Sn(st(f),"int32");for(let g=0;g<u;++g){const x=g*h,b=new Float32Array(h-1);b[0]=d[x];for(let I=1;I<b.length;++I)b[I]=b[I-1]+d[x+I];const w=Pu.alea(i.toString()),v=g*o;for(let I=0;I<o;++I){const C=w();m[v+I]=b.length;for(let k=0;k<b.length;k++)if(C<b[k]){m[v+I]=k;break}}}return a||e.disposeIntermediateTensorInfo(l),e.makeTensorInfo(f,"int32",m)}const EU={kernelName:p1,backendName:"cpu",kernelFunc:TU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _U=Vg;function RU(n){const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:o}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s;kt(r,"NonMaxSuppression");const u=e.data.get(r.dataId).values,h=e.data.get(o.dataId).values,{selectedIndices:d}=_U(u,h,i,a,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}const AU={kernelName:Nm,backendName:"cpu",kernelFunc:RU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DU=Ug;function FU(n){const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:o}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;kt(r,"NonMaxSuppressionPadded");const h=e.data.get(r.dataId).values,d=e.data.get(o.dataId).values,{selectedIndices:f,validOutputs:m}=DU(h,d,i,a,l,u);return[e.makeTensorInfo([f.length],"int32",new Int32Array(f)),e.makeTensorInfo([],"int32",new Int32Array([m]))]}const OU={kernelName:Tm,backendName:"cpu",kernelFunc:FU};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LU=Gg;function PU(n){const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:o}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;kt(r,"NonMaxSuppressionWithScore");const h=e.data.get(r.dataId).values,d=e.data.get(o.dataId).values,f=i,m=a,g=l,x=u,{selectedIndices:b,selectedScores:w}=LU(h,d,f,m,g,x);return[e.makeTensorInfo([b.length],"int32",new Int32Array(b)),e.makeTensorInfo([w.length],"float32",new Float32Array(w))]}const MU={kernelName:Em,backendName:"cpu",kernelFunc:PU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BU(n){const{inputs:t,backend:e,attrs:s}=n,{indices:r}=t,{dtype:o,depth:i,onValue:a,offValue:l}=s;kt(r,"oneHot");const u=st(r.shape),h=new Float32Array(u*i);h.fill(l);const d=e.data.get(r.dataId).values;for(let f=0;f<u;++f)d[f]>=0&&d[f]<i&&(h[f*i+d[f]]=a);return e.makeTensorInfo([...r.shape,i],o,h)}const zU={kernelName:Gh,backendName:"cpu",kernelFunc:BU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cf(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Ui({inputs:{input:s},backend:e}),o=cf({inputs:{x:r},backend:e}),i=qa({inputs:{input:s},backend:e}),a=cf({inputs:{x:i},backend:e}),l=hs({inputs:{real:o,imag:a},backend:e});return e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(a),l}else return bb({backend:e,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const WU={kernelName:ad,backendName:"cpu",kernelFunc:cf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sS(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Ui({inputs:{input:s},backend:e}),o=sS({inputs:{x:r},backend:e}),i=qa({inputs:{input:s},backend:e}),a=cf({inputs:{x:i},backend:e}),l=hs({inputs:{real:o,imag:a},backend:e});return e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(a),l}else return bb({backend:e,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const VU={kernelName:Uh,backendName:"cpu",kernelFunc:sS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rS(n){const{inputs:t,backend:e,attrs:s}=n,{axis:r}=s;if(t.length===1)return uf({inputs:{input:t[0]},backend:e,attrs:{dim:r}});const o=t[0].shape,i=t[0].dtype;t.forEach(h=>{rh(o,h.shape,"All tensors passed to stack must have matching shapes"),A(i===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=t.map(h=>{const d=uf({inputs:{input:h},backend:e,attrs:{dim:r}});return a.push(d),d}),u=ja({inputs:l,backend:e,attrs:{axis:r}});return a.forEach(h=>e.disposeIntermediateTensorInfo(h)),u}const UU={kernelName:Hh,backendName:"cpu",kernelFunc:rS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GU(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{paddings:o,constantValue:i}=s;kt(r,"pad");const a=o.map((v,I)=>v[0]+r.shape[I]+v[1]),l=o.map(v=>v[0]),u=e.data.get(r.dataId).values,h=st(r.shape),d=r.shape.length,f=_t(r.shape),m=st(a),g=a.length,x=_t(a),b=kn(r.dtype,m);i!==0&&b.fill(i);for(let v=0;v<h;v++){const C=Ca(v,d,f).map((N,T)=>N+l[T]),k=Cr(C,g,x);b[k]=u[v]}return{dataId:e.write(b,a,r.dtype),shape:a,dtype:r.dtype}}const oS={kernelName:Kh,backendName:"cpu",kernelFunc:GU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HU=Ye((n,t)=>Math.pow(n,t)),KU=ln(au,HU),qU={kernelName:au,backendName:"cpu",kernelFunc:KU};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jU(n){const{inputs:t,backend:e,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=t,a=r.map(b=>e.data.get(b.dataId).values),l=r.map(b=>b.shape),u=e.data.get(o.dataId).values,h=e.data.get(i.dataId).values,[d,f,m]=vk(a,l,u,o.shape,o.dtype,h,i.shape),g=d.map(b=>e.makeTensorInfo([b.length],"int32",b)),x=e.makeTensorInfo(m,o.dtype,f);return g.concat([x])}const XU={kernelName:m1,backendName:"cpu",kernelFunc:jU};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YU(n){const{inputs:t,backend:e}=n,{starts:s,limits:r,deltas:o}=t,i=e.data.get(s.dataId).values,a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,[u,h]=Ik(i,s.shape,s.dtype,a,r.shape,l,o.shape),d=e.makeTensorInfo([u.length],"int32",u),f=e.makeTensorInfo([h.length],s.dtype,h);return[d,f]}const ZU={kernelName:g1,backendName:"cpu",kernelFunc:YU};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JU(n){const{inputs:t,backend:e,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=t,{rowPartitionTypes:l}=s,u=e.data.get(r.dataId).values,h=e.data.get(o.dataId).values,d=e.data.get(i.dataId).values,f=a.map(b=>e.data.get(b.dataId).values),m=a.map(b=>b.shape),[g,x]=Sk(u,r.shape,h,o.shape,o.dtype,d,i.shape,f,m,l);return e.makeTensorInfo(g,o.dtype,x)}const QU={kernelName:x1,backendName:"cpu",kernelFunc:JU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tG(n){const{backend:t,attrs:e}=n,{start:s,stop:r,dtype:o,step:i}=e,a=Nk(s,r,i,o);return t.makeTensorInfo([a.length],o,a)}const eG={kernelName:_m,backendName:"cpu",kernelFunc:tG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nG=ge(lu,n=>1/n),sG={kernelName:lu,backendName:"cpu",kernelFunc:nG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rG(n){const{inputs:t,backend:e,attrs:s}=n,{images:r}=t,{alignCorners:o,halfPixelCenters:i,size:a}=s;kt(r,"resizeBilinear");const l=_t(r.shape),[u,h]=a,[d,f,m,g]=r.shape,x=e.data.get(r.dataId).values,b=new Float32Array(st([d,u,h,g])),w=[o&&u>1?f-1:f,o&&h>1?m-1:m],v=[o&&u>1?u-1:u,o&&h>1?h-1:h];let I=0;const C=w[0]/v[0],k=w[1]/v[1];for(let N=0;N<d;N++)for(let T=0;T<u;T++){let R;i?R=C*(T+.5)-.5:R=C*T;const E=Math.max(0,Math.floor(R)),F=R-E,P=Math.min(f-1,Math.ceil(R)),q=N*l[0]+E*l[1],j=N*l[0]+P*l[1];for(let K=0;K<h;K++){let Y;i?Y=k*(K+.5)-.5:Y=k*K;const Q=Math.max(0,Math.floor(Y)),tt=Y-Q,Z=Math.min(m-1,Math.ceil(Y)),rt=q+Q*l[2],ut=j+Q*l[2],lt=q+Z*l[2],mt=j+Z*l[2];for(let ft=0;ft<g;ft++){const bt=x[rt+ft],pt=x[ut+ft],yt=x[lt+ft],Nt=x[mt+ft],Rt=bt+(yt-bt)*tt,Et=pt+(Nt-pt)*tt,Ut=Rt+(Et-Rt)*F;b[I++]=Ut}}}return e.makeTensorInfo([d,u,h,g],"float32",b)}const oG={kernelName:Zh,backendName:"cpu",kernelFunc:rG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iG(n){const{inputs:t,backend:e,attrs:s}=n,{images:r,dy:o}=t,{alignCorners:i}=s;kt([o,r],"resizeBilinearGrad");const a=_t(r.shape),[l,u,h,d]=r.shape,[,f,m]=o.shape,g=new Float32Array(l*u*h*d),x=[i&&f>1?u-1:u,i&&m>1?h-1:h],b=[i&&f>1?f-1:f,i&&m>1?m-1:m],w=x[0]/b[0],v=x[1]/b[1],I=e.data.get(o.dataId).values;let C=0;for(let k=0;k<l;k++){const N=k*a[0];for(let T=0;T<f;T++){const R=T*w,E=Math.floor(R),F=Math.min(Math.ceil(R),u-1),P=N+E*a[1],q=N+F*a[1],j=R-E,K=1-j;for(let Y=0;Y<m;Y++){const Q=Y*v,tt=Math.floor(Q),Z=Math.min(Math.ceil(Q),h-1),rt=Q-tt,ut=1-rt,lt=P+tt*a[2],mt=P+Z*a[2],ft=q+tt*a[2],bt=q+Z*a[2],pt=K*ut,yt=K*rt,Nt=j*ut,Rt=j*rt;for(let Et=0;Et<d;Et++){const Ut=I[C++];g[lt+Et]+=Ut*pt,g[mt+Et]+=Ut*yt,g[ft+Et]+=Ut*Nt,g[bt+Et]+=Ut*Rt}}}}return e.makeTensorInfo([l,h,u,d],"float32",g)}const aG={kernelName:Dm,backendName:"cpu",kernelFunc:iG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lG(n){const{inputs:t,backend:e,attrs:s}=n,{images:r}=t,{alignCorners:o,halfPixelCenters:i,size:a}=s;kt(r,"resizeNearestNeighbor");const l=_t(r.shape),[u,h]=a,[d,f,m,g]=r.shape,x=e.data.get(r.dataId).values,b=new Float32Array(d*u*h*g),w=[o&&u>1?f-1:f,o&&h>1?m-1:m],v=[o&&u>1?u-1:u,o&&h>1?h-1:h],I=w[0]/v[0],C=w[1]/v[1];let k=0;for(let N=0;N<d;N++){const T=N*l[0];for(let R=0;R<u;R++){const E=i?I*(R+.5):I*R;let F=Math.min(f-1,o?Math.round(E):Math.floor(E));i&&(F=Math.max(0,F));const P=T+F*l[1];for(let q=0;q<h;q++){const j=i?C*(q+.5):C*q;let K=Math.min(m-1,o?Math.round(j):Math.floor(j));i&&(K=Math.max(0,K));const Y=P+K*l[2];for(let Q=0;Q<g;Q++){const tt=x[Y+Q];b[k++]=tt}}}}return e.makeTensorInfo([d,u,h,g],r.dtype,b)}const uG={kernelName:Yh,backendName:"cpu",kernelFunc:lG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cG(n){const{inputs:t,backend:e,attrs:s}=n,{images:r,dy:o}=t,{alignCorners:i}=s;kt([o,r],"resizeNearestNeighborGrad");const a=_t(r.shape),l=_t(o.shape),[u,h,d,f]=r.shape,[,m,g]=o.shape,x=new Float32Array(u*h*d*f),b=e.data.get(o.dataId).values,w=[i&&m>1?h-1:h,i&&g>1?d-1:d],v=[i&&m>1?m-1:m,i&&g>1?g-1:g],I=w[0]/v[0],C=w[1]/v[1],k=1/I,N=1/C,T=Math.ceil(k)*2+2,R=Math.ceil(N)*2+2;for(let E=0;E<u;E++){const F=E*a[0];for(let P=0;P<h;P++){const q=F+P*a[1],j=Math.floor(P*k),K=Math.floor(j-T/2);for(let Y=0;Y<d;Y++){const Q=q+Y*a[2],tt=Math.floor(Y*N),Z=Math.floor(tt-R/2);for(let rt=0;rt<f;rt++){let ut=0;for(let lt=0;lt<T;lt++){const mt=lt+K;if(mt<0||mt>=m)continue;const ft=F+mt*l[1],bt=mt*I,pt=Math.min(h-1,i?Math.round(bt):Math.floor(bt));if(P===pt)for(let yt=0;yt<R;yt++){const Nt=yt+Z;if(Nt<0||Nt>=g)continue;const Rt=ft+Nt*l[2],Et=Nt*C,Ut=Math.min(d-1,i?Math.round(Et):Math.floor(Et));Y===Ut&&(ut+=b[Rt+rt])}}x[Q+rt]=ut}}}}return e.makeTensorInfo(r.shape,r.dtype,x)}const hG={kernelName:Am,backendName:"cpu",kernelFunc:cG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dG(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{dims:o}=s;kt(r,"reverse");const i=r.shape.length,a=Xt(o,r.shape);if(i===0)return Pr({inputs:{x:r},backend:e});const l=new yn(r.shape,r.dtype),u=e.bufferSync(r);for(let h=0;h<l.size;h++){const d=l.indexToLoc(h),f=d.slice();a.forEach(m=>f[m]=r.shape[m]-1-f[m]),l.set(u.get(...f),...d)}return e.makeTensorInfo(l.shape,l.dtype,l.values)}const fG={kernelName:Jh,backendName:"cpu",kernelFunc:dG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pG={kernelName:zm,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=t,a=e,l=kn(s.dtype,st(s.shape)),[u,h,d,f]=s.shape,[m,g]=nx(i,h,d),x=255,b=Math.sin(r),w=Math.cos(r),v=a.data.get(s.dataId).values;for(let C=0;C<u;C++){const k=C*d*h*f;for(let N=0;N<h;N++){const T=N*(d*f);for(let R=0;R<d;R++){const E=R*f;for(let F=0;F<f;F++){const P=[u,N,R,F],q=P[2],j=P[1];let K=(q-m)*w-(j-g)*b,Y=(q-m)*b+(j-g)*w;K=Math.round(K+m),Y=Math.round(Y+g);let Q=o;if(typeof o!="number"&&(F===3?Q=x:Q=o[F]),K>=0&&K<d&&Y>=0&&Y<h){const Z=Y*(d*f),rt=K*f,ut=k+Z+rt+F;Q=v[ut]}const tt=k+T+E+F;l[tt]=Q}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mG=ge(hu,n=>{const t=Math.floor(n);return n-t<.5?Math.floor(n):n-t>.5?Math.ceil(n):t%2===0?t:t+1}),gG={kernelName:hu,backendName:"cpu",kernelFunc:mG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xG(n){const{inputs:t,backend:e,attrs:s}=n,{indices:r,updates:o}=t,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:h,outputSize:d}=Di(o,r,i),f=!0,m=e.bufferSync(r),g=e.bufferSync(o),x=Gi(m,g,i,d,u,l,a,h,0,f);return e.makeTensorInfo(i,x.dtype,x.values)}const bG={kernelName:b1,backendName:"cpu",kernelFunc:xG};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yG(n,t){let e=0,s=n.length,r=0;for(;e<s;)r=Math.floor((e+s)/2),n[r]<t?e=r+1:s=r;return s}function wG(n,t){let e=0,s=n.length,r=0;for(;e<s;)r=Math.floor((e+s)/2),n[r]<=t?e=r+1:s=r;return s}function vG(n,t,e,s,r,o){const i=He("int32",e*r);for(let a=0;a<e;++a){const l=n.slice(a*s,(a+1)*s),u=a*r;for(let h=0;h<r;++h)i[u+h]=o==="left"?yG(l,t[h+u]):wG(l,t[h+u])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CG(n){const{inputs:t,backend:e,attrs:s}=n,{sortedSequence:r,values:o}=t,{side:i}=s,a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,u=vG(a,l,r.shape[0],r.shape[1],o.shape[1],i);return e.makeTensorInfo(o.shape,"int32",u)}const IG={kernelName:w1,backendName:"cpu",kernelFunc:CG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $G(n){const{inputs:t,backend:e}=n,{condition:s,t:r,e:o}=t;kt([s,r,o],"select");const i=s.shape.length,a=e.data.get(s.dataId).values,l=e.data.get(r.dataId).values,u=e.data.get(o.dataId).values,h=us(r.dtype,o.dtype),d=Sn(st(r.shape),h);let f=0;const m=i===0||i>1||r.shape.length===1?1:st(r.shape.slice(1));for(let g=0;g<a.length;g++)for(let x=0;x<m;x++)a[g]===1?d[f++]=l[g]:d[f++]=u[g];return e.makeTensorInfo(r.shape,h,d)}const kG={kernelName:Qh,backendName:"cpu",kernelFunc:$G};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SG=_d,NG=Rd,TG=ge(fu,n=>n>=0?NG*n:SG*(Math.exp(n)-1)),EG={kernelName:fu,backendName:"cpu",kernelFunc:TG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _G=ge(gu,n=>n<0?-1:n>0?1:0),RG={kernelName:gu,backendName:"cpu",kernelFunc:_G};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AG=ge(pu,n=>Math.sin(n)),DG={kernelName:pu,backendName:"cpu",kernelFunc:AG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FG=ge(mu,n=>Math.sinh(n)),OG={kernelName:mu,backendName:"cpu",kernelFunc:FG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iS=Math.log(11920928955078125e-23)+2,LG=ge(bu,n=>{const t=n>-iS,e=n<iS,s=Math.exp(n);let r;return e?r=s:t?r=n:r=Math.log(1+s),r}),PG={kernelName:bu,backendName:"cpu",kernelFunc:LG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MG(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockShape:o,paddings:i}=s;kt([r],"spaceToBatchND");const a=st(o),l=[[0,0]];l.push(...i);for(let N=1+o.length;N<r.shape.length;++N)l.push([0,0]);const u=oS.kernelFunc({inputs:{x:r},backend:e,attrs:{paddings:l,constantValue:0}}),h=Uu(u.shape,o,a,!1),d=Gu(h.length,o.length,!1),f=Hu(u.shape,o,a,!1),x=Ne({inputs:{x:u},backend:e,attrs:{shape:h}}),v=Jn({inputs:{x},backend:e,attrs:{perm:d}}),k=Ne({inputs:{x:v},backend:e,attrs:{shape:f}});return e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(v),k}const BG={kernelName:nd,backendName:"cpu",kernelFunc:MG};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zG(n){const{inputs:t,backend:e}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=t;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=e.data.get(s.dataId).values,l=e.data.get(r.dataId).values,u=e.data.get(o.dataId).values,h=e.data.get(i.dataId).values[0],[d,f,m,g,x]=Rk(a,s.shape,s.dtype,l,r.dtype,u,h);return[e.makeTensorInfo(f,s.dtype,d),e.makeTensorInfo([f[0]],r.dtype,m),e.makeTensorInfo([g.length],"bool",new Uint8Array(g.map(b=>Number(b)))),e.makeTensorInfo([x.length],s.dtype,new Int32Array(x))]}const WG={kernelName:v1,backendName:"cpu",kernelFunc:zG};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VG(n){const{inputs:t,backend:e}=n,{inputIndices:s,inputShape:r,newShape:o}=t;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(e.data.get(r.dataId).values),a=e.data.get(s.dataId).values,l=Array.from(e.data.get(o.dataId).values),[u,h,d]=Ak(a,s.shape,s.dtype,i,l);return[e.makeTensorInfo(h,s.dtype,u),e.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const UG={kernelName:C1,backendName:"cpu",kernelFunc:VG};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GG(n){const{inputs:t,backend:e}=n,{data:s,indices:r,segmentIds:o}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=e.data.get(s.dataId).values,a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,[u,h]=db(i,s.shape,s.dtype,a,l,!0);return e.makeTensorInfo(h,s.dtype,u)}const HG={kernelName:I1,backendName:"cpu",kernelFunc:GG};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KG(n){const{inputs:t,backend:e}=n,{data:s,indices:r,segmentIds:o}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=e.data.get(s.dataId).values,a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,[u,h]=db(i,s.shape,s.dtype,a,l);return e.makeTensorInfo(h,s.dtype,u)}const qG={kernelName:$1,backendName:"cpu",kernelFunc:KG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jG(n){const{inputs:t,backend:e,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=t,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:h,strides:d,outputSize:f}=Di(o,r,a),m=!1,g=e.bufferSync(r);let x;switch(o.dtype){case"bool":{const b=e.bufferSync(o),w=!!e.data.get(i.dataId).values[0];x=Gi(g,b,a,f,h,u,l,d,w,m);break}case"float32":{const b=e.bufferSync(o),w=e.data.get(i.dataId).values[0];x=Gi(g,b,a,f,h,u,l,d,w,m);break}case"int32":{const b=e.bufferSync(o),w=e.data.get(i.dataId).values[0];x=Gi(g,b,a,f,h,u,l,d,w,m);break}case"string":{const b=e.bufferSync(o),w=To(e.data.get(i.dataId).values[0]);x=Gi(g,b,a,f,h,u,l,d,w,m);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return e.makeTensorInfo(a,x.dtype,x.values)}const XG={kernelName:k1,backendName:"cpu",kernelFunc:jG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YG(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{numOrSizeSplits:o,axis:i}=s,a=Xt(i,r.shape)[0],l=bx(r,o,a),u=new Array(r.shape.length).fill(0),h=r.shape.slice();return l.map(d=>{const f=[...h];f[a]=d;const m=Hi({inputs:{x:r},backend:e,attrs:{begin:u,size:f}});return u[a]+=d,m})}const ZG={kernelName:sd,backendName:"cpu",kernelFunc:YG};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JG={kernelName:Fm,backendName:"cpu",kernelFunc:({inputs:n,backend:t})=>{const{x:e}=n,s=t;kt(e,"square");const r=s.data.get(e.dataId).values,o=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];o[a]=l*l}return{dataId:s.write(o,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QG=ge(ku,(n,t)=>{const e=t;return isNaN(n)?NaN:n>0?1:e.alpha}),tH={kernelName:ku,backendName:"cpu",kernelFunc:QG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eH(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{begin:o,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:h,newAxisMask:d,shrinkAxisMask:f}=s;kt(r,"stridedSlice");const{finalShapeSparse:m,finalShape:g,isIdentity:x,sliceDim0:b,isSimpleSlice:w,begin:v,end:I,strides:C}=Qg(r.shape,o,i,a,l,u,h,d,f);let k;if(x)k=Ne({inputs:{x:r},backend:e,attrs:{shape:g}});else if(b||w){A(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const N=Yg(v,I,C),T=Hi({inputs:{x:r},backend:e,attrs:{begin:v,size:N}});k=Ne({inputs:{x:T},backend:e,attrs:{shape:g}}),e.disposeIntermediateTensorInfo(T)}else{const N=e.bufferSync(r),T=Ok(m,N,C,v);k=e.makeTensorInfo(g,T.dtype,T.values)}return k}const nH={kernelName:Lm,backendName:"cpu",kernelFunc:eH};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sH(n){const{inputs:t,backend:e,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:h,dataSplits:d}=t,f=e.data.get(h.dataId).values,m=e.data.get(d.dataId).values,[g,x]=Lk(f,m,r,o,i,a,l,u);return[e.makeTensorInfo([g.length],"string",g),e.makeTensorInfo(d.shape,"int32",x)]}const rH={kernelName:S1,backendName:"cpu",kernelFunc:sH};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oH(n){const{inputs:t,backend:e,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=t;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values[0],[u,h,d]=Pk(a,l,r),f=h.length;return[e.makeTensorInfo([f,2],"int32",u),e.makeTensorInfo([f],"string",h),e.makeTensorInfo([2],"int32",new Int32Array(d))]}const iH={kernelName:N1,backendName:"cpu",kernelFunc:oH};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aH(n){const{inputs:t,backend:e,attrs:s}=n,{numBuckets:r}=s,{input:o}=t;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=e.data.get(o.dataId).values,a=Mk(i,r);return e.makeTensorInfo(o.shape,"int32",a)}const lH={kernelName:T1,backendName:"cpu",kernelFunc:aH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uH=ge(Cu,n=>Math.tan(n)),cH={kernelName:Cu,backendName:"cpu",kernelFunc:uH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hH=ge(Iu,n=>Math.tanh(n)),dH={kernelName:Iu,backendName:"cpu",kernelFunc:hH};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fH(n){const{inputs:t,backend:e}=n,{tensor:s,indices:r,updates:o}=t,{sliceRank:i,numUpdates:a,sliceSize:l,strides:u,outputSize:h}=Di(o,r,s.shape),d=!1,f=e.bufferSync(r),m=e.bufferSync(o),g=e.bufferSync(s),x=Gi(f,m,s.shape,h,l,a,i,u,g,d);return e.makeTensorInfo(s.shape,x.dtype,x.values)}const pH={kernelName:y1,backendName:"cpu",kernelFunc:fH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mH(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{reps:o}=s;kt(r,"tile");const i=zk(e.bufferSync(r),o);return e.makeTensorInfo(i.shape,i.dtype,i.values)}const gH={kernelName:$u,backendName:"cpu",kernelFunc:mH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xH(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{k:o,sorted:i}=s;kt(r,"topk");const a=e.data.get(r.dataId).values,[l,u]=Vk(a,r.shape,r.dtype,o,i);return[e.makeTensorInfo(l.shape,l.dtype,l.values),e.makeTensorInfo(u.shape,u.dtype,u.values)]}const bH={kernelName:Pm,backendName:"cpu",kernelFunc:xH};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yH(n){const{inputs:t,attrs:e,backend:s}=n,{image:r,transforms:o}=t,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=e,[h,d,f,m]=r.shape,[g,x]=u??[d,f],b=[h,g,x,m],w=_t(r.shape),v=w[0],I=w[1],C=w[2],k=_t(b),N=k[0],T=k[1],R=k[2],E=kn(r.dtype,st(b));E.fill(l);const F=s.data.get(r.dataId).values,P=s.data.get(o.dataId).values;for(let j=0;j<h;++j){const K=o.shape[0]===1?P:P.subarray(j*8,j*8+8);for(let Y=0;Y<g;++Y)for(let Q=0;Q<x;++Q)for(let tt=0;tt<m;++tt){let Z;const rt=K[6]*Q+K[7]*Y+1;if(rt===0)continue;const ut=(K[0]*Q+K[1]*Y+K[2])/rt,lt=(K[3]*Q+K[4]*Y+K[5])/rt,mt=aS(ut,f,a),ft=aS(lt,d,a);switch(i){case"nearest":Z=kH(F,d,f,v,I,C,j,ft,mt,tt,l);break;case"bilinear":Z=SH(F,d,f,v,I,C,j,ft,mt,tt,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const bt=j*N+Y*T+Q*R+tt;E[bt]=Z}return s.makeTensorInfo(b,r.dtype,E)}return{dataId:s.write(E,b,r.dtype),shape:r.shape,dtype:r.dtype}}const wH={kernelName:Mm,backendName:"cpu",kernelFunc:yH};function aS(n,t,e){switch(e){case"reflect":return vH(n,t);case"wrap":return CH(n,t);case"nearest":return $H(n,t);case"constant":default:return IH(n)}}function vH(n,t){let e=n;if(e<0)if(t<=1)e=0;else{const s=2*t;e<s&&(e=s*Math.trunc(-e/s)+e),e=e<-t?e+s:-e-1}else if(e>t-1)if(t<=1)e=0;else{const s=2*t;e-=s*Math.trunc(e/s),e>=t&&(e=s-e-1)}return mi(0,e,t-1)}function CH(n,t){let e=n;if(e<0)if(t<=1)e=0;else{const s=t-1;e+=t*(Math.trunc(-e/s)+1)}else if(e>t-1)if(t<=1)e=0;else{const s=t-1;e-=t*Math.trunc(e/s)}return mi(0,e,t-1)}function IH(n,t){return n}function $H(n,t){return mi(0,n,t-1)}function cc(n,t,e,s,r,o,i,a,l,u,h){const d=i*s+a*r+l*o+u;return 0<=a&&a<t&&0<=l&&l<e?n[d]:h}function kH(n,t,e,s,r,o,i,a,l,u,h){const d=Math.round(a),f=Math.round(l);return cc(n,t,e,s,r,o,i,d,f,u,h)}function SH(n,t,e,s,r,o,i,a,l,u,h){const d=Math.floor(a),f=Math.floor(l),m=d+1,g=f+1,x=(g-l)*cc(n,t,e,s,r,o,i,d,f,u,h)+(l-f)*cc(n,t,e,s,r,o,i,d,g,u,h),b=(g-l)*cc(n,t,e,s,r,o,i,m,f,u,h)+(l-f)*cc(n,t,e,s,r,o,i,m,g,u,h);return(m-a)*x+(a-d)*b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NH(n){const{inputs:t,attrs:e,backend:s}=n,{axis:r}=e,{x:o}=t;kt(o,"unique");const i=s.data.get(o.dataId).values,{outputValues:a,outputShape:l,indices:u}=Uk(i,r,o.shape,o.dtype);return[s.makeTensorInfo(l,o.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const TH={kernelName:Bm,backendName:"cpu",kernelFunc:NH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EH(n){const{inputs:t,backend:e,attrs:s}=n,{value:r}=t;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r.shape.length,a=r.shape[o],l=new Array(i-1);let u=0;for(let m=0;m<i;m++)m!==o&&(l[u++]=r.shape[m]);const h=new Array(i).fill(0),d=r.shape.slice();d[o]=1;const f=new Array(a);for(let m=0;m<f.length;m++){h[o]=m;const g=Hi({inputs:{x:r},backend:e,attrs:{begin:h,size:d}});f[m]=Ne({inputs:{x:g},backend:e,attrs:{shape:l}}),e.disposeIntermediateTensorInfo(g)}return f}const _H={kernelName:od,backendName:"cpu",kernelFunc:EH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RH(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,segmentIds:o}=t,{numSegments:i}=s;kt(r,"unsortedSegmentSum");const a=r.shape.length,l=o.shape.length,u=[],h=[],d=a-l;let f=o;for(let g=0;g<d;++g){const x=uf({inputs:{input:f},backend:e,attrs:{dim:g+1}});f=x,h.push(x)}for(let g=0;g<i;++g){const x=So(g,"int32"),b=e.makeTensorInfo([],"int32",x),w=tk({inputs:{a:b,b:f},backend:e}),v=Ho({inputs:{x:w},backend:e,attrs:{dtype:"float32"}}),I=of({inputs:{a:v,b:r},backend:e}),C=uc({inputs:{x:I},backend:e,attrs:{axis:0,keepDims:!1}});u.push(C),h.push(b),h.push(w),h.push(v),h.push(I),h.push(C)}const m=rS({inputs:u,backend:e,attrs:{axis:0}});return h.forEach(g=>e.disposeIntermediateTensorInfo(g)),m}const AH={kernelName:id,backendName:"cpu",kernelFunc:RH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DH=[EW,uz,RW,DW,mz,OW,PW,BW,WW,UW,HW,qW,XW,JW,tV,sV,oV,aV,uV,NW,hV,fV,mV,xz,xV,fz,yz,yV,cz,wV,CV,IV,kV,NV,EV,RV,DV,OV,PV,BV,WV,UV,HV,qV,jV,YV,JV,t4,e4,n4,s4,o4,l4,wW,c4,wz,b4,vz,y4,Iz,k4,S4,T4,kz,Nz,_4,A4,F4,L4,Ez,Rz,hz,M4,vV,z4,V4,G4,vW,Dz,Oz,K4,Pz,j4,Z4,Q4,nU,rU,iU,aU,Bz,uU,hU,fU,mU,xU,yU,vU,Wz,IU,SU,EU,Uz,Hz,AU,OU,MU,qz,zU,VU,UU,oS,qU,IW,Yz,XU,ZU,QU,eG,dz,gb,sG,$W,kW,SW,oG,aG,uG,hG,fG,pG,gG,rW,bG,IG,kG,EG,iW,RG,DG,OG,aW,NU,PG,BG,WG,UG,HG,qG,XG,ZG,cW,JG,dW,pW,tH,nH,rH,iH,lH,bW,i4,cH,dH,pH,gH,bH,wH,jz,TH,_H,AH,WU];for(const n of DH)D1(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ki={},hf={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function FH(n,t){Ki[n]=t}function mr(n,t){if(!(n in Ki)||t!=null){const s=LH(n,t);if(s!==null)Ki[n]=s;else return console.log("Could not get context for WebGL version",n),null}const e=Ki[n];return e==null||e.isContextLost()?(delete Ki[n],mr(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Ki[n])}function OH(n){if(!J().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function LH(n,t){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const e=t??OH(n);return e.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Ki[n]},!1),J().getBool("SOFTWARE_WEBGL_ENABLED")&&(hf.failIfMajorPerformanceCaveat=!1),n===1?e.getContext("webgl",hf)||e.getContext("experimental-webgl",hf):e.getContext("webgl2",hf)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hc;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(hc||(hc={}));var $s;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})($s||($s={}));var Cn;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Cn||(Cn={}));function dc(n,t){return[t,n]}function PH(n,t){return n*t}function df(n){const t=st(n),e=Math.ceil(t/4);return Kp(e)}function Xa(n,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(n/2))]}function MH(n,t){const[e,s]=Xa(n,t);return e*s*4}function yb(n,t){const e=n;let s,r,o,i,a,l,u,h,d,f;return J().getNumber("WEBGL_VERSION")===2?(s=e.R32F,r=e.R16F,o=e.RGBA16F,i=e.RGBA32F,a=e.RED,u=4,h=1,d=e.HALF_FLOAT,f=e.FLOAT,l=e.RGBA8):(s=n.RGBA,r=n.RGBA,o=n.RGBA,i=e.RGBA,a=n.RGBA,u=4,h=4,d=t!=null?t.HALF_FLOAT_OES:null,f=n.FLOAT,l=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:h,textureTypeHalfFloat:d,textureTypeFloat:f}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ct(n,t){const e=t();return J().getBool("DEBUG")&&BH(n),e}function BH(n){const t=n.getError();if(t!==n.NO_ERROR)throw new Error("WebGL Error: "+UH(n,t))}const zH=596e-10,WH=65504;function VH(n){return!!(J().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||zH<Math.abs(n)&&Math.abs(n)<WH)}function UH(n,t){switch(t){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function ff(n,t){return so(n,()=>n.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function GH(n,t){const e=so(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Ct(n,()=>n.shaderSource(e,t)),Ct(n,()=>n.compileShader(e)),n.getShaderParameter(e,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function HH(n,t){const e=so(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Ct(n,()=>n.shaderSource(e,t)),Ct(n,()=>n.compileShader(e)),J().get("ENGINE_COMPILE_ONLY"))return e;if(n.getShaderParameter(e,n.COMPILE_STATUS)===!1)throw lS(t,n.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}const KH=/ERROR: [0-9]+:([0-9]+):/g;function lS(n,t){const e=KH.exec(t);if(e==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(n);return}const s=+e[1],r=n.split(`
`),o=r.length.toString().length+2,i=r.map((d,f)=>wa((f+1).toString(),o)+d);let a=0;for(let d=0;d<i.length;d++)a=Math.max(i[d].length,a);const l=i.slice(0,s-1),u=i.slice(s-1,s),h=i.slice(s);console.log(l.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${wa(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join(`
`))}function qH(n){return so(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function jH(n,t){if(Ct(n,()=>n.linkProgram(t)),!J().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function wb(n,t){if(Ct(n,()=>n.validateProgram(t)),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function XH(n,t){const e=so(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Ct(n,()=>n.bindBuffer(n.ARRAY_BUFFER,e)),Ct(n,()=>n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)),e}function YH(n,t){const e=so(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Ct(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e)),Ct(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)),e}function ZH(n){return so(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function JH(n,t){const e=J().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||t<=0){const s=`[${n}x${t}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>e||t>e){const s=`[${n}x${t}]`,r=`[${e}x${e}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function QH(n){return so(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function uS(n,t,e,s,r,o,i){const a=n.getAttribLocation(t,e);return a===-1?!1:(Ct(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),Ct(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,o,i)),Ct(n,()=>n.enableVertexAttribArray(a)),!0)}function tK(n,t,e){oK(n,e),Ct(n,()=>n.activeTexture(n.TEXTURE0+e)),Ct(n,()=>n.bindTexture(n.TEXTURE_2D,t))}function eK(n,t,e){return so(n,()=>n.getUniformLocation(t,e),'uniform "'+e+'" not present in program.')}function nK(n,t,e){return n.getUniformLocation(t,e)}function sK(n,t,e,s){Ct(n,()=>tK(n,t,s)),Ct(n,()=>n.uniform1i(e,s))}function vb(n,t,e){Ct(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Ct(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0))}function cS(n,t){Ct(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Ct(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function pf(n){const t=n.checkFramebufferStatus(n.FRAMEBUFFER);if(t!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+rK(n,t))}function rK(n,t){switch(t){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function so(n,t,e){const s=Ct(n,()=>t());if(s==null)throw new Error(e);return s}function oK(n,t){const e=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=t+n.TEXTURE0;if(s<n.TEXTURE0||s>e){const r=`[gl.TEXTURE0, gl.TEXTURE${e}]`;throw new Error(`textureUnit must be in ${r}.`)}}function Ya(n,t=2){return st(n.slice(0,n.length-t))}function Za(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function mf(n){let t=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(t=[Ya(n),...Za(n)]),t}function iK(n,t=!1){let e=J().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=J().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&J().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=e/2),t&&(e=e*2,s=s*2,n=n.map((a,l)=>l>=n.length-2?Hp(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=$o(n).newShape);let r=st(n),o=null;n.length<=1&&r<=e?o=[1,r]:n.length===2&&n[0]<=e&&n[1]<=e?o=n:n.length===3&&n[0]*n[1]<=e&&n[2]<=e?o=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=e&&n[1]*n[2]<=e?o=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=e&&n[3]<=e?o=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=e&&n[1]*n[2]*n[3]<=e&&(o=[n[0],n[1]*n[2]*n[3]]);const i=o!=null&&Math.max(...o)>s&&Math.min(...o)<=(t?2:1)&&Math.min(...o)>0;if(o==null||i)if(t){const a=Ya(n);let l=2,u=2;n.length&&([l,u]=Za(n)),r=a*(l/2)*(u/2),o=Kp(r).map(h=>h*2)}else o=Kp(r);return o}function gf(n){return n%2===0}function xf(n,t){if(n=n.slice(-2),t=t.slice(-2),he(n,t)||!n.length||!t.length||n[0]===0||n[1]===0||t[0]===0||t[1]===0)return!0;if(n.length!==t.length){const e=n[n.length-1],s=t[t.length-1];if(e===s||gf(e)&&gf(s)&&(n[0]===1||t[0]===1))return!0}return n[1]===t[1]&&gf(n[0])&&gf(t[0])}let Cb,Ib;function aK(n){if(Cb==null){const t=mr(n);Cb=t.getParameter(t.MAX_TEXTURE_SIZE)}return Cb}function lK(n){if(Ib==null){const t=mr(n);Ib=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ib)}function uK(n){if(n===0)return 0;let t;const e=mr(n);return Ks(e,"EXT_disjoint_timer_query_webgl2")&&n===2?t=2:Ks(e,"EXT_disjoint_timer_query")?t=1:t=0,t}function Ks(n,t){return n.getExtension(t)!=null}function hS(n){try{if(mr(n)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function cK(n){if(n===0)return!1;const t=mr(n);if(n===1){if(!Ks(t,"OES_texture_float"))return!1}else if(!Ks(t,"EXT_color_buffer_float"))return!1;return $b(t)}function hK(n){if(n===0)return!1;const t=mr(n);if(n===1){if(!Ks(t,"OES_texture_float")||!Ks(t,"WEBGL_color_buffer_float"))return!1}else{if(Ks(t,"EXT_color_buffer_float"))return $b(t);const s="EXT_color_buffer_half_float";if(Ks(t,s)){const r=t.getExtension(s);return dK(t,r)}return!1}return $b(t)}function $b(n){const t=yb(n),e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);const s=1,r=1;n.texImage2D(n.TEXTURE_2D,0,t.internalFormatFloat,s,r,0,t.textureFormatFloat,t.textureTypeFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);const i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(e),n.deleteFramebuffer(o),i}function dK(n,t){const e=yb(n,t),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s);const r=1,o=1;n.texImage2D(n.TEXTURE_2D,0,e.internalFormatHalfFloat,r,o,0,e.textureFormatFloat,e.textureTypeHalfFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(i),a}function fK(n){return n!==2?!1:mr(n).fenceSync!=null}function fc(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>{e!=null&&A(e.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const St=J();St.registerFlag("HAS_WEBGL",()=>St.getNumber("WEBGL_VERSION")>0),St.registerFlag("WEBGL_VERSION",()=>hS(2)?2:hS(1)?1:0),St.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),St.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>St.get("WEBGL_VERSION")===2),St.registerFlag("WEBGL_CPU_FORWARD",()=>!0),St.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),St.registerFlag("WEBGL_PACK",()=>St.getBool("HAS_WEBGL")),St.registerFlag("WEBGL_PACK_NORMALIZATION",()=>St.getBool("WEBGL_PACK")),St.registerFlag("WEBGL_PACK_CLIP",()=>St.getBool("WEBGL_PACK")),St.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>St.getBool("WEBGL_PACK")),St.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>St.getBool("WEBGL_PACK")),St.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>St.getBool("WEBGL_PACK")),St.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>St.getBool("WEBGL_PACK")),St.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>St.getBool("WEBGL_PACK")),St.registerFlag("WEBGL_PACK_REDUCE",()=>St.getBool("WEBGL_PACK")),St.registerFlag("WEBGL_LAZILY_UNPACK",()=>St.getBool("WEBGL_PACK")),St.registerFlag("WEBGL_CONV_IM2COL",()=>St.getBool("WEBGL_PACK")),St.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>St.getBool("WEBGL_PACK")),St.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>aK(St.getNumber("WEBGL_VERSION"))),St.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>lK(St.getNumber("WEBGL_VERSION"))),St.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=St.getNumber("WEBGL_VERSION");return n===0?0:uK(n)}),St.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>St.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!ow()),St.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>cK(St.getNumber("WEBGL_VERSION"))),St.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>St.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:St.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),St.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>hK(St.getNumber("WEBGL_VERSION"))),St.registerFlag("WEBGL_FENCE_API_ENABLED",()=>fK(St.getNumber("WEBGL_VERSION"))),St.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>St.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),St.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)}),St.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>ow()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)}),St.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128),St.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1),St.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5),St.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128),St.registerFlag("WEBGL_EXP_CONV",()=>!1),St.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>St.getBool("IS_TEST")),St.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0),St.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1),St.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1),St.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pn(){let n,t,e,s,r,o,i,a,l,u;return J().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",t="in",e="out",s="in",r="texture",o="outputColor",i="out vec4 outputColor;",a=J().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",t="attribute",e="varying",s="varying",r="texture2D",o="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:t,varyingVs:e,varyingFs:s,texture2D:r,output:o,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qi(n,t,e="index"){const s=_t(t);return s.map((r,o)=>{const i=`int ${n[o]} = ${e} / ${r}`,a=o===s.length-1?`int ${n[o+1]} = ${e} - ${n[o]} * ${r}`:`index -= ${n[o]} * ${r}`;return`${i}; ${a};`}).join("")}function bf(n,t,e="index"){const s=_t(t);return s.map((r,o)=>{const i=`int ${n[o]} = ${e} / outShapeStrides[${o}]`,a=o===s.length-1?`int ${n[o+1]} = ${e} - ${n[o]} * outShapeStrides[${o}]`:`index -= ${n[o]} * outShapeStrides[${o}]`;return`${i}; ${a};`}).join("")}function pK(n,t){const e=n.length,s=n.map(o=>`${t}[${o}]`),r=new Array(e-1);r[e-2]=s[e-1];for(let o=e-3;o>=0;--o)r[o]=`(${r[o+1]} * ${s[o+1]})`;return r}function mK(n,t,e="index"){const s=n.map((o,i)=>i),r=pK(s,t);return r.map((o,i)=>{const a=`int ${n[i]} = ${e} / ${r[i]}`,l=i===r.length-1?`int ${n[i+1]} = ${e} - ${n[i]} * ${r[i]}`:`index -= ${n[i]} * ${r[i]}`;return`${a}; ${l};`}).join("")}function kb(n){const t=_t(n).map(e=>e.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function Sb(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const dS=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:fS}=BL;function gK(n,t,e){const s=[];if(n.forEach(m=>{const g=st(m.shapeInfo.logicalShape);if(m.shapeInfo.isUniform?s.push(`uniform float ${m.name}${g>1?`[${g}]`:""};`):(s.push(`uniform sampler2D ${m.name};`),s.push(`uniform int offset${m.name};`)),e.enableShapeUniforms){const{uniformShape:x}=Nb(e.packedInputs,m.shapeInfo.logicalShape,m.shapeInfo.texShape);switch(x.length){case 1:s.push(`uniform int ${m.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${m.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${m.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${m.name}Shape;`);break}s.push(`uniform ivec2 ${m.name}TexShape;`)}}),e.enableShapeUniforms){switch(t.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}e.customUniforms&&e.customUniforms.forEach(m=>{s.push(`uniform ${m.type} ${m.name}${m.arrayIndex?`[${m.arrayIndex}]`:""};`)});const r=s.join(`
`),o=n.map(m=>xK(m,t,e.packedInputs,e.enableShapeUniforms)).join(`
`),i=t.texShape,a=Pn(),l=wK(a);let u,h,d=IK(a);return t.isPacked?(u=bK(t.logicalShape,i,e.enableShapeUniforms),h=CK(a)):(u=yK(t.logicalShape,i,e.enableShapeUniforms),h=vK(a)),e.packedInputs&&(d+=NK),[d,l,h,r,u,o,e.userCode].join(`
`)}function Ja(n,t=!1){const e=n.shapeInfo.logicalShape;switch(e.length){case 0:return BK(n,t);case 1:return WK(n,t);case 2:return UK(n,t);case 3:return HK(n,t);case 4:return qK(n,t);case 5:return jK(n);case 6:return XK(n);default:throw new Error(`${e.length}-D input sampling is not yet supported`)}}function pS(n,t){switch(n.shapeInfo.logicalShape.length){case 0:return MK(n);case 1:return zK(n,t);case 2:return VK(n,t);case 3:return GK(n,t);default:return KK(n,t)}}function xK(n,t,e=!1,s){let r="";e?r+=pS(n,s):r+=Ja(n,s);const o=n.shapeInfo.logicalShape,i=t.logicalShape;return o.length<=i.length&&(e?r+=YK(n,t):r+=ZK(n,t)),r}function bK(n,t,e){switch(n.length){case 0:return mS();case 1:return TK(n,t,e);case 2:return LK(n,t,e);case 3:return _K(n,t,e);default:return AK(n,t,e)}}function yK(n,t,e){switch(n.length){case 0:return mS();case 1:return EK(n,t,e);case 2:return PK(n,t,e);case 3:return RK(n,t,e);case 4:return DK(n,t,e);case 5:return FK(n,t);case 6:return OK(n,t);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function wK(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function vK(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function CK(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function IK(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${$K}
    ${kK}
    ${SK}
  `}const $K=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,kK=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,SK=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,NK=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function mS(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function TK(n,t,e){const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return s[0]===1?e?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?e?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:e?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function EK(n,t,e){return t[0]===1?e?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?e?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:e?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function _K(n,t,e){if(e)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(n[2]/2),o=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function RK(n,t,e){if(e)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${bf(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=qi(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function AK(n,t,e){if(e)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(n[n.length-1]/2),o=r*Math.ceil(n[n.length-2]/2);let i=o,a="",l="b, r, c";for(let u=2;u<n.length-1;u++)i*=n[n.length-u-1],a=`
      int b${u} = index / ${i};
      index -= b${u} * ${i};
    `+a,l=`b${u}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${l});
    }
  `}function DK(n,t,e){if(e)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${bf(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=qi(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function FK(n,t){const e=qi(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${e}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function OK(n,t){const e=qi(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${e}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function LK(n,t,e){const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(he(n,t))return e?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return e?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function PK(n,t,e){return he(n,t)?e?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:n[1]===1?e?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?e?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:e?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function ji(n){return`offset${n}`}function MK(n){const t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),s=Pn();return`
    vec4 ${e}() {
      return ${s.texture2D}(${t}, halfCR);
    }
  `}function BK(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${e};}`;const[r,o]=n.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${s}() {
        return sampleTexture(${e}, halfCR);
      }
    `;const i=ji(e);if(t)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${e}TexShape[0], ${e}TexShape[1], ${i});
      return sampleTexture(${e}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${i});
      return sampleTexture(${e}, uv);
    }
  `}function zK(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),r=n.shapeInfo.texShape,o=Pn();if(t)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${e}TexShape[0]) / 2.0), ceil(float(${e}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${e}, uv);
    }
  `;const i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${o.texture2D}(${e}, uv);
    }
  `}function WK(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Qa(n)}
      }
    `;const r=n.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${s}(int index) {
        return sampleTexture(${e}, halfCR);
      }
    `;const a=ji(e);return i===1?t?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${e}TexShape[0]));
        return sampleTexture(${e}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);
        return sampleTexture(${e}, uv);
      }
    `:o===1?t?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${e}TexShape[1]), 0.5);
        return sampleTexture(${e}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${e}, uv);
      }
    `:t?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${e}TexShape[0], ${e}TexShape[1], index + ${a});
      return sampleTexture(${e}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${a});
      return sampleTexture(${e}, uv);
    }
  `}function VK(n,t){const e=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=o[0],a=o[1],l=Pn();if(o!=null&&he(e,o))return t?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(t)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],h=Math.ceil(e[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${h}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function UK(n,t){const e=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape;if(o!=null&&he(e,o)){if(t)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const f=o[0],m=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${m}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:i,keptDims:a}=$o(e),l=i;if(l.length<e.length){const f=tl(n,l),m=["row","col"];return`
      ${Ja(f,t)}
      float ${r}(int row, int col) {
        return ${r}(${el(m,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${e[1]}, 1)));
        ${Qa(n)}
      }
    `;const u=o[0],h=o[1],d=ji(s);return h===1?t?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${e[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?t?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${e[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${h}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:t?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${e[1]} + col + ${d};
    vec2 uv = uvFromFlat(${u}, ${h}, index);
    return sampleTexture(${s}, uv);
  }
`}function GK(n,t){const e=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(e[0]===1){const f=e.slice(1),m=[1,2],g=tl(n,f),x=["b","row","col"];return`
        ${pS(g,t)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${el(x,m)});
        }
      `}const a=Pn();if(t)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=i[0],u=i[1],h=Math.ceil(e[2]/2),d=h*Math.ceil(e[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${d}, ${h}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function HK(n,t){const e=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=e[1]*e[2],i=e[2],{newShape:a,keptDims:l}=$o(e),u=a;if(u.length<e.length){const x=tl(n,u),b=["row","col","depth"];return`
        ${Ja(x,t)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${el(b,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${Qa(n)}
      }
    `;const h=n.shapeInfo.texShape,d=h[0],f=h[1],m=n.shapeInfo.flatOffset;if(f===o&&m==null)return t?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${d}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(f===i&&m==null)return t?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${e[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${d}.0);
      return sampleTexture(${s}, uv);
    }
  `;const g=ji(s);return t?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${g};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${g};
        vec2 uv = uvFromFlat(${d}, ${f}, index);
        return sampleTexture(${s}, uv);
      }
  `}function KK(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),r=Pn();if(t)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${e}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${e}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${e}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${e}TexShape[0]) / 2.0), ceil(float(${e}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${e}, uv);
    }
  `;const o=n.shapeInfo.logicalShape,i=o.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],h=l[1],d=Math.ceil(o[i-1]/2);let f=d*Math.ceil(o[i-2]/2),m="int b, int row, int col",g=`b * ${f} + (row / 2) * ${d} + (col / 2)`;for(let x=2;x<i-1;x++)m=`int b${x}, `+m,f*=o[i-x-1],g=`b${x} * ${f} + `+g;return`
    vec4 ${s}(${m}) {
      int index = ${g};
      int texR = index / ${h};
      int texC = index - texR * ${h};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}, ${u});
      return ${r.texture2D}(${e}, uv);
    }
  `}function qK(n,t){const e=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=e[3],i=e[2]*o,a=e[1]*i,{newShape:l,keptDims:u}=$o(e);if(l.length<e.length){const v=tl(n,l),I=["row","col","depth","depth2"];return`
      ${Ja(v,t)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${el(I,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${o}, 1)));
        ${Qa(n)}
      }
    `;const h=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,f=d[0],m=d[1],g=`int stride2 = ${s}Shape[3];`,x=`int stride1 = ${s}Shape[2] * stride2;`,b=`int stride0 = ${s}Shape[1] * stride1;`;if(m===a&&h==null)return t?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${g}
        ${x}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(m===o&&h==null)return t?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${e[1]*e[2]}, ${e[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;const w=ji(s);return t?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${g}
      ${x}
      ${b}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${w});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${f}, ${m}, index + ${w});
      return sampleTexture(${s}, uv);
    }
  `}function jK(n){const t=n.shapeInfo.logicalShape,e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),r=t[4],o=t[3]*r,i=t[2]*o,a=t[1]*i,{newShape:l,keptDims:u}=$o(t);if(l.length<t.length){const x=tl(n,l),b=["row","col","depth","depth2","depth3"];return`
      ${Ja(x)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${el(b,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${o}, ${r})) +
          depth3;
        ${Qa(n)}
      }
    `;const h=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,f=d[0],m=d[1];if(m===a&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(m===r&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;const g=ji(e);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${o} +
          depth2 * ${r} + depth3 + ${g};
      vec2 uv = uvFromFlat(${f}, ${m}, index);
      return sampleTexture(${e}, uv);
    }
  `}function XK(n){const t=n.shapeInfo.logicalShape,e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),{newShape:r,keptDims:o}=$o(t);if(r.length<t.length){const b=tl(n,r),w=["row","col","depth","depth2","depth3","depth4"];return`
      ${Ja(b)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${el(w,o)});
      }
    `}const i=t[5],a=t[4]*i,l=t[3]*a,u=t[2]*l,h=t[1]*u;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${h}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Qa(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,m=f[0],g=f[1];if(g===h&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${m}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(g===i&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${m}.0);
        return sampleTexture(${e}, uv);
      }
    `;const x=ji(e);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${h} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${x};
      vec2 uv = uvFromFlat(${m}, ${g}, index);
      return sampleTexture(${e}, uv);
    }
  `}function Qa(n){const t=n.name,e=st(n.shapeInfo.logicalShape);return e<2?`return ${t};`:`
    for (int i = 0; i < ${e}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function YK(n,t){const e=n.name,s=e.charAt(0).toUpperCase()+e.slice(1),r="get"+s+"AtOutCoords",o=n.shapeInfo.logicalShape.length,i=t.logicalShape.length,a=fS(n.shapeInfo.logicalShape,t.logicalShape),l=ye(i),u=i-o;let h;const d=["x","y","z","w","u","v"];o===0?h="":i<2&&a.length>=1?h="coords = 0;":h=a.map(v=>`coords.${d[v+u]} = 0;`).join(`
`);let f="";i<2&&o>0?f="coords":f=n.shapeInfo.logicalShape.map((v,I)=>`coords.${d[I+u]}`).join(", ");let m="return outputValue;";const x=st(n.shapeInfo.logicalShape)===1,w=st(t.logicalShape)===1;if(o===1&&!x&&!w)m=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(x&&!w)i===1?m=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:m=`
        return vec4(outputValue.x);
      `;else if(a.length){const v=o-2,I=o-1;a.indexOf(v)>-1&&a.indexOf(I)>-1?m="return vec4(outputValue.x);":a.indexOf(v)>-1?m="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(I)>-1&&(m="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${h}
      vec4 outputValue = get${s}(${f});
      ${m}
    }
  `}function ZK(n,t){const e=n.name,s=e.charAt(0).toUpperCase()+e.slice(1),r="get"+s+"AtOutCoords",o=t.texShape,i=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=t.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&he(i,o))return`
      float ${r}() {
        return sampleTexture(${e}, resultUV);
      }
    `;const u=ye(l),h=fS(n.shapeInfo.logicalShape,t.logicalShape),d=l-a;let f;const m=["x","y","z","w","u","v"];a===0?f="":l<2&&h.length>=1?f="coords = 0;":f=h.map(x=>`coords.${m[x+d]} = 0;`).join(`
`);let g="";return l<2&&a>0?g="coords":g=n.shapeInfo.logicalShape.map((x,b)=>`coords.${m[b+d]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${f}
      return get${s}(${g});
    }
  `}function ye(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function Nb(n,t,e){const{newShape:s,keptDims:r}=$o(t),o=t.length,i=n&&o===3&&t[0]===1,a=i?t.slice(1):s,l=!n&&o>1&&!he(t,e)&&s.length<o||i;return{useSqueezeShape:l,uniformShape:l?a:t,keptDims:r}}function tl(n,t){const e=JSON.parse(JSON.stringify(n));return e.shapeInfo.logicalShape=t,e}function el(n,t){return t.map(e=>n[e]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JK(n,t,e,s){const r=e.map((h,d)=>{const f={logicalShape:h.shape,texShape:h.isUniform?null:h.texData.texShape,isUniform:h.isUniform,isPacked:h.isUniform?!1:h.texData.isPacked,flatOffset:null};return h.texData!=null&&h.texData.slice!=null&&h.texData.slice.flatOffset>0&&(f.flatOffset=h.texData.slice.flatOffset),{name:t.variableNames[d],shapeInfo:f}}),o=r.map(h=>h.shapeInfo),i={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=gK(r,i,t),l=HH(n.gl,a),u=n.createProgram(l);return J().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:o,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(u),Object.assign({program:t,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:o,outShapeInfo:i},gS(n,t,u)))}function gS(n,t,e){const s=[],r=[];let o,i,a,l=null,u=null;u=n.getUniformLocation(e,"NAN",!1),J().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(e,"INFINITY",!1));const h=!1;for(const d of t.variableNames){const f={name:d,uniform:n.getUniformLocation(e,d,h),offset:n.getUniformLocation(e,`offset${d}`,h)};t.enableShapeUniforms&&(f.shape=n.getUniformLocation(e,`${d}Shape`,h),f.texShape=n.getUniformLocation(e,`${d}TexShape`,h)),s.push(f)}if(t.enableShapeUniforms&&(o=n.getUniformLocation(e,"outShape",h),a=n.getUniformLocation(e,"outShapeStrides",h),i=n.getUniformLocation(e,"outTexShape",h)),t.customUniforms)for(const d of t.customUniforms)r.push(n.getUniformLocation(e,d.name,h));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:u,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:i}}function xS(n,t){if(n.length!==t.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${t.length} inputs`);n.forEach((e,s)=>{const r=e.logicalShape,o=t[s],i=o.shape;if(!he(r,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${i} must match`);if(e.isUniform&&o.isUniform)return;const a=e.texShape,l=o.isUniform?null:o.texData.texShape;if(!he(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function QK(n,t,e,s,r){t.program.enableShapeUniforms||(xS(t.inShapeInfos,e),xS([t.outShapeInfo],[s]));const o=s.texData.texture,i=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):n.setOutputMatrixTexture(o.texture,i[0],i[1]),n.setProgram(t.webGLProgram),n.bindVertexArray(t.webGLProgram.vao),J().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&n.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&n.gl.uniform1f(t.nanLoc,NaN);for(let l=0;l<e.length;++l){const u=e[l],{uniform:h,offset:d,shape:f,texShape:m}=t.variablesLocations[l];if(f){const{uniformShape:g}=Nb(t.program.packedInputs,u.shape,u.texData.texShape);switch(g.length){case 1:n.gl.uniform1iv(f,new Int32Array(g));break;case 2:n.gl.uniform2iv(f,new Int32Array(g));break;case 3:n.gl.uniform3iv(f,new Int32Array(g));break;case 4:n.gl.uniform4iv(f,new Int32Array(g));break}}if(m&&n.gl.uniform2i(m,u.texData.texShape[0],u.texData.texShape[1]),h!=null){if(u.isUniform){if(st(u.shape)<2)n.gl.uniform1f(h,u.uniformValues[0]);else{let g=u.uniformValues;g instanceof Float32Array||(g=new Float32Array(g)),n.gl.uniform1fv(h,g)}continue}u.texData.slice!=null&&d!=null&&n.gl.uniform1i(d,u.texData.slice.flatOffset),n.setInputMatrixTexture(u.texData.texture.texture,h,l)}}const a=t.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(t.outShapeStridesLocation){const l=_t(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(l));break}}if(t.outTexShapeLocation&&n.gl.uniform2i(t.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),t.program.customUniforms&&r)for(let l=0;l<t.program.customUniforms.length;++l){const u=t.program.customUniforms[l],h=t.customUniformLocations[l],d=r[l];if(u.type==="float")n.gl.uniform1fv(h,d);else if(u.type==="vec2")n.gl.uniform2fv(h,d);else if(u.type==="vec3")n.gl.uniform3fv(h,d);else if(u.type==="vec4")n.gl.uniform4fv(h,d);else if(u.type==="int")n.gl.uniform1iv(h,d);else if(u.type==="ivec2")n.gl.uniform2iv(h,d);else if(u.type==="ivec3")n.gl.uniform3iv(h,d);else if(u.type==="ivec4")n.gl.uniform4iv(h,d);else throw Error(`uniform type ${u.type} is not supported yet.`)}n.executeProgram()}function tq(n,t,e){let s="";t.concat(e).forEach(i=>{const a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!i.isUniform){const l=i.texData.texShape,{useSqueezeShape:u,uniformShape:h,keptDims:d}=Nb(n.packedInputs,i.shape,l);let f="",m="",g="";if(h.length===1&&n.packedInputs){const k=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];f=`${k[0]>1}_${k[1]>1}`}else if(h.length===2&&!n.packedInputs)m=`${h[0]>1}_${h[1]>1}`;else if(h.length>2&&!n.packedInputs){const k=_t(h);g=`${k[0]===l[1]}_${k[k.length-1]===l[1]}`}const x=i.shape.length,b=h.length===2&&he(i.shape,l),w=st(i.shape)===1,v=Fa(i.shape,e.shape),I=!n.packedInputs&&x===e.shape.length&&he(l,e.texData.texShape),C=n.packedInputs||h.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${x}_${I}_${u?d:""}_${h.length}_${w}_${v}_${b}_${f}_${m}_${g}_${C}_${a}`}else{const l=i.isUniform?"uniform":i.texData.texShape;s+=`${i.shape}_${l}_${a}`}});const r=n.userCode;let o=n.constructor.name;return o+="_"+s+"_"+r+`${J().getNumber("WEBGL_VERSION")}`,o}function En(n){return J().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eq{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=hc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=Pn();this.outputShape=t,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?bf(["r","c","d"],t):qi(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${e.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nq{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=hc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=Pn();this.outputShape=t,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?bf(["r","c","d"],t):qi(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${e.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sq{constructor(t){this.variableNames=["A"],this.outTexUsage=$s.DOWNLOAD;const e=Pn();this.outputShape=t,this.userCode=`
      ${dS}

      void main() {
        float x = getAAtOutCoords();
        ${e.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rq{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=$s.DOWNLOAD;const e=Pn();this.outputShape=t,this.userCode=`
      ${dS}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${e.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oq={R:0,G:1,B:2,A:3};class bS{constructor(t,e=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Pn();this.outputShape=t,this.enableShapeUniforms=En(this.outputShape.length);let o="result";e&&(o="floor(result * 255. + 0.5)");let i="";for(let a=0;a<s.length;a++){const l=s[a];i+=`
          if(offset == ${a}) {
            result = values[${oq[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Sb():kb(t)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${i}
        }
        ${r.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iq{constructor(t,e=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Pn();this.outputShape=t,this.enableShapeUniforms=En(this.outputShape.length);let r="",o="result";e&&(o="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){const l=i*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Sb():kb(t)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aq(n){const t=Pn(),e=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return GH(n,e)}function lq(n){const t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return XH(n,t)}function uq(n){const t=new Uint16Array([0,1,2,2,1,3]);return YH(n,t)}function pc(n,t,e,s,r,o){JH(t,e);const i=ZH(n),a=n.TEXTURE_2D;return Ct(n,()=>n.bindTexture(a,i)),Ct(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Ct(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Ct(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Ct(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),J().getNumber("WEBGL_VERSION")===1?Ct(n,()=>n.texImage2D(a,0,s,t,e,0,r,o,null)):Ct(n,()=>n.texStorage2D(a,1,s,t,e)),Ct(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:i,texShape:[e,t]}}function yS(n){return n.internalFormatFloat}function cq(n,t,e,s){const[r,o]=dc(t,e);return pc(n,r,o,yS(s),s.textureFormatFloat,n.FLOAT)}function wS(n){return n.internalFormatHalfFloat}function hq(n,t,e,s){const[r,o]=dc(t,e);return pc(n,r,o,wS(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function vS(n){return n.downloadTextureFormat}function dq(n,t,e,s){const[r,o]=dc(t,e);return pc(n,r,o,vS(s),n.RGBA,n.UNSIGNED_BYTE)}function CS(n){return n.internalFormatPackedFloat}function fq(n,t,e,s){const[r,o]=Xa(t,e);return pc(n,r,o,CS(s),n.RGBA,n.FLOAT)}function IS(n){return n.internalFormatPackedHalfFloat}function pq(n,t,e,s){const[r,o]=Xa(t,e);return pc(n,r,o,IS(s),n.RGBA,s.textureTypeHalfFloat)}function mq(n,t,e){return Ct(n,()=>n.bindBuffer(n.ARRAY_BUFFER,e)),uS(n,t,"clipSpacePos",e,3,20,0)&&uS(n,t,"uv",e,2,20,12)}function gq(n,t,e,s,r,o){Ct(n,()=>n.bindTexture(n.TEXTURE_2D,t));let i,a,l;r instanceof Uint8Array?(i=new Uint8Array(e*s*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(i=new Float32Array(e*s*4),a=n.FLOAT,l=o.internalFormatPackedFloat),i.set(r),J().getNumber("WEBGL_VERSION")===2?Ct(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,e,s,n.RGBA,a,i)):Ct(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,e,s,0,n.RGBA,a,i)),Ct(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function xq(n,t,e){Ct(n,()=>n.bindTexture(n.TEXTURE_2D,t)),e.data instanceof Uint8Array?J().getNumber("WEBGL_VERSION")===2?Ct(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.width,e.height,n.RGBA,n.UNSIGNED_BYTE,e.data)):Ct(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e.width,e.height,0,n.RGBA,n.UNSIGNED_BYTE,e.data)):J().getNumber("WEBGL_VERSION")===2?Ct(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,e)):Ct(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e)),Ct(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function bq(n,t,e,s){const r=n.createBuffer();Ct(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*t*e;return Ct(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Ct(n,()=>n.readPixels(0,0,e,t,n.RGBA,n.FLOAT,0)),Ct(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function yq(n,t,e){const s=n,r=new Float32Array(e);return s.bindBuffer(s.PIXEL_PACK_BUFFER,t),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function wq(n,t,e,s){const[r,o]=dc(t,e),i=4,a=new Uint8Array(PH(t*e,i));return Ct(n,()=>n.readPixels(0,0,r,o,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function vq(n,t,e,s,r,o,i,a){const l=n,u=new Float32Array(MH(o,i));return l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function Cq(n,t,e){const s=new Float32Array(t*e*4);return Ct(n,()=>n.readPixels(0,0,e,t,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tb{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const e=J().getNumber("WEBGL_VERSION");if(t!=null?(this.gl=t,FH(e,t)):this.gl=mr(e),t=this.gl,J().getNumber("WEBGL_VERSION")===2){const o=t;this.createVertexArray=()=>Ct(o,()=>o.createVertexArray()),this.bindVertexArray=i=>Ct(o,()=>o.bindVertexArray(i)),this.deleteVertexArray=i=>Ct(o,()=>o.deleteVertexArray(i)),this.getVertexArray=()=>Ct(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(t!=null){const o=t.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Ct(t,()=>o.createVertexArrayOES()),this.bindVertexArray=i=>Ct(t,()=>o.bindVertexArrayOES(i)),this.deleteVertexArray=i=>Ct(t,()=>o.deleteVertexArrayOES(i)),this.getVertexArray=()=>Ct(t,()=>t.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),J().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=ff(this.gl,o),Ks(this.gl,i))this.textureHalfFloatExtension=ff(this.gl,i);else if(J().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Ks(this.gl,r))this.colorBufferHalfFloatExtension=ff(this.gl,r);else if(J().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Ks(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Ks(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=lq(this.gl),this.indexBuffer=uq(this.gl),this.framebuffer=QH(this.gl),this.textureConfig=yb(this.gl,this.textureHalfFloatExtension)}get debug(){return J().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;Ct(t,()=>t.finish()),Ct(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),Ct(t,()=>t.deleteFramebuffer(this.framebuffer)),Ct(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),Ct(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),Ct(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),cq(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),hq(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),dq(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),xq(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,s,r){this.throwIfDisposed(),gq(this.gl,t,e,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),pq(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),fq(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(cS(this.gl,this.framebuffer),this.outputTexture=null),Ct(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,s){return this.downloadMatrixDriver(t,()=>wq(this.gl,e,s,this.textureConfig))}downloadPackedMatrixFromBuffer(t,e,s,r,o,i){return vq(this.gl,t,e,s,r,o,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return yq(this.gl,t,e)}createBufferFromTexture(t,e,s){this.bindTextureToFrameBuffer(t);const r=bq(this.gl,e,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,s;if(J().getBool("WEBGL_FENCE_API_ENABLED")){const r=t,o=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),s=()=>{const i=r.clientWaitSync(o,0,0);return i===r.ALREADY_SIGNALED||i===r.CONDITION_SATISFIED},e=o}else J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(e,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:e,isFencePassed:s}}downloadMatrixFromPackedTexture(t,e,s){return this.downloadMatrixDriver(t,()=>Cq(this.gl,e,s))}createProgram(t){this.throwIfDisposed();const e=this.gl;this.vertexShader==null&&(this.vertexShader=aq(e));const s=qH(e);Ct(e,()=>e.attachShader(s,this.vertexShader)),Ct(e,()=>e.attachShader(s,t)),jH(e,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&wb(e,r),r}buildVao(t){this.setProgram(t),this.bindVertexArray(t.vao);const e=this.gl;Ct(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),mq(e,t,this.vertexBuffer)}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&(Ct(this.gl,()=>this.gl.deleteProgram(t)),this.deleteVertexArray(t.vao))}setProgram(t){this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&wb(this.gl,this.program),Ct(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,e,s=!0){return this.throwIfDisposed(),s?eK(this.gl,t,e):nK(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),Ct(this.gl,()=>this.gl.getAttribLocation(t,e))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,s){this.throwIfDisposed(),this.throwIfNoProgram(),sK(this.gl,t,e,s)}setOutputMatrixTexture(t,e,s){this.setOutputMatrixTextureDriver(t,s,e)}setOutputPackedMatrixTexture(t,e,s){this.throwIfDisposed();const[r,o]=Xa(e,s);this.setOutputMatrixTextureDriver(t,r,o)}setOutputMatrixWriteRegion(t,e,s,r){this.setOutputMatrixWriteRegionDriver(s,t,r,e)}setOutputPackedMatrixWriteRegion(t,e,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&wb(this.gl,this.program),pf(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;if(this.debug){const e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Ct(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Ct(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=ff(this.gl,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,o),o}const t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const e=this.gl,s=this.getQueryTimerExtensionWebGL2();e.endQuery(s.TIME_ELAPSED_EXT);return}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await e1(()=>this.disposed||this.isQueryAvailable(t,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,e){if(e===0)return null;if(e===2){const s=this.gl;return s.getQueryParameter(t,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(t,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(e===0)return!0;if(e===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.getQueryParameter(t,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(t,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(t){return new Promise(e=>{this.addItemToPoll(()=>t.isFencePassed(),()=>e())})}pollItems(){const t=Iq(this.itemsToPoll.map(e=>e.isDoneFn));for(let e=0;e<=t;++e){const{resolveFn:s}=this.itemsToPoll[e];s()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in J().platform&&(s=J().platform.setTimeoutCustom.bind(J().platform)),e1(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),vb(this.gl,t,this.framebuffer),this.debug&&pf(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(vb(this.gl,this.outputTexture,this.framebuffer),this.debug&&pf(this.gl)):cS(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);const s=e();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(t,e,s){this.throwIfDisposed();const r=this.gl;vb(r,t,this.framebuffer),this.debug&&pf(r),this.outputTexture=t,Ct(r,()=>r.viewport(0,0,e,s)),Ct(r,()=>r.scissor(0,0,e,s))}setOutputMatrixWriteRegionDriver(t,e,s,r){this.throwIfDisposed(),Ct(this.gl,()=>this.gl.scissor(t,e,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function Iq(n){let t=0;for(;t<n.length&&n[t]();++t);return t-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:$q,bincountImpl:$S,bincountReduceImpl:kq,bitwiseAndImpl:Sq,castImpl:Nq,ceilImpl:Tq,concatImpl:Eq,equalImpl:_q,expImpl:Rq,expm1Impl:Aq,floorImpl:Dq,gatherNdImpl:Fq,gatherV2Impl:Oq,greaterImpl:Lq,greaterEqualImpl:Pq,lessImpl:Mq,lessEqualImpl:Bq,linSpaceImpl:zq,logImpl:Wq,maxImpl:Vq,maximumImpl:Uq,minimumImpl:Gq,multiplyImpl:Hq,negImpl:Kq,notEqualImpl:qq,prodImpl:jq,raggedGatherImpl:Xq,raggedRangeImpl:Yq,raggedTensorToTensorImpl:Zq,rangeImpl:Jq,rsqrtImpl:Qq,scatterImpl:t6,sigmoidImpl:e6,simpleAbsImpl:kS,sliceImpl:n6,sparseFillEmptyRowsImpl:s6,sparseReshapeImpl:r6,sparseSegmentReductionImpl:SS,sqrtImpl:o6,staticRegexReplaceImpl:i6,stridedSliceImpl:a6,stringNGramsImpl:l6,stringSplitImpl:u6,stringToHashBucketFastImpl:c6,subImpl:h6,tileImpl:d6,topKImpl:f6,transposeImpl:Eb,uniqueImpl:p6}=yW;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NS(n,t){return["x","y","z","w","u","v"].slice(0,t).map(e=>`${n}.${e}`)}function Mn(n,t){return t===1?[n]:NS(n,t)}function m6(n,t){if(n===1)return"rc";let e="";for(let s=0;s<n;s++)e+=t[s],s<n-1&&(e+=",");return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g6{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=En(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const e=Mn("rc",this.rank),s=ye(this.rank),r=this.getOutOfBoundsCondition(e),o=this.getSetup(e),i=this.getOutput(e);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(t){const e=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let o=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)o=`${t[t.length-1-i]},`+o;e.push(o)}return e}getOutOfBoundsCondition(t){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let e="";for(let s=this.rank-2;s<this.rank;s++)e+=`${t[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(e+="||");return e}getSetup(t){if(this.rank===1)return"";const e=t.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${e[0]};
      int c = ${e[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(t){const e=this.getSourceCoordsArr(t);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${e[0]}),
            cEdge ? 0. : getA(${e[1]}),
            rEdge ? 0. : getA(${e[2]}),
            rEdge || cEdge ? 0. : getA(${e[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TS{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=En(this.outputShape.length);let s="";for(let r=0;r<4;r++){let o="thisRC = rc;";r%2===1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),s+=`
        ${o}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${x6(e,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Sb():kb(t)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};

        ${s}

        setOutput(result);
      }
    `}}function x6(n,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?mK(["r","c","d"],"inputShape"):qi(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b6{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(t,e,s){const r=_S(e,s),o=RS(t,r,s);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const i=ES(t,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const l=this.freeTextures[o].pop();return this.usedTextures[o].push(l),l}let a;return r===Cn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):r===Cn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):r===Cn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):r===Cn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):r===Cn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[o].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(t,e,s,r){if(this.freeTextures==null)return;const o=_S(s,r),i=RS(e,o,r);i in this.freeTextures||(this.freeTextures[i]=[]);const a=ES(e,o,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=J().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(t),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[i],h=u&&u.indexOf(t);if(h==null||h<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[h]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const t in this.freeTextures)this.freeTextures[t].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});for(const t in this.usedTextures)this.usedTextures[t].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function y6(n,t){const e=n;if(t===e.R32F)return 4;if(t===e.R16F)return 2;if(t===e.RGBA32F)return 16;if(t===n.RGBA)return 16;if(t===e.RGBA16F)return 8;if(t===e.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function ES(n,t,e,s,r){const o=w6(t,s);let i;if(r){const[l,u]=Xa(n[0],n[1]);i=l*u}else{const[l,u]=dc(n[0],n[1]);i=l*u}const a=y6(e,o);return i*a}function w6(n,t){switch(n){case Cn.PACKED_2X2_FLOAT32:return CS(t);case Cn.PACKED_2X2_FLOAT16:return IS(t);case Cn.UNPACKED_FLOAT32:return yS(t);case Cn.UNPACKED_FLOAT16:return wS(t);case Cn.PACKED_4X1_UNSIGNED_BYTE:return vS(t);default:throw new Error(`Unknown physical texture type ${n}`)}}function v6(n){return J().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Cn.PACKED_2X2_FLOAT32:Cn.UNPACKED_FLOAT32:n?Cn.PACKED_2X2_FLOAT16:Cn.UNPACKED_FLOAT16}function _S(n,t){if(n===$s.UPLOAD)return Cn.PACKED_2X2_FLOAT32;if(n===$s.RENDER||n==null)return v6(t);if(n===$s.DOWNLOAD||n===$s.PIXELS)return Cn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function RS(n,t,e){return`${n[0]}_${n[1]}_${t}_${e}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Br{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${e}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const qs="if (isnan(x)) return x;",C6="return x;",AS="return abs(x);",I6="return (x >= 0.0) ? x : (exp(x) - 1.0);",$6=qs+`
  return (x < 0.0) ? 0.0 : x;
`,k6=qs+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,qo="return x;",S6="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N6="return x;",T6=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,E6=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,_6=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,R6="return 1.0 / (1.0 + exp(-1.0 * x));";class jo{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${e}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A6{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=En(this.outputShape.length);const e=t.length,s=Mn("rc",e),r=ye(e),o=m6(e,s),i=s.slice(-2),a=e<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D6=Qw,F6=1e-7,O6=1e-4,yf={};function L6(n){return n in yf||(yf[n]={}),yf[n]}const P6=J().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),M6=600;function B6(){return J().global.screen==null?1024:J().global.screen.height*J().global.screen.width*window.devicePixelRatio*M6/1024/1024}class wf extends Gp{nextDataId(){return wf.nextDataId++}constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!J().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let e;if(t!=null){if(t instanceof Tb)e=t;else{const s=mr(J().getNumber("WEBGL_VERSION"),t);e=new Tb(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=mr(J().getNumber("WEBGL_VERSION"));e=new Tb(s),this.binaryCache=L6(J().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=e,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new b6(this.gpgpu),this.numMBBeforeWarning=B6(),this.texData=new Q0(this,$r())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,e,s,r,o,i){const a=this.makeTensorInfo(e,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:t,texShape:[r,o]},l.texShape=[r,o];const u=mf(e),h=new bS(u,!1,i),d=this.runWebGLProgram(h,[a],s,[[r,o]]);return d.shape=e,l.texture=null,this.disposeIntermediateTensorInfo(a),d.dataId}write(t,e,s){if((J().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||J().getBool("DEBUG"))&&this.checkNumericalProblems(t),s==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:e,dtype:s,values:t,usage:$s.UPLOAD,refCount:1}),r}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){const e=this.texData.get(t);e.refCount++}decRef(t){if(this.texData.has(t)){const e=this.texData.get(t);e.refCount--}}move(t,e,s,r,o){if(J().getBool("DEBUG")&&this.checkNumericalProblems(e),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:s,dtype:r,values:e,usage:$s.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const e=this.texData.get(t),{values:s,dtype:r,complexTensorInfos:o,slice:i,shape:a,isPacked:l}=e;if(i!=null){let f;l?f=new jo(a,qo):f=new Br(a,qo);const m=this.runWebGLProgram(f,[{dataId:t,shape:a,dtype:r}],r),g=this.readSync(m.dataId);return this.disposeIntermediateTensorInfo(m),g}if(s!=null)return this.convertAndCacheOnCPU(t);if(r==="string")return s;const u=this.activeTimers!=null;let h;u&&(h=Nn());let d;if(r==="complex64"){const f=this.readSync(o.real.dataId),m=this.readSync(o.imag.dataId);d=Qr(f,m)}else d=this.getValuesFromTexture(t);return u&&(this.downloadWaitMs+=Nn()-h),this.convertAndCacheOnCPU(t,d)}async read(t){if(this.pendingRead.has(t)){const g=this.pendingRead.get(t);return new Promise(x=>g.push(x))}const e=this.texData.get(t),{values:s,shape:r,slice:o,dtype:i,complexTensorInfos:a,isPacked:l}=e;if(o!=null){let g;l?g=new jo(r,qo):g=new Br(r,qo);const x=this.runWebGLProgram(g,[{dataId:t,shape:r,dtype:i}],i),b=this.read(x.dataId);return this.disposeIntermediateTensorInfo(x),b}if(s!=null)return this.convertAndCacheOnCPU(t);if(J().getBool("DEBUG")&&!J().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&J().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,h;if(i!=="complex64"&&J().get("WEBGL_BUFFER_SUPPORTED")){h=this.decode(t);const g=this.texData.get(h.dataId);u=this.gpgpu.createBufferFromTexture(g.texture.texture,...df(r))}this.pendingRead.set(t,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(i==="complex64"){const g=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),x=g[0],b=g[1];d=Qr(x,b)}else if(u==null)d=this.getValuesFromTexture(t);else{const g=st(r);d=this.gpgpu.downloadFloat32MatrixFromBuffer(u,g)}if(h!=null&&this.disposeIntermediateTensorInfo(h),u!=null){const g=this.gpgpu.gl;Ct(g,()=>g.deleteBuffer(u))}const f=this.convertAndCacheOnCPU(t,d),m=this.pendingRead.get(t);return this.pendingRead.delete(t),m.forEach(g=>g(f)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&$r().removeDataId(t,this),this.pendingDeletes--),f}readToGPU(t,e={}){const s=this.texData.get(t),{values:r,shape:o,slice:i,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let m;l?m=new jo(o,qo):m=new Br(o,qo);const g=this.runWebGLProgram(m,[{dataId:t,shape:o,dtype:a}],a),x=this.readToGPU(g,e);return this.disposeIntermediateTensorInfo(g),x}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const h=this.decode(t,e.customTexShape),d=$r().makeTensorFromTensorInfo(h),f=this.texData.get(h.dataId);return Object.assign({tensorRef:d},f.texture)}bufferSync(t){const e=this.readSync(t.dataId);if(t.dtype==="string")try{const s=e.map(r=>To(r));return Yt(t.shape,t.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Yt(t.shape,t.dtype,e)}checkNumericalProblems(t){if(t!=null)for(let e=0;e<t.length;e++){const s=t[e];if(!VH(s))throw J().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(t){const{shape:e,dtype:s,isPacked:r}=this.texData.get(t),o=st(e);if(J().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(t),m=this.texData.get(f.dataId),g=this.gpgpu.downloadMatrixFromPackedTexture(m.texture.texture,...df(e)).subarray(0,o);return this.disposeIntermediateTensorInfo(f),g}const i=J().getBool("WEBGL_PACK")&&r===!0,a=i?mf(e):e,l=i?new rq(a):new sq(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:t}],"float32"),h=this.texData.get(u.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture.texture,h.texShape[0],h.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(u),d}timerAvailable(){return J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const e=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,t();const o=vi(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),i=vi(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=e,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(o);a.kernelMs=s_(l),a.getExtraProfileInfo=()=>l.map((u,h)=>({name:i[h],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Nn(),endMs:null}}endTimer(t){return J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Nn(),t)}async getQueryTime(t){if(J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const e=t;return e.endMs-e.startMs}disposeData(t,e=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(e?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!e&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:s}=this.texData.get(t);return s!=null&&(this.disposeData(s.real.dataId,e),this.disposeData(s.imag.dataId,e)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:e,dtype:s,texShape:r,usage:o,isPacked:i,slice:a}=this.texData.get(t),l=a&&a.origDataId||t,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),e!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(e,r,o,i)));const h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,e=P6){return J().getBool("WEBGL_CPU_FORWARD")&&t.every(s=>this.texData.get(s.dataId).texture==null&&st(s.shape)<e)}getGPGPUContext(){return this.gpgpu}where(t){bs("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const e=t.dataSync();return D6(t.shape,e)}packedUnaryOp(t,e,s){const r=new jo(t.shape,e),o=this.compileAndRun(r,[t],s);return $r().makeTensorFromTensorInfo(o)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){const r=kS(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,r)}if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,AS,t.dtype);const e=new Br(t.shape,AS),s=this.compileAndRun(e,[t]);return $r().makeTensorFromTensorInfo(s)}makeTensorInfo(t,e,s){let r;if(e==="string"&&s!=null&&s.length>0&&_l(s[0])){const o=s.map(i=>No(i));r=this.write(o,t,e)}else r=this.write(s,t,e);return this.texData.get(r).usage=null,{dataId:r,shape:t,dtype:e}}makeOutput(t,e,s){return $r().makeTensorFromTensorInfo(this.makeTensorInfo(t,e,s),this)}unpackTensor(t){const e=new A6(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){const e=new g6(t.shape),s=!0;return this.runWebGLProgram(e,[t],t.dtype,null,s)}packedReshape(t,e){const s=[Ya(t.shape),...Za(t.shape)],r={dtype:t.dtype,shape:s,dataId:t.dataId},o=[Ya(e),...Za(e)],i=new TS(o,s),a=!0,l=[s],u=this.runWebGLProgram(i,[r],t.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}decode(t,e){const s=this.texData.get(t),{isPacked:r,shape:o,dtype:i}=s;if(e!=null){const f=st(o),m=e[0]*e[1]*4;A(f<=m,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=mf(o);let l;r?l=new nq(a):l=new eq(a);const u=!0,h=[e??df(a)],d=this.runWebGLProgram(l,[{shape:a,dtype:i,dataId:t}],i,h,u,e);return{dtype:i,shape:o,dataId:d.dataId}}runWebGLProgram(t,e,s,r,o=!1,i){const a=this.makeTensorInfo(t.outputShape,s),l=this.texData.get(a.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===hc.DENSE){const w=i??df(t.outputShape);l.texShape=w.map(v=>v*2)}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),st(a.shape)===0)return l.values=kn(a.dtype,0),a;const u=[],h=e.map(w=>{if(w.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let v=this.texData.get(w.dataId);if(v.texture==null){if(!t.packedInputs&&st(w.shape)<=J().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:w.shape,texData:null,isUniform:!0,uniformValues:v.values};t.packedInputs&&(v.isPacked=!0,v.shape=w.shape)}if(this.uploadToGPU(w.dataId),!!v.isPacked!=!!t.packedInputs)w=v.isPacked?this.unpackTensor(w):this.packTensor(w),u.push(w),v=this.texData.get(w.dataId);else if(v.isPacked&&!xf(v.shape,w.shape)){const I=w,C=w.shape;w.shape=v.shape,w=this.packedReshape(w,C),u.push(w),v=this.texData.get(w.dataId),I.shape=C}return{shape:w.shape,texData:v,isUniform:!1}});this.uploadToGPU(a.dataId);const d={shape:a.shape,texData:l,isUniform:!1},f=tq(t,h,d),m=this.getAndSaveBinary(f,()=>JK(this.gpgpu,t,h,d)),g=this.activeTimers!=null;let x;g&&(x=this.startTimer()),J().get("ENGINE_COMPILE_ONLY")||QK(this.gpgpu,m,h,d,r),u.forEach(w=>this.disposeIntermediateTensorInfo(w)),g&&(x=this.endTimer(x),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(x)}));const b=J().getNumber("WEBGL_FLUSH_THRESHOLD");if(b>0){const w=Nn();w-this.lastGlFlushTime>b&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=w)}if(!J().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){const w=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),w}return a}compileAndRun(t,e,s,r,o=!1){return s=s||e[0].dtype,this.runWebGLProgram(t,e,s,r,o)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(J().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=X(()=>{if(!J().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=J().getBool("DEBUG");J().set("DEBUG",!1);const e=this.abs(fe(1e-8)).dataSync()[0];if(J().set("DEBUG",t),e>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?F6:O6}uploadToGPU(t){const e=this.texData.get(t),{shape:s,dtype:r,values:o,texture:i,usage:a,isPacked:l}=e;if(i!=null)return;const u=this.activeTimers!=null;let h;u&&(h=Nn());let d=e.texShape;if(d==null&&(d=iK(s,l),e.texShape=d),o!=null){const f=mf(s);let m,g=d[1],x=d[0];const b=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(l||!b)&&([g,x]=Xa(d[0],d[1])),l?m=new iq(f,b):m=new bS(f,b);const w=b?[x,g]:d,v=this.makeTensorInfo(w,r),I=this.texData.get(v.dataId);b?I.usage=$s.PIXELS:I.usage=$s.UPLOAD,I.texShape=w,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),g,x,o);const C=[[x,g]],k=!0,N=this.runWebGLProgram(m,[v],r,C,k),T=this.texData.get(N.dataId);e.texShape=T.texShape,e.isPacked=T.isPacked,e.usage=T.usage,J().get("ENGINE_COMPILE_ONLY")?this.disposeData(N.dataId):(e.texture=T.texture,e.values=null,this.texData.delete(N.dataId)),this.disposeIntermediateTensorInfo(v),u&&(this.uploadWaitMs+=Nn()-h)}else{const f=this.acquireTexture(d,a,r,l);e.texture=f}}convertAndCacheOnCPU(t,e){const s=this.texData.get(t),{dtype:r}=s;return e!=null&&(s.values=z6(e,r)),s.values}acquireTexture(t,e,s,r){if(this.numBytesInGPU+=this.computeBytes(t,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,e,r)}computeBytes(t,e){return t[0]*t[1]*oh(e)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,e]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(e));return Promise.all(t)}else{for(const[,e]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(e),r(!0)}catch(o){throw o}});t.push(s)}return Promise.all(t)}}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await wv(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(lS(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const t of Object.values(this.binaryCache)){this.gpgpu.buildVao(t.webGLProgram);const{variablesLocations:e,customUniformLocations:s,infLoc:r,nanLoc:o,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:l}=gS(this.gpgpu,t.program,t.webGLProgram);t.variablesLocations=e,t.customUniformLocations=s,t.infLoc=r,t.nanLoc=o,t.outShapeLocation=i,t.outShapeStridesLocation=a,t.outTexShapeLocation=l}}createTensorFromGPUData(t,e,s){t.channels=t.channels||"RGBA";const{texture:r,height:o,width:i,channels:a}=t,l=$r().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(r,e,s,o,i,a);return $r().makeTensorFromDataId(u,e,s,l)}}wf.nextDataId=0;function z6(n,t){if(t==="float32"||t==="complex64")return n;if(t==="int32"||t==="bool"){const e=t==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<e.length;++s)e[s]=Math.round(n[s]);return e}else throw new Error(`Unknown dtype ${t}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */iw()&&vw("webgl",()=>new wf,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _b=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Xi{constructor(t,e,s){this.variableNames=["A","B"],this.outputShape=Vt(e,s),this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${t}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yi=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class nl{constructor(t,e,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Vt(e,s);const o=this.outputShape.length;this.enableShapeUniforms=En(o);let i="";if(r)if(o===0||st(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${ye(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=Mn("coords",o);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${t}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ds(n){const{inputs:t,backend:e}=n,{x:s}=t;return e.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const W6={kernelName:Zl,backendName:"webgl",kernelFunc:ds};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xo(n){const{inputs:t,backend:e}=n,{real:s,imag:r}=t,o=e.makeTensorInfo(s.shape,"complex64"),i=e.texData.get(o.dataId),a=ds({inputs:{x:s},backend:e}),l=ds({inputs:{x:r},backend:e});return i.complexTensorInfos={real:a,imag:l},o}const V6={kernelName:om,backendName:"webgl",kernelFunc:Xo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DS="return (a < 0.) ? b * a : a;",FS=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function U6(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{alpha:o}=s,i=e.makeTensorInfo([],"float32",So(o,"float32")),a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new nl(FS,r.shape,i.shape):new Xi(DS,r.shape,i.shape),l=e.runWebGLProgram(a,[r,i],"float32");return e.disposeIntermediateTensorInfo(i),l}const G6={kernelName:Th,backendName:"webgl",kernelFunc:U6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OS="return (a < 0.) ? b * a : a;",LS=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function H6(n){const{inputs:t,backend:e}=n,{x:s,alpha:r}=t,o=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new nl(LS,s.shape,r.shape):new Xi(OS,s.shape,r.shape);return e.runWebGLProgram(o,[s,r],"float32")}const K6={kernelName:qh,backendName:"webgl",kernelFunc:H6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sl="if (isnan(x)) return x;";function re({opSnippet:n,packedOpSnippet:t,cpuKernelImpl:e,dtype:s}){return({inputs:r,backend:o})=>{const{x:i}=r,a=o,l=s||i.dtype;if(a.shouldExecuteOnCPU([i])&&e!=null){const d=a.texData.get(i.dataId),f=e(d.values,l);return a.makeTensorInfo(i.shape,l,f)}const u=J().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null;let h;return u?h=new jo(i.shape,t):h=new Br(i.shape,n),a.runWebGLProgram(h,[i],l)}}function In({opSnippet:n,packedOpSnippet:t,checkOutOfBounds:e=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:o}){return({inputs:i,backend:a})=>{const{a:l,b:u}=i,h=a;if(s&&l.dtype==="complex64"){const g=h.texData.get(l.dataId),x=h.texData.get(u.dataId),[b,w]=[[g.complexTensorInfos.real,x.complexTensorInfos.real],[g.complexTensorInfos.imag,x.complexTensorInfos.imag]].map(I=>{const[C,k]=I,N={dataId:C.dataId,dtype:C.dtype,shape:l.shape},T={dataId:k.dataId,dtype:k.dtype,shape:u.shape},R=new Xi(n,l.shape,u.shape);return h.runWebGLProgram(R,[N,T],us(C.dtype,k.dtype))}),v=Xo({inputs:{real:b,imag:w},backend:h});return h.disposeIntermediateTensorInfo(b),h.disposeIntermediateTensorInfo(w),v}const d=o||us(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||h.shouldExecuteOnCPU([l,u]))&&r!=null){const g=h.texData.get(l.dataId).values,x=h.texData.get(u.dataId).values,b=l.dtype==="string"?to(g):g,w=l.dtype==="string"?to(x):x,[v,I]=r(l.shape,u.shape,b,w,d),C=h.makeTensorInfo(I,d),k=h.texData.get(C.dataId);return k.values=v,C}const f=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null;let m;return f?m=new nl(t,l.shape,u.shape,e):m=new Xi(n,l.shape,u.shape),h.runWebGLProgram(m,[l,u],d)}}function mc(n,t=!1){if(n==="linear")return t?N6:C6;if(n==="relu")return t?E6:$6;if(n==="elu")return t?T6:I6;if(n==="relu6")return t?_6:k6;if(n==="prelu")return t?LS:OS;if(n==="leakyrelu")return t?FS:DS;if(n==="sigmoid")return t?R6:S6;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PS{constructor(t,e,s,r=!1,o=!1,i=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=En(this.outputShape.length);const h=r?t[1]:t[2],d=Math.ceil(h/2),f=r?"i * 2, rc.y":"rc.y, i * 2",m=o?"rc.z, i * 2":"i * 2, rc.z",g=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],x=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let b="",w="";a&&(l?b=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?b=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:b=`vec4 activation(vec4 x) {
          ${a}
        }`,w="result = activation(result);");const v=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let I="rc.x",C="rc.x";t[0]<e[0]?I=`imod(rc.x, ${t[0]})`:e[0]<t[0]&&(C=`imod(rc.x, ${e[0]})`),this.userCode=`
      ${b}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${I};
        int batchB = ${C};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${m});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${g[0]} * ${x[0]});
          result += (${g[1]} * ${x[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${v}

        ${w}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MS={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class BS{constructor(t,e,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Vt(e,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${t}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zS="return a * b;";function Rb(n){const{inputs:t,backend:e}=n,{a:s,b:r}=t,o=us(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=e.texData.get(s.dataId),l=e.texData.get(r.dataId),u=new BS(MS.REAL,s.shape,r.shape),h=new BS(MS.IMAG,s.shape,r.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],f=e.runWebGLProgram(u,d,"float32"),m=e.runWebGLProgram(h,d,"float32"),g=Xo({inputs:{real:f,imag:m},backend:e});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),g}if(e.shouldExecuteOnCPU([s,r])){const a=e.texData.get(s.dataId),l=e.texData.get(r.dataId),[u,h]=Hq(s.shape,r.shape,a.values,l.values,o),d=e.makeTensorInfo(h,o),f=e.texData.get(d.dataId);return f.values=u,d}let i;return J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new nl(zS,s.shape,r.shape):i=new Xi(zS,s.shape,r.shape),e.runWebGLProgram(i,[s,r],o)}const q6={kernelName:iu,backendName:"webgl",kernelFunc:Rb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j6(n,t,e){const s=[Ya(n.shape),...Za(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},o=[Ya(t),...Za(t)],i=new TS(o,s),a=!0,l=[s],u=e.runWebGLProgram(i,[r],n.dtype,l,a);return{dataId:u.dataId,shape:t,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{shape:o}=s,i=e,a=st(r.shape),l=n1(o,a),u=st(l);A(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const h=i.texData.get(r.dataId);return h.isPacked&&!xf(r.shape,l)&&!(h.texture!==null&&xf(h.shape,l))?j6(r,l,i):(i.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const X6={kernelName:Xh,backendName:"webgl",kernelFunc:gt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WS{constructor(t,e){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=t;this.outputShape=[r,i];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(e!=null){const d=1/e;u=`sumValue += dot(values * ${ya(d)?d.toPrecision(2):d}, ones);`}let h="";o%s>0&&(h=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y6{constructor(t,e){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=t;this.outputShape=[r,i];let a="0.0",l="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",l="min"):e==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");const h=Math.floor(s/4)*4,d=s%4;let f=`
      if (${e==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${e==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${e==="min"} || ${e==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,m="vec4";e==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,m="bvec4"):e==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,m="bvec4");let g="";o%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${h};
        if (${d===1}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${d===2}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${d===3}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z6(n){const t=[];for(;t.length===0||t[t.length-1].outSize!==1;){const e=t.length?t[t.length-1].outSize:n[1],s=Ed(e);t.push({inSize:e,windowSize:s,outSize:Math.ceil(e/s)})}return t}function Zi(n,t,e,s){const r=Z6(n.shape);let o=n;for(let i=0;i<r.length;i++){const{inSize:a,windowSize:l,outSize:u}=r[i];let h,d;e==="mean"?h=i===0?new WS({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},a):new WS({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u}):h=new Y6({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},e),d=o,o=s.runWebGLProgram(h,[o],t),d.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(d)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J6{constructor(t,e){this.variableNames=["A"];const s=new Array(t.length);for(let i=0;i<s.length;i++)s[i]=t[e[i]];this.outputShape=s,this.rank=s.length;const r=ye(this.rank),o=Q6(e);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function Q6(n){const t=n.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(t);for(let r=0;r<n.length;r++)s[n[r]]=e[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tj{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(t.length);for(let h=0;h<s.length;h++)s[h]=t[e[h]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=ye(this.rank),o=NS("rc",this.rank),i=new Array(this.rank);for(let h=0;h<e.length;h++)i[e[h]]=o[h];const a=`vec2(${i.slice(-2).join()})`,l=`++${o[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vf(n,t,e){const s=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new tj(n.shape,t):new J6(n.shape,t);return e.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ej(n,t,e,s){const r=t,o=n.shape.length,i=Xt(r,n.shape);let a=i;const l=Be(a,o),u=l!=null;let h=n;u&&(h=vf(n,l,s),a=qe(a.length,o)),vn("sum",a,o);const[d,f]=dn(h.shape,a);let m=d;e&&(m=Je(d,i));const g=st(f),b=st(n.shape)/g,w=gt({inputs:{x:h},attrs:{shape:[b,g]},backend:s}),v=Ym(n.dtype),I=Zi(w,v,"sum",s),C=gt({inputs:{x:I},attrs:{shape:m},backend:s});return s.disposeIntermediateTensorInfo(w),s.disposeIntermediateTensorInfo(I),u&&s.disposeIntermediateTensorInfo(h),C}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cf(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o,keepDims:i}=s;return ej(r,o,i,e)}const nj={kernelName:ed,backendName:"webgl",kernelFunc:Cf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bn(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{perm:o}=s,i=e,a=r.shape.length,l=new Array(a);for(let h=0;h<l.length;h++)l[h]=r.shape[o[h]];let u;if(i.shouldExecuteOnCPU([r])){const d=i.texData.get(r.dataId).values,f=Eb(d,r.shape,r.dtype,o,l);u=i.makeTensorInfo(l,r.dtype);const m=i.texData.get(u.dataId);m.values=f}else u=vf(r,o,i);return u}const sj={kernelName:$a,backendName:"webgl",kernelFunc:Bn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VS=1e3;function If({a:n,b:t,transposeA:e,transposeB:s,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:l=null}){const u=n.shape.length,h=t.shape.length,d=e?n.shape[u-2]:n.shape[u-1],f=s?t.shape[h-1]:t.shape[h-2],m=e?n.shape[u-1]:n.shape[u-2],g=s?t.shape[h-2]:t.shape[h-1],x=n.shape.slice(0,-2),b=t.shape.slice(0,-2),w=st(x),v=st(b),C=Vt(n.shape.slice(0,-2),t.shape.slice(0,-2)).concat([m,g]);A(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${n.shape} and ${t.shape} and transposeA=${e} and transposeB=${s} must match.`);const k=e?[w,d,m]:[w,m,d],N=s?[v,g,f]:[v,f,g],T=gt({inputs:{x:n},backend:r,attrs:{shape:k}}),R=gt({inputs:{x:t},backend:r,attrs:{shape:N}}),E=[T,R],F=Math.max(w,v),P=e?T.shape[1]:T.shape[2],q=o!=null,j=i!=null,K=l==="leakyrelu",Y=l!=null?mc(l,!0):null,Q=q||j||K||Y!=null;let tt;if((m===1||g===1)&&P>VS&&Q===!1){let rt=T,ut=R;e&&(rt=Bn({inputs:{x:T},backend:r,attrs:{perm:[0,2,1]}}),E.push(rt)),s&&(ut=Bn({inputs:{x:R},backend:r,attrs:{perm:[0,2,1]}}),E.push(ut));const lt=g!==1,mt=g===1;let ft=rt;lt&&(ft=gt({inputs:{x:rt},backend:r,attrs:{shape:[F,P,1]}}),E.push(ft));const bt=g===1?2:1;let pt=ut;mt&&(pt=gt({inputs:{x:ut},backend:r,attrs:{shape:[F,1,P]}}),E.push(pt));const yt=Rb({inputs:{a:ft,b:pt},backend:r});tt=Cf({inputs:{x:yt},backend:r,attrs:{axis:bt,keepDims:!0}}),E.push(yt)}else{const rt=us(n.dtype,t.dtype),ut=new PS(k,N,[F,m,g],e,s,q,Y,j,K),lt=[T,R];if(o!=null&&lt.push(o),j&&lt.push(i),K){const mt=r.makeTensorInfo([],"float32",So(a,"float32"));lt.push(mt),E.push(mt)}tt=r.runWebGLProgram(ut,lt,rt)}const Z=gt({inputs:{x:tt},backend:r,attrs:{shape:C}});E.push(tt);for(const rt of E)r.disposeIntermediateTensorInfo(rt);return Z}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rj(n){const{inputs:t,backend:e,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:a}=t,{transposeA:l,transposeB:u,activation:h,leakyreluAlpha:d}=s;return If({a:r,b:o,transposeA:l,transposeB:u,backend:e,bias:i,preluActivationWeights:a,leakyreluAlpha:d,activation:h})}const oj={kernelName:ld,backendName:"webgl",kernelFunc:rj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const US="return abs(x);";function ij(n){const{inputs:t,backend:e}=n,{x:s}=t;if(e.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const o=e.texData.get(s.dataId),i=kS(o.values);return e.makeTensorInfo(s.shape,s.dtype,i)}let r;return J().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new jo(s.shape,US):r=new Br(s.shape,US),e.runWebGLProgram(r,[s],s.dtype)}const aj={kernelName:lh,backendName:"webgl",kernelFunc:ij};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lj=qs+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,uj=re({opSnippet:lj}),cj={kernelName:Rl,backendName:"webgl",kernelFunc:uj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hj=qs+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,dj=re({opSnippet:hj}),fj={kernelName:Al,backendName:"webgl",kernelFunc:dj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GS="return a + b;",pj=In({opSnippet:GS,packedOpSnippet:GS,supportsComplex:!0,cpuKernelImpl:$q}),mj={kernelName:Ia,backendName:"webgl",kernelFunc:pj};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gj{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`float v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xj{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`vec4 v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $f(n){const{inputs:t,backend:e}=n,s=t;if(s.length===1)return ds({inputs:{x:s[0]},backend:e});if(s.length>J().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=$f({inputs:s.slice(0,l),backend:e}),h=$f({inputs:s.slice(l),backend:e});return $f({inputs:[u,h],backend:e})}const r=s.map(l=>l.dtype).reduce((l,u)=>us(l,u)),o=s.map(l=>l.shape),a=J().getBool("WEBGL_PACK")?new xj(s[0].shape,o):new gj(s[0].shape,o);return e.runWebGLProgram(a,s,r)}const bj={kernelName:Jp,backendName:"webgl",kernelFunc:$f};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yj(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o,keepDims:i}=s,a=r.shape.length,l=Xt(o,r.shape);let u=l;const h=Be(u,a);let d=r;h!=null&&(d=Bn({inputs:{x:r},backend:e,attrs:{perm:h}}),u=qe(u.length,a)),vn("all",u,a);const[f,m]=dn(d.shape,u),g=st(m),x=gt({inputs:{x:d},backend:e,attrs:{shape:[-1,g]}}),b=Zi(x,x.dtype,"all",e);let w;if(i){const v=Je(f,l);w=gt({inputs:{x:b},backend:e,attrs:{shape:v}})}else w=gt({inputs:{x:b},backend:e,attrs:{shape:f}});return e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b),h!=null&&e.disposeIntermediateTensorInfo(d),w}const wj={kernelName:Qp,backendName:"webgl",kernelFunc:yj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vj(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o,keepDims:i}=s,a=r.shape.length,l=Xt(o,r.shape);let u=l;const h=Be(u,a);let d=r;h!=null&&(d=Bn({inputs:{x:r},backend:e,attrs:{perm:h}}),u=qe(u.length,a)),vn("any",u,a);const[f,m]=dn(d.shape,u),g=st(m),x=gt({inputs:{x:d},backend:e,attrs:{shape:[-1,g]}}),b=Zi(x,x.dtype,"any",e);let w;if(i){const v=Je(f,l);w=gt({inputs:{x:b},backend:e,attrs:{shape:v}})}else w=gt({inputs:{x:b},backend:e,attrs:{shape:f}});return e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b),h!=null&&e.disposeIntermediateTensorInfo(d),w}const Cj={kernelName:tm,backendName:"webgl",kernelFunc:vj};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ij{constructor(t,e,s){this.variableNames=["A"];const{windowSize:r,batchSize:o,outSize:i}=t;s||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];const a=e==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $j{constructor(t,e,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,A(t.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const o=t[t.length-1],i=Math.ceil(o/e);this.outputShape=t.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=ye(l),h=Mn("coords",l);let d,f;if(i===1){f=l+1;const R=ye(f);d=`
        ${R} sourceLocR = ${R}(${h.join()}, 0);
        ++${h[l-1]};
        ${R} sourceLocG = ${R}(${h.join()}, 0);
        ++${h[l-2]};
        ${R} sourceLocA = ${R}(${h.join()}, 0);
        --${h[l-1]};
        ${R} sourceLocB = ${R}(${h.join()}, 0);
        --${h[l-2]};`}else f=l,d=`
        ${u} sourceLocR = coords;
        ++${h[l-1]};
        ${u} sourceLocG = coords;
        ++${h[l-2]};
        ${u} sourceLocA = coords;
        --${h[l-1]};
        ${u} sourceLocB = coords;
        --${h[l-2]};`;const m=["x","y","z","w","u","v"].slice(0,f),g="."+m[f-1],x=m.map(R=>"int "+R),b=Mn("sourceLocR",f-1).concat("inIdx.r"),w=Mn("sourceLocG",f-1).concat("inIdx.g"),v=Mn("sourceLocB",f-1).concat("inIdx.b"),I=Mn("sourceLocA",f-1).concat("inIdx.a"),C=s==="max"?"greaterThan":"lessThan",k=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${I.join()})));`,N=`vec4(
            getAChannel(${b.join()}),
            hasNextCol ? getAChannel(${w.join()}) : 0.,
            hasNextRow ? getAChannel(${v.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${I.join()}) : 0.)`,T=r?"":`
      float getBestIndicesAChannel(${x.join()}) {
        return getChannel(getBestIndicesA(${m.join()}),
                                          vec2(${m.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${x.join()}) {
        return getChannel(getA(${m.join()}),
                               vec2(${m.slice(-2).join()}));
      }
      ${T}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${h[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${h[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${g}, sourceLocG${g},
          sourceLocB${g}, sourceLocA${g}) * ${e};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${N};

        for (int i = 0; i < ${e}; i++) {
          inIdx = srcIdx;
          ${k}
          vec4 candidate = ${N};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${C}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HS(n,t,e,s=null){let r=t.shape[0],o=t.shape[1];s!=null&&(r=s.shape[0],o=s.shape[1]);const i=Ed(o),a={windowSize:i,inSize:o,batchSize:r,outSize:Math.ceil(o/i)},l=new Ij(a,e,s==null),u=[t];s!=null&&u.push(s);const h=n.runWebGLProgram(l,u,"int32");if(h.shape[1]===1)return h;const d=HS(n,t,e,h);return n.disposeIntermediateTensorInfo(h),d}function KS(n,t,e,s=null){const r=s!=null?s.shape:t.shape,o=r[r.length-1],i=Ed(o),a=new $j(r,i,e,s==null),l=s==null?[t]:[t,s],u=n.runWebGLProgram(a,l,"int32");if(u.shape.length===t.shape.length){const h=KS(n,t,e,u);return n.disposeIntermediateTensorInfo(u),h}return u}function qS(n,t,e,s){const r=[e];if(vn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,t.shape.length),!J().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const o=[],i=n.texData.get(t.dataId),a=i!==null&&i.isPacked;let l=t;a&&(l=n.unpackTensor(t),o.push(l));const[u,h]=dn(l.shape,r),d=st(h),f=gt({inputs:{x:l},backend:n,attrs:{shape:[-1,d]}});o.push(f);const m=HS(n,f,s);o.push(m);const g=gt({inputs:{x:m},backend:n,attrs:{shape:u}});return o.forEach(x=>n.disposeIntermediateTensorInfo(x)),g}return KS(n,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kj(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o}=s;let i=Xt(o,r.shape);const a=Be(i,r.shape.length);let l=r;const u=[];a!=null&&(l=Bn({inputs:{x:r},backend:e,attrs:{perm:a}}),u.push(l),i=qe(i.length,l.shape.length)),vn("argMax",[i[0]],l.shape.length);const h=qS(e,l,i[0],"max");return u.forEach(d=>e.disposeIntermediateTensorInfo(d)),h}const Sj={kernelName:uh,backendName:"webgl",kernelFunc:kj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nj(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o}=s;let i=Xt(o,r.shape);const a=Be(i,r.shape.length);let l=r;const u=[];a!=null&&(l=Bn({inputs:{x:r},backend:e,attrs:{perm:a}}),u.push(l),i=qe(i.length,l.shape.length)),vn("argMin",[i[0]],l.shape.length);const h=qS(e,l,i[0],"min");return u.forEach(d=>e.disposeIntermediateTensorInfo(d)),h}const Tj={kernelName:ch,backendName:"webgl",kernelFunc:Nj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ej=qs+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,_j=re({opSnippet:Ej}),Rj={kernelName:Dl,backendName:"webgl",kernelFunc:_j};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aj=qs+"return log(x + sqrt(x * x + 1.0));",Dj=re({opSnippet:Aj}),Fj={kernelName:Fl,backendName:"webgl",kernelFunc:Dj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oj=qs+`
  return atan(x);
`,Lj=re({opSnippet:Oj}),Pj={kernelName:Ol,backendName:"webgl",kernelFunc:Lj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mj=_b+`
  return atan(a, b);
`,Bj=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Yi+`
  return result;
`,zj=In({opSnippet:Mj,packedOpSnippet:Bj}),Wj={kernelName:Pl,backendName:"webgl",kernelFunc:zj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vj=qs+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Uj=re({opSnippet:Vj}),Gj={kernelName:Ll,backendName:"webgl",kernelFunc:Uj};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gc{constructor(t,e,s,r=!1,o=!1){if(this.variableNames=["x"],e==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=t.filterWidth,a=t.strideHeight,l=t.strideWidth,u=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,m=t.padInfo.top,g=t.padInfo.left;this.outputShape=t.outShape;const x=e==="avg",b=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,w=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let v="0.0";if(x||(v="-1.0 / 1e-20"),s){const R=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${m}, ${g});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${h}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${R} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?o?b:w:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const I="max";let C=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(C="avgValue / max(count, 1.0)");const k=Math.floor(i/4)*4,N=i%4,T=`
      if (${x}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${I}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${m}, ${g});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${k}; wC += 4) {
            int xC = xCCorner + wC * ${h};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              getValue(batch, xR, xC + 3 * ${h}, d)
            );

            ${T}
          }

          int xC = xCCorner + ${k};
          if (${N===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${T}
          } else if (${N===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              initializationValue,
              initializationValue
            );

            ${T}
          } else if (${N===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              initializationValue
            );

            ${T}
          }
        }
        setOutput(${C});
      }
    `}}class Ab{constructor(t,e,s,r=!1,o=!1){if(this.variableNames=["x"],e==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=t.filterWidth,a=t.strideDepth,l=t.strideHeight,u=t.strideWidth,h=t.dilationDepth,d=t.dilationHeight,f=t.dilationWidth,m=t.effectiveFilterDepth,g=t.effectiveFilterHeight,x=t.effectiveFilterWidth,b=t.padInfo.front,w=t.padInfo.top,v=t.padInfo.left;this.outputShape=t.outShape;const I=e==="avg";let C="0.0";if(I||(C="-1.0 / 1e-20"),s){const F=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${b}, ${w}, ${v});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${m};
              wD += ${h}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${t.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${g};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${x};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${F} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?o?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${g} * ${x} +
                      wR * ${x} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const k="max";let N=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(N="avgValue / max(count, 1.0)");const T=Math.floor(i/4)*4,R=i%4,E=`
      if (${I}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${k}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${b}, ${w}, ${v});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${m};
            wD += ${h}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${g};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${T}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${E}
            }

            int xC = xCCorner + ${T};
            if (${R===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${E}
            } else if (${R===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${E}
            } else if (${R===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${E}
            }
          }
        }
        setOutput(${N});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hj(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t;fc(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;A(Tn(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const h=Ps(r.shape,o,i,u,a,l);if(h.filterWidth===1&&h.filterHeight===1&&he(h.inShape,h.outShape))return ds({inputs:{x:r},backend:e});const d=new gc(h,"avg",!1);return e.runWebGLProgram(d,[r],"float32")}const Kj={kernelName:hh,backendName:"webgl",kernelFunc:Hj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qj(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s,h=[1,1,1],d=Xr(r.shape,o,i,h,a,l,u),f=new Ab(d,"avg",!1);return e.runWebGLProgram(f,[r],"float32")}const jj={kernelName:dh,backendName:"webgl",kernelFunc:qj};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xj{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterHeight,s=t.filterWidth,r=t.strideHeight,o=t.strideWidth,i=t.dilationHeight,a=t.dilationWidth,l=t.effectiveFilterHeight,u=t.effectiveFilterWidth,h=l-1-t.padInfo.top,d=u-1-t.padInfo.left,f=1/(e*s);this.userCode=`
      const ivec2 pads = ivec2(${h}, ${d});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Yj{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterDepth,s=t.filterHeight,r=t.filterWidth,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,l=t.dilationDepth,u=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterDepth,f=t.effectiveFilterHeight,m=t.effectiveFilterWidth,g=d-1-t.padInfo.front,x=f-1-t.padInfo.top,b=m-1-t.padInfo.left,w=1/(e*s*r);this.userCode=`
      const ivec3 pads = ivec3(${g}, ${x}, ${b});
      const float avgMultiplier = float(${w});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${m};
                wC += ${h}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zj(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:o}=t,i=o,{filterSize:a,strides:l,pad:u,dimRoundingMode:h}=s,d=[1,1,1],f=Xr(i.shape,a,l,d,u,h),m=new Yj(f);return e.runWebGLProgram(m,[r],i.dtype)}const Jj={kernelName:nm,backendName:"webgl",kernelFunc:Zj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qj(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:o}=t,i=o;fc([r,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,h=Ps(i.shape,a,l,1,u),d=new Xj(h);return e.runWebGLProgram(d,[r],i.dtype)}const tX={kernelName:em,backendName:"webgl",kernelFunc:Qj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eX(n){const{inputs:t,backend:e,attrs:s}=n,{a:r,b:o}=t,{transposeA:i,transposeB:a}=s;return If({a:r,b:o,transposeA:i,transposeB:a,backend:e})}const nX={kernelName:fh,backendName:"webgl",kernelFunc:eX};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sX{constructor(t,e,s,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Vt(t,e),Vt(t,s);let a="0.0";r!=null&&(Vt(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";o!=null&&(Vt(t,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rX{constructor(t,e,s,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Vt(t,e),Vt(t,s);let a="vec4(0.0)";r!=null&&(Vt(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";o!=null&&(Vt(t,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oX={kernelName:kh,backendName:"webgl",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,mean:r,variance:o,offset:i,scale:a}=n;A(r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A(i==null||r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=e;l==null&&(l=.001);const u=[s,r,o];let h=null;i!=null&&(h=i.shape,u.push(i));let d=null;a!=null&&(d=a.shape,u.push(a));const f=J().getBool("WEBGL_PACK_NORMALIZATION")?new rX(s.shape,r.shape,o.shape,h,d,l):new sX(s.shape,r.shape,o.shape,h,d,l);return t.runWebGLProgram(f,u,u[0].dtype)}};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iX{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const e=ye(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=aX(this.rank);let r;const o=t.map((i,a)=>`sourceLoc.${Db[a]} = start[${a}] + coords.${Db[a]};`);r=`
        ${e} sourceLoc;
        ${e} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const Db=["x","y","z","w","u","v"];function aX(n){if(n===1)return"sourceLoc";if(n<=6)return Db.slice(0,n).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lX{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const e=ye(this.rank),s=Mn("coords",this.rank),r=Mn("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,i=`getChannel(getSource(${r.join()}), ${o})`,a=`
      result.x = ${i};
      if (++${s[this.rank-1]} < ${t[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${i};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${t[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${i};
        if (++${s[this.rank-1]} < ${t[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${i};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${e}(${t.map((h,d)=>`start[${d}]`).join()});`:t.map((h,d)=>`${r[d]} = ${s[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${e} coords = getOutputCoords();
        ${e} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uX(n,t,e,s){const r=s.texData.get(n.dataId),o=s.makeTensorInfo(e,n.dtype),i=s.texData.get(o.dataId);Object.assign(i,r),i.refCount=1,i.shape=e,i.dtype=n.dtype;let a=Jg(t,_t(n.shape));r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const l=s.dataRefCount.get(i.slice.origDataId)||1;return s.dataRefCount.set(i.slice.origDataId,l+1),o}function rl(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{begin:o,size:i}=s,[a,l]=Td(r,o,i);if(Xg(r,a,l),st(l)===0)return e.makeTensorInfo(l,r.dtype,[]);if(e.shouldExecuteOnCPU([r])||r.dtype==="string"){const d=e.texData.get(r.dataId),f=n6(d.values,a,l,r.shape,r.dtype);return e.makeTensorInfo(l,r.dtype,f)}const{isPacked:u}=e.texData.get(r.dataId),h=Zg(r.shape,a,l);if(u||!h){const d=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lX(l):new iX(l),f=[a];return e.runWebGLProgram(d,[r],r.dtype,f)}return e.uploadToGPU(r.dataId),uX(r,a,l,e)}const cX={kernelName:td,backendName:"webgl",kernelFunc:rl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hX={kernelName:ph,backendName:"webgl",kernelFunc:n=>{const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockShape:o,crops:i}=s;A(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((v,I)=>v*I),l=Uu(r.shape,o,a),u=Gu(l.length,o.length),h=Hu(r.shape,o,a),d=sx(i,o.length),f=rx(h,i,o.length),m=[],g=gt({inputs:{x:r},backend:e,attrs:{shape:l}}),x=Bn({inputs:{x:g},backend:e,attrs:{perm:u}}),b=gt({inputs:{x},backend:e,attrs:{shape:h}}),w=rl({inputs:{x:b},backend:e,attrs:{begin:d,size:f}});return m.push(g),m.push(x),m.push(b),m.forEach(v=>e.disposeIntermediateTensorInfo(v)),w}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dX(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,weights:o}=t,{size:i}=s,a=e.readSync(r.dataId),l=e.readSync(o.dataId),u=$S(a,l,o.dtype,o.shape,i);return e.makeTensorInfo([i],o.dtype,u)}const fX={kernelName:sm,backendName:"webgl",kernelFunc:dX};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pX=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,mX=`
  return float(int(a.r) & int(b.r));
`;function gX(n){const{inputs:t,backend:e}=n,{a:s,b:r}=t,o=J().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=J().getNumber("WEBGL_VERSION");if(e.shouldExecuteOnCPU([s,r])||i===1){const l=e.texData.get(s.dataId).values,u=e.texData.get(r.dataId).values,[h,d]=Sq(s.shape,r.shape,l,u,s.dtype),f=e.makeTensorInfo(d,s.dtype),m=e.texData.get(f.dataId);return m.values=h,f}let a;return o?a=new nl(pX,s.shape,r.shape,!1):a=new Xi(mX,s.shape,r.shape),e.runWebGLProgram(a,[s,r],s.dtype)}const xX={kernelName:rm,backendName:"webgl",kernelFunc:gX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bX(n){const{inputs:t,backend:e}=n,{s0:s,s1:r}=t,o=e.readSync(s.dataId),i=e.readSync(r.dataId),a=Vt(Array.from(o),Array.from(i));return e.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const yX={kernelName:u1,backendName:"webgl",kernelFunc:bX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jS=In({opSnippet:"return float(a != b);",cpuKernelImpl:qq,dtype:"bool"}),wX={kernelName:Vh,backendName:"webgl",kernelFunc:jS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xc(n){const{inputs:t,backend:e}=n,{input:s}=t,r=e.texData.get(s.dataId);return ds({inputs:{x:r.complexTensorInfos.real},backend:e})}const vX={kernelName:Rm,backendName:"webgl",kernelFunc:xc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CX="return float(int(x));";function IX(n,t){const e=new Br(n.shape,CX),s=t.runWebGLProgram(e,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fb(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return ds({inputs:{x:r},backend:e});const i=fn(r.shape),a=Fb({inputs:{x:r},backend:e,attrs:{dtype:"float32"}}),l=Xo({inputs:{real:a,imag:i},backend:e});return i.dispose(),e.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const i=xc({inputs:{input:r},backend:e}),a=Fb({inputs:{x:i},backend:e,attrs:{dtype:o}});return e.disposeIntermediateTensorInfo(i),a}if(!s1(r.dtype,o)){const i=ds({inputs:{x:r},backend:e});return{dataId:i.dataId,shape:i.shape,dtype:o}}if(e.shouldExecuteOnCPU([r])){const i=e.texData.get(r.dataId).values,[a,l,u]=Nq(i,r.shape,r.dtype,o);return e.makeTensorInfo(a,l,u)}if(o==="int32")return IX(r,e);if(o==="bool"){const i=e.makeTensorInfo([],"bool",kn("bool",1)),l=jS({inputs:{a:r,b:i},backend:e});return e.disposeIntermediateTensorInfo(i),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const $X={kernelName:Ml,backendName:"webgl",kernelFunc:Fb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XS="return ceil(x);",kX=re({opSnippet:XS,packedOpSnippet:XS,cpuKernelImpl:Tq}),SX={kernelName:Bl,backendName:"webgl",kernelFunc:kX};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NX{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TX{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EX(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{clipValueMin:o,clipValueMax:i}=s;let a;J().getBool("WEBGL_PACK_CLIP")?a=new TX(r.shape):a=new NX(r.shape);const l=[[o],[i]];return e.runWebGLProgram(a,[r],r.dtype,l)}const _X={kernelName:zl,backendName:"webgl",kernelFunc:EX};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RX{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YS(n,t){return{dataId:t.dataId,dtype:t.dtype,shape:n.shape}}function AX(n){const{inputs:t,backend:e}=n,{x:s}=t,r=e.texData.get(s.dataId),o=new RX(s.shape),i=[YS(s,r.complexTensorInfos.real),YS(s,r.complexTensorInfos.imag)];return e.runWebGLProgram(o,i,i[0].dtype)}const DX={kernelName:mh,backendName:"webgl",kernelFunc:AX};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FX{constructor(t){this.outputShape=[],this.outputShape=_r(t,1),this.variableNames=t.map((i,a)=>`T${a}`);const e=new Array(t.length-1);e[0]=t[0][1];for(let i=1;i<e.length;i++)e[i]=e[i-1]+t[i][1];const s=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<e.length;i++){const a=e[i-1];s.push(`else if (yC < ${e[i]}) setOutput(getT${i}(yR, yC-${a}));`)}const r=e.length,o=e[e.length-1];s.push(`else setOutput(getT${r}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OX{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=_r(t,e);const s=this.outputShape,r=s.length,o=ye(r),i=Mn("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map((x,b)=>`T${b}`);const l=new Array(t.length-1);l[0]=t[0][e];for(let x=1;x<l.length;x++)l[x]=l[x-1]+t[x][e];const u=a[e],h=a.slice(-2),d=a.join();let f=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${h.join()}));
        }`;for(let x=1;x<l.length;x++){const b=l[x-1];f+=`
        if (${u} < ${l[x]}  && ${u} >= ${l[x-1]}) {
          return getChannel(
            getT${x}(${kf(a,u,b)}),
            vec2(${kf(h,u,b)}));
        }`}const m=l.length,g=l[l.length-1];f+=`
        return getChannel(
          getT${m}(${kf(a,u,g)}),
          vec2(${kf(h,u,g)}));`,this.userCode=`
      float getValue(${a.map(x=>"int "+x)}) {
        ${f}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[r-1]} = ${i[r-1]} + 1;
        if (${i[r-1]} < ${s[r-1]}) {
          result.g = getValue(${i});
        }

        ${i[r-2]} = ${i[r-2]} + 1;
        if (${i[r-2]} < ${s[r-2]}) {
          result.a = getValue(${i});
        }

        ${i[r-1]} = ${i[r-1]} - 1;
        if (${i[r-2]} < ${s[r-2]} &&
            ${i[r-1]} < ${s[r-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function kf(n,t,e){const s=n.indexOf(t);return n.map((o,i)=>i===s?`${o} - ${e}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sf(n){const{inputs:t,backend:e}=n,{input:s}=t,r=e.texData.get(s.dataId);return ds({inputs:{x:r.complexTensorInfos.imag},backend:e})}const LX={kernelName:Im,backendName:"webgl",kernelFunc:Sf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bc(n,t,e){const s=n[0].dtype;if(s==="complex64"){const m=n.map(v=>xc({inputs:{input:v},backend:e})),g=n.map(v=>Sf({inputs:{input:v},backend:e})),x=bc(m,t,e),b=bc(g,t,e),w=Xo({inputs:{real:x,imag:b},backend:e});return m.forEach(v=>e.disposeIntermediateTensorInfo(v)),g.forEach(v=>e.disposeIntermediateTensorInfo(v)),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b),w}let r=e.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const m=n.map(C=>{const N=[-1,st(C.shape.slice(t))];return gt({inputs:{x:C},backend:e,attrs:{shape:N}})}),g=m.map(C=>({vals:e.readSync(C.dataId),shape:C.shape})),x=_r(m.map(C=>C.shape),1),b=m[0].shape[0]===1,w=Eq(g,x,s,b),v=_r(n.map(C=>C.shape),t),I=e.makeTensorInfo(v,s,w);return m.forEach(C=>e.disposeIntermediateTensorInfo(C)),I}const o=n.filter(m=>st(m.shape)>0),i=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const m=i?new Br(n[0].shape,qo):new jo(n[0].shape,qo);return e.runWebGLProgram(m,n,s)}const a=J().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>a){const m=[];for(let x=0;x<o.length;x+=a){const b=o.slice(x,x+a);m.push(bc(b,t,e))}const g=bc(m,t,e);for(const x of m)e.disposeIntermediateTensorInfo(x);return g}if(i){const m=new OX(o.map(g=>g.shape),t);return e.runWebGLProgram(m,o,s)}const{tensors2D:l,outShape:u}=PX(o,t,e),h=new FX(l.map(m=>m.shape)),d=e.runWebGLProgram(h,l,s);l.forEach(m=>e.disposeIntermediateTensorInfo(m));const f=gt({inputs:{x:d},attrs:{shape:u},backend:e});return e.disposeIntermediateTensorInfo(d),f}function PX(n,t,e){const s=_r(n.map(o=>o.shape),t);return{tensors2D:n.map(o=>gt({inputs:{x:o},attrs:{shape:[-1,st(o.shape.slice(t))]},backend:e})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZS(n){const{inputs:t,backend:e,attrs:s}=n,{axis:r}=s,o=Xt(r,t[0].shape)[0],i=t.map(u=>u.shape);tx(i,o);const a=_r(t.map(u=>u.shape),o);if(st(a)===0)return e.makeTensorInfo(a,t[0].dtype,[]);const l=t.filter(u=>st(u.shape)>0);return l.length===1?ds({inputs:{x:l[0]},backend:e}):bc(l,o,e)}const MX={kernelName:gh,backendName:"webgl",kernelFunc:ZS};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JS{constructor(t,e=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const i=t.padInfo.top,a=t.padInfo.left,l=t.strideHeight,u=t.strideWidth,h=t.dilationHeight,d=t.dilationWidth,f=t.filterHeight,m=t.filterWidth,g=Math.floor(t.inChannels/4)*4,x=t.inChannels%4,b=t.dataFormat==="channelsLast",w=b?1:2,v=b?2:3,I=b?3:1;let C="",k="";s&&(r?C=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?C=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:C=`
          float activation(float x) {
            ${s}
          }
        `,k="result = activation(result);");const N=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${C}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${I}];

        ivec2 xRCCorner =
            ivec2(coords[${w}], coords[${v}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${h};

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${m}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${t.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${g}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${b}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${x===1}) {

              if (${b}) {
                dotProd +=
                    getX(batch, xR, xC, ${g}) *
                    getW(wR, wC, ${g}, d2);
              } else {
                dotProd +=
                    getX(batch, ${g}, xR, xC) *
                    getW(wR, wC, ${g}, d2);
              }

            } else if (${x===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${g}, d2),
                getW(wR, wC, ${g} + 1, d2)
              );

              if (${b}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${g}),
                  getX(batch, xR, xC, ${g} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${g}, xR, xC),
                  getX(batch, ${g} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${x===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${g}, d2),
                getW(wR, wC, ${g} + 1, d2),
                getW(wR, wC, ${g} + 2, d2)
              );

              if (${b}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${g}),
                  getX(batch, xR, xC, ${g} + 1),
                  getX(batch, xR, xC, ${g} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${g}, xR, xC),
                  getX(batch, ${g} + 1, xR, xC),
                  getX(batch, ${g} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${N}
        ${k}
        setOutput(result);
      }
    `}}class BX{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const e=t.padInfo.front,s=t.padInfo.top,r=t.padInfo.left,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,l=t.dilationDepth,u=t.dilationHeight,h=t.dilationWidth,d=t.filterDepth,f=t.filterHeight,m=t.filterWidth,g=Math.floor(t.inChannels/4)*4,x=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${i}, ${a});
      const ivec3 pads = ivec3(${e}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${m}; wC++) {
              int xC = xCCorner + wC * ${h};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${g}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${x===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${g}) *
                  getW(wF, wR, wC, ${g}, d2);
              } else if (${x===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${g}),
                  getX(batch, xF, xR, xC, ${g} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${g}, d2),
                  getW(wF, wR, wC, ${g} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${x===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${g}),
                  getX(batch, xF, xR, xC, ${g} + 1),
                  getX(batch, xF, xR, xC, ${g} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${g}, d2),
                  getW(wF, wR, wC, ${g} + 1, d2),
                  getW(wF, wR, wC, ${g} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QS{constructor(t,e=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=En(this.outputShape.length);const i=t.padInfo.left,a=t.strideWidth,l=t.dilationWidth,u=t.filterHeight,h=t.filterWidth,d=h;let f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let b=0;b<h;b++)f+=`
           vec4 xTexelC${b*2};
           int xTexelC${b*2}Ready;
           vec4 xTexelC${b*2+1};
           int xTexelC${b*2+1}Ready;
           vec4 xC${b};`;f+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {
       `;for(let b=0;b<h;b++)f+=`
           xTexelC${b*2} = vec4(0.0);
           xTexelC${b*2}Ready = 0;
           xTexelC${b*2+1} = vec4(0.0);
           xTexelC${b*2+1}Ready = 0;
           xC${b} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let b=0;b<(d+1)/2;b++){const w=b*2;if(f+=`
           xC = xCCorner + ${w*l};
           `,a===1){if(w<h&&(i%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                   xTexelC${w} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${w}.zw = vec2(0.0);
                   }
                   xTexelC${w}Ready = 1;
                 }
               `,l===1&&w>0?f+=`
                 xC${w} = vec4(xTexelC${w-2}.zw, xTexelC${w}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${w} = vec4(previous.zw, xTexelC${w}.xy);
                   } else {
                     xC${w} = vec4(0.0, 0.0, xTexelC${w}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                   xTexelC${w} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${w}.zw = vec2(0.0);
                   }
                   xTexelC${w}Ready = 1;
                 }

                 xC${w} = xTexelC${w};
                 `,w+1<h)){const v=i%2===0?Hp(l):l;l%2===0&&i%2===1||l%2!==0&&i%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${v};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                     xTexelC${w+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${w+1}.zw = vec2(0.0);
                     }
                     xTexelC${w+1}Ready = 1;
                   }
                   `,l>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${w+1} = vec4(previous.zw, xTexelC${w+1}.xy);
                     } else {
                      xC${w+1} = vec4(0.0, 0.0, xTexelC${w+1}.xy);
                     }
                     `:f+=`
                     xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.xy);
                     `):v===1?f+=`
                     xC${w+1} = xTexelC${w};
                     `:f+=`
                     xCOffset = xC + ${v};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                       xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${w+1}.zw = vec2(0.0);
                       }
                       xTexelC${w+1}Ready = 1;
                     }

                     xC${w+1} = xTexelC${w+1};
                     `}}else w<h&&(i%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                   xTexelC${w} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${w}.zw = vec2(0.0);
                   }
                   xTexelC${w}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${w+1}Ready == 0) {
                   xTexelC${w+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${w+1}.zw = vec2(0.0);
                   }
                   xTexelC${w+1}Ready = 1;
                 }

                 xC${w} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
               `,w+1<h&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${w+1} = vec4(xTexelC${w+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                   xTexelC${w} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${w}.zw = vec2(0.0);
                   }
                   xTexelC${w}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                   xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${w+1}.zw = vec2(0.);
                   }
                   xTexelC${w+1}Ready = 1;
                 }

                 xC${w} = vec4(
                   xTexelC${w}.xy, xTexelC${w+1}.xy);
               `,w+1<h&&(f+=`
                   xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
                 `)));w<h&&(f+=`
             wTexel = getW(r, ${w}, d1, d2);
             dotProd += xC${w}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${t.inChannels}) {
               dotProd += xC${w}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,w+1<h&&(f+=`
               wTexel = getW(r, ${w+1}, d1, d2);
               dotProd += xC${w+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${t.inChannels}) {
                 dotProd += xC${w+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let m="",g="";s&&(r?m=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:o?m=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:m=`vec4 activation(vec4 x) {
           ${s}
         }`,g="result = activation(result);");const x=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${m}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${x}
         ${g}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zX{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=En(this.outputShape.length);const{dataFormat:s}=e,r=Pn(),o=s==="channelsLast",i=o?1:2,a=o?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`;let u="";for(let h=0;h<=1;h++)for(let d=0;d<=1;d++)u+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${h};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${h*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${h*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nf(n,t){const e=n.length;return e>=3?t?[...n.slice(0,-3),n[e-3]*n[e-2],n[e-1]]:[...n.slice(0,-3),n[e-3],n[e-2]*n[e-1]]:!t&&e===1&&n[0]>1?[n[0],1]:null}function t2({x:n,filter:t,convInfo:e,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const l=n.shape,u=s.texData.get(n.dataId),h=e.inChannels,d=l[0]*l[1]*l[2],f=e.outChannels,m=e.dataFormat==="channelsLast",g=!1,x=!1;let b;const w=[];if(o!=null){const C=Nf(o.shape,m);C!=null&&(o=gt({inputs:{x:o},backend:s,attrs:{shape:C}}),w.push(o))}if(r!=null){const C=Nf(r.shape,m);C!=null&&(r=gt({inputs:{x:r},backend:s,attrs:{shape:C}}),w.push(r))}if(!((d===1||f===1)&&h>VS)&&u.isPacked&&m&&u.texture!=null&&l[2]%2!==0&&he(u.shape.slice(-3),l.slice(-3))){const C=l[0]*l[1]*(l[2]+1),k={dataId:n.dataId,shape:[1,C,e.inChannels],dtype:n.dtype},N=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,A(xf(u.shape,k.shape),()=>`packed reshape ${u.shape} to ${k.shape} isn't free`);const T=gt({inputs:{x:t},backend:s,attrs:{shape:[1,e.inChannels,e.outChannels]}});w.push(T);const R=If({a:k,b:T,backend:s,transposeA:g,transposeB:x,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),E=s.texData.get(R.dataId);A(E.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=N,E.shape=e.outShape,b=ds({inputs:{x:R},backend:s}),b.shape=e.outShape,w.push(R)}else{const C=e.outHeight*e.outWidth,k=gt({inputs:{x:n},backend:s,attrs:{shape:m?[e.batchSize,C,e.inChannels]:[e.batchSize,e.inChannels,C]}}),N=gt({inputs:{x:t},backend:s,attrs:{shape:[1,e.inChannels,e.outChannels]}}),T=If({a:m?k:N,b:m?N:k,transposeA:!m,transposeB:x,backend:s,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i});b=gt({inputs:{x:T},backend:s,attrs:{shape:e.outShape}}),w.push(k),w.push(N),w.push(T)}for(const C of w)s.disposeIntermediateTensorInfo(C);return b}function e2({x:n,filter:t,convInfo:e,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:h,outWidth:d,outHeight:f,dataFormat:m}=e,g=m==="channelsLast",x=l*u*h,b=f*d,w=[e.batchSize,x,b],v=!0,I=!1,C=[];if(o!=null){const Z=Nf(o.shape,g);Z!=null&&(o=gt({inputs:{x:o},backend:s,attrs:{shape:Z}}),C.push(o))}if(r!=null){const Z=Nf(r.shape,g);Z!=null&&(r=gt({inputs:{x:r},backend:s,attrs:{shape:Z}}),C.push(r))}const k=gt({inputs:{x:t},backend:s,attrs:{shape:[1,x,st(t.shape)/x]}});C.push(k);const N=new zX(w,e),T=[n.shape,[e.padInfo.top,e.padInfo.left],[e.strideHeight,e.strideWidth],[e.dilationHeight,e.dilationWidth],[e.inChannels],[e.filterWidth*e.inChannels],[e.outWidth]],R=s.runWebGLProgram(N,[n],"float32",T),E=gt({inputs:{x:R},backend:s,attrs:{shape:w}});C.push(R),C.push(E);const F=r!=null,P=o!=null,q=a==="leakyrelu",j=a?mc(a,!0):null,K=new PS(g?E.shape:k.shape,g?k.shape:E.shape,g?[e.batchSize,b,e.outChannels]:[e.batchSize,e.outChannels,b],v,I,F,j,P,q),Y=g?[E,k]:[k,E];if(r&&Y.push(r),P&&Y.push(o),q){const Z=s.makeTensorInfo([],"float32",So(i,"float32"));Y.push(Z),C.push(Z)}const Q=s.runWebGLProgram(K,Y,"float32"),tt=gt({inputs:{x:Q},backend:s,attrs:{shape:e.outShape}});C.push(Q);for(const Z of C)s.disposeIntermediateTensorInfo(Z);return tt}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WX(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:o}=t,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:h}=s,d=Yr(l),f=wn(r.shape,o.shape,i,u,a,h,!1,d);let m;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))m=t2({x:r,filter:o,convInfo:f,backend:e});else if(f.strideWidth<=2&&d==="channelsLast"&&J().getBool("WEBGL_EXP_CONV")){const x=new QS(f),b=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];m=e.runWebGLProgram(x,[r,o],"float32",b)}else if(J().getBool("WEBGL_CONV_IM2COL"))m=e2({x:r,filter:o,convInfo:f,backend:e});else{const x=new JS(f);m=e.runWebGLProgram(x,[r,o],"float32")}const g=gt({inputs:{x:m},backend:e,attrs:{shape:f.outShape}});return e.disposeIntermediateTensorInfo(m),g}const VX={kernelName:xh,backendName:"webgl",kernelFunc:WX};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UX{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,s=t.strideWidth,r=t.padInfo.top,o=t.padInfo.left,i=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${r};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class GX{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,s=t.filterWidth,r=t.strideHeight,o=t.strideWidth,i=t.dataFormat==="channelsLast",a=e-1-t.padInfo.top,l=s-1-t.padInfo.left,u=i?1:2,h=i?2:3,d=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${h}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class HX{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideDepth,s=t.strideHeight,r=t.strideWidth,o=t.padInfo.front,i=t.padInfo.top,a=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yF = 0; yF < ${t.outDepth}; yF++) {
            int xF = wF + yF * ${e} - ${o};

            if (xF < 0 || xF >= ${t.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${t.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${i};

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${t.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class KX{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterDepth,s=t.filterHeight,r=t.filterWidth,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,l=e-1-t.padInfo.front,u=s-1-t.padInfo.top,h=r-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${e}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${e} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qX(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:o}=t,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:h}=s,d=Yr(l),f=wn(r.shape,h,i,1,a,u,!1,d),m=new UX(f);return e.runWebGLProgram(m,[r,o],"float32")}const jX={kernelName:im,backendName:"webgl",kernelFunc:qX};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XX{constructor(t){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=En(this.outputShape.length);const e=t.filterHeight,s=t.filterWidth,r=e-1-t.padInfo.top,o=s-1-t.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${t.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${t.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YX(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:o}=t,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:h}=s,d=Yr(u),f=wn(i,o.shape,a,1,l,h,!1,d);if(J().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){const m=[[f.strideHeight,f.strideWidth]],g=new XX(f);return e.runWebGLProgram(g,[r,o],"float32",m)}else{const m=new GX(f);return e.runWebGLProgram(m,[r,o],"float32")}}const ZX={kernelName:bh,backendName:"webgl",kernelFunc:YX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JX(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:o}=t,{strides:i,pad:a,dilations:l}=s,u=Ro(r.shape,o.shape,i,l,a),h=new BX(u);return e.runWebGLProgram(h,[r,o],"float32")}const QX={kernelName:yh,backendName:"webgl",kernelFunc:JX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t5(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:o}=t,{strides:i,pad:a,filterShape:l}=s,u=Ro(r.shape,l,i,1,a),h=new HX(u);return e.runWebGLProgram(h,[r,o],"float32")}const e5={kernelName:am,backendName:"webgl",kernelFunc:t5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n5(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:o}=t,{pad:i,strides:a,inputShape:l}=s,u=Ro(l,o.shape,a,1,i),h=new KX(u);return e.runWebGLProgram(h,[r,o],"float32")}const s5={kernelName:lm,backendName:"webgl",kernelFunc:n5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r5=sl+`
  return cos(x);
`,o5=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Yi}
  return result;
`,i5=re({opSnippet:r5,packedOpSnippet:o5}),a5={kernelName:Wl,backendName:"webgl",kernelFunc:i5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l5=re({opSnippet:`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`}),u5={kernelName:Vl,backendName:"webgl",kernelFunc:l5};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c5{constructor(t,e,s,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,a,l,u]=t,[h]=e,[d,f]=s;this.outputShape=[h,d,f,u];const m=r==="bilinear"?1:0,[g,x]=[`${a-1}.0`,`${l-1}.0`],[b,w,v]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${g} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${g}`],[I,C,k]=f>1?[`${(l-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${x} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${x}`];this.userCode=`
      const float height_ratio = float(${b});
      const float width_ratio = float(${I});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${w};
        float width_scale = ${C};

        float in_y = ${v};
        if( in_y < 0.0 || in_y > ${g} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${k};
        if( in_x < 0.0 || in_x > ${x} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${m} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h5={kernelName:cm,backendName:"webgl",kernelFunc:n=>{const{inputs:t,backend:e,attrs:s}=n,{image:r,boxes:o,boxInd:i}=t,{cropSize:a,method:l,extrapolationValue:u}=s,h=new c5(r.shape,o.shape,a,l,u);return e.runWebGLProgram(h,[r,o,i],"float32")}};var yc;(function(n){n.Prod="*",n.Sum="+"})(yc||(yc={}));class n2{constructor(t,e,s,r){this.op=t,this.outputShape=e,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,i=this.op===yc.Prod?"1.0":"0.0",a=s?i:`getX(${s2(o,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",h="";s?(u=r?`end != ${l-1}`:"end != 0",h=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",h=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${ye(o)} coords = getOutputCoords();
        int end = ${r2(o,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${h};
          ${r2(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${s2(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function s2(n,t,e){if(n===1)return`${t}`;if(n===2)return`${t}.x, ${t}.y`;if(n===3)return`${t}.x, ${t}.y, ${t}.z`;if(n===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${e} for rank ${n} is not yet supported`)}function r2(n,t,e){if(n===1)return`${t}`;if(n===2)return`${t}.y`;if(n===3)return`${t}.z`;if(n===4)return`${t}.w`;throw new Error(`Cumulative ${e} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o2(n,t,e,s,r,o){const i=t.shape.length,a=Be([s],i);let l=t;a!=null&&(l=Bn({inputs:{x:t},backend:e,attrs:{perm:a}}));const u=qe(1,i)[0];if(u!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${s}`);const h=l.shape[u];let d=ds({inputs:{x:l},backend:e});for(let f=0;f<=Math.ceil(Math.log2(h))-1;f++){const m=new n2(n,l.shape,!1,o),g=[[f]],x=d;d=e.runWebGLProgram(m,[d],d.dtype,g),e.disposeIntermediateTensorInfo(x)}if(r){const f=new n2(n,l.shape,r,o),m=d;d=e.runWebGLProgram(f,[d],d.dtype),e.disposeIntermediateTensorInfo(m)}if(a!=null){const f=Ao(a),m=Bn({inputs:{x:d},backend:e,attrs:{perm:f}});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(l),m}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d5(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o,exclusive:i,reverse:a}=s;return o2(yc.Prod,r,e,o,i,a)}const f5={kernelName:um,backendName:"webgl",kernelFunc:d5};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p5(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o,exclusive:i,reverse:a}=s;return o2(yc.Sum,r,e,o,i,a)}const m5={kernelName:wh,backendName:"webgl",kernelFunc:p5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g5(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,weights:o}=t,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const l=e.readSync(r.dataId),u=e.readSync(o.dataId),h=$S(l,u,o.dtype,o.shape,i);return e.makeTensorInfo([i],o.dtype,h)}else if(r.shape.length===2){const l=e.bufferSync(r),u=e.bufferSync(o),h=kq(l,u,i,a);return e.makeTensorInfo(h.shape,o.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const x5={kernelName:hm,backendName:"webgl",kernelFunc:g5};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b5{constructor(t,e,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${e};
      int offset_h = imod(h, ${e});
      int in_w = w / ${e};
      int offset_w = imod(w, ${e});
      int offset_d = (offset_h * ${e} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y5(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockSize:o,dataFormat:i}=s,a=r.shape[0],l=i==="NHWC"?r.shape[1]:r.shape[2],u=i==="NHWC"?r.shape[2]:r.shape[3],h=i==="NHWC"?r.shape[3]:r.shape[1],d=l*o,f=u*o,m=h/(o*o),g=i==="NHWC"?[a,d,f,m]:[a,m,d,f],x=new b5(g,o,i);return e.runWebGLProgram(x,[r],r.dtype)}const w5={kernelName:dm,backendName:"webgl",kernelFunc:y5};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i2{constructor(t,e=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=En(this.outputShape.length);const i=t.filterHeight,a=t.filterWidth,l=t.outChannels/t.inChannels;let u="",h="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,h="result = activation(result);");const d=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${h}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a2{constructor(t,e=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=En(this.outputShape.length);const i=t.outChannels/t.inChannels,a=t.padInfo.left,l=t.strideWidth,u=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,f=d;let m=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let w=0;w<d;w++)m+=`
          vec4 xTexelC${w*2};
          int xTexelC${w*2}Ready;
          vec4 xTexelC${w*2+1};
          int xTexelC${w*2+1}Ready;
          vec4 xC${w};`;m+=`
    for (int r = 0; r < ${h}; r++) {
      `;for(let w=0;w<d;w++)m+=`
          xTexelC${w*2} = vec4(0.0);
          xTexelC${w*2}Ready = 0;
          xTexelC${w*2+1} = vec4(0.0);
          xTexelC${w*2+1}Ready = 0;
          xC${w} = vec4(0.0);`;m+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let w=0;w<(f+1)/2;w++){const v=w*2;if(m+=`
          xC = xCCorner + ${v*u};
          `,l===1){if(v<d&&(a%2===1?(m+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }
              `,u===1&&v>0?m+=`
                xC${v} = vec4(xTexelC${v-2}.zw, xTexelC${v}.xy);
                `:m+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${v} = vec4(previous.zw, xTexelC${v}.xy);
                  } else {
                    xC${v} = vec4(0.0, 0.0, xTexelC${v}.xy);
                  }
                  `):m+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                xC${v} = xTexelC${v};
                `,v+1<d)){const I=a%2===0?Hp(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(m+=`
                  xCOffset = xC + imod(pads[1], 2) + ${I};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                    xTexelC${v+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${v+1}.zw = vec2(0.0);
                    }
                    xTexelC${v+1}Ready = 1;
                  }
                  `,u>1?m+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${v+1} = vec4(previous.zw, xTexelC${v+1}.xy);
                    } else {
                     xC${v+1} = vec4(0.0, 0.0, xTexelC${v+1}.xy);
                    }
                    `:m+=`
                    xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.xy);
                    `):I===1?m+=`
                    xC${v+1} = xTexelC${v};
                    `:m+=`
                    xCOffset = xC + ${I};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                      xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${v+1}.zw = vec2(0.0);
                      }
                      xTexelC${v+1}Ready = 1;
                    }

                    xC${v+1} = xTexelC${v+1};
                    `}}else v<d&&(a%2===1?(m+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${v+1}Ready == 0) {
                  xTexelC${v+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${v+1}.zw = vec2(0.0);
                  }
                  xTexelC${v+1}Ready = 1;
                }

                xC${v} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
              `,v+1<d&&(m+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${v+1} = vec4(xTexelC${v+1}.xy, final.xy);
                `)):(m+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                  xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v+1}.zw = vec2(0.);
                  }
                  xTexelC${v+1}Ready = 1;
                }

                xC${v} = vec4(
                  xTexelC${v}.xy, xTexelC${v+1}.xy);
              `,v+1<d&&(m+=`
                  xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
                `)));v<d&&(m+=`
            wTexel = getW(r, ${v}, d1, q);
            dotProd += xC${v} * vec4(wTexel.xz, wTexel.xz);
          `,v+1<d&&(m+=`
              wTexel = getW(r, ${v+1}, d1, q);
              dotProd += xC${v+1} * vec4(wTexel.xz, wTexel.xz);
            `))}m+=`
    }
  `,m+=`
      }
    `;let g="",x="";s&&(r?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:g=`vec4 activation(vec4 x) {
          ${s}
        }`,x="result = activation(result);");const b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${g}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${m}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${b}
        ${x}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v5(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:o}=t,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=s;let h=l;h==null&&(h=[1,1]),A(Tn(i,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);const d=wn(r.shape,o.shape,i,h,a,u,!0);let f;J().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?f=new a2(d):f=new i2(d);const m=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return e.runWebGLProgram(f,[r,o],"float32",m)}const C5={kernelName:vh,backendName:"webgl",kernelFunc:v5};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I5{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,s=t.strideWidth,r=t.padInfo.top,o=t.padInfo.left,i=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${r};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class $5{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,s=t.filterWidth,r=t.strideHeight,o=t.strideWidth,i=e-1-t.padInfo.top,a=s-1-t.padInfo.left,l=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k5(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:o}=t,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:h}=s,d=wn(r.shape,h,i,a,l,u,!0),f=new I5(d);return e.runWebGLProgram(f,[r,o],"float32")}const S5={kernelName:fm,backendName:"webgl",kernelFunc:k5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N5(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:o}=t,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:h}=s,d=wn(h,o.shape,i,a,l,u,!0),f=new $5(d);return e.runWebGLProgram(f,[r,o],"float32")}const T5={kernelName:pm,backendName:"webgl",kernelFunc:N5};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E5{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _5(n){const{inputs:t,backend:e}=n,{x:s}=t,r=[...s.shape,...s.shape],o=st(s.shape),i=gt({inputs:{x:s},backend:e,attrs:{shape:[o]}}),a=new E5(o),l=e.runWebGLProgram(a,[i],i.dtype),u=gt({inputs:{x:l},backend:e,attrs:{shape:r}});return e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(l),u}const R5={kernelName:c1,backendName:"webgl",kernelFunc:_5};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A5{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:e,inWidth:s,padInfo:r,strideHeight:o,strideWidth:i,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:h}=t,{top:d,left:f}=r;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${i});
      const ivec2 pads = ivec2(${d}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${e}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${h};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D5(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:o}=t,{strides:i,pad:a,dilations:l}=s,u=_u(r.shape,o.shape,i,a,"NHWC",l);let h;const d=new A5(u);h=e.runWebGLProgram(d,[r,o],"float32");const f=gt({inputs:{x:h},backend:e,attrs:{shape:u.outShape}});return e.disposeIntermediateTensorInfo(h),f}const F5={kernelName:Ch,backendName:"webgl",kernelFunc:D5};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O5(n){const{inputs:t,backend:e,attrs:s}=n,{equation:r}=s,o=t,{allDims:i,summedDims:a,idDims:l}=fx(r,o.length);mx(i.length,l,o);const{path:u,steps:h}=gx(a,l),d=h.length;let f=null,m=i.length;const g=[];for(let x=0;x<d;++x){for(const b of h[x]){const{permutationIndices:w,expandDims:v}=px(m,l[b]);let I;xx(w)?I=o[b]:(I=Bn({inputs:{x:o[b]},backend:e,attrs:{perm:w}}),g.push(I));const C=I.shape.slice();for(let k=0;k<v.length;++k)C.splice(v[k],0,1);he(I.shape,C)||(I=gt({inputs:{x:I},backend:e,attrs:{shape:C}}),g.push(I)),f===null?f=I:(f=Rb({inputs:{a:I,b:f},backend:e}),g.push(f))}x<d-1&&(u[x]>=0&&(f=Cf({inputs:{x:f},backend:e,attrs:{axis:u[x]-(i.length-m),keepDims:!1}}),g.push(f)),m--)}for(const x of g)x!==f&&e.disposeIntermediateTensorInfo(x);return f}const L5={kernelName:xm,backendName:"webgl",kernelFunc:O5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P5=re({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`}),M5={kernelName:Gl,backendName:"webgl",kernelFunc:P5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B5="return (b >= 0.0) ? a : a * (b + 1.0);",z5=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,W5={kernelName:bm,backendName:"webgl",kernelFunc:n=>{const{inputs:t,backend:e}=n,{dy:s,y:r}=t,o=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new nl(z5,s.shape,r.shape):new Xi(B5,s.shape,r.shape);return e.runWebGLProgram(o,[s,r],s.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V5=In({opSnippet:"return float(a == b);",packedOpSnippet:`
  return vec4(equal(a, b));
`,dtype:"bool",cpuKernelImpl:_q}),U5={kernelName:Ih,backendName:"webgl",kernelFunc:V5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G5=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${ox};
  float a1 = ${ix};
  float a2 = ${ax};
  float a3 = ${lx};
  float a4 = ${ux};
  float a5 = ${cx};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,H5=re({opSnippet:G5}),K5={kernelName:Hl,backendName:"webgl",kernelFunc:H5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q5=sl+`
  return exp(x);
`,l2=re({opSnippet:q5,packedOpSnippet:`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:Rq,dtype:"float32"}),j5={kernelName:Kl,backendName:"webgl",kernelFunc:l2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ob(n){const{inputs:t,attrs:e,backend:s}=n,{dim:r}=e,{input:o}=t,i=o.shape.length,a=o.shape.slice();let l=r;return r<0&&(A(-(i+1)<=r,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+r+1),a.splice(l,0,1),gt({inputs:{x:o},backend:s,attrs:{shape:a}})}const X5={kernelName:$h,backendName:"webgl",kernelFunc:Ob};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u2="return exp(x) - 1.0;",Y5=re({opSnippet:u2,packedOpSnippet:u2,cpuKernelImpl:Aq}),Z5={kernelName:ql,backendName:"webgl",kernelFunc:Y5};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c2{constructor(t,e,s){this.variableNames=["real","imag"];const r=e[1];this.outputShape=e;const o=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=s?`${r}.0`:"1.0";let a;if(t==="real")a="return real * expR - imag * expI;";else if(t==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h2(n,t,e){const s=e.texData.get(n.dataId),r=st(n.shape),o=n.shape[n.shape.length-1],i=r/o,a=gt({inputs:{x:n},backend:e,attrs:{shape:[i,o]}}),l=a.shape,u=new c2("real",l,t),h=new c2("imag",l,t),d=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],f=e.runWebGLProgram(u,d,"float32"),m=e.runWebGLProgram(h,d,"float32"),g=Xo({inputs:{real:f,imag:m},backend:e});e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m);const x=gt({inputs:{x:g},backend:e,attrs:{shape:n.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(g),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J5(n){const{inputs:t,backend:e}=n,{input:s}=t;return h2(s,!1,e)}const Q5={kernelName:ym,backendName:"webgl",kernelFunc:J5};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t8{constructor(t,e){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wc(n){const{backend:t,attrs:e}=n,{shape:s,value:r}=e;let{dtype:o}=e;if(o=o||va(r),o==="string"){const i=He(o,st(s));return i.fill(r),t.makeTensorInfo(s,o,i)}else{const i=new t8(s,r),a=[[r]];return t.runWebGLProgram(i,[],o,a)}}const e8={kernelName:wm,backendName:"webgl",kernelFunc:wc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n8{constructor(t){this.variableNames=["Image"],this.outputShape=[];const e=t[2];this.outputShape=t,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${e} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${e}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s8={kernelName:vm,backendName:"webgl",kernelFunc:({inputs:n,backend:t})=>{const{image:e}=n,s=t,r=new n8(e.shape);return s.runWebGLProgram(r,[e],e.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d2="return floor(x);",r8=re({opSnippet:d2,packedOpSnippet:d2,cpuKernelImpl:Dq}),o8={kernelName:jl,backendName:"webgl",kernelFunc:r8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i8=In({opSnippet:`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,packedOpSnippet:`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,dtype:"int32"}),a8={kernelName:Xl,backendName:"webgl",kernelFunc:i8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l8{constructor(t){this.variableNames=["A"];const e=Pn(),[s,r]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${e.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u8{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const e=Pn(),[s,r]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${e.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${e.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c8={kernelName:b_,backendName:"webgl",kernelFunc:h8};let ol,Lb=J().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function h8(n){const{inputs:t,backend:e,attrs:s}=n;let{pixels:r}=t;const{numChannels:o}=s,i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,u]=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],h=[u,l],d=[u,l,o];if(a||i){const x=J().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(ol==null||x!==Lb)&&(Lb=x,ol=document.createElement("canvas").getContext("2d",{willReadFrequently:Lb})),ol.canvas.width=l,ol.canvas.height=u,ol.drawImage(r,0,0,l,u),r=ol.canvas}const f=e.makeTensorInfo(h,"int32");e.texData.get(f.dataId).usage=$s.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(f.dataId),r);const m=J().getBool("WEBGL_PACK")?new u8(d):new l8(d),g=e.runWebGLProgram(m,[f],"int32");return e.disposeData(f.dataId),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d8(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=t,{strides:l,pad:u,dataFormat:h,dilations:d,dimRoundingMode:f,activation:m,leakyreluAlpha:g}=s,x=Yr(h),b=wn(r.shape,o.shape,l,d,u,f,!1,x);let w;const v=[],I=i!=null,C=a!=null,k=m==="leakyrelu",N=()=>{const R=[r,o],E=(F,P)=>{if(P==="NCHW"&&F.shape.length===1&&F.shape[0]!==1){const q=gt({inputs:{x:F},backend:e,attrs:{shape:[F.shape[0],1,1]}});return v.push(q),q}return F};if(I&&R.push(E(i,h)),C&&R.push(E(a,h)),k){const F=e.makeTensorInfo([],"float32",So(g,"float32"));R.push(F),v.push(F)}return R};if(b.filterHeight===1&&b.filterWidth===1&&b.dilationHeight===1&&b.dilationWidth===1&&b.strideHeight===1&&b.strideWidth===1&&(b.padInfo.type==="SAME"||b.padInfo.type==="VALID"))w=t2({x:r,filter:o,convInfo:b,backend:e,bias:i,activation:m,preluActivationWeights:a,leakyreluAlpha:g});else if(b.strideWidth<=2&&x==="channelsLast"&&J().getBool("WEBGL_EXP_CONV")){const R=m?mc(m,!0):null,E=new QS(b,I,R,C,k),F=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],P=N();w=e.runWebGLProgram(E,P,"float32",F)}else if(J().getBool("WEBGL_CONV_IM2COL"))w=e2({x:r,filter:o,convInfo:b,backend:e,bias:i,activation:m,preluActivationWeights:a,leakyreluAlpha:g});else{const R=m?mc(m,!1):null,E=new JS(b,I,R,C,k),F=N();w=e.runWebGLProgram(E,F,"float32")}const T=gt({inputs:{x:w},backend:e,attrs:{shape:b.outShape}});return v.push(w),v.forEach(R=>e.disposeIntermediateTensorInfo(R)),T}const f8={kernelName:ud,backendName:"webgl",kernelFunc:d8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p8(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=t,{strides:l,pad:u,dilations:h,dimRoundingMode:d,activation:f,leakyreluAlpha:m}=s,g=[];let x=h;x==null&&(x=[1,1]),A(Tn(l,x),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${x}'`);const b=wn(r.shape,o.shape,l,x,u,d,!0),w=J().getBool("WEBGL_PACK_DEPTHWISECONV")&&b.strideWidth<=2&&b.outChannels/b.inChannels===1,v=f?mc(f,w):null,I=[r,o],C=i!=null,k=a!=null,N=f==="leakyrelu";if(C&&I.push(i),k&&I.push(a),N){const F=e.makeTensorInfo([],"float32",So(m,"float32"));I.push(F),g.push(F)}let T;w?T=new a2(b,C,v,k,N):T=new i2(b,C,v,k,N);const R=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],E=e.runWebGLProgram(T,I,"float32",R);return g.forEach(F=>e.disposeIntermediateTensorInfo(F)),E}const m8={kernelName:E1,backendName:"webgl",kernelFunc:p8};class g8{constructor(t,e,s,r){this.sliceDim=t,this.strides=e,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const o=ye(s.length);let i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x8(n){const{inputs:t,backend:e}=n,{params:s,indices:r}=t,o=r.shape,i=o[o.length-1],a=st(s.shape),[l,u,h,d]=qg(s,r),f=gt({inputs:{x:r},backend:e,attrs:{shape:[u,i]}}),m=gt({inputs:{x:s},backend:e,attrs:{shape:[st(s.shape)/h,h]}});if(e.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const w=e.readSync(r.dataId),v=e.bufferSync(s),I=Fq(w,v,s.dtype,u,i,h,d,s.shape,a);return e.makeTensorInfo(l,s.dtype,I.values)}const g=new g8(i,d,[u,h],s.shape),x=e.runWebGLProgram(g,[m,f],m.dtype),b=gt({inputs:{x},backend:e,attrs:{shape:l}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(x),b}const b8={kernelName:h1,backendName:"webgl",kernelFunc:x8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y8{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;const s=ye(this.rank),r=w8(t);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function w8(n,t){const e=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${e[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f2(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,indices:o}=t,{axis:i,batchDims:a}=s,l=Xt(i,r.shape)[0];if(J().get("DEBUG")){const v=e.readSync(o.dataId),I=r.shape[l];for(let C=0;C<v.length;++C){const k=v[C];A(k<=I-1&&k>=0,()=>`GatherV2: the index value ${k} is not in [0, ${I-1}]`)}}const u=wx(r,o,l,a),h=st(o.shape),d=[],f=gt({inputs:{x:r},backend:e,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),m=gt({inputs:{x:o},backend:e,attrs:{shape:[u.batchSize,h/u.batchSize]}});d.push(f),d.push(m);const g=[u.batchSize,u.outerSize,h/u.batchSize,u.sliceSize];if(e.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const v=e.bufferSync(m),I=e.bufferSync(f),C=Oq(I,v,g);return d.forEach(k=>e.disposeIntermediateTensorInfo(k)),e.makeTensorInfo(u.outputShape,C.dtype,C.values)}const x=new y8(f.shape,g),b=e.runWebGLProgram(x,[f,m],f.dtype);d.push(b);const w=gt({inputs:{x:b},backend:e,attrs:{shape:u.outputShape}});return d.forEach(v=>e.disposeIntermediateTensorInfo(v)),w}const v8={kernelName:Sh,backendName:"webgl",kernelFunc:f2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C8=In({opSnippet:"return float(a > b);",packedOpSnippet:`
  return vec4(greaterThan(a, b));
`,cpuKernelImpl:Lq,dtype:"bool"}),I8={kernelName:Nh,backendName:"webgl",kernelFunc:C8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $8=In({opSnippet:"return float(a >= b);",packedOpSnippet:`
  return vec4(greaterThanEqual(a, b));
`,dtype:"bool",cpuKernelImpl:Pq}),k8={kernelName:Yl,backendName:"webgl",kernelFunc:$8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S8(n){const{inputs:t,backend:e}=n,{input:s}=t;return h2(s,!0,e)}const N8={kernelName:Cm,backendName:"webgl",kernelFunc:S8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T8=re({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),E8={kernelName:Jl,backendName:"webgl",kernelFunc:T8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _8=re({opSnippet:"return float(isinf(x));",dtype:"bool"}),R8={kernelName:Ql,backendName:"webgl",kernelFunc:_8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A8=re({opSnippet:"return float(isnan(x));",dtype:"bool"}),D8={kernelName:tu,backendName:"webgl",kernelFunc:A8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F8=In({opSnippet:"return float(a < b);",packedOpSnippet:`
  return vec4(lessThan(a, b));
`,cpuKernelImpl:Mq,dtype:"bool"}),O8={kernelName:Eh,backendName:"webgl",kernelFunc:F8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L8=In({opSnippet:"return float(a <= b);",packedOpSnippet:`
  return vec4(lessThanEqual(a, b));
`,cpuKernelImpl:Bq,dtype:"bool"}),P8={kernelName:_h,backendName:"webgl",kernelFunc:L8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M8(n){const{backend:t,attrs:e}=n,{start:s,stop:r,num:o}=e,i=zq(s,r,o);return t.makeTensorInfo([i.length],"float32",i)}const B8={kernelName:d1,backendName:"webgl",kernelFunc:M8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z8=sl+`
  return x < 0.0 ? 0./0. : log(x);
`,W8=re({opSnippet:z8,packedOpSnippet:`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,cpuKernelImpl:Wq}),V8={kernelName:eu,backendName:"webgl",kernelFunc:W8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U8=sl+`
  return log(1.0 + x);
`,G8=re({opSnippet:U8}),H8={kernelName:nu,backendName:"webgl",kernelFunc:G8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K8=In({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,dtype:"bool"}),q8={kernelName:Rh,backendName:"webgl",kernelFunc:K8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j8=re({opSnippet:"return float(!(x >= 1.0));"}),X8={kernelName:Ah,backendName:"webgl",kernelFunc:j8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y8=In({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,dtype:"bool"}),Z8={kernelName:Dh,backendName:"webgl",kernelFunc:Y8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J8{constructor(t,e,s,r,o){this.variableNames=["x"],this.outputShape=[];const i=e,a=t[3]-1;this.outputShape=t;let l;const u=`float(${s}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${u})`:o===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q8{constructor(t,e,s,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=e,a=t[3]-1;this.outputShape=t;let l;const u=`float(${s}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${u})`:o===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tY={kernelName:Fh,backendName:"webgl",kernelFunc:n=>{const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{depthRadius:o,bias:i,alpha:a,beta:l}=s,u=J().getBool("WEBGL_PACK_NORMALIZATION")?new Q8(r.shape,o,i,a,l):new J8(r.shape,o,i,a,l);return e.runWebGLProgram(u,[r],r.dtype)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eY{constructor(t,e,s,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=s,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${e})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${e} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nY={kernelName:$m,backendName:"webgl",kernelFunc:n=>{const{inputs:t,backend:e,attrs:s}=n,{x:r,y:o,dy:i}=t,{depthRadius:a,bias:l,alpha:u,beta:h}=s,d=new eY(r.shape,a,l,u,h);return e.runWebGLProgram(d,[r,o,i],r.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sY(n,t,e,s){const r=st(t),i=st(n.shape)/r,a=gt({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),l=Zi(a,n.dtype,"max",s),u=gt({inputs:{x:l},attrs:{shape:e},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p2(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{reductionIndices:o,keepDims:i}=s,a=r.shape.length,l=Xt(o,r.shape);let u=l;const h=Be(u,a),d=h!=null,f=e.shouldExecuteOnCPU([r]);let m=r;if(d){if(f){const I=e.texData.get(m.dataId).values,C=new Array(a);for(let T=0;T<C.length;T++)C[T]=r.shape[h[T]];const k=Eb(I,r.shape,r.dtype,h,C);m=e.makeTensorInfo(C,r.dtype);const N=e.texData.get(m.dataId);N.values=k}else m=vf(r,h,e);u=qe(u.length,a)}vn("max",u,a);const[g,x]=dn(m.shape,u);let b=g;i&&(b=Je(g,l));let w;if(f){const I=e.texData.get(m.dataId).values,C=Vq(I,st(x),b,r.dtype);w=e.makeTensorInfo(b,r.dtype);const k=e.texData.get(w.dataId);k.values=C}else w=sY(m,x,b,e);return d&&e.disposeIntermediateTensorInfo(m),w}const rY={kernelName:Oh,backendName:"webgl",kernelFunc:p2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oY=_b+`
  return max(a, b);
`,iY=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Yi+`
  return result;
`,aY=In({opSnippet:oY,packedOpSnippet:iY,cpuKernelImpl:Uq}),lY={kernelName:su,backendName:"webgl",kernelFunc:aY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uY(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t;fc(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;A(Tn(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const h=Ps(r.shape,o,i,u,a,l);if(h.filterWidth===1&&h.filterHeight===1&&he(h.inShape,h.outShape))return ds({inputs:{x:r},backend:e});const d=new gc(h,"max",!1);return e.runWebGLProgram(d,[r],r.dtype)}const cY={kernelName:Lh,backendName:"webgl",kernelFunc:uY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hY(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{filterSize:o,strides:i,pad:a,dataFormat:l,dimRoundingMode:u}=s,h=[1,1,1],d=Xr(r.shape,o,i,h,a,u,l),f=new Ab(d,"max",!1);return e.runWebGLProgram(f,[r],r.dtype)}const dY={kernelName:Ph,backendName:"webgl",kernelFunc:hY};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fY{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideHeight,s=t.strideWidth,r=t.dilationHeight,o=t.effectiveFilterHeight,i=t.effectiveFilterWidth,a=o-1-t.padInfo.top,l=i-1-t.padInfo.left,u=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${e}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class pY{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideDepth,s=t.strideHeight,r=t.strideWidth,o=t.dilationDepth,i=t.dilationHeight,a=t.dilationWidth,l=t.effectiveFilterDepth,u=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=l-1-t.padInfo.front,f=u-1-t.padInfo.top,m=h-1-t.padInfo.left,g=l*u*h-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${f}, ${m});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${e}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${h};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${g} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${h} +
                  wR * ${h} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mY(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:o}=t,i=o,{filterSize:a,strides:l,pad:u,dimRoundingMode:h}=s,d=[1,1,1],f=Xr(i.shape,a,l,d,u,h),m=new Ab(f,"max",!0),g=e.runWebGLProgram(m,[i],i.dtype),x=new pY(f),b=e.runWebGLProgram(x,[r,g],i.dtype);return e.disposeIntermediateTensorInfo(g),b}const gY={kernelName:Sm,backendName:"webgl",kernelFunc:mY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xY(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:o,output:i}=t,a=o;fc([o,i],"maxPoolGrad");const{filterSize:l,strides:u,pad:h,dimRoundingMode:d}=s,f=Ps(a.shape,l,u,1,h,d),m=!0,g=new gc(f,"max",m),x=e.runWebGLProgram(g,[a],a.dtype),b=new fY(f),w=e.runWebGLProgram(b,[r,x],a.dtype);return e.disposeIntermediateTensorInfo(x),w}const bY={kernelName:km,backendName:"webgl",kernelFunc:xY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yY(n,t,e,s){let r=new gc(e,"max",!1);const o=s.runWebGLProgram(r,[n],"float32");r=new gc(e,"max",!0,!0,t);const i=s.runWebGLProgram(r,[n],"float32");return[o,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wY={kernelName:f1,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=t,l=e;A(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];A(Tn(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=Ps(s.shape,r,o,u,i),[d,f]=yY(s,a,h,l);return[d,f]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vY(n,t,e,s){const r=st(t),i=st(n.shape)/r,a=gt({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),l=Zi(a,"float32","mean",s),u=gt({inputs:{x:l},attrs:{shape:e},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CY={kernelName:Mh,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:s}=n,{keepDims:r,axis:o}=t,i=e,a=s.shape.length,l=Xt(o,s.shape);let u=l;const h=Be(u,a),d=h!=null,f=i.shouldExecuteOnCPU([s]),m=[];let g=s;if(d){if(f){const C=i.texData.get(g.dataId).values,k=new Array(a);for(let R=0;R<k.length;R++)k[R]=s.shape[h[R]];const N=Eb(C,s.shape,s.dtype,h,k);g=i.makeTensorInfo(k,s.dtype);const T=i.texData.get(g.dataId);T.values=N}else g=vf(s,h,i);m.push(g),u=qe(u.length,a)}vn("sum",u,a);const[x,b]=dn(g.shape,u);let w=x;r&&(w=Je(x,l));const v=vY(g,b,w,i);for(const I of m)i.disposeIntermediateTensorInfo(I);return v}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IY(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o,keepDims:i}=s,a=r.shape.length,l=Xt(o,r.shape);let u=l;const h=Be(u,a);let d=r;h!=null&&(d=Bn({inputs:{x:r},backend:e,attrs:{perm:h}}),u=qe(u.length,r.shape.length)),vn("min",u,a);const[f,m]=dn(d.shape,u),g=st(m),x=gt({inputs:{x:d},backend:e,attrs:{shape:[-1,g]}}),b=Zi(x,x.dtype,"min",e);let w;if(i){const v=Je(f,l);w=gt({inputs:{x:b},backend:e,attrs:{shape:v}})}else w=gt({inputs:{x:b},backend:e,attrs:{shape:f}});return e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b),h!=null&&e.disposeIntermediateTensorInfo(d),w}const $Y={kernelName:Bh,backendName:"webgl",kernelFunc:IY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kY=_b+`
  return min(a, b);
`,SY=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Yi+`
  return result;
`,NY=In({opSnippet:kY,packedOpSnippet:SY,cpuKernelImpl:Gq}),TY={kernelName:ru,backendName:"webgl",kernelFunc:NY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EY{constructor(t,e,s){this.variableNames=["x"],this.outputShape=e.map((h,d)=>h[0]+t[d]+h[1]);const r=t.length,o=ye(r),i=e.map(h=>h[0]).join(","),a=e.map((h,d)=>h[0]+t[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Y{constructor(t,e,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((g,x)=>g[0]+t[x]+g[1]);const r=t.length,o=ye(r),i=e.map(g=>g[0]).join(","),a=e.map((g,x)=>g[0]+t[x]).join(","),l=Mn("rc",r),u=Mn("source",r),h=`${l[r-1]} < ${this.outputShape[r-1]}`,d=r===1?"source":`vec2(${u.slice(-2).join()})`,f=s==="reflect"?0:1;let m="";if(r===1){const g=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;m=`
        ${o} rc = outputLoc;
        ${g}
        result[0] = getChannel(getX(${u.join()}), ${d});
        ${l[r-1]} += 1;
        if(${h}) {
          ${g}
          result[1] = getChannel(getX(${u.join()}), ${d});
        }
      `}else{const g=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;m=`
        ${o} rc = outputLoc;
        ${g}
        result[0] = getChannel(getX(${u.join()}), ${d});
        ${l[r-1]} += 1;
        if(${h}) {
          ${g}
          result[1] = getChannel(getX(${u.join()}), ${d});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${g}
          result[2] = getChannel(getX(${u.join()}), ${d});
          ${l[r-1]} += 1;
          if(${h}) {
            ${g}
            result[3] = getChannel(getX(${u.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RY={kernelName:zh,backendName:"webgl",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s}=n,{paddings:r,mode:o}=e,i=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _Y(s.shape,r,o):new EY(s.shape,r,o);return t.runWebGLProgram(i,[s],s.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AY=`if (b == 0.0) return NAN;
  return mod(a, b);`,DY=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Yi+`
  return result;
`,FY=In({opSnippet:AY,packedOpSnippet:DY}),OY={kernelName:ou,backendName:"webgl",kernelFunc:FY};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LY{constructor(t,e,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${e-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${e-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m2=In({opSnippet:`
if (a == b) {
  return 1.0;
};
return a / b;`,packedOpSnippet:`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,checkOutOfBounds:!0}),PY={kernelName:Ul,backendName:"webgl",kernelFunc:m2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g2="return a - b;",x2=In({opSnippet:g2,packedOpSnippet:g2,supportsComplex:!0,cpuKernelImpl:h6}),MY={kernelName:vu,backendName:"webgl",kernelFunc:x2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b2(n){const{inputs:t,backend:e,attrs:s}=n,{logits:r}=t,{dim:o}=s,i=Xt([o],r.shape),a=p2({inputs:{x:r},backend:e,attrs:{reductionIndices:i,keepDims:!1}}),l=Je(a.shape,i),u=gt({inputs:{x:a},backend:e,attrs:{shape:l}}),h=x2({inputs:{a:r,b:u},backend:e}),d=l2({inputs:{x:h},backend:e}),f=Cf({inputs:{x:d},backend:e,attrs:{axis:i,keepDims:!1}}),m=gt({inputs:{x:f},backend:e,attrs:{shape:l}}),g=m2({inputs:{a:d,b:m},backend:e});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),g}const BY={kernelName:rd,backendName:"webgl",kernelFunc:b2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zY(n){const{inputs:t,backend:e,attrs:s}=n,{logits:r}=t,{numSamples:o,seed:i,normalized:a}=s,l=a?r:b2({inputs:{logits:r},backend:e,attrs:{dim:r.shape.length-1}}),u=l.shape[0],h=l.shape[1],d=new LY(u,h,o),f=[[i]],m=e.runWebGLProgram(d,[l],"int32",f);return a||e.disposeIntermediateTensorInfo(l),m}const WY={kernelName:p1,backendName:"webgl",kernelFunc:zY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VY=qs+`
  return -x;
`,UY=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function GY(n){const{inputs:t,backend:e}=n,{x:s}=t;if(e.shouldExecuteOnCPU([s])){const o=e.texData.get(s.dataId),[i,a]=Kq(o.values,s.shape,s.dtype);return e.makeTensorInfo(a,s.dtype,i)}let r;return J().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new jo(s.shape,UY):r=new Br(s.shape,VY),e.runWebGLProgram(r,[s],s.dtype)}const HY={kernelName:Wh,backendName:"webgl",kernelFunc:GY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KY=Vg;function qY(n){bs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:o}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s,u=e.readSync(r.dataId),h=e.readSync(o.dataId),{selectedIndices:d}=KY(u,h,i,a,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}const jY={kernelName:Nm,backendName:"webgl",kernelFunc:qY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XY=Ug;function YY(n){bs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:o}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,h=e.readSync(r.dataId),d=e.readSync(o.dataId),{selectedIndices:f,validOutputs:m}=XY(h,d,i,a,l,u);return[e.makeTensorInfo([f.length],"int32",new Int32Array(f)),e.makeTensorInfo([],"int32",new Int32Array([m]))]}const ZY={kernelName:Tm,backendName:"webgl",kernelFunc:YY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JY=Gg;function QY(n){bs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:o}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,h=e.readSync(r.dataId),d=e.readSync(o.dataId),f=i,m=a,g=l,x=u,{selectedIndices:b,selectedScores:w}=JY(h,d,f,m,g,x);return[e.makeTensorInfo([b.length],"int32",new Int32Array(b)),e.makeTensorInfo([w.length],"float32",new Float32Array(w))]}const t7={kernelName:Em,backendName:"webgl",kernelFunc:QY};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e7{constructor(t,e,s,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n7={kernelName:Gh,backendName:"webgl",kernelFunc:n=>{const{inputs:t,backend:e,attrs:s}=n,{indices:r}=t,{dtype:o,depth:i,onValue:a,offValue:l}=s,u=st(r.shape),h=new e7(u,i,a,l),d=gt({inputs:{x:r},backend:e,attrs:{shape:[u]}}),f=e.runWebGLProgram(h,[d],o);e.disposeIntermediateTensorInfo(d);const m=[...r.shape,i],g=gt({inputs:{x:f},backend:e,attrs:{shape:m}});return e.disposeIntermediateTensorInfo(f),g}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tf(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="complex64"){const r=xc({inputs:{input:s},backend:e}),o=Tf({inputs:{x:r},backend:e}),i=Sf({inputs:{input:s},backend:e}),a=Tf({inputs:{x:i},backend:e}),l=Xo({inputs:{real:o,imag:a},backend:e});return e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(a),l}else return wc({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:e})}const s7={kernelName:ad,backendName:"webgl",kernelFunc:Tf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y2(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=xc({inputs:{input:s},backend:e}),o=y2({inputs:{x:r},backend:e}),i=Sf({inputs:{input:s},backend:e}),a=Tf({inputs:{x:i},backend:e}),l=Xo({inputs:{real:o,imag:a},backend:e});return e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(a),l}else return wc({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:e})}const r7={kernelName:Uh,backendName:"webgl",kernelFunc:y2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o7(n){const{inputs:t,backend:e,attrs:s}=n,{axis:r}=s;if(t.length===1)return Ob({inputs:{input:t[0]},backend:e,attrs:{dim:r}});const o=t[0].shape,i=t[0].dtype;t.forEach(h=>{rh(o,h.shape,"All tensors passed to stack must have matching shapes"),A(i===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=t.map(h=>{const d=Ob({inputs:{input:h},backend:e,attrs:{dim:r}});return a.push(d),d}),u=ZS({inputs:l,backend:e,attrs:{axis:r}});return a.forEach(h=>e.disposeIntermediateTensorInfo(h)),u}const i7={kernelName:Hh,backendName:"webgl",kernelFunc:o7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a7{constructor(t,e,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map((u,h)=>u[0]+t[h]+u[1]);const r=t.length,o=ye(r),i=e.map(u=>u[0]).join(","),a=e.map((u,h)=>u[0]+t[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l7{constructor(t,e,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map((x,b)=>x[0]+t[b]+x[1]);const r=t.length,o=ye(r),i=e.map(x=>x[0]).join(","),a=e.map((x,b)=>x[0]+t[b]).join(","),l=Mn("rc",r),u=Mn("source",r),h=`${l[r-1]} < ${this.outputShape[r-1]}`,d=r===1?"source":`vec2(${u.slice(-2).join()})`,f=[`${o} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${h}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${h}) {`],m=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let g="";for(let x=0,b=r===1?2:4;x<b;x++)g+=`
        ${f[x]}
        if (${m}) {
          result[${x}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${x}] = getChannel(getX(${u.join()}), ${d});
        }
      `;g+=r===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w2=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{paddings:o,constantValue:i}=s;if(st(r.shape)===0){const u=o.map((h,d)=>h[0]+r.shape[d]+h[1]);return wc({backend:e,attrs:{shape:u,value:i,dtype:r.dtype}})}const a=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new l7(r.shape,o,i):new a7(r.shape,o,i),l=[[i]];return e.runWebGLProgram(a,[r],r.dtype,l)},u7={kernelName:Kh,backendName:"webgl",kernelFunc:w2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c7=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,h7=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Yi+`
  return result;
`,d7=In({opSnippet:c7,packedOpSnippet:h7}),f7={kernelName:au,backendName:"webgl",kernelFunc:d7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p7(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:o,keepDims:i}=s,a=r.shape.length,l=[],u=Xt(o,r.shape);let h=u;const d=Be(h,a);let f=r;d!=null&&(f=Bn({inputs:{x:r},backend:e,attrs:{perm:d}}),h=qe(h.length,a),l.push(f)),vn("prod",h,a);let m;if(e.shouldExecuteOnCPU([f])){const g=e.texData.get(f.dataId).values,{outVals:x,outShape:b,outDtype:w}=jq(f.shape,f.dtype,g,h);m=e.makeTensorInfo(b,w,x)}else{const[g,x]=dn(f.shape,h),b=st(x),w=gt({inputs:{x:f},backend:e,attrs:{shape:[-1,b]}}),v=Ym(r.dtype),I=Zi(w,v,"prod",e);m=gt({inputs:{x:I},backend:e,attrs:{shape:g}}),l.push(w),l.push(I)}if(i){l.push(m);const g=Je(m.shape,u);m=gt({inputs:{x:m},backend:e,attrs:{shape:g}})}return l.forEach(g=>e.disposeIntermediateTensorInfo(g)),m}const m7={kernelName:jh,backendName:"webgl",kernelFunc:p7};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g7(n){const{inputs:t,backend:e,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=t,{outputRaggedRank:a}=s,l=r.map(w=>e.readSync(w.dataId)),u=r.map(w=>w.shape),h=e.readSync(o.dataId),d=e.readSync(i.dataId),[f,m,g]=Xq(l,u,h,o.shape,o.dtype,d,i.shape,a),x=f.map(w=>e.makeTensorInfo([w.length],"int32",w)),b=e.makeTensorInfo(g,o.dtype,m);return x.concat([b])}const x7={kernelName:m1,backendName:"webgl",kernelFunc:g7};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b7(n){const{inputs:t,backend:e}=n,{starts:s,limits:r,deltas:o}=t,i=e.readSync(s.dataId),a=e.readSync(r.dataId),l=e.readSync(o.dataId),[u,h]=Yq(i,s.shape,s.dtype,a,r.shape,l,o.shape),d=e.makeTensorInfo([u.length],"int32",u),f=e.makeTensorInfo([h.length],s.dtype,h);return[d,f]}const y7={kernelName:g1,backendName:"webgl",kernelFunc:b7};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w7(n){const{inputs:t,backend:e,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=t,{rowPartitionTypes:l}=s,u=e.readSync(r.dataId),h=e.readSync(o.dataId),d=e.readSync(i.dataId),f=a.map(b=>e.readSync(b.dataId)),m=a.map(b=>b.shape),[g,x]=Zq(u,r.shape,h,o.shape,o.dtype,d,i.shape,f,m,l);return e.makeTensorInfo(g,o.dtype,x)}const v7={kernelName:x1,backendName:"webgl",kernelFunc:w7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v2=n=>{const{backend:t,attrs:e}=n,{start:s,stop:r,step:o,dtype:i}=e,a=Jq(s,r,o,i);return t.makeTensorInfo([a.length],i,a)},C7={kernelName:_m,backendName:"webgl",kernelFunc:v2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I7=re({opSnippet:"return 1.0 / x;"}),$7={kernelName:lu,backendName:"webgl",kernelFunc:I7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k7=qs+`
  return (x < 0.0) ? 0.0 : x;
`,S7=re({opSnippet:k7,packedOpSnippet:`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`}),N7={kernelName:uu,backendName:"webgl",kernelFunc:S7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T7=qs+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,E7=re({opSnippet:T7,packedOpSnippet:`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`}),_7={kernelName:cu,backendName:"webgl",kernelFunc:E7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R7{constructor(t,e,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,l,u]=t;this.outputShape=[i,e,s,u];const h=[r&&e>1?a-1:a,r&&s>1?l-1:l],d=[r&&e>1?e-1:e,r&&s>1?s-1:s];let f;o?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/d[0]},
          ${h[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A7{constructor(t,e,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,u]=t;this.outputShape=[i,e,s,u];const h=[r&&e>1?a-1:a,r&&s>1?l-1:l],d=[r&&e>1?e-1:e,r&&s>1?s-1:s];let f;o?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/d[0]},
          ${h[1]/d[1]},
          ${h[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D7(n){const{inputs:t,backend:e,attrs:s}=n,{images:r}=t,{alignCorners:o,halfPixelCenters:i,size:a}=s,[l,u]=a,h=J().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new A7(r.shape,l,u,o,i):new R7(r.shape,l,u,o,i);return e.runWebGLProgram(h,[r],"float32")}const F7={kernelName:Zh,backendName:"webgl",kernelFunc:D7};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O7{constructor(t,e,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,o]=e,[,i,a]=t,l=[s&&i>1?r-1:r,s&&a>1?o-1:o],u=[s&&i>1?i-1:i,s&&a>1?a-1:a],h=l[0]/u[0],d=l[1]/u[1],f=1/h,m=1/d,g=Math.ceil(f)*2+2,x=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${d});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${m});

        const int winHeight = int(${g});
        const int winWidth = int(${x});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L7(n){const{inputs:t,backend:e,attrs:s}=n,{images:r,dy:o}=t,{alignCorners:i}=s,a=new O7(o.shape,r.shape,i);return e.runWebGLProgram(a,[o],o.dtype)}const P7={kernelName:Dm,backendName:"webgl",kernelFunc:L7};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M7{constructor(t,e,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,l,u]=t;this.outputShape=[i,e,s,u];const h=[r&&e>1?a-1:a,r&&s>1?l-1:l],d=[r&&e>1?e-1:e,r&&s>1?s-1:s],f=r?"0.5":"0.0";let m;o?m="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":m="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/d[0]},
          ${h[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${m};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B7{constructor(t,e,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,u]=t;this.outputShape=[i,e,s,u];const h=[r&&e>1?a-1:a,r&&s>1?l-1:l],d=[r&&e>1?e-1:e,r&&s>1?s-1:s],f=r?"0.5":"0.0";let m;o?m="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":m="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/d[0]},
          ${h[1]/d[1]},
          ${h[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${m};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z7(n){const{inputs:t,backend:e,attrs:s}=n,{images:r}=t,{alignCorners:o,halfPixelCenters:i,size:a}=s,[l,u]=a,h=J().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new B7(r.shape,l,u,o,i):new M7(r.shape,l,u,o,i);return e.runWebGLProgram(h,[r],r.dtype)}const W7={kernelName:Yh,backendName:"webgl",kernelFunc:z7};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class V7{constructor(t,e,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,o]=e,[,i,a]=t,l=[s&&i>1?r-1:r,s&&a>1?o-1:o],u=[s&&i>1?i-1:i,s&&a>1?a-1:a],h=l[0]/u[0],d=l[1]/u[1],f=1/h,m=1/d,g=Math.ceil(f)*2+2,x=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${d});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${m});

        const int winHeight = int(${g});
        const int winWidth = int(${x});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U7(n){const{inputs:t,backend:e,attrs:s}=n,{images:r,dy:o}=t,{alignCorners:i}=s,a=new V7(o.shape,r.shape,i);return e.runWebGLProgram(a,[o],o.dtype)}const G7={kernelName:Am,backendName:"webgl",kernelFunc:U7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class H7{constructor(t,e){this.variableNames=["x"];const s=t.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=t,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${t[0]} - coord - 1));
        }
      `;return}const r=a=>e.indexOf(a)!==-1&&t[a]!==1?`${t[a]} - coords[${a}] - 1`:`coords[${a}]`,o=t.map((a,l)=>r(l)).join(","),i=ye(s);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K7{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=t.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=t;const r=Mn("rc",s),o=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,i=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=ye(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${t[0]} - rc - 1),
            ${t[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),
                ${t[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${o}){
            result.g = ${u(r.slice())};
          }
          if(${i}) {
            result.b = ${h(r.slice())};
            if(${o}) {
              result.a = ${d(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(g){return f(g)}function u(g){return g[s-1]="("+g[s-1]+" + 1)",f(g)}function h(g){return g[s-2]="("+g[s-2]+" + 1)",f(g)}function d(g){return g[s-1]="("+g[s-1]+" + 1)",g[s-2]="("+g[s-2]+" + 1)",f(g)}function f(g){const x=t.map((v,I)=>m(I,g)),b=x.join(","),w=x.slice(-2).join(",");return`getChannel(getX(${b}), vec2(${w}))`}function m(g,x){return e.indexOf(g)!==-1&&t[g]!==1?`${t[g]} - ${x[g]} - 1`:`${x[g]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q7(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{dims:o}=s,i=r.shape.length,a=Xt(o,r.shape);if(i===0)return ds({inputs:{x:r},backend:e});const l=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new K7(r.shape,a):new H7(r.shape,a);return e.runWebGLProgram(l,[r],r.dtype)}const j7={kernelName:Jh,backendName:"webgl",kernelFunc:q7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X7{constructor(t,e){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=t[1],r=t[2];this.outputShape=t;let o="";typeof e=="number"?o=`float outputValue = ${e.toFixed(2)};`:o=`
        vec3 fill = vec3(${e.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y7={kernelName:zm,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=t,a=e,l=new X7(s.shape,o),[u,h]=nx(i,s.shape[1],s.shape[2]),d=[[u,h,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,d)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z7=re({opSnippet:`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`}),J7={kernelName:hu,backendName:"webgl",kernelFunc:Z7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q7=re({opSnippet:"return inversesqrt(x);",cpuKernelImpl:Qq}),t9={kernelName:du,backendName:"webgl",kernelFunc:Q7};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pb{constructor(t,e,s,r,o,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const u=ye(o.length),h=ye(i.length);let d="";s===1?d="i":s===2&&(d="i, j");const f=`getIndices(${d})`;let m="";r===1?m="i":r===2&&(m="i, coords[1]");const g=`getUpdates(${m})`;let x="";l&&(x="coords[0], coords[1]");const b=`getDefaultValue(${x})`,w=e>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${o});

        void main() {
          ${h} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${t}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${e}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${w};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${g};
              found = true;
            }
          }
          setOutput(mix(${b}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e9{constructor(t,e,s,r,o,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const u=ye(o.length),h=ye(i.length);let d="";s===1?d="i":s===2&&(d="i, j");const f=`getIndices(${d})`;let m="";r===1?m="i":r===2&&(m="i, coords[1]");const g=`getUpdates(${m})`;let x="";l&&(x="coords[0], coords[1]");const b=`getDefaultValue(${x})`,w=e>1?"strides[j]":"strides",v=e>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${o});

        void main() {
          ${h} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${t}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${e}; j+=2) {
              ivec4 index = round(${f});
              flattenedIndex += index.xz * ${w};
              if (j + 1 < ${e}) {
                flattenedIndex += index.yw * ${v};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${g};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${b}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n9(n){const{inputs:t,backend:e,attrs:s}=n,{indices:r,updates:o}=t,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:h,outputSize:d}=Di(o,r,i),f=[d/u,u];if(d===0)return e.makeTensorInfo(i,r.dtype);const m=gt({inputs:{x:r},backend:e,attrs:{shape:[l,a]}}),g=gt({inputs:{x:o},backend:e,attrs:{shape:[l,u]}}),x=e.makeTensorInfo([],"float32",new Float32Array([0]));let b;J().getBool("WEBGL_PACK")?b=new e9(l,a,m.shape.length,g.shape.length,h,f):b=new Pb(l,a,m.shape.length,g.shape.length,h,f);const w=e.runWebGLProgram(b,[g,m,x],g.dtype),v=gt({inputs:{x:w},backend:e,attrs:{shape:i}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(w),e.disposeIntermediateTensorInfo(x),v}const s9={kernelName:b1,backendName:"webgl",kernelFunc:n9};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r9{constructor(t,e,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,s];const o="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(e+1))}; ++i) { if (left >= right) break;`,a=J().getNumber("WEBGL_VERSION")===2?o:i,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o9(n){const{inputs:t,backend:e,attrs:s}=n,{sortedSequence:r,values:o}=t,{side:i}=s,a=new r9(r.shape[0],r.shape[1],o.shape[1],i),l=[[r.shape[1]]];return e.runWebGLProgram(a,[r,o],"int32",l)}const i9={kernelName:w1,backendName:"webgl",kernelFunc:o9};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a9{constructor(t,e,s){this.variableNames=["c","a","b"],this.outputShape=e;let r,o;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)o="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let h=0;h<e.length;h++)u.push(`${a[h]}`),h<t&&l.push(`${a[h]}`);r=l.join(),o=u.join()}const i=ye(s);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l9(n){const{inputs:t,backend:e}=n,{condition:s,t:r,e:o}=t,i=new a9(s.shape.length,r.shape,r.shape.length);return e.runWebGLProgram(i,[s,r,o],us(r.dtype,o.dtype))}const u9={kernelName:Qh,backendName:"webgl",kernelFunc:l9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c9=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${_d};
  float scale = ${Rd};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,h9=re({opSnippet:c9}),d9={kernelName:fu,backendName:"webgl",kernelFunc:h9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f9=sl+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,p9=re({opSnippet:f9,packedOpSnippet:`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:e6}),m9={kernelName:xu,backendName:"webgl",kernelFunc:p9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g9=re({opSnippet:`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`}),x9={kernelName:gu,backendName:"webgl",kernelFunc:g9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b9=sl+`
  return sin(x);
`,y9=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Yi}
  return result;
`,w9=re({opSnippet:b9,packedOpSnippet:y9}),v9={kernelName:pu,backendName:"webgl",kernelFunc:w9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C9=re({opSnippet:`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`}),I9={kernelName:mu,backendName:"webgl",kernelFunc:C9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $9=re({opSnippet:`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`}),k9={kernelName:bu,backendName:"webgl",kernelFunc:$9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S9={kernelName:nd,backendName:"webgl",kernelFunc:n=>{const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockShape:o,paddings:i}=s;A(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((w,v)=>w*v),l=[[0,0]];l.push(...i);for(let w=1+o.length;w<r.shape.length;++w)l.push([0,0]);const u=[],h=w2({inputs:{x:r},backend:e,attrs:{paddings:l,constantValue:0}}),d=Uu(h.shape,o,a,!1),f=Gu(d.length,o.length,!1),m=Hu(h.shape,o,a,!1),g=gt({inputs:{x:h},backend:e,attrs:{shape:d}}),x=Bn({inputs:{x:g},backend:e,attrs:{perm:f}}),b=gt({inputs:{x},backend:e,attrs:{shape:m}});return u.push(h),u.push(g),u.push(x),u.forEach(w=>e.disposeIntermediateTensorInfo(w)),b}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N9(n){const{inputs:t,backend:e}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=t;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=e.readSync(s.dataId),l=e.readSync(r.dataId),u=e.readSync(o.dataId),h=e.readSync(i.dataId)[0],[d,f,m,g,x]=s6(a,s.shape,s.dtype,l,r.dtype,u,h);return[e.makeTensorInfo(f,s.dtype,d),e.makeTensorInfo([f[0]],r.dtype,m),e.makeTensorInfo([g.length],"bool",new Uint8Array(g.map(b=>Number(b)))),e.makeTensorInfo([x.length],s.dtype,new Int32Array(x))]}const T9={kernelName:v1,backendName:"webgl",kernelFunc:N9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E9(n){const{inputs:t,backend:e}=n,{inputIndices:s,inputShape:r,newShape:o}=t;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(e.readSync(r.dataId)),a=e.readSync(s.dataId),l=Array.from(e.readSync(o.dataId)),[u,h,d]=r6(a,s.shape,s.dtype,i,l);return[e.makeTensorInfo(h,s.dtype,u),e.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const _9={kernelName:C1,backendName:"webgl",kernelFunc:E9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R9(n){const{inputs:t,backend:e}=n,{data:s,indices:r,segmentIds:o}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const i=e.readSync(s.dataId),a=e.readSync(r.dataId),l=e.readSync(o.dataId),[u,h]=SS(i,s.shape,s.dtype,a,l,!0);return e.makeTensorInfo(h,s.dtype,u)}const A9={kernelName:I1,backendName:"webgl",kernelFunc:R9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D9(n){const{inputs:t,backend:e}=n,{data:s,indices:r,segmentIds:o}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const i=e.readSync(s.dataId),a=e.readSync(r.dataId),l=e.readSync(o.dataId),[u,h]=SS(i,s.shape,s.dtype,a,l);return e.makeTensorInfo(h,s.dtype,u)}const F9={kernelName:$1,backendName:"webgl",kernelFunc:D9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O9(n){const{inputs:t,backend:e,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=t,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:h,strides:d,outputSize:f}=Di(o,r,a),m=!1;if(o.dtype==="string"){const w=e.bufferSync(r),v=e.bufferSync(o),I=To(e.readSync(i.dataId)[0]),C=t6(w,v,a,f,h,u,l,d,I,m);return e.makeTensorInfo(a,C.dtype,C.values)}const g=new Pb(u,l,r.shape.length,o.shape.length,d,[f,1],m),x=e.runWebGLProgram(g,[o,r,i],o.dtype),b=gt({inputs:{x},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(x),b}const L9={kernelName:k1,backendName:"webgl",kernelFunc:O9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P9(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{numOrSizeSplits:o,axis:i}=s,a=Xt(i,r.shape)[0],l=bx(r,o,a),u=r.shape.length,h=new Array(u).fill(0),d=r.shape.slice();return l.map(f=>{const m=[...d];m[a]=f;const g=rl({inputs:{x:r},backend:e,attrs:{begin:h,size:m}});return h[a]+=f,g})}const M9={kernelName:sd,backendName:"webgl",kernelFunc:P9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C2="return sqrt(x);",B9=re({opSnippet:C2,packedOpSnippet:C2,cpuKernelImpl:o6}),z9={kernelName:yu,backendName:"webgl",kernelFunc:B9};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W9=re({opSnippet:"return x * x;"}),V9={kernelName:Fm,backendName:"webgl",kernelFunc:W9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I2="return (a - b) * (a - b);",U9=In({opSnippet:I2,packedOpSnippet:I2}),G9={kernelName:wu,backendName:"webgl",kernelFunc:U9};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H9(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const o=e.readSync(r.dataId),i=to(o),a=i6(i,"string",s);return e.makeTensorInfo(r.shape,"string",a)}const K9={kernelName:Om,backendName:"webgl",kernelFunc:H9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q9({inputs:n,attrs:t,backend:e}){const{x:s}=n,r=qs+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,o=new Br(s.shape,r);return e.runWebGLProgram(o,[s],s.dtype)}const j9={kernelName:ku,backendName:"webgl",kernelFunc:q9};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X9{constructor(t,e,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,o=ye(s.length),i=ye(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((u,h)=>(l++,s.length===1?`coords * strides[${h}] + begin[${h}]`:`coords[${l-1}] * strides[${h}] + begin[${h}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${t});
      ${o} strides = ${o}(${e});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y9(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{begin:o,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:h,newAxisMask:d,shrinkAxisMask:f}=s,{finalShapeSparse:m,finalShape:g,isIdentity:x,sliceDim0:b,isSimpleSlice:w,begin:v,end:I,strides:C}=Qg(r.shape,o,i,a,l,u,h,d,f);let k;if(x)k=gt({inputs:{x:r},backend:e,attrs:{shape:g}});else if(b||w){A(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const T=Yg(v,I,C),R=rl({inputs:{x:r},backend:e,attrs:{begin:v,size:T}});k=gt({inputs:{x:R},backend:e,attrs:{shape:g}}),e.disposeIntermediateTensorInfo(R)}else if(e.shouldExecuteOnCPU([r])){const R=e.readSync(r.dataId),E=Yt(r.shape,r.dtype,R),F=a6(m,E,C,v);k=e.makeTensorInfo(g,r.dtype,F.values)}else{const R=new X9(v,C,m);k=e.runWebGLProgram(R,[r],r.dtype)}const N=gt({inputs:{x:k},backend:e,attrs:{shape:g}});return e.disposeIntermediateTensorInfo(k),N}const Z9={kernelName:Lm,backendName:"webgl",kernelFunc:Y9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J9(n){const{inputs:t,backend:e,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:h,dataSplits:d}=t,f=e.readSync(h.dataId),m=e.readSync(d.dataId),[g,x]=l6(f,m,r,o,i,a,l,u);return[e.makeTensorInfo([g.length],"string",g),e.makeTensorInfo(d.shape,"int32",x)]}const Q9={kernelName:S1,backendName:"webgl",kernelFunc:J9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tZ(n){const{inputs:t,backend:e,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=t;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=e.readSync(o.dataId),l=e.readSync(i.dataId)[0],[u,h,d]=u6(a,l,r),f=h.length;return[e.makeTensorInfo([f,2],"int32",u),e.makeTensorInfo([f],"string",h),e.makeTensorInfo([2],"int32",new Int32Array(d))]}const eZ={kernelName:N1,backendName:"webgl",kernelFunc:tZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nZ(n){const{inputs:t,backend:e,attrs:s}=n,{numBuckets:r}=s,{input:o}=t;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=e.readSync(o.dataId),a=c6(i,r);return e.makeTensorInfo(o.shape,"int32",a)}const sZ={kernelName:T1,backendName:"webgl",kernelFunc:nZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rZ=re({opSnippet:"return tan(x);"}),oZ={kernelName:Cu,backendName:"webgl",kernelFunc:rZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iZ=re({opSnippet:`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`}),aZ={kernelName:Iu,backendName:"webgl",kernelFunc:iZ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lZ(n){const{inputs:t,backend:e,attrs:s}=n,{tensor:r,indices:o,updates:i}=t,{sliceRank:a,numUpdates:l,sliceSize:u,strides:h,outputSize:d}=Di(i,o,r.shape),f=[d/u,u];if(d===0)return e.makeTensorInfo(r.shape,o.dtype);const m=gt({inputs:{x:o},backend:e,attrs:{shape:[l,a]}}),g=gt({inputs:{x:i},backend:e,attrs:{shape:[l,u]}}),x=gt({inputs:{x:r},backend:e,attrs:{shape:f}}),b=new Pb(l,a,m.shape.length,g.shape.length,h,f,!1,!0),w=e.runWebGLProgram(b,[g,m,x],x.dtype),v=gt({inputs:{x:w},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(w),v}const uZ={kernelName:y1,backendName:"webgl",kernelFunc:lZ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cZ{constructor(t,e){this.variableNames=["A"];const s=new Array(t.length);for(let i=0;i<s.length;i++)s[i]=t[i]*e[i];this.outputShape=s,this.rank=s.length;const r=ye(this.rank),o=hZ(t);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function hZ(n){const t=n.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${n[0]})`;const e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${e[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $2(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{reps:o}=s;if(r.dtype==="string"||r.shape.length>5){const l=e.readSync(r.dataId),u=r.dtype==="string"?l.map(f=>To(f)):l,h=Yt(r.shape,r.dtype,u),d=d6(h,o);return e.makeTensorInfo(d.shape,d.dtype,d.values)}const i=new cZ(r.shape,o);return e.runWebGLProgram(i,[r],r.dtype)}const dZ={kernelName:$u,backendName:"webgl",kernelFunc:$2};class fZ{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class pZ{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ji(n,t){t!==null&&n.disposeIntermediateTensorInfo(t)}function k2(n){let t=1;for(;t<n;)t*=2;return t}function mZ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{k:o,sorted:i}=s,a=J().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=J().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,h=u[u.length-1];if(e.shouldExecuteOnCPU([r])||h<a||o>l){const F=e.readSync(r.dataId),[P,q]=f6(F,u,r.dtype,o,i);return[e.makeTensorInfo(P.shape,P.dtype,P.values),e.makeTensorInfo(q.shape,q.dtype,q.values)]}if(o===0)return u[u.length-1]=0,[e.makeTensorInfo(u,r.dtype,[]),e.makeTensorInfo(u,"int32",[])];if(h===1)return[r,wc({attrs:{shape:u,dtype:"int32",value:0},backend:e})];const d=e.texData.get(r.dataId),f=d!==null&&d.isPacked,m=f?e.unpackTensor(r):r,x=st(u)/h,b=gt({inputs:{x:m},attrs:{shape:[x,h]},backend:e});f&&Ji(e,m);const w=k2(o),v=k2(h);let I=null;const C=()=>I===null?[b,b]:[b,I],k=(F,P,q)=>{const j=C(),K=new fZ(q),Q=[[h],[I===null?1:0],[Number.NEGATIVE_INFINITY],[F],[P]],tt=I;I=e.runWebGLProgram(K,j,"int32",Q),Ji(e,tt)};for(let F=1;F<w;F*=2){const P=F*2;for(let q=F;q>=1;q/=2)k(P,q,[x,v])}for(let F=v;F>w;F/=2){const P=C(),q=new pZ([x,F/2]),K=[[h],[I===null?1:0],[w]],Y=I;I=e.runWebGLProgram(q,P,"int32",K),Ji(e,Y);const Q=w/2,tt=Q*2;for(let Z=Q;Z>=1;Z/=2)k(tt,Z,I.shape)}let N=I;I=rl({inputs:{x:I},backend:e,attrs:{begin:0,size:[x,o]}}),Ji(e,N);let T=f2({inputs:{x:b,indices:I},backend:e,attrs:{axis:1,batchDims:1}});Ji(e,b);const R=u.slice(0,-1);R.push(o),N=I,I=gt({inputs:{x:I},attrs:{shape:R},backend:e}),Ji(e,N);const E=T;return T=gt({inputs:{x:T},attrs:{shape:R},backend:e}),Ji(e,E),[T,I]}const gZ={kernelName:Pm,backendName:"webgl",kernelFunc:mZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xZ{constructor(t,e,s,r,o,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${e}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${e}));
                float mapY = mapCoord(inY, float(${t}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bZ(n){const{inputs:t,backend:e,attrs:s}=n,{image:r,transforms:o}=t,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=s,[h,d,f,m]=r.shape,[g,x]=u??[d,f],b=[h,g,x,m],w=new xZ(d,f,i,a,l,b);return e.runWebGLProgram(w,[r,o],"float32")}const yZ={kernelName:Mm,backendName:"webgl",kernelFunc:bZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wZ(n){const{inputs:t,attrs:e,backend:s}=n,{axis:r}=e,{x:o}=t;fc(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=s.readSync(o.dataId),{outputValues:a,outputShape:l,indices:u}=p6(i,r,o.shape,o.dtype);return[s.makeTensorInfo(l,o.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const vZ={kernelName:Bm,backendName:"webgl",kernelFunc:wZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CZ(n){const{inputs:t,backend:e,attrs:s}=n,{value:r}=t;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r,a=i.shape.length,l=r.shape[o],u=new Array(a-1);let h=0;for(let x=0;x<a;x++)x!==o&&(u[h++]=i.shape[x]);const d=[],f=new Array(a).fill(0),m=i.shape.slice();m[o]=1;const g=new Array(l);for(let x=0;x<g.length;x++){f[o]=x;const b=rl({inputs:{x:i},backend:e,attrs:{begin:f,size:m}}),w=gt({inputs:{x:b},backend:e,attrs:{shape:u}});g[x]=w,d.push(b)}return d.forEach(x=>e.disposeIntermediateTensorInfo(x)),g}const IZ={kernelName:od,backendName:"webgl",kernelFunc:CZ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Z{constructor(t,e){this.variableNames=["x","segmentIds"];const s=t.windowSize,r=t.batchSize,o=t.inSize,i=t.numSegments,a=i*Math.ceil(o/s);this.outputShape=[r,a];const l="0.0",u="sumValue",h=Math.floor(s/4)*4,d=s%4,f=`
        sumValue += dot(values, segFilter);
    `;let m="";o%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let g="";o%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${g}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${h};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kZ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,segmentIds:o}=t,{numSegments:i}=s,a=r.shape.length,l=[];let u=0;const h=Be([u],a);let d=r;h!=null&&(d=Bn({inputs:{x:r},backend:e,attrs:{perm:h}}),l.push(d),u=qe(1,a)[0]);const f=Hv(d.shape,u,i),m=st([d.shape[u]]),g=gt({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}});l.push(g);const x=Ym(r.dtype),b=(C,k,N,T,R)=>{const E=C.shape[0],F=C.shape[1],P=Gv(F,R),q={windowSize:P,inSize:F,batchSize:E,numSegments:R},j=new $Z(q,k),K=e.compileAndRun(j,[C,N],T);if(l.push(K),K.shape[1]===R)return K;const Y=v2({backend:e,attrs:{start:0,stop:R,step:1,dtype:"float32"}}),Q=$2({inputs:{x:Y},backend:e,attrs:{reps:[F/P]}});return l.push(Y),l.push(Q),b(K,k,Q,T,R)},w=b(g,"unsortedSegmentSum",o,x,i),v=gt({inputs:{x:w},backend:e,attrs:{shape:f}});let I=v;if(h!=null){l.push(v);const C=Ao(h);I=Bn({inputs:{x:I},backend:e,attrs:{perm:C}})}return l.forEach(C=>e.disposeIntermediateTensorInfo(C)),I}const SZ={kernelName:id,backendName:"webgl",kernelFunc:kZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NZ=[oj,aj,cj,fj,mj,bj,wj,Cj,Sj,Tj,Rj,Fj,Pj,Wj,Gj,Kj,jj,Jj,tX,nX,oX,hX,fX,xX,yX,$X,SX,_X,V6,DX,MX,VX,jX,ZX,QX,e5,s5,a5,u5,h5,f5,m5,x5,w5,C5,S5,T5,R5,F5,L5,M5,W5,U5,K5,j5,X5,Z5,Q5,e8,s8,o8,a8,c8,f8,m8,b8,v8,I8,k8,W6,N8,LX,E8,R8,D8,G6,O8,P8,B8,V8,H8,q8,X8,Z8,tY,nY,rY,lY,cY,dY,gY,bY,wY,CY,$Y,TY,RY,OY,WY,q6,HY,jY,ZY,t7,wX,n7,r7,i7,u7,f7,K6,m7,x7,y7,v7,C7,vX,PY,$7,N7,_7,X6,F7,P7,W7,G7,j7,Y7,J7,t9,s9,i9,u9,d9,m9,x9,v9,I9,cX,BY,k9,S9,T9,_9,A9,F9,L9,M9,z9,V9,G9,K9,j9,Z9,Q9,eZ,sZ,MY,nj,oZ,aZ,uZ,dZ,gZ,yZ,sj,vZ,IZ,SZ,s7];for(const n of NZ)D1(n);const Pe=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,un=Object.keys,zn=Array.isArray;function Qn(n,t){return typeof t!="object"||un(t).forEach(function(e){n[e]=t[e]}),n}typeof Promise>"u"||Pe.Promise||(Pe.Promise=Promise);const vc=Object.getPrototypeOf,TZ={}.hasOwnProperty;function ks(n,t){return TZ.call(n,t)}function il(n,t){typeof t=="function"&&(t=t(vc(n))),(typeof Reflect>"u"?un:Reflect.ownKeys)(t).forEach(e=>{ro(n,e,t[e])})}const S2=Object.defineProperty;function ro(n,t,e,s){S2(n,t,Qn(e&&ks(e,"get")&&typeof e.get=="function"?{get:e.get,set:e.set,configurable:!0}:{value:e,configurable:!0,writable:!0},s))}function al(n){return{from:function(t){return n.prototype=Object.create(t.prototype),ro(n.prototype,"constructor",n),{extend:il.bind(null,n.prototype)}}}}const EZ=Object.getOwnPropertyDescriptor;function Mb(n,t){let e;return EZ(n,t)||(e=vc(n))&&Mb(e,t)}const _Z=[].slice;function Ef(n,t,e){return _Z.call(n,t,e)}function N2(n,t){return t(n)}function Cc(n){if(!n)throw new Error("Assertion Failed")}function T2(n){Pe.setImmediate?setImmediate(n):setTimeout(n,0)}function E2(n,t){return n.reduce((e,s,r)=>{var o=t(s,r);return o&&(e[o[0]]=o[1]),e},{})}function oo(n,t){if(ks(n,t))return n[t];if(!t)return n;if(typeof t!="string"){for(var e=[],s=0,r=t.length;s<r;++s){var o=oo(n,t[s]);e.push(o)}return e}var i=t.indexOf(".");if(i!==-1){var a=n[t.substr(0,i)];return a===void 0?void 0:oo(a,t.substr(i+1))}}function gr(n,t,e){if(n&&t!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(n)))if(typeof t!="string"&&"length"in t){Cc(typeof e!="string"&&"length"in e);for(var s=0,r=t.length;s<r;++s)gr(n,t[s],e[s])}else{var o=t.indexOf(".");if(o!==-1){var i=t.substr(0,o),a=t.substr(o+1);if(a==="")e===void 0?zn(n)&&!isNaN(parseInt(i))?n.splice(i,1):delete n[i]:n[i]=e;else{var l=n[i];l&&ks(n,i)||(l=n[i]={}),gr(l,a,e)}}else e===void 0?zn(n)&&!isNaN(parseInt(t))?n.splice(t,1):delete n[t]:n[t]=e}}function _2(n){var t={};for(var e in n)ks(n,e)&&(t[e]=n[e]);return t}const RZ=[].concat;function R2(n){return RZ.apply([],n)}const A2="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(R2([8,16,32,64].map(n=>["Int","Uint","Float"].map(t=>t+n+"Array")))).filter(n=>Pe[n]),AZ=A2.map(n=>Pe[n]);E2(A2,n=>[n,!0]);let Yo=null;function Ic(n){Yo=typeof WeakMap<"u"&&new WeakMap;const t=Bb(n);return Yo=null,t}function Bb(n){if(!n||typeof n!="object")return n;let t=Yo&&Yo.get(n);if(t)return t;if(zn(n)){t=[],Yo&&Yo.set(n,t);for(var e=0,s=n.length;e<s;++e)t.push(Bb(n[e]))}else if(AZ.indexOf(n.constructor)>=0)t=n;else{const o=vc(n);for(var r in t=o===Object.prototype?{}:Object.create(o),Yo&&Yo.set(n,t),n)ks(n,r)&&(t[r]=Bb(n[r]))}return t}const{toString:DZ}={};function zb(n){return DZ.call(n).slice(8,-1)}const Wb=typeof Symbol<"u"?Symbol.iterator:"@@iterator",FZ=typeof Wb=="symbol"?function(n){var t;return n!=null&&(t=n[Wb])&&t.apply(n)}:function(){return null},ll={};function io(n){var t,e,s,r;if(arguments.length===1){if(zn(n))return n.slice();if(this===ll&&typeof n=="string")return[n];if(r=FZ(n)){for(e=[];!(s=r.next()).done;)e.push(s.value);return e}if(n==null)return[n];if(typeof(t=n.length)=="number"){for(e=new Array(t);t--;)e[t]=n[t];return e}return[n]}for(t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return e}const Vb=typeof Symbol<"u"?n=>n[Symbol.toStringTag]==="AsyncFunction":()=>!1;var zr=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function D2(n,t){zr=n,F2=t}var F2=()=>!0;const OZ=!new Error("").stack;function Qi(){if(OZ)try{throw Qi.arguments,new Error}catch(n){return n}return new Error}function Ub(n,t){var e=n.stack;return e?(t=t||0,e.indexOf(n.name)===0&&(t+=(n.name+n.message).split(`
`).length),e.split(`
`).slice(t).filter(F2).map(s=>`
`+s).join("")):""}var O2=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Gb=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(O2),LZ={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ul(n,t){this._e=Qi(),this.name=n,this.message=t}function L2(n,t){return n+". Errors: "+Object.keys(t).map(e=>t[e].toString()).filter((e,s,r)=>r.indexOf(e)===s).join(`
`)}function _f(n,t,e,s){this._e=Qi(),this.failures=t,this.failedKeys=s,this.successCount=e,this.message=L2(n,t)}function $c(n,t){this._e=Qi(),this.name="BulkError",this.failures=Object.keys(t).map(e=>t[e]),this.failuresByPos=t,this.message=L2(n,t)}al(ul).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Ub(this._e,2))}},toString:function(){return this.name+": "+this.message}}),al(_f).from(ul),al($c).from(ul);var Hb=Gb.reduce((n,t)=>(n[t]=t+"Error",n),{});const PZ=ul;var zt=Gb.reduce((n,t)=>{var e=t+"Error";function s(r,o){this._e=Qi(),this.name=e,r?typeof r=="string"?(this.message=`${r}${o?`
 `+o:""}`,this.inner=o||null):typeof r=="object"&&(this.message=`${r.name} ${r.message}`,this.inner=r):(this.message=LZ[t]||e,this.inner=null)}return al(s).from(PZ),n[t]=s,n},{});zt.Syntax=SyntaxError,zt.Type=TypeError,zt.Range=RangeError;var P2=O2.reduce((n,t)=>(n[t+"Error"]=zt[t],n),{}),Rf=Gb.reduce((n,t)=>(["Syntax","Type","Range"].indexOf(t)===-1&&(n[t+"Error"]=zt[t]),n),{});function Te(){}function kc(n){return n}function MZ(n,t){return n==null||n===kc?t:function(e){return t(n(e))}}function ta(n,t){return function(){n.apply(this,arguments),t.apply(this,arguments)}}function BZ(n,t){return n===Te?t:function(){var e=n.apply(this,arguments);e!==void 0&&(arguments[0]=e);var s=this.onsuccess,r=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?ta(s,this.onsuccess):s),r&&(this.onerror=this.onerror?ta(r,this.onerror):r),o!==void 0?o:e}}function zZ(n,t){return n===Te?t:function(){n.apply(this,arguments);var e=this.onsuccess,s=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),e&&(this.onsuccess=this.onsuccess?ta(e,this.onsuccess):e),s&&(this.onerror=this.onerror?ta(s,this.onerror):s)}}function WZ(n,t){return n===Te?t:function(e){var s=n.apply(this,arguments);Qn(e,s);var r=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ta(r,this.onsuccess):r),o&&(this.onerror=this.onerror?ta(o,this.onerror):o),s===void 0?i===void 0?void 0:i:Qn(s,i)}}function VZ(n,t){return n===Te?t:function(){return t.apply(this,arguments)!==!1&&n.apply(this,arguments)}}function Kb(n,t){return n===Te?t:function(){var e=n.apply(this,arguments);if(e&&typeof e.then=="function"){for(var s=this,r=arguments.length,o=new Array(r);r--;)o[r]=arguments[r];return e.then(function(){return t.apply(s,o)})}return t.apply(this,arguments)}}Rf.ModifyError=_f,Rf.DexieError=ul,Rf.BulkError=$c;var Sc={};const M2=100,[qb,Af,jb]=typeof Promise>"u"?[]:(()=>{let n=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[n,vc(n),n];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,vc(t),n]})(),B2=Af&&Af.then,Df=qb&&qb.constructor,Xb=!!jb;var Yb=!1,UZ=jb?()=>{jb.then(Pf)}:Pe.setImmediate?setImmediate.bind(null,Pf):Pe.MutationObserver?()=>{var n=document.createElement("div");new MutationObserver(()=>{Pf(),n=null}).observe(n,{attributes:!0}),n.setAttribute("i","1")}:()=>{setTimeout(Pf,0)},Nc=function(n,t){Tc.push([n,t]),Ff&&(UZ(),Ff=!1)},Zb=!0,Ff=!0,ea=[],Of=[],Jb=null,Qb=kc,cl={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:X2,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(n=>{try{X2(n[0],n[1])}catch{}})}},Ft=cl,Tc=[],na=0,Lf=[];function $t(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=Te,this._lib=!1;var t=this._PSD=Ft;if(zr&&(this._stackHolder=Qi(),this._prev=null,this._numPrev=0),typeof n!="function"){if(n!==Sc)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&ey(this,this._value))}this._state=null,this._value=null,++t.ref,W2(this,n)}const ty={get:function(){var n=Ft,t=zf;function e(s,r){var o=!n.global&&(n!==Ft||t!==zf);const i=o&&!ao();var a=new $t((l,u)=>{ny(this,new z2(Vf(s,n,o,i),Vf(r,n,o,i),l,u,n))});return zr&&G2(a,this),a}return e.prototype=Sc,e},set:function(n){ro(this,"then",n&&n.prototype===Sc?ty:{get:function(){return n},set:ty.set})}};function z2(n,t,e,s,r){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof t=="function"?t:null,this.resolve=e,this.reject=s,this.psd=r}function W2(n,t){try{t(e=>{if(n._state===null){if(e===n)throw new TypeError("A promise cannot be resolved with itself.");var s=n._lib&&Ec();e&&typeof e.then=="function"?W2(n,(r,o)=>{e instanceof $t?e._then(r,o):e.then(r,o)}):(n._state=!0,n._value=e,V2(n)),s&&_c()}},ey.bind(null,n))}catch(e){ey(n,e)}}function ey(n,t){if(Of.push(t),n._state===null){var e=n._lib&&Ec();t=Qb(t),n._state=!1,n._value=t,zr&&t!==null&&typeof t=="object"&&!t._promise&&function(s,r,o){try{s.apply(null,o)}catch(i){r&&r(i)}}(()=>{var s=Mb(t,"stack");t._promise=n,ro(t,"stack",{get:()=>Yb?s&&(s.get?s.get.apply(t):s.value):n.stack})}),function(s){ea.some(r=>r._value===s._value)||ea.push(s)}(n),V2(n),e&&_c()}}function V2(n){var t=n._listeners;n._listeners=[];for(var e=0,s=t.length;e<s;++e)ny(n,t[e]);var r=n._PSD;--r.ref||r.finalize(),na===0&&(++na,Nc(()=>{--na==0&&sy()},[]))}function ny(n,t){if(n._state!==null){var e=n._state?t.onFulfilled:t.onRejected;if(e===null)return(n._state?t.resolve:t.reject)(n._value);++t.psd.ref,++na,Nc(GZ,[e,n,t])}else n._listeners.push(t)}function GZ(n,t,e){try{Jb=t;var s,r=t._value;t._state?s=n(r):(Of.length&&(Of=[]),s=n(r),Of.indexOf(r)===-1&&function(o){for(var i=ea.length;i;)if(ea[--i]._value===o._value)return void ea.splice(i,1)}(t)),e.resolve(s)}catch(o){e.reject(o)}finally{Jb=null,--na==0&&sy(),--e.psd.ref||e.psd.finalize()}}function U2(n,t,e){if(t.length===e)return t;var s="";if(n._state===!1){var r,o,i=n._value;i!=null?(r=i.name||"Error",o=i.message||i,s=Ub(i,0)):(r=i,o=""),t.push(r+(o?": "+o:"")+s)}return zr&&((s=Ub(n._stackHolder,2))&&t.indexOf(s)===-1&&t.push(s),n._prev&&U2(n._prev,t,e)),t}function G2(n,t){var e=t?t._numPrev+1:0;e<100&&(n._prev=t,n._numPrev=e)}function Pf(){Ec()&&_c()}function Ec(){var n=Zb;return Zb=!1,Ff=!1,n}function _c(){var n,t,e;do for(;Tc.length>0;)for(n=Tc,Tc=[],e=n.length,t=0;t<e;++t){var s=n[t];s[0].apply(null,s[1])}while(Tc.length>0);Zb=!0,Ff=!0}function sy(){var n=ea;ea=[],n.forEach(s=>{s._PSD.onunhandled.call(null,s._value,s)});for(var t=Lf.slice(0),e=t.length;e;)t[--e]()}function Mf(n){return new $t(Sc,!1,n)}function We(n,t){var e=Ft;return function(){var s=Ec(),r=Ft;try{return Jo(e,!0),n.apply(this,arguments)}catch(o){t&&t(o)}finally{Jo(r,!1),s&&_c()}}}il($t.prototype,{then:ty,_then:function(n,t){ny(this,new z2(null,null,n,t,Ft))},catch:function(n){if(arguments.length===1)return this.then(null,n);var t=arguments[0],e=arguments[1];return typeof t=="function"?this.then(null,s=>s instanceof t?e(s):Mf(s)):this.then(null,s=>s&&s.name===t?e(s):Mf(s))},finally:function(n){return this.then(t=>(n(),t),t=>(n(),Mf(t)))},stack:{get:function(){if(this._stack)return this._stack;try{Yb=!0;var n=U2(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=n),n}finally{Yb=!1}}},timeout:function(n,t){return n<1/0?new $t((e,s)=>{var r=setTimeout(()=>s(new zt.Timeout(t)),n);this.then(e,s).finally(clearTimeout.bind(null,r))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ro($t.prototype,Symbol.toStringTag,"Dexie.Promise"),cl.env=H2(),il($t,{all:function(){var n=io.apply(null,arguments).map(Wf);return new $t(function(t,e){n.length===0&&t([]);var s=n.length;n.forEach((r,o)=>$t.resolve(r).then(i=>{n[o]=i,--s||t(n)},e))})},resolve:n=>{if(n instanceof $t)return n;if(n&&typeof n.then=="function")return new $t((e,s)=>{n.then(e,s)});var t=new $t(Sc,!0,n);return G2(t,Jb),t},reject:Mf,race:function(){var n=io.apply(null,arguments).map(Wf);return new $t((t,e)=>{n.map(s=>$t.resolve(s).then(t,e))})},PSD:{get:()=>Ft,set:n=>Ft=n},totalEchoes:{get:()=>zf},newPSD:Zo,usePSD:dl,scheduler:{get:()=>Nc,set:n=>{Nc=n}},rejectionMapper:{get:()=>Qb,set:n=>{Qb=n}},follow:(n,t)=>new $t((e,s)=>Zo((r,o)=>{var i=Ft;i.unhandleds=[],i.onunhandled=o,i.finalize=ta(function(){(function(a){function l(){a(),Lf.splice(Lf.indexOf(l),1)}Lf.push(l),++na,Nc(()=>{--na==0&&sy()},[])})(()=>{this.unhandleds.length===0?r():o(this.unhandleds[0])})},i.finalize),n()},t,e,s))}),Df&&(Df.allSettled&&ro($t,"allSettled",function(){const n=io.apply(null,arguments).map(Wf);return new $t(t=>{n.length===0&&t([]);let e=n.length;const s=new Array(e);n.forEach((r,o)=>$t.resolve(r).then(i=>s[o]={status:"fulfilled",value:i},i=>s[o]={status:"rejected",reason:i}).then(()=>--e||t(s)))})}),Df.any&&typeof AggregateError<"u"&&ro($t,"any",function(){const n=io.apply(null,arguments).map(Wf);return new $t((t,e)=>{n.length===0&&e(new AggregateError([]));let s=n.length;const r=new Array(s);n.forEach((o,i)=>$t.resolve(o).then(a=>t(a),a=>{r[i]=a,--s||e(new AggregateError(r))}))})}));const Wn={awaits:0,echoes:0,id:0};var HZ=0,Bf=[],ry=0,zf=0,KZ=0;function Zo(n,t,e,s){var r=Ft,o=Object.create(r);o.parent=r,o.ref=0,o.global=!1,o.id=++KZ;var i=cl.env;o.env=Xb?{Promise:$t,PromiseProp:{value:$t,configurable:!0,writable:!0},all:$t.all,race:$t.race,allSettled:$t.allSettled,any:$t.any,resolve:$t.resolve,reject:$t.reject,nthen:q2(i.nthen,o),gthen:q2(i.gthen,o)}:{},t&&Qn(o,t),++r.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=dl(o,n,e,s);return o.ref===0&&o.finalize(),a}function hl(){return Wn.id||(Wn.id=++HZ),++Wn.awaits,Wn.echoes+=M2,Wn.id}function ao(){return!!Wn.awaits&&(--Wn.awaits==0&&(Wn.id=0),Wn.echoes=Wn.awaits*M2,!0)}function Wf(n){return Wn.echoes&&n&&n.constructor===Df?(hl(),n.then(t=>(ao(),t),t=>(ao(),mn(t)))):n}function qZ(n){++zf,Wn.echoes&&--Wn.echoes!=0||(Wn.echoes=Wn.id=0),Bf.push(Ft),Jo(n,!0)}function jZ(){var n=Bf[Bf.length-1];Bf.pop(),Jo(n,!1)}function Jo(n,t){var e=Ft;if((t?!Wn.echoes||ry++&&n===Ft:!ry||--ry&&n===Ft)||K2(t?qZ.bind(null,n):jZ),n!==Ft&&(Ft=n,e===cl&&(cl.env=H2()),Xb)){var s=cl.env.Promise,r=n.env;Af.then=r.nthen,s.prototype.then=r.gthen,(e.global||n.global)&&(Object.defineProperty(Pe,"Promise",r.PromiseProp),s.all=r.all,s.race=r.race,s.resolve=r.resolve,s.reject=r.reject,r.allSettled&&(s.allSettled=r.allSettled),r.any&&(s.any=r.any))}}function H2(){var n=Pe.Promise;return Xb?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(Pe,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject,nthen:Af.then,gthen:n.prototype.then}:{}}function dl(n,t,e,s,r){var o=Ft;try{return Jo(n,!0),t(e,s,r)}finally{Jo(o,!1)}}function K2(n){B2.call(qb,n)}function Vf(n,t,e,s){return typeof n!="function"?n:function(){var r=Ft;e&&hl(),Jo(t,!0);try{return n.apply(this,arguments)}finally{Jo(r,!1),s&&K2(ao)}}}function q2(n,t){return function(e,s){return n.call(this,Vf(e,t),Vf(s,t))}}(""+B2).indexOf("[native code]")===-1&&(hl=ao=Te);const j2="unhandledrejection";function X2(n,t){var e;try{e=t.onuncatched(n)}catch{}if(e!==!1)try{var s,r={promise:t,reason:n};if(Pe.document&&document.createEvent?((s=document.createEvent("Event")).initEvent(j2,!0,!0),Qn(s,r)):Pe.CustomEvent&&Qn(s=new CustomEvent(j2,{detail:r}),r),s&&Pe.dispatchEvent&&(dispatchEvent(s),!Pe.PromiseRejectionEvent&&Pe.onunhandledrejection))try{Pe.onunhandledrejection(s)}catch{}zr&&s&&!s.defaultPrevented&&console.warn(`Unhandled rejection: ${n.stack||n}`)}catch{}}var mn=$t.reject;function oy(n,t,e,s){if(n.idbdb&&(n._state.openComplete||Ft.letThrough||n._vip)){var r=n._createTransaction(t,e,n._dbSchema);try{r.create(),n._state.PR1398_maxLoop=3}catch(o){return o.name===Hb.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>oy(n,t,e,s))):mn(o)}return r._promise(t,(o,i)=>Zo(()=>(Ft.trans=r,s(o,i,r)))).then(o=>r._completion.then(()=>o))}if(n._state.openComplete)return mn(new zt.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen)return mn(new zt.DatabaseClosed);n.open().catch(Te)}return n._state.dbReadyPromise.then(()=>oy(n,t,e,s))}const Y2="3.2.4",sa=String.fromCharCode(65535),iy=-1/0,lo="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Z2="String expected.",Rc=[],Uf=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),XZ=Uf,YZ=Uf,J2=n=>!/(dexie\.js|dexie\.min\.js)/.test(n),Gf="__dbnames",ay="readonly",ly="readwrite";function ra(n,t){return n?t?function(){return n.apply(this,arguments)&&t.apply(this,arguments)}:n:t}const Q2={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Hf(n){return typeof n!="string"||/\./.test(n)?t=>t:t=>(t[n]===void 0&&n in t&&delete(t=Ic(t))[n],t)}class ZZ{_trans(t,e,s){const r=this._tx||Ft.trans,o=this.name;function i(l,u,h){if(!h.schema[o])throw new zt.NotFound("Table "+o+" not part of transaction");return e(h.idbtrans,h)}const a=Ec();try{return r&&r.db===this.db?r===Ft.trans?r._promise(t,i,s):Zo(()=>r._promise(t,i,s),{trans:r,transless:Ft.transless||Ft}):oy(this.db,t,[this.name],i)}finally{a&&_c()}}get(t,e){return t&&t.constructor===Object?this.where(t).first(e):this._trans("readonly",s=>this.core.get({trans:s,key:t}).then(r=>this.hook.reading.fire(r))).then(e)}where(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(zn(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const e=un(t);if(e.length===1)return this.where(e[0]).equals(t[e[0]]);const s=this.schema.indexes.concat(this.schema.primKey).filter(u=>u.compound&&e.every(h=>u.keyPath.indexOf(h)>=0)&&u.keyPath.every(h=>e.indexOf(h)>=0))[0];if(s&&this.db._maxKey!==sa)return this.where(s.name).equals(s.keyPath.map(u=>t[u]));!s&&zr&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${e.join("+")}]`);const{idxByName:r}=this.schema,o=this.db._deps.indexedDB;function i(u,h){try{return o.cmp(u,h)===0}catch{return!1}}const[a,l]=e.reduce(([u,h],d)=>{const f=r[d],m=t[d];return[u||f,u||!f?ra(h,f&&f.multi?g=>{const x=oo(g,d);return zn(x)&&x.some(b=>i(m,b))}:g=>i(m,oo(g,d))):h]},[null,null]);return a?this.where(a.name).equals(t[a.keyPath]).filter(l):s?this.filter(l):this.where(e).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,zn(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const e=s=>{if(!s)return s;const r=Object.create(t.prototype);for(var o in s)if(ks(s,o))try{r[o]=s[o]}catch{}return r};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=e,this.hook("reading",e),t}defineClass(){return this.mapToClass(function(t){Qn(this,t)})}add(t,e){const{auto:s,keyPath:r}=this.schema.primKey;let o=t;return r&&s&&(o=Hf(r)(t)),this._trans("readwrite",i=>this.core.mutate({trans:i,type:"add",keys:e!=null?[e]:null,values:[o]})).then(i=>i.numFailures?$t.reject(i.failures[0]):i.lastResult).then(i=>{if(r)try{gr(t,r,i)}catch{}return i})}update(t,e){if(typeof t!="object"||zn(t))return this.where(":id").equals(t).modify(e);{const s=oo(t,this.schema.primKey.keyPath);if(s===void 0)return mn(new zt.InvalidArgument("Given object does not contain its primary key"));try{typeof e!="function"?un(e).forEach(r=>{gr(t,r,e[r])}):e(t,{value:t,primKey:s})}catch{}return this.where(":id").equals(s).modify(e)}}put(t,e){const{auto:s,keyPath:r}=this.schema.primKey;let o=t;return r&&s&&(o=Hf(r)(t)),this._trans("readwrite",i=>this.core.mutate({trans:i,type:"put",values:[o],keys:e!=null?[e]:null})).then(i=>i.numFailures?$t.reject(i.failures[0]):i.lastResult).then(i=>{if(r)try{gr(t,r,i)}catch{}return i})}delete(t){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"delete",keys:[t]})).then(e=>e.numFailures?$t.reject(e.failures[0]):void 0)}clear(){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"deleteRange",range:Q2})).then(t=>t.numFailures?$t.reject(t.failures[0]):void 0)}bulkGet(t){return this._trans("readonly",e=>this.core.getMany({keys:t,trans:e}).then(s=>s.map(r=>this.hook.reading.fire(r))))}bulkAdd(t,e,s){const r=Array.isArray(e)?e:void 0,o=(s=s||(r?void 0:e))?s.allKeys:void 0;return this._trans("readwrite",i=>{const{auto:a,keyPath:l}=this.schema.primKey;if(l&&r)throw new zt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==t.length)throw new zt.InvalidArgument("Arguments objects and keys must have the same length");const u=t.length;let h=l&&a?t.map(Hf(l)):t;return this.core.mutate({trans:i,type:"add",keys:r,values:h,wantResults:o}).then(({numFailures:d,results:f,lastResult:m,failures:g})=>{if(d===0)return o?f:m;throw new $c(`${this.name}.bulkAdd(): ${d} of ${u} operations failed`,g)})})}bulkPut(t,e,s){const r=Array.isArray(e)?e:void 0,o=(s=s||(r?void 0:e))?s.allKeys:void 0;return this._trans("readwrite",i=>{const{auto:a,keyPath:l}=this.schema.primKey;if(l&&r)throw new zt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==t.length)throw new zt.InvalidArgument("Arguments objects and keys must have the same length");const u=t.length;let h=l&&a?t.map(Hf(l)):t;return this.core.mutate({trans:i,type:"put",keys:r,values:h,wantResults:o}).then(({numFailures:d,results:f,lastResult:m,failures:g})=>{if(d===0)return o?f:m;throw new $c(`${this.name}.bulkPut(): ${d} of ${u} operations failed`,g)})})}bulkDelete(t){const e=t.length;return this._trans("readwrite",s=>this.core.mutate({trans:s,type:"delete",keys:t})).then(({numFailures:s,lastResult:r,failures:o})=>{if(s===0)return r;throw new $c(`${this.name}.bulkDelete(): ${s} of ${e} operations failed`,o)})}}function Ac(n){var t={},e=function(i,a){if(a){for(var l=arguments.length,u=new Array(l-1);--l;)u[l-1]=arguments[l];return t[i].subscribe.apply(null,u),n}if(typeof i=="string")return t[i]};e.addEventType=o;for(var s=1,r=arguments.length;s<r;++s)o(arguments[s]);return e;function o(i,a,l){if(typeof i!="object"){var u;a||(a=VZ),l||(l=Te);var h={subscribers:[],fire:l,subscribe:function(d){h.subscribers.indexOf(d)===-1&&(h.subscribers.push(d),h.fire=a(h.fire,d))},unsubscribe:function(d){h.subscribers=h.subscribers.filter(function(f){return f!==d}),h.fire=h.subscribers.reduce(a,l)}};return t[i]=e[i]=h,h}un(u=i).forEach(function(d){var f=u[d];if(zn(f))o(d,u[d][0],u[d][1]);else{if(f!=="asap")throw new zt.InvalidArgument("Invalid event config");var m=o(d,kc,function(){for(var g=arguments.length,x=new Array(g);g--;)x[g]=arguments[g];m.subscribers.forEach(function(b){T2(function(){b.apply(null,x)})})})}})}}function Dc(n,t){return al(t).from({prototype:n}),t}function fl(n,t){return!(n.filter||n.algorithm||n.or)&&(t?n.justLimit:!n.replayFilter)}function uy(n,t){n.filter=ra(n.filter,t)}function cy(n,t,e){var s=n.replayFilter;n.replayFilter=s?()=>ra(s(),t()):t,n.justLimit=e&&!s}function Kf(n,t){if(n.isPrimKey)return t.primaryKey;const e=t.getIndexByKeyPath(n.index);if(!e)throw new zt.Schema("KeyPath "+n.index+" on object store "+t.name+" is not indexed");return e}function tN(n,t,e){const s=Kf(n,t.schema);return t.openCursor({trans:e,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:s,range:n.range}})}function qf(n,t,e,s){const r=n.replayFilter?ra(n.filter,n.replayFilter()):n.filter;if(n.or){const o={},i=(a,l,u)=>{if(!r||r(l,u,f=>l.stop(f),f=>l.fail(f))){var h=l.primaryKey,d=""+h;d==="[object ArrayBuffer]"&&(d=""+new Uint8Array(h)),ks(o,d)||(o[d]=!0,t(a,l,u))}};return Promise.all([n.or._iterate(i,e),eN(tN(n,s,e),n.algorithm,i,!n.keysOnly&&n.valueMapper)])}return eN(tN(n,s,e),ra(n.algorithm,r),t,!n.keysOnly&&n.valueMapper)}function eN(n,t,e,s){var r=We(s?(o,i,a)=>e(s(o),i,a):e);return n.then(o=>{if(o)return o.start(()=>{var i=()=>o.continue();t&&!t(o,a=>i=a,a=>{o.stop(a),i=Te},a=>{o.fail(a),i=Te})||r(o.value,o,a=>i=a),i()})})}function ts(n,t){try{const e=nN(n),s=nN(t);if(e!==s)return e==="Array"?1:s==="Array"?-1:e==="binary"?1:s==="binary"?-1:e==="string"?1:s==="string"?-1:e==="Date"?1:s!=="Date"?NaN:-1;switch(e){case"number":case"Date":case"string":return n>t?1:n<t?-1:0;case"binary":return function(r,o){const i=r.length,a=o.length,l=i<a?i:a;for(let u=0;u<l;++u)if(r[u]!==o[u])return r[u]<o[u]?-1:1;return i===a?0:i<a?-1:1}(sN(n),sN(t));case"Array":return function(r,o){const i=r.length,a=o.length,l=i<a?i:a;for(let u=0;u<l;++u){const h=ts(r[u],o[u]);if(h!==0)return h}return i===a?0:i<a?-1:1}(n,t)}}catch{}return NaN}function nN(n){const t=typeof n;if(t!=="object")return t;if(ArrayBuffer.isView(n))return"binary";const e=zb(n);return e==="ArrayBuffer"?"binary":e}function sN(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}class JZ{_read(t,e){var s=this._ctx;return s.error?s.table._trans(null,mn.bind(null,s.error)):s.table._trans("readonly",t).then(e)}_write(t){var e=this._ctx;return e.error?e.table._trans(null,mn.bind(null,e.error)):e.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var e=this._ctx;e.algorithm=ra(e.algorithm,t)}_iterate(t,e){return qf(this._ctx,t,e,this._ctx.table.core)}clone(t){var e=Object.create(this.constructor.prototype),s=Object.create(this._ctx);return t&&Qn(s,t),e._ctx=s,e}raw(){return this._ctx.valueMapper=null,this}each(t){var e=this._ctx;return this._read(s=>qf(e,t,s,e.table.core))}count(t){return this._read(e=>{const s=this._ctx,r=s.table.core;if(fl(s,!0))return r.count({trans:e,query:{index:Kf(s,r.schema),range:s.range}}).then(i=>Math.min(i,s.limit));var o=0;return qf(s,()=>(++o,!1),e,r).then(()=>o)}).then(t)}sortBy(t,e){const s=t.split(".").reverse(),r=s[0],o=s.length-1;function i(u,h){return h?i(u[s[h]],h-1):u[r]}var a=this._ctx.dir==="next"?1:-1;function l(u,h){var d=i(u,o),f=i(h,o);return d<f?-a:d>f?a:0}return this.toArray(function(u){return u.sort(l)}).then(e)}toArray(t){return this._read(e=>{var s=this._ctx;if(s.dir==="next"&&fl(s,!0)&&s.limit>0){const{valueMapper:r}=s,o=Kf(s,s.table.core.schema);return s.table.core.query({trans:e,limit:s.limit,values:!0,query:{index:o,range:s.range}}).then(({result:i})=>r?i.map(r):i)}{const r=[];return qf(s,o=>r.push(o),e,s.table.core).then(()=>r)}},t)}offset(t){var e=this._ctx;return t<=0||(e.offset+=t,fl(e)?cy(e,()=>{var s=t;return(r,o)=>s===0||(s===1?(--s,!1):(o(()=>{r.advance(s),s=0}),!1))}):cy(e,()=>{var s=t;return()=>--s<0})),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),cy(this._ctx,()=>{var e=t;return function(s,r,o){return--e<=0&&r(o),e>=0}},!0),this}until(t,e){return uy(this._ctx,function(s,r,o){return!t(s.value)||(r(o),e)}),this}first(t){return this.limit(1).toArray(function(e){return e[0]}).then(t)}last(t){return this.reverse().first(t)}filter(t){var e,s;return uy(this._ctx,function(r){return t(r.value)}),e=this._ctx,s=t,e.isMatch=ra(e.isMatch,s),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(s,r){t(r.key,r)})}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(s,r){t(r.primaryKey,r)})}keys(t){var e=this._ctx;e.keysOnly=!e.isMatch;var s=[];return this.each(function(r,o){s.push(o.key)}).then(function(){return s}).then(t)}primaryKeys(t){var e=this._ctx;if(e.dir==="next"&&fl(e,!0)&&e.limit>0)return this._read(r=>{var o=Kf(e,e.table.core.schema);return e.table.core.query({trans:r,values:!1,limit:e.limit,query:{index:o,range:e.range}})}).then(({result:r})=>r).then(t);e.keysOnly=!e.isMatch;var s=[];return this.each(function(r,o){s.push(o.primaryKey)}).then(function(){return s}).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys(function(e){return e[0]}).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,e=t.index&&t.table.schema.idxByName[t.index];if(!e||!e.multi)return this;var s={};return uy(this._ctx,function(r){var o=r.primaryKey.toString(),i=ks(s,o);return s[o]=!0,!i}),this}modify(t){var e=this._ctx;return this._write(s=>{var r;if(typeof t=="function")r=t;else{var o=un(t),i=o.length;r=function(x){for(var b=!1,w=0;w<i;++w){var v=o[w],I=t[v];oo(x,v)!==I&&(gr(x,v,I),b=!0)}return b}}const a=e.table.core,{outbound:l,extractKey:u}=a.schema.primaryKey,h=this.db._options.modifyChunkSize||200,d=[];let f=0;const m=[],g=(x,b)=>{const{failures:w,numFailures:v}=b;f+=x-v;for(let I of un(w))d.push(w[I])};return this.clone().primaryKeys().then(x=>{const b=w=>{const v=Math.min(h,x.length-w);return a.getMany({trans:s,keys:x.slice(w,w+v),cache:"immutable"}).then(I=>{const C=[],k=[],N=l?[]:null,T=[];for(let E=0;E<v;++E){const F=I[E],P={value:Ic(F),primKey:x[w+E]};r.call(P,P.value,P)!==!1&&(P.value==null?T.push(x[w+E]):l||ts(u(F),u(P.value))===0?(k.push(P.value),l&&N.push(x[w+E])):(T.push(x[w+E]),C.push(P.value)))}const R=fl(e)&&e.limit===1/0&&(typeof t!="function"||t===hy)&&{index:e.index,range:e.range};return Promise.resolve(C.length>0&&a.mutate({trans:s,type:"add",values:C}).then(E=>{for(let F in E.failures)T.splice(parseInt(F),1);g(C.length,E)})).then(()=>(k.length>0||R&&typeof t=="object")&&a.mutate({trans:s,type:"put",keys:N,values:k,criteria:R,changeSpec:typeof t!="function"&&t}).then(E=>g(k.length,E))).then(()=>(T.length>0||R&&t===hy)&&a.mutate({trans:s,type:"delete",keys:T,criteria:R}).then(E=>g(T.length,E))).then(()=>x.length>w+v&&b(w+h))})};return b(0).then(()=>{if(d.length>0)throw new _f("Error modifying one or more objects",d,f,m);return x.length})})})}delete(){var t=this._ctx,e=t.range;return fl(t)&&(t.isPrimKey&&!YZ||e.type===3)?this._write(s=>{const{primaryKey:r}=t.table.core.schema,o=e;return t.table.core.count({trans:s,query:{index:r,range:o}}).then(i=>t.table.core.mutate({trans:s,type:"deleteRange",range:o}).then(({failures:a,lastResult:l,results:u,numFailures:h})=>{if(h)throw new _f("Could not delete some values",Object.keys(a).map(d=>a[d]),i-h);return i-h}))}):this.modify(hy)}}const hy=(n,t)=>t.value=null;function QZ(n,t){return n<t?-1:n===t?0:1}function tJ(n,t){return n>t?-1:n===t?0:1}function Ss(n,t,e){var s=n instanceof oN?new n.Collection(n):n;return s._ctx.error=e?new e(t):new TypeError(t),s}function pl(n){return new n.Collection(n,()=>rN("")).limit(0)}function eJ(n,t,e,s,r,o){for(var i=Math.min(n.length,s.length),a=-1,l=0;l<i;++l){var u=t[l];if(u!==s[l])return r(n[l],e[l])<0?n.substr(0,l)+e[l]+e.substr(l+1):r(n[l],s[l])<0?n.substr(0,l)+s[l]+e.substr(l+1):a>=0?n.substr(0,a)+t[a]+e.substr(a+1):null;r(n[l],u)<0&&(a=l)}return i<s.length&&o==="next"?n+e.substr(n.length):i<n.length&&o==="prev"?n.substr(0,e.length):a<0?null:n.substr(0,a)+s[a]+e.substr(a+1)}function jf(n,t,e,s){var r,o,i,a,l,u,h,d=e.length;if(!e.every(x=>typeof x=="string"))return Ss(n,Z2);function f(x){r=function(w){return w==="next"?v=>v.toUpperCase():v=>v.toLowerCase()}(x),o=function(w){return w==="next"?v=>v.toLowerCase():v=>v.toUpperCase()}(x),i=x==="next"?QZ:tJ;var b=e.map(function(w){return{lower:o(w),upper:r(w)}}).sort(function(w,v){return i(w.lower,v.lower)});a=b.map(function(w){return w.upper}),l=b.map(function(w){return w.lower}),u=x,h=x==="next"?"":s}f("next");var m=new n.Collection(n,()=>Qo(a[0],l[d-1]+s));m._ondirectionchange=function(x){f(x)};var g=0;return m._addAlgorithm(function(x,b,w){var v=x.key;if(typeof v!="string")return!1;var I=o(v);if(t(I,l,g))return!0;for(var C=null,k=g;k<d;++k){var N=eJ(v,I,a[k],l[k],i,u);N===null&&C===null?g=k+1:(C===null||i(C,N)>0)&&(C=N)}return b(C!==null?function(){x.continue(C+h)}:w),!1}),m}function Qo(n,t,e,s){return{type:2,lower:n,upper:t,lowerOpen:e,upperOpen:s}}function rN(n){return{type:1,lower:n,upper:n}}class oN{get Collection(){return this._ctx.table.db.Collection}between(t,e,s,r){s=s!==!1,r=r===!0;try{return this._cmp(t,e)>0||this._cmp(t,e)===0&&(s||r)&&(!s||!r)?pl(this):new this.Collection(this,()=>Qo(t,e,!s,!r))}catch{return Ss(this,lo)}}equals(t){return t==null?Ss(this,lo):new this.Collection(this,()=>rN(t))}above(t){return t==null?Ss(this,lo):new this.Collection(this,()=>Qo(t,void 0,!0))}aboveOrEqual(t){return t==null?Ss(this,lo):new this.Collection(this,()=>Qo(t,void 0,!1))}below(t){return t==null?Ss(this,lo):new this.Collection(this,()=>Qo(void 0,t,!1,!0))}belowOrEqual(t){return t==null?Ss(this,lo):new this.Collection(this,()=>Qo(void 0,t))}startsWith(t){return typeof t!="string"?Ss(this,Z2):this.between(t,t+sa,!0,!0)}startsWithIgnoreCase(t){return t===""?this.startsWith(t):jf(this,(e,s)=>e.indexOf(s[0])===0,[t],sa)}equalsIgnoreCase(t){return jf(this,(e,s)=>e===s[0],[t],"")}anyOfIgnoreCase(){var t=io.apply(ll,arguments);return t.length===0?pl(this):jf(this,(e,s)=>s.indexOf(e)!==-1,t,"")}startsWithAnyOfIgnoreCase(){var t=io.apply(ll,arguments);return t.length===0?pl(this):jf(this,(e,s)=>s.some(r=>e.indexOf(r)===0),t,sa)}anyOf(){const t=io.apply(ll,arguments);let e=this._cmp;try{t.sort(e)}catch{return Ss(this,lo)}if(t.length===0)return pl(this);const s=new this.Collection(this,()=>Qo(t[0],t[t.length-1]));s._ondirectionchange=o=>{e=o==="next"?this._ascending:this._descending,t.sort(e)};let r=0;return s._addAlgorithm((o,i,a)=>{const l=o.key;for(;e(l,t[r])>0;)if(++r,r===t.length)return i(a),!1;return e(l,t[r])===0||(i(()=>{o.continue(t[r])}),!1)}),s}notEqual(t){return this.inAnyRange([[iy,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=io.apply(ll,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return Ss(this,lo)}const e=t.reduce((s,r)=>s?s.concat([[s[s.length-1][1],r]]):[[iy,r]],null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,e){const s=this._cmp,r=this._ascending,o=this._descending,i=this._min,a=this._max;if(t.length===0)return pl(this);if(!t.every(v=>v[0]!==void 0&&v[1]!==void 0&&r(v[0],v[1])<=0))return Ss(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",zt.InvalidArgument);const l=!e||e.includeLowers!==!1,u=e&&e.includeUppers===!0;let h,d=r;function f(v,I){return d(v[0],I[0])}try{h=t.reduce(function(v,I){let C=0,k=v.length;for(;C<k;++C){const N=v[C];if(s(I[0],N[1])<0&&s(I[1],N[0])>0){N[0]=i(N[0],I[0]),N[1]=a(N[1],I[1]);break}}return C===k&&v.push(I),v},[]),h.sort(f)}catch{return Ss(this,lo)}let m=0;const g=u?v=>r(v,h[m][1])>0:v=>r(v,h[m][1])>=0,x=l?v=>o(v,h[m][0])>0:v=>o(v,h[m][0])>=0;let b=g;const w=new this.Collection(this,()=>Qo(h[0][0],h[h.length-1][1],!l,!u));return w._ondirectionchange=v=>{v==="next"?(b=g,d=r):(b=x,d=o),h.sort(f)},w._addAlgorithm((v,I,C)=>{for(var k=v.key;b(k);)if(++m,m===h.length)return I(C),!1;return!!function(N){return!g(N)&&!x(N)}(k)||(this._cmp(k,h[m][1])===0||this._cmp(k,h[m][0])===0||I(()=>{d===r?v.continue(h[m][0]):v.continue(h[m][1])}),!1)}),w}startsWithAnyOf(){const t=io.apply(ll,arguments);return t.every(e=>typeof e=="string")?t.length===0?pl(this):this.inAnyRange(t.map(e=>[e,e+sa])):Ss(this,"startsWithAnyOf() only works with strings")}}function Wr(n){return We(function(t){return Fc(t),n(t.target.error),!1})}function Fc(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}const Oc="storagemutated",ti="x-storagemutated-1",ei=Ac(null,Oc);class nJ{_lock(){return Cc(!Ft.global),++this._reculock,this._reculock!==1||Ft.global||(Ft.lockOwnerFor=this),this}_unlock(){if(Cc(!Ft.global),--this._reculock==0)for(Ft.global||(Ft.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{dl(t[1],t[0])}catch{}}return this}_locked(){return this._reculock&&Ft.lockOwnerFor!==this}create(t){if(!this.mode)return this;const e=this.db.idbdb,s=this.db._state.dbOpenError;if(Cc(!this.idbtrans),!t&&!e)switch(s&&s.name){case"DatabaseClosedError":throw new zt.DatabaseClosed(s);case"MissingAPIError":throw new zt.MissingAPI(s.message,s);default:throw new zt.OpenFailed(s)}if(!this.active)throw new zt.TransactionInactive;return Cc(this._completion._state===null),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):e.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=We(r=>{Fc(r),this._reject(t.error)}),t.onabort=We(r=>{Fc(r),this.active&&this._reject(new zt.Abort(t.error)),this.active=!1,this.on("abort").fire(r)}),t.oncomplete=We(()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&ei.storagemutated.fire(t.mutatedParts)}),this}_promise(t,e,s){if(t==="readwrite"&&this.mode!=="readwrite")return mn(new zt.ReadOnly("Transaction is readonly"));if(!this.active)return mn(new zt.TransactionInactive);if(this._locked())return new $t((o,i)=>{this._blockedFuncs.push([()=>{this._promise(t,e,s).then(o,i)},Ft])});if(s)return Zo(()=>{var o=new $t((i,a)=>{this._lock();const l=e(i,a,this);l&&l.then&&l.then(i,a)});return o.finally(()=>this._unlock()),o._lib=!0,o});var r=new $t((o,i)=>{var a=e(o,i,this);a&&a.then&&a.then(o,i)});return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(t){var e=this._root();const s=$t.resolve(t);if(e._waitingFor)e._waitingFor=e._waitingFor.then(()=>s);else{e._waitingFor=s,e._waitingQueue=[];var r=e.idbtrans.objectStore(e.storeNames[0]);(function i(){for(++e._spinCount;e._waitingQueue.length;)e._waitingQueue.shift()();e._waitingFor&&(r.get(-1/0).onsuccess=i)})()}var o=e._waitingFor;return new $t((i,a)=>{s.then(l=>e._waitingQueue.push(We(i.bind(null,l))),l=>e._waitingQueue.push(We(a.bind(null,l)))).finally(()=>{e._waitingFor===o&&(e._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new zt.Abort))}table(t){const e=this._memoizedTables||(this._memoizedTables={});if(ks(e,t))return e[t];const s=this.schema[t];if(!s)throw new zt.NotFound("Table "+t+" not part of transaction");const r=new this.db.Table(t,s,this);return r.core=this.db.core.table(t),e[t]=r,r}}function dy(n,t,e,s,r,o,i){return{name:n,keyPath:t,unique:e,multi:s,auto:r,compound:o,src:(e&&!i?"&":"")+(s?"*":"")+(r?"++":"")+iN(t)}}function iN(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function aN(n,t,e){return{name:n,primKey:t,indexes:e,mappedClass:null,idxByName:E2(e,s=>[s.name,s])}}let Lc=n=>{try{return n.only([[]]),Lc=()=>[[]],[[]]}catch{return Lc=()=>sa,sa}};function fy(n){return n==null?()=>{}:typeof n=="string"?function(t){return t.split(".").length===1?s=>s[t]:s=>oo(s,t)}(n):t=>oo(t,n)}function lN(n){return[].slice.call(n)}let sJ=0;function Pc(n){return n==null?":id":typeof n=="string"?n:`[${n.join("+")}]`}function rJ(n,t,e){function s(l){if(l.type===3)return null;if(l.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:u,upper:h,lowerOpen:d,upperOpen:f}=l;return u===void 0?h===void 0?null:t.upperBound(h,!!f):h===void 0?t.lowerBound(u,!!d):t.bound(u,h,!!d,!!f)}const{schema:r,hasGetAll:o}=function(l,u){const h=lN(l.objectStoreNames);return{schema:{name:l.name,tables:h.map(d=>u.objectStore(d)).map(d=>{const{keyPath:f,autoIncrement:m}=d,g=zn(f),x=f==null,b={},w={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:x,compound:g,keyPath:f,autoIncrement:m,unique:!0,extractKey:fy(f)},indexes:lN(d.indexNames).map(v=>d.index(v)).map(v=>{const{name:I,unique:C,multiEntry:k,keyPath:N}=v,T={name:I,compound:zn(N),keyPath:N,unique:C,multiEntry:k,extractKey:fy(N)};return b[Pc(N)]=T,T}),getIndexByKeyPath:v=>b[Pc(v)]};return b[":id"]=w.primaryKey,f!=null&&(b[Pc(f)]=w.primaryKey),w})},hasGetAll:h.length>0&&"getAll"in u.objectStore(h[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(n,e),i=r.tables.map(l=>function(u){const h=u.name;return{name:h,schema:u,mutate:function({trans:d,type:f,keys:m,values:g,range:x}){return new Promise((b,w)=>{b=We(b);const v=d.objectStore(h),I=v.keyPath==null,C=f==="put"||f==="add";if(!C&&f!=="delete"&&f!=="deleteRange")throw new Error("Invalid operation type: "+f);const{length:k}=m||g||{length:1};if(m&&g&&m.length!==g.length)throw new Error("Given keys array must have same length as given values array.");if(k===0)return b({numFailures:0,failures:{},results:[],lastResult:void 0});let N;const T=[],R=[];let E=0;const F=q=>{++E,Fc(q)};if(f==="deleteRange"){if(x.type===4)return b({numFailures:E,failures:R,results:[],lastResult:void 0});x.type===3?T.push(N=v.clear()):T.push(N=v.delete(s(x)))}else{const[q,j]=C?I?[g,m]:[g,null]:[m,null];if(C)for(let K=0;K<k;++K)T.push(N=j&&j[K]!==void 0?v[f](q[K],j[K]):v[f](q[K])),N.onerror=F;else for(let K=0;K<k;++K)T.push(N=v[f](q[K])),N.onerror=F}const P=q=>{const j=q.target.result;T.forEach((K,Y)=>K.error!=null&&(R[Y]=K.error)),b({numFailures:E,failures:R,results:f==="delete"?m:T.map(K=>K.result),lastResult:j})};N.onerror=q=>{F(q),P(q)},N.onsuccess=P})},getMany:({trans:d,keys:f})=>new Promise((m,g)=>{m=We(m);const x=d.objectStore(h),b=f.length,w=new Array(b);let v,I=0,C=0;const k=T=>{const R=T.target;w[R._pos]=R.result,++C===I&&m(w)},N=Wr(g);for(let T=0;T<b;++T)f[T]!=null&&(v=x.get(f[T]),v._pos=T,v.onsuccess=k,v.onerror=N,++I);I===0&&m(w)}),get:({trans:d,key:f})=>new Promise((m,g)=>{m=We(m);const x=d.objectStore(h).get(f);x.onsuccess=b=>m(b.target.result),x.onerror=Wr(g)}),query:function(d){return f=>new Promise((m,g)=>{m=We(m);const{trans:x,values:b,limit:w,query:v}=f,I=w===1/0?void 0:w,{index:C,range:k}=v,N=x.objectStore(h),T=C.isPrimaryKey?N:N.index(C.name),R=s(k);if(w===0)return m({result:[]});if(d){const E=b?T.getAll(R,I):T.getAllKeys(R,I);E.onsuccess=F=>m({result:F.target.result}),E.onerror=Wr(g)}else{let E=0;const F=b||!("openKeyCursor"in T)?T.openCursor(R):T.openKeyCursor(R),P=[];F.onsuccess=q=>{const j=F.result;return j?(P.push(b?j.value:j.primaryKey),++E===w?m({result:P}):void j.continue()):m({result:P})},F.onerror=Wr(g)}})}(o),openCursor:function({trans:d,values:f,query:m,reverse:g,unique:x}){return new Promise((b,w)=>{b=We(b);const{index:v,range:I}=m,C=d.objectStore(h),k=v.isPrimaryKey?C:C.index(v.name),N=g?x?"prevunique":"prev":x?"nextunique":"next",T=f||!("openKeyCursor"in k)?k.openCursor(s(I),N):k.openKeyCursor(s(I),N);T.onerror=Wr(w),T.onsuccess=We(R=>{const E=T.result;if(!E)return void b(null);E.___id=++sJ,E.done=!1;const F=E.continue.bind(E);let P=E.continuePrimaryKey;P&&(P=P.bind(E));const q=E.advance.bind(E),j=()=>{throw new Error("Cursor not stopped")};E.trans=d,E.stop=E.continue=E.continuePrimaryKey=E.advance=()=>{throw new Error("Cursor not started")},E.fail=We(w),E.next=function(){let K=1;return this.start(()=>K--?this.continue():this.stop()).then(()=>this)},E.start=K=>{const Y=new Promise((tt,Z)=>{tt=We(tt),T.onerror=Wr(Z),E.fail=Z,E.stop=rt=>{E.stop=E.continue=E.continuePrimaryKey=E.advance=j,tt(rt)}}),Q=()=>{if(T.result)try{K()}catch(tt){E.fail(tt)}else E.done=!0,E.start=()=>{throw new Error("Cursor behind last entry")},E.stop()};return T.onsuccess=We(tt=>{T.onsuccess=Q,Q()}),E.continue=F,E.continuePrimaryKey=P,E.advance=q,Q(),Y},b(E)},w)})},count({query:d,trans:f}){const{index:m,range:g}=d;return new Promise((x,b)=>{const w=f.objectStore(h),v=m.isPrimaryKey?w:w.index(m.name),I=s(g),C=I?v.count(I):v.count();C.onsuccess=We(k=>x(k.target.result)),C.onerror=Wr(b)})}}}(l)),a={};return i.forEach(l=>a[l.name]=l),{stack:"dbcore",transaction:n.transaction.bind(n),table(l){if(!a[l])throw new Error(`Table '${l}' not found`);return a[l]},MIN_KEY:-1/0,MAX_KEY:Lc(t),schema:r}}function py({_novip:n},t){const e=t.db,s=function(r,o,{IDBKeyRange:i,indexedDB:a},l){return{dbcore:function(h,d){return d.reduce((f,{create:m})=>({...f,...m(f)}),h)}(rJ(o,i,l),r.dbcore)}}(n._middlewares,e,n._deps,t);n.core=s.dbcore,n.tables.forEach(r=>{const o=r.name;n.core.schema.tables.some(i=>i.name===o)&&(r.core=n.core.table(o),n[o]instanceof n.Table&&(n[o].core=r.core))})}function Xf({_novip:n},t,e,s){e.forEach(r=>{const o=s[r];t.forEach(i=>{const a=Mb(i,r);(!a||"value"in a&&a.value===void 0)&&(i===n.Transaction.prototype||i instanceof n.Transaction?ro(i,r,{get(){return this.table(r)},set(l){S2(this,r,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):i[r]=new n.Table(r,o))})})}function my({_novip:n},t){t.forEach(e=>{for(let s in e)e[s]instanceof n.Table&&delete e[s]})}function oJ(n,t){return n._cfg.version-t._cfg.version}function iJ(n,t,e,s){const r=n._dbSchema,o=n._createTransaction("readwrite",n._storeNames,r);o.create(e),o._completion.catch(s);const i=o._reject.bind(o),a=Ft.transless||Ft;Zo(()=>{Ft.trans=o,Ft.transless=a,t===0?(un(r).forEach(l=>{gy(e,l,r[l].primKey,r[l].indexes)}),py(n,e),$t.follow(()=>n.on.populate.fire(o)).catch(i)):function({_novip:l},u,h,d){const f=[],m=l._versions;let g=l._dbSchema=by(l,l.idbdb,d),x=!1;const b=m.filter(v=>v._cfg.version>=u);function w(){return f.length?$t.resolve(f.shift()(h.idbtrans)).then(w):$t.resolve()}return b.forEach(v=>{f.push(()=>{const I=g,C=v._cfg.dbschema;yy(l,I,d),yy(l,C,d),g=l._dbSchema=C;const k=uN(I,C);k.add.forEach(T=>{gy(d,T[0],T[1].primKey,T[1].indexes)}),k.change.forEach(T=>{if(T.recreate)throw new zt.Upgrade("Not yet support for changing primary key");{const R=d.objectStore(T.name);T.add.forEach(E=>xy(R,E)),T.change.forEach(E=>{R.deleteIndex(E.name),xy(R,E)}),T.del.forEach(E=>R.deleteIndex(E))}});const N=v._cfg.contentUpgrade;if(N&&v._cfg.version>u){py(l,d),h._memoizedTables={},x=!0;let T=_2(C);k.del.forEach(P=>{T[P]=I[P]}),my(l,[l.Transaction.prototype]),Xf(l,[l.Transaction.prototype],un(T),T),h.schema=T;const R=Vb(N);let E;R&&hl();const F=$t.follow(()=>{if(E=N(h),E&&R){var P=ao.bind(null,null);E.then(P,P)}});return E&&typeof E.then=="function"?$t.resolve(E):F.then(()=>E)}}),f.push(I=>{(!x||!XZ)&&function(C,k){[].slice.call(k.db.objectStoreNames).forEach(N=>C[N]==null&&k.db.deleteObjectStore(N))}(v._cfg.dbschema,I),my(l,[l.Transaction.prototype]),Xf(l,[l.Transaction.prototype],l._storeNames,l._dbSchema),h.schema=l._dbSchema})}),w().then(()=>{var v,I;I=d,un(v=g).forEach(C=>{I.db.objectStoreNames.contains(C)||gy(I,C,v[C].primKey,v[C].indexes)})})}(n,t,o,e).catch(i)})}function uN(n,t){const e={del:[],add:[],change:[]};let s;for(s in n)t[s]||e.del.push(s);for(s in t){const r=n[s],o=t[s];if(r){const i={name:s,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(r.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||r.primKey.auto!==o.primKey.auto&&!Uf)i.recreate=!0,e.change.push(i);else{const a=r.idxByName,l=o.idxByName;let u;for(u in a)l[u]||i.del.push(u);for(u in l){const h=a[u],d=l[u];h?h.src!==d.src&&i.change.push(d):i.add.push(d)}(i.del.length>0||i.add.length>0||i.change.length>0)&&e.change.push(i)}}else e.add.push([s,o])}return e}function gy(n,t,e,s){const r=n.db.createObjectStore(t,e.keyPath?{keyPath:e.keyPath,autoIncrement:e.auto}:{autoIncrement:e.auto});return s.forEach(o=>xy(r,o)),r}function xy(n,t){n.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function by(n,t,e){const s={};return Ef(t.objectStoreNames,0).forEach(r=>{const o=e.objectStore(r);let i=o.keyPath;const a=dy(iN(i),i||"",!1,!1,!!o.autoIncrement,i&&typeof i!="string",!0),l=[];for(let h=0;h<o.indexNames.length;++h){const d=o.index(o.indexNames[h]);i=d.keyPath;var u=dy(d.name,i,!!d.unique,!!d.multiEntry,!1,i&&typeof i!="string",!1);l.push(u)}s[r]=aN(r,a,l)}),s}function yy({_novip:n},t,e){const s=e.db.objectStoreNames;for(let r=0;r<s.length;++r){const o=s[r],i=e.objectStore(o);n._hasGetAll="getAll"in i;for(let a=0;a<i.indexNames.length;++a){const l=i.indexNames[a],u=i.index(l).keyPath,h=typeof u=="string"?u:"["+Ef(u).join("+")+"]";if(t[o]){const d=t[o].idxByName[h];d&&(d.name=l,delete t[o].idxByName[h],t[o].idxByName[l]=d)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Pe.WorkerGlobalScope&&Pe instanceof Pe.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}class aJ{_parseStoresSpec(t,e){un(t).forEach(s=>{if(t[s]!==null){var r=t[s].split(",").map((i,a)=>{const l=(i=i.trim()).replace(/([&*]|\+\+)/g,""),u=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return dy(l,u||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),zn(u),a===0)}),o=r.shift();if(o.multi)throw new zt.Schema("Primary key cannot be multi-valued");r.forEach(i=>{if(i.auto)throw new zt.Schema("Only primary key can be marked as autoIncrement (++)");if(!i.keyPath)throw new zt.Schema("Index must have a name and cannot be an empty string")}),e[s]=aN(s,o,r)}})}stores(t){const e=this.db;this._cfg.storesSource=this._cfg.storesSource?Qn(this._cfg.storesSource,t):t;const s=e._versions,r={};let o={};return s.forEach(i=>{Qn(r,i._cfg.storesSource),o=i._cfg.dbschema={},i._parseStoresSpec(r,o)}),e._dbSchema=o,my(e,[e._allTables,e,e.Transaction.prototype]),Xf(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],un(o),o),e._storeNames=un(o),this}upgrade(t){return this._cfg.contentUpgrade=Kb(this._cfg.contentUpgrade||Te,t),this}}function wy(n,t){let e=n._dbNamesDB;return e||(e=n._dbNamesDB=new oa(Gf,{addons:[],indexedDB:n,IDBKeyRange:t}),e.version(1).stores({dbnames:"name"})),e.table("dbnames")}function vy(n){return n&&typeof n.databases=="function"}function Cy(n){return Zo(function(){return Ft.letThrough=!0,n()})}function lJ(){var n;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(t){var e=function(){return indexedDB.databases().finally(t)};n=setInterval(e,100),e()}).finally(function(){return clearInterval(n)}):Promise.resolve()}function uJ(n){const t=n._state,{indexedDB:e}=n._deps;if(t.isBeingOpened||n.idbdb)return t.dbReadyPromise.then(()=>t.dbOpenError?mn(t.dbOpenError):n);zr&&(t.openCanceller._stackHolder=Qi()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const s=t.openCanceller;function r(){if(t.openCanceller!==s)throw new zt.DatabaseClosed("db.open() was cancelled")}let o=t.dbReadyResolve,i=null,a=!1;return $t.race([s,(typeof navigator>"u"?$t.resolve():lJ()).then(()=>new $t((l,u)=>{if(r(),!e)throw new zt.MissingAPI;const h=n.name,d=t.autoSchema?e.open(h):e.open(h,Math.round(10*n.verno));if(!d)throw new zt.MissingAPI;d.onerror=Wr(u),d.onblocked=We(n._fireOnBlocked),d.onupgradeneeded=We(f=>{if(i=d.transaction,t.autoSchema&&!n._options.allowEmptyDB){d.onerror=Fc,i.abort(),d.result.close();const g=e.deleteDatabase(h);g.onsuccess=g.onerror=We(()=>{u(new zt.NoSuchDatabase(`Database ${h} doesnt exist`))})}else{i.onerror=Wr(u);var m=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;a=m<1,n._novip.idbdb=d.result,iJ(n,m/10,i,u)}},u),d.onsuccess=We(()=>{i=null;const f=n._novip.idbdb=d.result,m=Ef(f.objectStoreNames);if(m.length>0)try{const x=f.transaction((g=m).length===1?g[0]:g,"readonly");t.autoSchema?function({_novip:b},w,v){b.verno=w.version/10;const I=b._dbSchema=by(0,w,v);b._storeNames=Ef(w.objectStoreNames,0),Xf(b,[b._allTables],un(I),I)}(n,f,x):(yy(n,n._dbSchema,x),function(b,w){const v=uN(by(0,b.idbdb,w),b._dbSchema);return!(v.add.length||v.change.some(I=>I.add.length||I.change.length))}(n,x)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),py(n,x)}catch{}var g;Rc.push(n),f.onversionchange=We(x=>{t.vcFired=!0,n.on("versionchange").fire(x)}),f.onclose=We(x=>{n.on("close").fire(x)}),a&&function({indexedDB:x,IDBKeyRange:b},w){!vy(x)&&w!==Gf&&wy(x,b).put({name:w}).catch(Te)}(n._deps,h),l()},u)}))]).then(()=>(r(),t.onReadyBeingFired=[],$t.resolve(Cy(()=>n.on.ready.fire(n.vip))).then(function l(){if(t.onReadyBeingFired.length>0){let u=t.onReadyBeingFired.reduce(Kb,Te);return t.onReadyBeingFired=[],$t.resolve(Cy(()=>u(n.vip))).then(l)}}))).finally(()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(()=>n).catch(l=>{t.dbOpenError=l;try{i&&i.abort()}catch{}return s===t.openCanceller&&n._close(),mn(l)}).finally(()=>{t.openComplete=!0,o()})}function Iy(n){var t=o=>n.next(o),e=r(t),s=r(o=>n.throw(o));function r(o){return i=>{var a=o(i),l=a.value;return a.done?l:l&&typeof l.then=="function"?l.then(e,s):zn(l)?Promise.all(l).then(e,s):e(l)}}return r(t)()}function cJ(n,t,e){var s=arguments.length;if(s<2)throw new zt.InvalidArgument("Too few arguments");for(var r=new Array(s-1);--s;)r[s-1]=arguments[s];return e=r.pop(),[n,R2(r),e]}function cN(n,t,e,s,r){return $t.resolve().then(()=>{const o=Ft.transless||Ft,i=n._createTransaction(t,e,n._dbSchema,s),a={trans:i,transless:o};if(s)i.idbtrans=s.idbtrans;else try{i.create(),n._state.PR1398_maxLoop=3}catch(d){return d.name===Hb.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>cN(n,t,e,null,r))):mn(d)}const l=Vb(r);let u;l&&hl();const h=$t.follow(()=>{if(u=r.call(i,i),u)if(l){var d=ao.bind(null,null);u.then(d,d)}else typeof u.next=="function"&&typeof u.throw=="function"&&(u=Iy(u))},a);return(u&&typeof u.then=="function"?$t.resolve(u).then(d=>i.active?d:mn(new zt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):h.then(()=>u)).then(d=>(s&&i._resolve(),i._completion.then(()=>d))).catch(d=>(i._reject(d),mn(d)))})}function Yf(n,t,e){const s=zn(n)?n.slice():[n];for(let r=0;r<e;++r)s.push(t);return s}const hJ={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(n){return{...n,table(t){const e=n.table(t),{schema:s}=e,r={},o=[];function i(h,d,f){const m=Pc(h),g=r[m]=r[m]||[],x=h==null?0:typeof h=="string"?1:h.length,b=d>0,w={...f,isVirtual:b,keyTail:d,keyLength:x,extractKey:fy(h),unique:!b&&f.unique};return g.push(w),w.isPrimaryKey||o.push(w),x>1&&i(x===2?h[0]:h.slice(0,x-1),d+1,f),g.sort((v,I)=>v.keyTail-I.keyTail),w}const a=i(s.primaryKey.keyPath,0,s.primaryKey);r[":id"]=[a];for(const h of s.indexes)i(h.keyPath,0,h);function l(h){const d=h.query.index;return d.isVirtual?{...h,query:{index:d,range:(f=h.query.range,m=d.keyTail,{type:f.type===1?2:f.type,lower:Yf(f.lower,f.lowerOpen?n.MAX_KEY:n.MIN_KEY,m),lowerOpen:!0,upper:Yf(f.upper,f.upperOpen?n.MIN_KEY:n.MAX_KEY,m),upperOpen:!0})}}:h;var f,m}return{...e,schema:{...s,primaryKey:a,indexes:o,getIndexByKeyPath:function(h){const d=r[Pc(h)];return d&&d[0]}},count:h=>e.count(l(h)),query:h=>e.query(l(h)),openCursor(h){const{keyTail:d,isVirtual:f,keyLength:m}=h.query.index;return f?e.openCursor(l(h)).then(g=>g&&function(x){return Object.create(x,{continue:{value:function(w){w!=null?x.continue(Yf(w,h.reverse?n.MAX_KEY:n.MIN_KEY,d)):h.unique?x.continue(x.key.slice(0,m).concat(h.reverse?n.MIN_KEY:n.MAX_KEY,d)):x.continue()}},continuePrimaryKey:{value(w,v){x.continuePrimaryKey(Yf(w,n.MAX_KEY,d),v)}},primaryKey:{get:()=>x.primaryKey},key:{get(){const w=x.key;return m===1?w[0]:w.slice(0,m)}},value:{get:()=>x.value}})}(g)):e.openCursor(h)}}}}}};function $y(n,t,e,s){return e=e||{},s=s||"",un(n).forEach(r=>{if(ks(t,r)){var o=n[r],i=t[r];if(typeof o=="object"&&typeof i=="object"&&o&&i){const a=zb(o);a!==zb(i)?e[s+r]=t[r]:a==="Object"?$y(o,i,e,s+r+"."):o!==i&&(e[s+r]=t[r])}else o!==i&&(e[s+r]=t[r])}else e[s+r]=void 0}),un(t).forEach(r=>{ks(n,r)||(e[s+r]=t[r])}),e}const dJ={stack:"dbcore",name:"HooksMiddleware",level:2,create:n=>({...n,table(t){const e=n.table(t),{primaryKey:s}=e.schema;return{...e,mutate(o){const i=Ft.trans,{deleting:a,creating:l,updating:u}=i.table(t).hook;switch(o.type){case"add":if(l.fire===Te)break;return i._promise("readwrite",()=>h(o),!0);case"put":if(l.fire===Te&&u.fire===Te)break;return i._promise("readwrite",()=>h(o),!0);case"delete":if(a.fire===Te)break;return i._promise("readwrite",()=>h(o),!0);case"deleteRange":if(a.fire===Te)break;return i._promise("readwrite",()=>function(f){return d(f.trans,f.range,1e4)}(o),!0)}return e.mutate(o);function h(f){const m=Ft.trans,g=f.keys||function(x,b){return b.type==="delete"?b.keys:b.keys||b.values.map(x.extractKey)}(s,f);if(!g)throw new Error("Keys missing");return(f=f.type==="add"||f.type==="put"?{...f,keys:g}:{...f}).type!=="delete"&&(f.values=[...f.values]),f.keys&&(f.keys=[...f.keys]),function(x,b,w){return b.type==="add"?Promise.resolve([]):x.getMany({trans:b.trans,keys:w,cache:"immutable"})}(e,f,g).then(x=>{const b=g.map((w,v)=>{const I=x[v],C={onerror:null,onsuccess:null};if(f.type==="delete")a.fire.call(C,w,I,m);else if(f.type==="add"||I===void 0){const k=l.fire.call(C,w,f.values[v],m);w==null&&k!=null&&(w=k,f.keys[v]=w,s.outbound||gr(f.values[v],s.keyPath,w))}else{const k=$y(I,f.values[v]),N=u.fire.call(C,k,w,I,m);if(N){const T=f.values[v];Object.keys(N).forEach(R=>{ks(T,R)?T[R]=N[R]:gr(T,R,N[R])})}}return C});return e.mutate(f).then(({failures:w,results:v,numFailures:I,lastResult:C})=>{for(let k=0;k<g.length;++k){const N=v?v[k]:g[k],T=b[k];N==null?T.onerror&&T.onerror(w[k]):T.onsuccess&&T.onsuccess(f.type==="put"&&x[k]?f.values[k]:N)}return{failures:w,results:v,numFailures:I,lastResult:C}}).catch(w=>(b.forEach(v=>v.onerror&&v.onerror(w)),Promise.reject(w)))})}function d(f,m,g){return e.query({trans:f,values:!1,query:{index:s,range:m},limit:g}).then(({result:x})=>h({type:"delete",keys:x,trans:f}).then(b=>b.numFailures>0?Promise.reject(b.failures[0]):x.length<g?{failures:[],numFailures:0,lastResult:void 0}:d(f,{...m,lower:x[x.length-1],lowerOpen:!0},g)))}}}}})};function hN(n,t,e){try{if(!t||t.keys.length<n.length)return null;const s=[];for(let r=0,o=0;r<t.keys.length&&o<n.length;++r)ts(t.keys[r],n[o])===0&&(s.push(e?Ic(t.values[r]):t.values[r]),++o);return s.length===n.length?s:null}catch{return null}}const fJ={stack:"dbcore",level:-1,create:n=>({table:t=>{const e=n.table(t);return{...e,getMany:s=>{if(!s.cache)return e.getMany(s);const r=hN(s.keys,s.trans._cache,s.cache==="clone");return r?$t.resolve(r):e.getMany(s).then(o=>(s.trans._cache={keys:s.keys,values:s.cache==="clone"?Ic(o):o},o))},mutate:s=>(s.type!=="add"&&(s.trans._cache=null),e.mutate(s))}}})};function ky(n){return!("from"in n)}const uo=function(n,t){if(!this){const e=new uo;return n&&"d"in n&&Qn(e,n),e}Qn(this,arguments.length?{d:1,from:n,to:arguments.length>1?t:n}:{d:0})};function Mc(n,t,e){const s=ts(t,e);if(isNaN(s))return;if(s>0)throw RangeError();if(ky(n))return Qn(n,{from:t,to:e,d:1});const r=n.l,o=n.r;if(ts(e,n.from)<0)return r?Mc(r,t,e):n.l={from:t,to:e,d:1,l:null,r:null},dN(n);if(ts(t,n.to)>0)return o?Mc(o,t,e):n.r={from:t,to:e,d:1,l:null,r:null},dN(n);ts(t,n.from)<0&&(n.from=t,n.l=null,n.d=o?o.d+1:1),ts(e,n.to)>0&&(n.to=e,n.r=null,n.d=n.l?n.l.d+1:1);const i=!n.r;r&&!n.l&&Zf(n,r),o&&i&&Zf(n,o)}function Zf(n,t){ky(t)||function e(s,{from:r,to:o,l:i,r:a}){Mc(s,r,o),i&&e(s,i),a&&e(s,a)}(n,t)}function pJ(n,t){const e=Sy(t);let s=e.next();if(s.done)return!1;let r=s.value;const o=Sy(n);let i=o.next(r.from),a=i.value;for(;!s.done&&!i.done;){if(ts(a.from,r.to)<=0&&ts(a.to,r.from)>=0)return!0;ts(r.from,a.from)<0?r=(s=e.next(a.from)).value:a=(i=o.next(r.from)).value}return!1}function Sy(n){let t=ky(n)?null:{s:0,n};return{next(e){const s=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,s)for(;t.n.l&&ts(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!s||ts(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function dN(n){var t,e;const s=(((t=n.r)===null||t===void 0?void 0:t.d)||0)-(((e=n.l)===null||e===void 0?void 0:e.d)||0),r=s>1?"r":s<-1?"l":"";if(r){const o=r==="r"?"l":"r",i={...n},a=n[r];n.from=a.from,n.to=a.to,n[r]=a[r],i[r]=a[o],n[o]=i,i.d=fN(i)}n.d=fN(n)}function fN({r:n,l:t}){return(n?t?Math.max(n.d,t.d):n.d:t?t.d:0)+1}il(uo.prototype,{add(n){return Zf(this,n),this},addKey(n){return Mc(this,n,n),this},addKeys(n){return n.forEach(t=>Mc(this,t,t)),this},[Wb](){return Sy(this)}});const mJ={stack:"dbcore",level:0,create:n=>{const t=n.schema.name,e=new uo(n.MIN_KEY,n.MAX_KEY);return{...n,table:s=>{const r=n.table(s),{schema:o}=r,{primaryKey:i}=o,{extractKey:a,outbound:l}=i,u={...r,mutate:f=>{const m=f.trans,g=m.mutatedParts||(m.mutatedParts={}),x=N=>{const T=`idb://${t}/${s}/${N}`;return g[T]||(g[T]=new uo)},b=x(""),w=x(":dels"),{type:v}=f;let[I,C]=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[];const k=f.trans._cache;return r.mutate(f).then(N=>{if(zn(I)){v!=="delete"&&(I=N.results),b.addKeys(I);const T=hN(I,k);T||v==="add"||w.addKeys(I),(T||C)&&function(R,E,F,P){function q(j){const K=R(j.name||"");function Y(tt){return tt!=null?j.extractKey(tt):null}const Q=tt=>j.multiEntry&&zn(tt)?tt.forEach(Z=>K.addKey(Z)):K.addKey(tt);(F||P).forEach((tt,Z)=>{const rt=F&&Y(F[Z]),ut=P&&Y(P[Z]);ts(rt,ut)!==0&&(rt!=null&&Q(rt),ut!=null&&Q(ut))})}E.indexes.forEach(q)}(x,o,T,C)}else if(I){const T={from:I.lower,to:I.upper};w.add(T),b.add(T)}else b.add(e),w.add(e),o.indexes.forEach(T=>x(T.name).add(e));return N})}},h=({query:{index:f,range:m}})=>{var g,x;return[f,new uo((g=m.lower)!==null&&g!==void 0?g:n.MIN_KEY,(x=m.upper)!==null&&x!==void 0?x:n.MAX_KEY)]},d={get:f=>[i,new uo(f.key)],getMany:f=>[i,new uo().addKeys(f.keys)],count:h,query:h,openCursor:h};return un(d).forEach(f=>{u[f]=function(m){const{subscr:g}=Ft;if(g){const x=C=>{const k=`idb://${t}/${s}/${C}`;return g[k]||(g[k]=new uo)},b=x(""),w=x(":dels"),[v,I]=d[f](m);if(x(v.name||"").add(I),!v.isPrimaryKey){if(f!=="count"){const C=f==="query"&&l&&m.values&&r.query({...m,values:!1});return r[f].apply(this,arguments).then(k=>{if(f==="query"){if(l&&m.values)return C.then(({result:T})=>(b.addKeys(T),k));const N=m.values?k.result.map(a):k.result;m.values?b.addKeys(N):w.addKeys(N)}else if(f==="openCursor"){const N=k,T=m.values;return N&&Object.create(N,{key:{get:()=>(w.addKey(N.primaryKey),N.key)},primaryKey:{get(){const R=N.primaryKey;return w.addKey(R),R}},value:{get:()=>(T&&b.addKey(N.primaryKey),N.value)}})}return k})}w.add(e)}}return r[f].apply(this,arguments)}}),u}}}};class oa{constructor(t,e){this._middlewares={},this.verno=0;const s=oa.dependencies;this._options=e={addons:oa.addons,autoOpen:!0,indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange,...e},this._deps={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange};const{addons:r}=e;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Te,dbReadyPromise:null,cancelOpen:Te,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var i;o.dbReadyPromise=new $t(a=>{o.dbReadyResolve=a}),o.openCanceller=new $t((a,l)=>{o.cancelOpen=l}),this._state=o,this.name=t,this.on=Ac(this,"populate","blocked","versionchange","close",{ready:[Kb,Te]}),this.on.ready.subscribe=N2(this.on.ready.subscribe,a=>(l,u)=>{oa.vip(()=>{const h=this._state;if(h.openComplete)h.dbOpenError||$t.resolve().then(l),u&&a(l);else if(h.onReadyBeingFired)h.onReadyBeingFired.push(l),u&&a(l);else{a(l);const d=this;u||a(function f(){d.on.ready.unsubscribe(l),d.on.ready.unsubscribe(f)})}})}),this.Collection=(i=this,Dc(JZ.prototype,function(a,l){this.db=i;let u=Q2,h=null;if(l)try{u=l()}catch(g){h=g}const d=a._ctx,f=d.table,m=f.hook.reading.fire;this._ctx={table:f,index:d.index,isPrimKey:!d.index||f.schema.primKey.keyPath&&d.index===f.schema.primKey.name,range:u,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:h,or:d.or,valueMapper:m!==kc?m:null}})),this.Table=function(a){return Dc(ZZ.prototype,function(l,u,h){this.db=a,this._tx=h,this.name=l,this.schema=u,this.hook=a._allTables[l]?a._allTables[l].hook:Ac(null,{creating:[BZ,Te],reading:[MZ,kc],updating:[WZ,Te],deleting:[zZ,Te]})})}(this),this.Transaction=function(a){return Dc(nJ.prototype,function(l,u,h,d,f){this.db=a,this.mode=l,this.storeNames=u,this.schema=h,this.chromeTransactionDurability=d,this.idbtrans=null,this.on=Ac(this,"complete","error","abort"),this.parent=f||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new $t((m,g)=>{this._resolve=m,this._reject=g}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},m=>{var g=this.active;return this.active=!1,this.on.error.fire(m),this.parent?this.parent._reject(m):g&&this.idbtrans&&this.idbtrans.abort(),mn(m)})})}(this),this.Version=function(a){return Dc(aJ.prototype,function(l){this.db=a,this._cfg={version:l,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(a){return Dc(oN.prototype,function(l,u,h){this.db=a,this._ctx={table:l,index:u===":id"?null:u,or:h};const d=a._deps.indexedDB;if(!d)throw new zt.MissingAPI;this._cmp=this._ascending=d.cmp.bind(d),this._descending=(f,m)=>d.cmp(m,f),this._max=(f,m)=>d.cmp(f,m)>0?f:m,this._min=(f,m)=>d.cmp(f,m)<0?f:m,this._IDBKeyRange=a._deps.IDBKeyRange})}(this),this.on("versionchange",a=>{a.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",a=>{!a.newVersion||a.newVersion<a.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${a.oldVersion/10}`)}),this._maxKey=Lc(e.IDBKeyRange),this._createTransaction=(a,l,u,h)=>new this.Transaction(a,l,u,this._options.chromeTransactionDurability,h),this._fireOnBlocked=a=>{this.on("blocked").fire(a),Rc.filter(l=>l.name===this.name&&l!==this&&!l._state.vcFired).map(l=>l.on("versionchange").fire(a))},this.use(hJ),this.use(dJ),this.use(mJ),this.use(fJ),this.vip=Object.create(this,{_vip:{value:!0}}),r.forEach(a=>a(this))}version(t){if(isNaN(t)||t<.1)throw new zt.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new zt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const e=this._versions;var s=e.filter(r=>r._cfg.version===t)[0];return s||(s=new this.Version(t),e.push(s),e.sort(oJ),s.stores({}),this._state.autoSchema=!1,s)}_whenReady(t){return this.idbdb&&(this._state.openComplete||Ft.letThrough||this._vip)?t():new $t((e,s)=>{if(this._state.openComplete)return s(new zt.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void s(new zt.DatabaseClosed);this.open().catch(Te)}this._state.dbReadyPromise.then(e,s)}).then(t)}use({stack:t,create:e,level:s,name:r}){r&&this.unuse({stack:t,name:r});const o=this._middlewares[t]||(this._middlewares[t]=[]);return o.push({stack:t,create:e,level:s??10,name:r}),o.sort((i,a)=>i.level-a.level),this}unuse({stack:t,name:e,create:s}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(r=>s?r.create!==s:!!e&&r.name!==e)),this}open(){return uJ(this)}_close(){const t=this._state,e=Rc.indexOf(this);if(e>=0&&Rc.splice(e,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}t.dbReadyPromise=new $t(s=>{t.dbReadyResolve=s}),t.openCanceller=new $t((s,r)=>{t.cancelOpen=r})}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new zt.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,e=this._state;return new $t((s,r)=>{const o=()=>{this.close();var i=this._deps.indexedDB.deleteDatabase(this.name);i.onsuccess=We(()=>{(function({indexedDB:a,IDBKeyRange:l},u){!vy(a)&&u!==Gf&&wy(a,l).delete(u).catch(Te)})(this._deps,this.name),s()}),i.onerror=Wr(r),i.onblocked=this._fireOnBlocked};if(t)throw new zt.InvalidArgument("Arguments not allowed in db.delete()");e.isBeingOpened?e.dbReadyPromise.then(o):o()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return un(this._allTables).map(t=>this._allTables[t])}transaction(){const t=cJ.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,e,s){let r=Ft.trans;r&&r.db===this&&t.indexOf("!")===-1||(r=null);const o=t.indexOf("?")!==-1;let i,a;t=t.replace("!","").replace("?","");try{if(a=e.map(u=>{var h=u instanceof this.Table?u.name:u;if(typeof h!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return h}),t=="r"||t===ay)i=ay;else{if(t!="rw"&&t!=ly)throw new zt.InvalidArgument("Invalid transaction mode: "+t);i=ly}if(r){if(r.mode===ay&&i===ly){if(!o)throw new zt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&a.forEach(u=>{if(r&&r.storeNames.indexOf(u)===-1){if(!o)throw new zt.SubTransaction("Table "+u+" not included in parent transaction.");r=null}}),o&&r&&!r.active&&(r=null)}}catch(u){return r?r._promise(null,(h,d)=>{d(u)}):mn(u)}const l=cN.bind(null,this,i,a,r,s);return r?r._promise(i,l,"lock"):Ft.trans?dl(Ft.transless,()=>this._whenReady(l)):this._whenReady(l)}table(t){if(!ks(this._allTables,t))throw new zt.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const gJ=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class xJ{constructor(t){this._subscribe=t}subscribe(t,e,s){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:e,complete:s})}[gJ](){return this}}function pN(n,t){return un(t).forEach(e=>{Zf(n[e]||(n[e]=new uo),t[e])}),n}function bJ(n){let t,e=!1;const s=new xJ(r=>{const o=Vb(n);let i=!1,a={},l={};const u={get closed(){return i},unsubscribe:()=>{i=!0,ei.storagemutated.unsubscribe(m)}};r.start&&r.start(u);let h=!1,d=!1;function f(){return un(l).some(x=>a[x]&&pJ(a[x],l[x]))}const m=x=>{pN(a,x),f()&&g()},g=()=>{if(h||i)return;a={};const x={},b=function(w){o&&hl();const v=()=>Zo(n,{subscr:w,trans:null}),I=Ft.trans?dl(Ft.transless,v):v();return o&&I.then(ao,ao),I}(x);d||(ei(Oc,m),d=!0),h=!0,Promise.resolve(b).then(w=>{e=!0,t=w,h=!1,i||(f()?g():(a={},l=x,r.next&&r.next(w)))},w=>{h=!1,e=!1,r.error&&r.error(w),u.unsubscribe()})};return g(),u});return s.hasValue=()=>e,s.getValue=()=>t,s}let Ny;try{Ny={indexedDB:Pe.indexedDB||Pe.mozIndexedDB||Pe.webkitIndexedDB||Pe.msIndexedDB,IDBKeyRange:Pe.IDBKeyRange||Pe.webkitIDBKeyRange}}catch{Ny={indexedDB:null,IDBKeyRange:null}}const ia=oa;function Jf(n){let t=co;try{co=!0,ei.storagemutated.fire(n)}finally{co=t}}il(ia,{...Rf,delete:n=>new ia(n,{addons:[]}).delete(),exists:n=>new ia(n,{addons:[]}).open().then(t=>(t.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(n){try{return function({indexedDB:t,IDBKeyRange:e}){return vy(t)?Promise.resolve(t.databases()).then(s=>s.map(r=>r.name).filter(r=>r!==Gf)):wy(t,e).toCollection().primaryKeys()}(ia.dependencies).then(n)}catch{return mn(new zt.MissingAPI)}},defineClass:()=>function(n){Qn(this,n)},ignoreTransaction:n=>Ft.trans?dl(Ft.transless,n):n(),vip:Cy,async:function(n){return function(){try{var t=Iy(n.apply(this,arguments));return t&&typeof t.then=="function"?t:$t.resolve(t)}catch(e){return mn(e)}}},spawn:function(n,t,e){try{var s=Iy(n.apply(e,t||[]));return s&&typeof s.then=="function"?s:$t.resolve(s)}catch(r){return mn(r)}},currentTransaction:{get:()=>Ft.trans||null},waitFor:function(n,t){const e=$t.resolve(typeof n=="function"?ia.ignoreTransaction(n):n).timeout(t||6e4);return Ft.trans?Ft.trans.waitFor(e):e},Promise:$t,debug:{get:()=>zr,set:n=>{D2(n,n==="dexie"?()=>!0:J2)}},derive:al,extend:Qn,props:il,override:N2,Events:Ac,on:ei,liveQuery:bJ,extendObservabilitySet:pN,getByKeyPath:oo,setByKeyPath:gr,delByKeyPath:function(n,t){typeof t=="string"?gr(n,t,void 0):"length"in t&&[].map.call(t,function(e){gr(n,e,void 0)})},shallowClone:_2,deepClone:Ic,getObjectDiff:$y,cmp:ts,asap:T2,minKey:iy,addons:[],connections:Rc,errnames:Hb,dependencies:Ny,semVer:Y2,version:Y2.split(".").map(n=>parseInt(n)).reduce((n,t,e)=>n+t/Math.pow(10,2*e))}),ia.maxKey=Lc(ia.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(ei(Oc,n=>{if(!co){let t;Uf?(t=document.createEvent("CustomEvent"),t.initCustomEvent(ti,!0,!0,n)):t=new CustomEvent(ti,{detail:n}),co=!0,dispatchEvent(t),co=!1}}),addEventListener(ti,({detail:n})=>{co||Jf(n)}));let co=!1;if(typeof BroadcastChannel<"u"){const n=new BroadcastChannel(ti);typeof n.unref=="function"&&n.unref(),ei(Oc,t=>{co||n.postMessage(t)}),n.onmessage=t=>{t.data&&Jf(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){ei(Oc,t=>{try{co||(typeof localStorage<"u"&&localStorage.setItem(ti,JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(e=>e.postMessage({type:ti,changedParts:t})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",t=>{if(t.key===ti){const e=JSON.parse(t.newValue);e&&Jf(e.changedParts)}});const n=self.document&&navigator.serviceWorker;n&&n.addEventListener("message",function({data:t}){t&&t.type===ti&&Jf(t.changedParts)})}$t.rejectionMapper=function(n,t){if(!n||n instanceof ul||n instanceof TypeError||n instanceof SyntaxError||!n.name||!P2[n.name])return n;var e=new P2[n.name](t||n.message,n);return"stack"in n&&ro(e,"stack",{get:function(){return this.inner.stack}}),e},D2(zr,J2);class yJ extends oa{constructor(){super("spaceshifter");Io(this,"embeddings");Io(this,"dataset");Io(this,"pair");Io(this,"savedMatrices");this.version(1).stores({embedding:"text, embedding, dateCreated",dataset:"++id, name, dateCreated, trainingParams",pair:"++id, dataset, dateCreated, text_1, text_2, label",matrix:"++id, dataset, matrix, shape, dateCreated"}),this.version(2).stores({embeddings:"[text+model], embedding, dateCreated",dataset:"++id, name, dateCreated, trainingParams",pair:"++id, dataset, dateCreated, text_1, text_2, label",matrix:"++id, dataset, matrix, shape, dateCreated"}).upgrade(async e=>e.table("embedding").clear())}async deleteDataset(e){return await this.transaction("rw",this.embeddings,this.pair,this.dataset,async()=>{const s=await this.pair.where("dataset").equals(e).toArray();for await(const{text_1:r,text_2:o}of s)await this.embeddings.where("text").equals(r).delete(),await this.embeddings.where("text").equals(o).delete();await this.pair.where("dataset").equals(e).delete(),await this.dataset.delete(e)})}}const mN=new yJ;var gN={exports:{}};(function(n){(function(t,e){n.exports?n.exports=e():t.log=e()})($e,function(){var t=function(){},e="undefined",s=typeof window!==e&&typeof window.navigator!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function o(x,b){var w=x[b];if(typeof w.bind=="function")return w.bind(x);try{return Function.prototype.bind.call(w,x)}catch{return function(){return Function.prototype.apply.apply(w,[x,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(x){return x==="debug"&&(x="log"),typeof console===e?!1:x==="trace"&&s?i:console[x]!==void 0?o(console,x):console.log!==void 0?o(console,"log"):t}function l(x,b){for(var w=0;w<r.length;w++){var v=r[w];this[v]=w<x?t:this.methodFactory(v,x,b)}this.log=this.debug}function u(x,b,w){return function(){typeof console!==e&&(l.call(this,b,w),this[x].apply(this,arguments))}}function h(x,b,w){return a(x)||u.apply(this,arguments)}function d(x,b,w){var v=this,I;b=b??"WARN";var C="loglevel";typeof x=="string"?C+=":"+x:typeof x=="symbol"&&(C=void 0);function k(E){var F=(r[E]||"silent").toUpperCase();if(!(typeof window===e||!C)){try{window.localStorage[C]=F;return}catch{}try{window.document.cookie=encodeURIComponent(C)+"="+F+";"}catch{}}}function N(){var E;if(!(typeof window===e||!C)){try{E=window.localStorage[C]}catch{}if(typeof E===e)try{var F=window.document.cookie,P=F.indexOf(encodeURIComponent(C)+"=");P!==-1&&(E=/^([^;]+)/.exec(F.slice(P))[1])}catch{}return v.levels[E]===void 0&&(E=void 0),E}}function T(){if(!(typeof window===e||!C)){try{window.localStorage.removeItem(C);return}catch{}try{window.document.cookie=encodeURIComponent(C)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}v.name=x,v.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},v.methodFactory=w||h,v.getLevel=function(){return I},v.setLevel=function(E,F){if(typeof E=="string"&&v.levels[E.toUpperCase()]!==void 0&&(E=v.levels[E.toUpperCase()]),typeof E=="number"&&E>=0&&E<=v.levels.SILENT){if(I=E,F!==!1&&k(E),l.call(v,E,x),typeof console===e&&E<v.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+E},v.setDefaultLevel=function(E){b=E,N()||v.setLevel(E,!1)},v.resetLevel=function(){v.setLevel(b,!1),T()},v.enableAll=function(E){v.setLevel(v.levels.TRACE,E)},v.disableAll=function(E){v.setLevel(v.levels.SILENT,E)};var R=N();R==null&&(R=b),v.setLevel(R,!1)}var f=new d,m={};f.getLogger=function(b){if(typeof b!="symbol"&&typeof b!="string"||b==="")throw new TypeError("You must supply a name when creating a logger.");var w=m[b];return w||(w=m[b]=new d(b,f.getLevel(),f.methodFactory)),w};var g=typeof window!==e?window.log:void 0;return f.noConflict=function(){return typeof window!==e&&window.log===f&&(window.log=g),f},f.getLoggers=function(){return m},f.default=f,f})})(gN);var wJ=gN.exports,Bc=L1(wJ),Qf={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Qf.exports,function(n,t){(function(){var e,s="4.17.21",r=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",i="Expected a function",a="Invalid `variable` option passed into `_.template`",l="__lodash_hash_undefined__",u=500,h="__lodash_placeholder__",d=1,f=2,m=4,g=1,x=2,b=1,w=2,v=4,I=8,C=16,k=32,N=64,T=128,R=256,E=512,F=30,P="...",q=800,j=16,K=1,Y=2,Q=3,tt=1/0,Z=9007199254740991,rt=17976931348623157e292,ut=0/0,lt=4294967295,mt=lt-1,ft=lt>>>1,bt=[["ary",T],["bind",b],["bindKey",w],["curry",I],["curryRight",C],["flip",E],["partial",k],["partialRight",N],["rearg",R]],pt="[object Arguments]",yt="[object Array]",Nt="[object AsyncFunction]",Rt="[object Boolean]",Et="[object Date]",Ut="[object DOMException]",Wt="[object Error]",oe="[object Function]",xe="[object GeneratorFunction]",ie="[object Map]",ce="[object Number]",pe="[object Null]",ue="[object Object]",Ie="[object Promise]",xr="[object Proxy]",Ve="[object RegExp]",cn="[object Set]",gn="[object String]",js="[object Symbol]",Ns="[object Undefined]",es="[object WeakMap]",Vr="[object WeakSet]",fs="[object ArrayBuffer]",ns="[object DataView]",fo="[object Float32Array]",aa="[object Float64Array]",la="[object Int8Array]",zc="[object Int16Array]",si="[object Int32Array]",Wc="[object Uint8Array]",Vc="[object Uint8ClampedArray]",By="[object Uint16Array]",zy="[object Uint32Array]",nQ=/\b__p \+= '';/g,sQ=/\b(__p \+=) '' \+/g,rQ=/(__e\(.*?\)|\b__t\)) \+\n'';/g,NN=/&(?:amp|lt|gt|quot|#39);/g,TN=/[&<>"']/g,oQ=RegExp(NN.source),iQ=RegExp(TN.source),aQ=/<%-([\s\S]+?)%>/g,lQ=/<%([\s\S]+?)%>/g,EN=/<%=([\s\S]+?)%>/g,uQ=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,cQ=/^\w*$/,hQ=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Wy=/[\\^$.*+?()[\]{}|]/g,dQ=RegExp(Wy.source),Vy=/^\s+/,fQ=/\s/,pQ=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,mQ=/\{\n\/\* \[wrapped with (.+)\] \*/,gQ=/,? & /,xQ=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,bQ=/[()=,{}\[\]\/\s]/,yQ=/\\(\\)?/g,wQ=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,_N=/\w*$/,vQ=/^[-+]0x[0-9a-f]+$/i,CQ=/^0b[01]+$/i,IQ=/^\[object .+?Constructor\]$/,$Q=/^0o[0-7]+$/i,kQ=/^(?:0|[1-9]\d*)$/,SQ=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,np=/($^)/,NQ=/['\n\r\u2028\u2029\\]/g,sp="\\ud800-\\udfff",TQ="\\u0300-\\u036f",EQ="\\ufe20-\\ufe2f",_Q="\\u20d0-\\u20ff",RN=TQ+EQ+_Q,AN="\\u2700-\\u27bf",DN="a-z\\xdf-\\xf6\\xf8-\\xff",RQ="\\xac\\xb1\\xd7\\xf7",AQ="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",DQ="\\u2000-\\u206f",FQ=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",FN="A-Z\\xc0-\\xd6\\xd8-\\xde",ON="\\ufe0e\\ufe0f",LN=RQ+AQ+DQ+FQ,Uy="['’]",OQ="["+sp+"]",PN="["+LN+"]",rp="["+RN+"]",MN="\\d+",LQ="["+AN+"]",BN="["+DN+"]",zN="[^"+sp+LN+MN+AN+DN+FN+"]",Gy="\\ud83c[\\udffb-\\udfff]",PQ="(?:"+rp+"|"+Gy+")",WN="[^"+sp+"]",Hy="(?:\\ud83c[\\udde6-\\uddff]){2}",Ky="[\\ud800-\\udbff][\\udc00-\\udfff]",gl="["+FN+"]",VN="\\u200d",UN="(?:"+BN+"|"+zN+")",MQ="(?:"+gl+"|"+zN+")",GN="(?:"+Uy+"(?:d|ll|m|re|s|t|ve))?",HN="(?:"+Uy+"(?:D|LL|M|RE|S|T|VE))?",KN=PQ+"?",qN="["+ON+"]?",BQ="(?:"+VN+"(?:"+[WN,Hy,Ky].join("|")+")"+qN+KN+")*",zQ="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",WQ="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",jN=qN+KN+BQ,VQ="(?:"+[LQ,Hy,Ky].join("|")+")"+jN,UQ="(?:"+[WN+rp+"?",rp,Hy,Ky,OQ].join("|")+")",GQ=RegExp(Uy,"g"),HQ=RegExp(rp,"g"),qy=RegExp(Gy+"(?="+Gy+")|"+UQ+jN,"g"),KQ=RegExp([gl+"?"+BN+"+"+GN+"(?="+[PN,gl,"$"].join("|")+")",MQ+"+"+HN+"(?="+[PN,gl+UN,"$"].join("|")+")",gl+"?"+UN+"+"+GN,gl+"+"+HN,WQ,zQ,MN,VQ].join("|"),"g"),qQ=RegExp("["+VN+sp+RN+ON+"]"),jQ=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,XQ=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],YQ=-1,Me={};Me[fo]=Me[aa]=Me[la]=Me[zc]=Me[si]=Me[Wc]=Me[Vc]=Me[By]=Me[zy]=!0,Me[pt]=Me[yt]=Me[fs]=Me[Rt]=Me[ns]=Me[Et]=Me[Wt]=Me[oe]=Me[ie]=Me[ce]=Me[ue]=Me[Ve]=Me[cn]=Me[gn]=Me[es]=!1;var De={};De[pt]=De[yt]=De[fs]=De[ns]=De[Rt]=De[Et]=De[fo]=De[aa]=De[la]=De[zc]=De[si]=De[ie]=De[ce]=De[ue]=De[Ve]=De[cn]=De[gn]=De[js]=De[Wc]=De[Vc]=De[By]=De[zy]=!0,De[Wt]=De[oe]=De[es]=!1;var ZQ={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},JQ={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},QQ={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},ttt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ett=parseFloat,ntt=parseInt,XN=typeof $e=="object"&&$e&&$e.Object===Object&&$e,stt=typeof self=="object"&&self&&self.Object===Object&&self,_n=XN||stt||Function("return this")(),jy=t&&!t.nodeType&&t,ua=jy&&!0&&n&&!n.nodeType&&n,YN=ua&&ua.exports===jy,Xy=YN&&XN.process,Xs=function(){try{var V=ua&&ua.require&&ua.require("util").types;return V||Xy&&Xy.binding&&Xy.binding("util")}catch{}}(),ZN=Xs&&Xs.isArrayBuffer,JN=Xs&&Xs.isDate,QN=Xs&&Xs.isMap,tT=Xs&&Xs.isRegExp,eT=Xs&&Xs.isSet,nT=Xs&&Xs.isTypedArray;function Ts(V,ot,et){switch(et.length){case 0:return V.call(ot);case 1:return V.call(ot,et[0]);case 2:return V.call(ot,et[0],et[1]);case 3:return V.call(ot,et[0],et[1],et[2])}return V.apply(ot,et)}function rtt(V,ot,et,It){for(var Gt=-1,me=V==null?0:V.length;++Gt<me;){var xn=V[Gt];ot(It,xn,et(xn),V)}return It}function Ys(V,ot){for(var et=-1,It=V==null?0:V.length;++et<It&&ot(V[et],et,V)!==!1;);return V}function ott(V,ot){for(var et=V==null?0:V.length;et--&&ot(V[et],et,V)!==!1;);return V}function sT(V,ot){for(var et=-1,It=V==null?0:V.length;++et<It;)if(!ot(V[et],et,V))return!1;return!0}function ri(V,ot){for(var et=-1,It=V==null?0:V.length,Gt=0,me=[];++et<It;){var xn=V[et];ot(xn,et,V)&&(me[Gt++]=xn)}return me}function op(V,ot){var et=V==null?0:V.length;return!!et&&xl(V,ot,0)>-1}function Yy(V,ot,et){for(var It=-1,Gt=V==null?0:V.length;++It<Gt;)if(et(ot,V[It]))return!0;return!1}function Ue(V,ot){for(var et=-1,It=V==null?0:V.length,Gt=Array(It);++et<It;)Gt[et]=ot(V[et],et,V);return Gt}function oi(V,ot){for(var et=-1,It=ot.length,Gt=V.length;++et<It;)V[Gt+et]=ot[et];return V}function Zy(V,ot,et,It){var Gt=-1,me=V==null?0:V.length;for(It&&me&&(et=V[++Gt]);++Gt<me;)et=ot(et,V[Gt],Gt,V);return et}function itt(V,ot,et,It){var Gt=V==null?0:V.length;for(It&&Gt&&(et=V[--Gt]);Gt--;)et=ot(et,V[Gt],Gt,V);return et}function Jy(V,ot){for(var et=-1,It=V==null?0:V.length;++et<It;)if(ot(V[et],et,V))return!0;return!1}var att=Qy("length");function ltt(V){return V.split("")}function utt(V){return V.match(xQ)||[]}function rT(V,ot,et){var It;return et(V,function(Gt,me,xn){if(ot(Gt,me,xn))return It=me,!1}),It}function ip(V,ot,et,It){for(var Gt=V.length,me=et+(It?1:-1);It?me--:++me<Gt;)if(ot(V[me],me,V))return me;return-1}function xl(V,ot,et){return ot===ot?vtt(V,ot,et):ip(V,oT,et)}function ctt(V,ot,et,It){for(var Gt=et-1,me=V.length;++Gt<me;)if(It(V[Gt],ot))return Gt;return-1}function oT(V){return V!==V}function iT(V,ot){var et=V==null?0:V.length;return et?e0(V,ot)/et:ut}function Qy(V){return function(ot){return ot==null?e:ot[V]}}function t0(V){return function(ot){return V==null?e:V[ot]}}function aT(V,ot,et,It,Gt){return Gt(V,function(me,xn,Ee){et=It?(It=!1,me):ot(et,me,xn,Ee)}),et}function htt(V,ot){var et=V.length;for(V.sort(ot);et--;)V[et]=V[et].value;return V}function e0(V,ot){for(var et,It=-1,Gt=V.length;++It<Gt;){var me=ot(V[It]);me!==e&&(et=et===e?me:et+me)}return et}function n0(V,ot){for(var et=-1,It=Array(V);++et<V;)It[et]=ot(et);return It}function dtt(V,ot){return Ue(ot,function(et){return[et,V[et]]})}function lT(V){return V&&V.slice(0,dT(V)+1).replace(Vy,"")}function Es(V){return function(ot){return V(ot)}}function s0(V,ot){return Ue(ot,function(et){return V[et]})}function Uc(V,ot){return V.has(ot)}function uT(V,ot){for(var et=-1,It=V.length;++et<It&&xl(ot,V[et],0)>-1;);return et}function cT(V,ot){for(var et=V.length;et--&&xl(ot,V[et],0)>-1;);return et}function ftt(V,ot){for(var et=V.length,It=0;et--;)V[et]===ot&&++It;return It}var ptt=t0(ZQ),mtt=t0(JQ);function gtt(V){return"\\"+ttt[V]}function xtt(V,ot){return V==null?e:V[ot]}function bl(V){return qQ.test(V)}function btt(V){return jQ.test(V)}function ytt(V){for(var ot,et=[];!(ot=V.next()).done;)et.push(ot.value);return et}function r0(V){var ot=-1,et=Array(V.size);return V.forEach(function(It,Gt){et[++ot]=[Gt,It]}),et}function hT(V,ot){return function(et){return V(ot(et))}}function ii(V,ot){for(var et=-1,It=V.length,Gt=0,me=[];++et<It;){var xn=V[et];(xn===ot||xn===h)&&(V[et]=h,me[Gt++]=et)}return me}function ap(V){var ot=-1,et=Array(V.size);return V.forEach(function(It){et[++ot]=It}),et}function wtt(V){var ot=-1,et=Array(V.size);return V.forEach(function(It){et[++ot]=[It,It]}),et}function vtt(V,ot,et){for(var It=et-1,Gt=V.length;++It<Gt;)if(V[It]===ot)return It;return-1}function Ctt(V,ot,et){for(var It=et+1;It--;)if(V[It]===ot)return It;return It}function yl(V){return bl(V)?$tt(V):att(V)}function br(V){return bl(V)?ktt(V):ltt(V)}function dT(V){for(var ot=V.length;ot--&&fQ.test(V.charAt(ot)););return ot}var Itt=t0(QQ);function $tt(V){for(var ot=qy.lastIndex=0;qy.test(V);)++ot;return ot}function ktt(V){return V.match(qy)||[]}function Stt(V){return V.match(KQ)||[]}var Ntt=function V(ot){ot=ot==null?_n:wl.defaults(_n.Object(),ot,wl.pick(_n,XQ));var et=ot.Array,It=ot.Date,Gt=ot.Error,me=ot.Function,xn=ot.Math,Ee=ot.Object,o0=ot.RegExp,Ttt=ot.String,Zs=ot.TypeError,lp=et.prototype,Ett=me.prototype,vl=Ee.prototype,up=ot["__core-js_shared__"],cp=Ett.toString,we=vl.hasOwnProperty,_tt=0,fT=function(){var c=/[^.]+$/.exec(up&&up.keys&&up.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),hp=vl.toString,Rtt=cp.call(Ee),Att=_n._,Dtt=o0("^"+cp.call(we).replace(Wy,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),dp=YN?ot.Buffer:e,ai=ot.Symbol,fp=ot.Uint8Array,pT=dp?dp.allocUnsafe:e,pp=hT(Ee.getPrototypeOf,Ee),mT=Ee.create,gT=vl.propertyIsEnumerable,mp=lp.splice,xT=ai?ai.isConcatSpreadable:e,Gc=ai?ai.iterator:e,ca=ai?ai.toStringTag:e,gp=function(){try{var c=ma(Ee,"defineProperty");return c({},"",{}),c}catch{}}(),Ftt=ot.clearTimeout!==_n.clearTimeout&&ot.clearTimeout,Ott=It&&It.now!==_n.Date.now&&It.now,Ltt=ot.setTimeout!==_n.setTimeout&&ot.setTimeout,xp=xn.ceil,bp=xn.floor,i0=Ee.getOwnPropertySymbols,Ptt=dp?dp.isBuffer:e,bT=ot.isFinite,Mtt=lp.join,Btt=hT(Ee.keys,Ee),bn=xn.max,Vn=xn.min,ztt=It.now,Wtt=ot.parseInt,yT=xn.random,Vtt=lp.reverse,a0=ma(ot,"DataView"),Hc=ma(ot,"Map"),l0=ma(ot,"Promise"),Cl=ma(ot,"Set"),Kc=ma(ot,"WeakMap"),qc=ma(Ee,"create"),yp=Kc&&new Kc,Il={},Utt=ga(a0),Gtt=ga(Hc),Htt=ga(l0),Ktt=ga(Cl),qtt=ga(Kc),wp=ai?ai.prototype:e,jc=wp?wp.valueOf:e,wT=wp?wp.toString:e;function _(c){if(Ze(c)&&!Kt(c)&&!(c instanceof ee)){if(c instanceof Js)return c;if(we.call(c,"__wrapped__"))return vE(c)}return new Js(c)}var $l=function(){function c(){}return function(p){if(!Ge(p))return{};if(mT)return mT(p);c.prototype=p;var y=new c;return c.prototype=e,y}}();function vp(){}function Js(c,p){this.__wrapped__=c,this.__actions__=[],this.__chain__=!!p,this.__index__=0,this.__values__=e}_.templateSettings={escape:aQ,evaluate:lQ,interpolate:EN,variable:"",imports:{_}},_.prototype=vp.prototype,_.prototype.constructor=_,Js.prototype=$l(vp.prototype),Js.prototype.constructor=Js;function ee(c){this.__wrapped__=c,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=lt,this.__views__=[]}function jtt(){var c=new ee(this.__wrapped__);return c.__actions__=ps(this.__actions__),c.__dir__=this.__dir__,c.__filtered__=this.__filtered__,c.__iteratees__=ps(this.__iteratees__),c.__takeCount__=this.__takeCount__,c.__views__=ps(this.__views__),c}function Xtt(){if(this.__filtered__){var c=new ee(this);c.__dir__=-1,c.__filtered__=!0}else c=this.clone(),c.__dir__*=-1;return c}function Ytt(){var c=this.__wrapped__.value(),p=this.__dir__,y=Kt(c),$=p<0,S=y?c.length:0,D=cnt(0,S,this.__views__),O=D.start,M=D.end,H=M-O,it=$?M:O-1,at=this.__iteratees__,ht=at.length,wt=0,Tt=Vn(H,this.__takeCount__);if(!y||!$&&S==H&&Tt==H)return GT(c,this.__actions__);var Mt=[];t:for(;H--&&wt<Tt;){it+=p;for(var Jt=-1,Bt=c[it];++Jt<ht;){var te=at[Jt],ae=te.iteratee,As=te.type,os=ae(Bt);if(As==Y)Bt=os;else if(!os){if(As==K)continue t;break t}}Mt[wt++]=Bt}return Mt}ee.prototype=$l(vp.prototype),ee.prototype.constructor=ee;function ha(c){var p=-1,y=c==null?0:c.length;for(this.clear();++p<y;){var $=c[p];this.set($[0],$[1])}}function Ztt(){this.__data__=qc?qc(null):{},this.size=0}function Jtt(c){var p=this.has(c)&&delete this.__data__[c];return this.size-=p?1:0,p}function Qtt(c){var p=this.__data__;if(qc){var y=p[c];return y===l?e:y}return we.call(p,c)?p[c]:e}function tet(c){var p=this.__data__;return qc?p[c]!==e:we.call(p,c)}function eet(c,p){var y=this.__data__;return this.size+=this.has(c)?0:1,y[c]=qc&&p===e?l:p,this}ha.prototype.clear=Ztt,ha.prototype.delete=Jtt,ha.prototype.get=Qtt,ha.prototype.has=tet,ha.prototype.set=eet;function po(c){var p=-1,y=c==null?0:c.length;for(this.clear();++p<y;){var $=c[p];this.set($[0],$[1])}}function net(){this.__data__=[],this.size=0}function set(c){var p=this.__data__,y=Cp(p,c);if(y<0)return!1;var $=p.length-1;return y==$?p.pop():mp.call(p,y,1),--this.size,!0}function ret(c){var p=this.__data__,y=Cp(p,c);return y<0?e:p[y][1]}function oet(c){return Cp(this.__data__,c)>-1}function iet(c,p){var y=this.__data__,$=Cp(y,c);return $<0?(++this.size,y.push([c,p])):y[$][1]=p,this}po.prototype.clear=net,po.prototype.delete=set,po.prototype.get=ret,po.prototype.has=oet,po.prototype.set=iet;function mo(c){var p=-1,y=c==null?0:c.length;for(this.clear();++p<y;){var $=c[p];this.set($[0],$[1])}}function aet(){this.size=0,this.__data__={hash:new ha,map:new(Hc||po),string:new ha}}function uet(c){var p=Fp(this,c).delete(c);return this.size-=p?1:0,p}function cet(c){return Fp(this,c).get(c)}function het(c){return Fp(this,c).has(c)}function det(c,p){var y=Fp(this,c),$=y.size;return y.set(c,p),this.size+=y.size==$?0:1,this}mo.prototype.clear=aet,mo.prototype.delete=uet,mo.prototype.get=cet,mo.prototype.has=het,mo.prototype.set=det;function da(c){var p=-1,y=c==null?0:c.length;for(this.__data__=new mo;++p<y;)this.add(c[p])}function fet(c){return this.__data__.set(c,l),this}function pet(c){return this.__data__.has(c)}da.prototype.add=da.prototype.push=fet,da.prototype.has=pet;function yr(c){var p=this.__data__=new po(c);this.size=p.size}function met(){this.__data__=new po,this.size=0}function get(c){var p=this.__data__,y=p.delete(c);return this.size=p.size,y}function xet(c){return this.__data__.get(c)}function bet(c){return this.__data__.has(c)}function yet(c,p){var y=this.__data__;if(y instanceof po){var $=y.__data__;if(!Hc||$.length<r-1)return $.push([c,p]),this.size=++y.size,this;y=this.__data__=new mo($)}return y.set(c,p),this.size=y.size,this}yr.prototype.clear=met,yr.prototype.delete=get,yr.prototype.get=xet,yr.prototype.has=bet,yr.prototype.set=yet;function vT(c,p){var y=Kt(c),$=!y&&xa(c),S=!y&&!$&&di(c),D=!y&&!$&&!S&&Tl(c),O=y||$||S||D,M=O?n0(c.length,Ttt):[],H=M.length;for(var it in c)(p||we.call(c,it))&&!(O&&(it=="length"||S&&(it=="offset"||it=="parent")||D&&(it=="buffer"||it=="byteLength"||it=="byteOffset")||yo(it,H)))&&M.push(it);return M}function CT(c){var p=c.length;return p?c[y0(0,p-1)]:e}function wet(c,p){return Op(ps(c),fa(p,0,c.length))}function vet(c){return Op(ps(c))}function u0(c,p,y){(y!==e&&!wr(c[p],y)||y===e&&!(p in c))&&go(c,p,y)}function Xc(c,p,y){var $=c[p];(!(we.call(c,p)&&wr($,y))||y===e&&!(p in c))&&go(c,p,y)}function Cp(c,p){for(var y=c.length;y--;)if(wr(c[y][0],p))return y;return-1}function Cet(c,p,y,$){return li(c,function(S,D,O){p($,S,y(S),O)}),$}function IT(c,p){return c&&Gr(p,$n(p),c)}function Iet(c,p){return c&&Gr(p,gs(p),c)}function go(c,p,y){p=="__proto__"&&gp?gp(c,p,{configurable:!0,enumerable:!0,value:y,writable:!0}):c[p]=y}function c0(c,p){for(var y=-1,$=p.length,S=et($),D=c==null;++y<$;)S[y]=D?e:G0(c,p[y]);return S}function fa(c,p,y){return c===c&&(y!==e&&(c=c<=y?c:y),p!==e&&(c=c>=p?c:p)),c}function Qs(c,p,y,$,S,D){var O,M=p&d,H=p&f,it=p&m;if(y&&(O=S?y(c,$,S,D):y(c)),O!==e)return O;if(!Ge(c))return c;var at=Kt(c);if(at){if(O=dnt(c),!M)return ps(c,O)}else{var ht=Un(c),wt=ht==oe||ht==xe;if(di(c))return qT(c,M);if(ht==ue||ht==pt||wt&&!S){if(O=H||wt?{}:dE(c),!M)return H?ent(c,Iet(O,c)):tnt(c,IT(O,c))}else{if(!De[ht])return S?c:{};O=fnt(c,ht,M)}}D||(D=new yr);var Tt=D.get(c);if(Tt)return Tt;D.set(c,O),WE(c)?c.forEach(function(Bt){O.add(Qs(Bt,p,y,Bt,c,D))}):BE(c)&&c.forEach(function(Bt,te){O.set(te,Qs(Bt,p,y,te,c,D))});var Mt=it?H?_0:E0:H?gs:$n,Jt=at?e:Mt(c);return Ys(Jt||c,function(Bt,te){Jt&&(te=Bt,Bt=c[te]),Xc(O,te,Qs(Bt,p,y,te,c,D))}),O}function $et(c){var p=$n(c);return function(y){return $T(y,c,p)}}function $T(c,p,y){var $=y.length;if(c==null)return!$;for(c=Ee(c);$--;){var S=y[$],D=p[S],O=c[S];if(O===e&&!(S in c)||!D(O))return!1}return!0}function kT(c,p,y){if(typeof c!="function")throw new Zs(i);return nh(function(){c.apply(e,y)},p)}function Yc(c,p,y,$){var S=-1,D=op,O=!0,M=c.length,H=[],it=p.length;if(!M)return H;y&&(p=Ue(p,Es(y))),$?(D=Yy,O=!1):p.length>=r&&(D=Uc,O=!1,p=new da(p));t:for(;++S<M;){var at=c[S],ht=y==null?at:y(at);if(at=$||at!==0?at:0,O&&ht===ht){for(var wt=it;wt--;)if(p[wt]===ht)continue t;H.push(at)}else D(p,ht,$)||H.push(at)}return H}var li=JT(Ur),ST=JT(d0,!0);function ket(c,p){var y=!0;return li(c,function($,S,D){return y=!!p($,S,D),y}),y}function Ip(c,p,y){for(var $=-1,S=c.length;++$<S;){var D=c[$],O=p(D);if(O!=null&&(M===e?O===O&&!Rs(O):y(O,M)))var M=O,H=D}return H}function Net(c,p,y,$){var S=c.length;for(y=jt(y),y<0&&(y=-y>S?0:S+y),$=$===e||$>S?S:jt($),$<0&&($+=S),$=y>$?0:UE($);y<$;)c[y++]=p;return c}function NT(c,p){var y=[];return li(c,function($,S,D){p($,S,D)&&y.push($)}),y}function Rn(c,p,y,$,S){var D=-1,O=c.length;for(y||(y=mnt),S||(S=[]);++D<O;){var M=c[D];p>0&&y(M)?p>1?Rn(M,p-1,y,$,S):oi(S,M):$||(S[S.length]=M)}return S}var h0=QT(),TT=QT(!0);function Ur(c,p){return c&&h0(c,p,$n)}function d0(c,p){return c&&TT(c,p,$n)}function $p(c,p){return ri(p,function(y){return wo(c[y])})}function pa(c,p){p=ci(p,c);for(var y=0,$=p.length;c!=null&&y<$;)c=c[Hr(p[y++])];return y&&y==$?c:e}function ET(c,p,y){var $=p(c);return Kt(c)?$:oi($,y(c))}function ss(c){return c==null?c===e?Ns:pe:ca&&ca in Ee(c)?unt(c):Cnt(c)}function f0(c,p){return c>p}function Tet(c,p){return c!=null&&we.call(c,p)}function Eet(c,p){return c!=null&&p in Ee(c)}function _et(c,p,y){return c>=Vn(p,y)&&c<bn(p,y)}function p0(c,p,y){for(var $=y?Yy:op,S=c[0].length,D=c.length,O=D,M=et(D),H=1/0,it=[];O--;){var at=c[O];O&&p&&(at=Ue(at,Es(p))),H=Vn(at.length,H),M[O]=!y&&(p||S>=120&&at.length>=120)?new da(O&&at):e}at=c[0];var ht=-1,wt=M[0];t:for(;++ht<S&&it.length<H;){var Tt=at[ht],Mt=p?p(Tt):Tt;if(Tt=y||Tt!==0?Tt:0,!(wt?Uc(wt,Mt):$(it,Mt,y))){for(O=D;--O;){var Jt=M[O];if(!(Jt?Uc(Jt,Mt):$(c[O],Mt,y)))continue t}wt&&wt.push(Mt),it.push(Tt)}}return it}function Ret(c,p,y,$){return Ur(c,function(S,D,O){p($,y(S),D,O)}),$}function Zc(c,p,y){p=ci(p,c),c=gE(c,p);var $=c==null?c:c[Hr(er(p))];return $==null?e:Ts($,c,y)}function _T(c){return Ze(c)&&ss(c)==pt}function Aet(c){return Ze(c)&&ss(c)==fs}function Det(c){return Ze(c)&&ss(c)==Et}function Jc(c,p,y,$,S){return c===p?!0:c==null||p==null||!Ze(c)&&!Ze(p)?c!==c&&p!==p:Fet(c,p,y,$,Jc,S)}function Fet(c,p,y,$,S,D){var O=Kt(c),M=Kt(p),H=O?yt:Un(c),it=M?yt:Un(p);H=H==pt?ue:H,it=it==pt?ue:it;var at=H==ue,ht=it==ue,wt=H==it;if(wt&&di(c)){if(!di(p))return!1;O=!0,at=!1}if(wt&&!at)return D||(D=new yr),O||Tl(c)?uE(c,p,y,$,S,D):ant(c,p,H,y,$,S,D);if(!(y&g)){var Tt=at&&we.call(c,"__wrapped__"),Mt=ht&&we.call(p,"__wrapped__");if(Tt||Mt){var Jt=Tt?c.value():c,Bt=Mt?p.value():p;return D||(D=new yr),S(Jt,Bt,y,$,D)}}return wt?(D||(D=new yr),lnt(c,p,y,$,S,D)):!1}function Oet(c){return Ze(c)&&Un(c)==ie}function m0(c,p,y,$){var S=y.length,D=S,O=!$;if(c==null)return!D;for(c=Ee(c);S--;){var M=y[S];if(O&&M[2]?M[1]!==c[M[0]]:!(M[0]in c))return!1}for(;++S<D;){M=y[S];var H=M[0],it=c[H],at=M[1];if(O&&M[2]){if(it===e&&!(H in c))return!1}else{var ht=new yr;if($)var wt=$(it,at,H,c,p,ht);if(!(wt===e?Jc(at,it,g|x,$,ht):wt))return!1}}return!0}function RT(c){if(!Ge(c)||xnt(c))return!1;var p=wo(c)?Dtt:IQ;return p.test(ga(c))}function Let(c){return Ze(c)&&ss(c)==Ve}function Pet(c){return Ze(c)&&Un(c)==cn}function Met(c){return Ze(c)&&Wp(c.length)&&!!Me[ss(c)]}function AT(c){return typeof c=="function"?c:c==null?xs:typeof c=="object"?Kt(c)?OT(c[0],c[1]):FT(c):t_(c)}function g0(c){if(!eh(c))return Btt(c);var p=[];for(var y in Ee(c))we.call(c,y)&&y!="constructor"&&p.push(y);return p}function Bet(c){if(!Ge(c))return vnt(c);var p=eh(c),y=[];for(var $ in c)$=="constructor"&&(p||!we.call(c,$))||y.push($);return y}function x0(c,p){return c<p}function DT(c,p){var y=-1,$=ms(c)?et(c.length):[];return li(c,function(S,D,O){$[++y]=p(S,D,O)}),$}function FT(c){var p=A0(c);return p.length==1&&p[0][2]?pE(p[0][0],p[0][1]):function(y){return y===c||m0(y,c,p)}}function OT(c,p){return F0(c)&&fE(p)?pE(Hr(c),p):function(y){var $=G0(y,c);return $===e&&$===p?H0(y,c):Jc(p,$,g|x)}}function kp(c,p,y,$,S){c!==p&&h0(p,function(D,O){if(S||(S=new yr),Ge(D))zet(c,p,O,y,kp,$,S);else{var M=$?$(L0(c,O),D,O+"",c,p,S):e;M===e&&(M=D),u0(c,O,M)}},gs)}function zet(c,p,y,$,S,D,O){var M=L0(c,y),H=L0(p,y),it=O.get(H);if(it){u0(c,y,it);return}var at=D?D(M,H,y+"",c,p,O):e,ht=at===e;if(ht){var wt=Kt(H),Tt=!wt&&di(H),Mt=!wt&&!Tt&&Tl(H);at=H,wt||Tt||Mt?Kt(M)?at=M:tn(M)?at=ps(M):Tt?(ht=!1,at=qT(H,!0)):Mt?(ht=!1,at=jT(H,!0)):at=[]:sh(H)||xa(H)?(at=M,xa(M)?at=GE(M):(!Ge(M)||wo(M))&&(at=dE(H))):ht=!1}ht&&(O.set(H,at),S(at,H,$,D,O),O.delete(H)),u0(c,y,at)}function LT(c,p){var y=c.length;if(y)return p+=p<0?y:0,yo(p,y)?c[p]:e}function PT(c,p,y){p.length?p=Ue(p,function(D){return Kt(D)?function(O){return pa(O,D.length===1?D[0]:D)}:D}):p=[xs];var $=-1;p=Ue(p,Es(Lt()));var S=DT(c,function(D,O,M){var H=Ue(p,function(it){return it(D)});return{criteria:H,index:++$,value:D}});return htt(S,function(D,O){return Qet(D,O,y)})}function Wet(c,p){return MT(c,p,function(y,$){return H0(c,$)})}function MT(c,p,y){for(var $=-1,S=p.length,D={};++$<S;){var O=p[$],M=pa(c,O);y(M,O)&&Qc(D,ci(O,c),M)}return D}function Vet(c){return function(p){return pa(p,c)}}function b0(c,p,y,$){var S=$?ctt:xl,D=-1,O=p.length,M=c;for(c===p&&(p=ps(p)),y&&(M=Ue(c,Es(y)));++D<O;)for(var H=0,it=p[D],at=y?y(it):it;(H=S(M,at,H,$))>-1;)M!==c&&mp.call(M,H,1),mp.call(c,H,1);return c}function BT(c,p){for(var y=c?p.length:0,$=y-1;y--;){var S=p[y];if(y==$||S!==D){var D=S;yo(S)?mp.call(c,S,1):C0(c,S)}}return c}function y0(c,p){return c+bp(yT()*(p-c+1))}function Uet(c,p,y,$){for(var S=-1,D=bn(xp((p-c)/(y||1)),0),O=et(D);D--;)O[$?D:++S]=c,c+=y;return O}function w0(c,p){var y="";if(!c||p<1||p>Z)return y;do p%2&&(y+=c),p=bp(p/2),p&&(c+=c);while(p);return y}function Qt(c,p){return P0(mE(c,p,xs),c+"")}function Get(c){return CT(El(c))}function Het(c,p){var y=El(c);return Op(y,fa(p,0,y.length))}function Qc(c,p,y,$){if(!Ge(c))return c;p=ci(p,c);for(var S=-1,D=p.length,O=D-1,M=c;M!=null&&++S<D;){var H=Hr(p[S]),it=y;if(H==="__proto__"||H==="constructor"||H==="prototype")return c;if(S!=O){var at=M[H];it=$?$(at,H,M):e,it===e&&(it=Ge(at)?at:yo(p[S+1])?[]:{})}Xc(M,H,it),M=M[H]}return c}var zT=yp?function(c,p){return yp.set(c,p),c}:xs,Ket=gp?function(c,p){return gp(c,"toString",{configurable:!0,enumerable:!1,value:q0(p),writable:!0})}:xs;function qet(c){return Op(El(c))}function tr(c,p,y){var $=-1,S=c.length;p<0&&(p=-p>S?0:S+p),y=y>S?S:y,y<0&&(y+=S),S=p>y?0:y-p>>>0,p>>>=0;for(var D=et(S);++$<S;)D[$]=c[$+p];return D}function jet(c,p){var y;return li(c,function($,S,D){return y=p($,S,D),!y}),!!y}function Sp(c,p,y){var $=0,S=c==null?$:c.length;if(typeof p=="number"&&p===p&&S<=ft){for(;$<S;){var D=$+S>>>1,O=c[D];O!==null&&!Rs(O)&&(y?O<=p:O<p)?$=D+1:S=D}return S}return v0(c,p,xs,y)}function v0(c,p,y,$){var S=0,D=c==null?0:c.length;if(D===0)return 0;p=y(p);for(var O=p!==p,M=p===null,H=Rs(p),it=p===e;S<D;){var at=bp((S+D)/2),ht=y(c[at]),wt=ht!==e,Tt=ht===null,Mt=ht===ht,Jt=Rs(ht);if(O)var Bt=$||Mt;else it?Bt=Mt&&($||wt):M?Bt=Mt&&wt&&($||!Tt):H?Bt=Mt&&wt&&!Tt&&($||!Jt):Tt||Jt?Bt=!1:Bt=$?ht<=p:ht<p;Bt?S=at+1:D=at}return Vn(D,mt)}function WT(c,p){for(var y=-1,$=c.length,S=0,D=[];++y<$;){var O=c[y],M=p?p(O):O;if(!y||!wr(M,H)){var H=M;D[S++]=O===0?0:O}}return D}function VT(c){return typeof c=="number"?c:Rs(c)?ut:+c}function _s(c){if(typeof c=="string")return c;if(Kt(c))return Ue(c,_s)+"";if(Rs(c))return wT?wT.call(c):"";var p=c+"";return p=="0"&&1/c==-tt?"-0":p}function ui(c,p,y){var $=-1,S=op,D=c.length,O=!0,M=[],H=M;if(y)O=!1,S=Yy;else if(D>=r){var it=p?null:ont(c);if(it)return ap(it);O=!1,S=Uc,H=new da}else H=p?[]:M;t:for(;++$<D;){var at=c[$],ht=p?p(at):at;if(at=y||at!==0?at:0,O&&ht===ht){for(var wt=H.length;wt--;)if(H[wt]===ht)continue t;p&&H.push(ht),M.push(at)}else S(H,ht,y)||(H!==M&&H.push(ht),M.push(at))}return M}function C0(c,p){return p=ci(p,c),c=gE(c,p),c==null||delete c[Hr(er(p))]}function UT(c,p,y,$){return Qc(c,p,y(pa(c,p)),$)}function Np(c,p,y,$){for(var S=c.length,D=$?S:-1;($?D--:++D<S)&&p(c[D],D,c););return y?tr(c,$?0:D,$?D+1:S):tr(c,$?D+1:0,$?S:D)}function GT(c,p){var y=c;return y instanceof ee&&(y=y.value()),Zy(p,function($,S){return S.func.apply(S.thisArg,oi([$],S.args))},y)}function I0(c,p,y){var $=c.length;if($<2)return $?ui(c[0]):[];for(var S=-1,D=et($);++S<$;)for(var O=c[S],M=-1;++M<$;)M!=S&&(D[S]=Yc(D[S]||O,c[M],p,y));return ui(Rn(D,1),p,y)}function HT(c,p,y){for(var $=-1,S=c.length,D=p.length,O={};++$<S;){var M=$<D?p[$]:e;y(O,c[$],M)}return O}function $0(c){return tn(c)?c:[]}function k0(c){return typeof c=="function"?c:xs}function ci(c,p){return Kt(c)?c:F0(c,p)?[c]:wE(be(c))}var Xet=Qt;function hi(c,p,y){var $=c.length;return y=y===e?$:y,!p&&y>=$?c:tr(c,p,y)}var KT=Ftt||function(c){return _n.clearTimeout(c)};function qT(c,p){if(p)return c.slice();var y=c.length,$=pT?pT(y):new c.constructor(y);return c.copy($),$}function S0(c){var p=new c.constructor(c.byteLength);return new fp(p).set(new fp(c)),p}function Yet(c,p){var y=p?S0(c.buffer):c.buffer;return new c.constructor(y,c.byteOffset,c.byteLength)}function Zet(c){var p=new c.constructor(c.source,_N.exec(c));return p.lastIndex=c.lastIndex,p}function Jet(c){return jc?Ee(jc.call(c)):{}}function jT(c,p){var y=p?S0(c.buffer):c.buffer;return new c.constructor(y,c.byteOffset,c.length)}function XT(c,p){if(c!==p){var y=c!==e,$=c===null,S=c===c,D=Rs(c),O=p!==e,M=p===null,H=p===p,it=Rs(p);if(!M&&!it&&!D&&c>p||D&&O&&H&&!M&&!it||$&&O&&H||!y&&H||!S)return 1;if(!$&&!D&&!it&&c<p||it&&y&&S&&!$&&!D||M&&y&&S||!O&&S||!H)return-1}return 0}function Qet(c,p,y){for(var $=-1,S=c.criteria,D=p.criteria,O=S.length,M=y.length;++$<O;){var H=XT(S[$],D[$]);if(H){if($>=M)return H;var it=y[$];return H*(it=="desc"?-1:1)}}return c.index-p.index}function YT(c,p,y,$){for(var S=-1,D=c.length,O=y.length,M=-1,H=p.length,it=bn(D-O,0),at=et(H+it),ht=!$;++M<H;)at[M]=p[M];for(;++S<O;)(ht||S<D)&&(at[y[S]]=c[S]);for(;it--;)at[M++]=c[S++];return at}function ZT(c,p,y,$){for(var S=-1,D=c.length,O=-1,M=y.length,H=-1,it=p.length,at=bn(D-M,0),ht=et(at+it),wt=!$;++S<at;)ht[S]=c[S];for(var Tt=S;++H<it;)ht[Tt+H]=p[H];for(;++O<M;)(wt||S<D)&&(ht[Tt+y[O]]=c[S++]);return ht}function ps(c,p){var y=-1,$=c.length;for(p||(p=et($));++y<$;)p[y]=c[y];return p}function Gr(c,p,y,$){var S=!y;y||(y={});for(var D=-1,O=p.length;++D<O;){var M=p[D],H=$?$(y[M],c[M],M,y,c):e;H===e&&(H=c[M]),S?go(y,M,H):Xc(y,M,H)}return y}function tnt(c,p){return Gr(c,D0(c),p)}function ent(c,p){return Gr(c,cE(c),p)}function Tp(c,p){return function(y,$){var S=Kt(y)?rtt:Cet,D=p?p():{};return S(y,c,Lt($,2),D)}}function kl(c){return Qt(function(p,y){var $=-1,S=y.length,D=S>1?y[S-1]:e,O=S>2?y[2]:e;for(D=c.length>3&&typeof D=="function"?(S--,D):e,O&&rs(y[0],y[1],O)&&(D=S<3?e:D,S=1),p=Ee(p);++$<S;){var M=y[$];M&&c(p,M,$,D)}return p})}function JT(c,p){return function(y,$){if(y==null)return y;if(!ms(y))return c(y,$);for(var S=y.length,D=p?S:-1,O=Ee(y);(p?D--:++D<S)&&$(O[D],D,O)!==!1;);return y}}function QT(c){return function(p,y,$){for(var S=-1,D=Ee(p),O=$(p),M=O.length;M--;){var H=O[c?M:++S];if(y(D[H],H,D)===!1)break}return p}}function nnt(c,p,y){var $=p&b,S=th(c);function D(){var O=this&&this!==_n&&this instanceof D?S:c;return O.apply($?y:this,arguments)}return D}function tE(c){return function(p){p=be(p);var y=bl(p)?br(p):e,$=y?y[0]:p.charAt(0),S=y?hi(y,1).join(""):p.slice(1);return $[c]()+S}}function Sl(c){return function(p){return Zy(JE(ZE(p).replace(GQ,"")),c,"")}}function th(c){return function(){var p=arguments;switch(p.length){case 0:return new c;case 1:return new c(p[0]);case 2:return new c(p[0],p[1]);case 3:return new c(p[0],p[1],p[2]);case 4:return new c(p[0],p[1],p[2],p[3]);case 5:return new c(p[0],p[1],p[2],p[3],p[4]);case 6:return new c(p[0],p[1],p[2],p[3],p[4],p[5]);case 7:return new c(p[0],p[1],p[2],p[3],p[4],p[5],p[6])}var y=$l(c.prototype),$=c.apply(y,p);return Ge($)?$:y}}function snt(c,p,y){var $=th(c);function S(){for(var D=arguments.length,O=et(D),M=D,H=Nl(S);M--;)O[M]=arguments[M];var it=D<3&&O[0]!==H&&O[D-1]!==H?[]:ii(O,H);if(D-=it.length,D<y)return oE(c,p,Ep,S.placeholder,e,O,it,e,e,y-D);var at=this&&this!==_n&&this instanceof S?$:c;return Ts(at,this,O)}return S}function eE(c){return function(p,y,$){var S=Ee(p);if(!ms(p)){var D=Lt(y,3);p=$n(p),y=function(M){return D(S[M],M,S)}}var O=c(p,y,$);return O>-1?S[D?p[O]:O]:e}}function nE(c){return bo(function(p){var y=p.length,$=y,S=Js.prototype.thru;for(c&&p.reverse();$--;){var D=p[$];if(typeof D!="function")throw new Zs(i);if(S&&!O&&Dp(D)=="wrapper")var O=new Js([],!0)}for($=O?$:y;++$<y;){D=p[$];var M=Dp(D),H=M=="wrapper"?R0(D):e;H&&O0(H[0])&&H[1]==(T|I|k|R)&&!H[4].length&&H[9]==1?O=O[Dp(H[0])].apply(O,H[3]):O=D.length==1&&O0(D)?O[M]():O.thru(D)}return function(){var it=arguments,at=it[0];if(O&&it.length==1&&Kt(at))return O.plant(at).value();for(var ht=0,wt=y?p[ht].apply(this,it):at;++ht<y;)wt=p[ht].call(this,wt);return wt}})}function Ep(c,p,y,$,S,D,O,M,H,it){var at=p&T,ht=p&b,wt=p&w,Tt=p&(I|C),Mt=p&E,Jt=wt?e:th(c);function Bt(){for(var te=arguments.length,ae=et(te),As=te;As--;)ae[As]=arguments[As];if(Tt)var os=Nl(Bt),Ds=ftt(ae,os);if($&&(ae=YT(ae,$,S,Tt)),D&&(ae=ZT(ae,D,O,Tt)),te-=Ds,Tt&&te<it){var en=ii(ae,os);return oE(c,p,Ep,Bt.placeholder,y,ae,en,M,H,it-te)}var vr=ht?y:this,Co=wt?vr[c]:c;return te=ae.length,M?ae=Int(ae,M):Mt&&te>1&&ae.reverse(),at&&H<te&&(ae.length=H),this&&this!==_n&&this instanceof Bt&&(Co=Jt||th(Co)),Co.apply(vr,ae)}return Bt}function sE(c,p){return function(y,$){return Ret(y,c,p($),{})}}function _p(c,p){return function(y,$){var S;if(y===e&&$===e)return p;if(y!==e&&(S=y),$!==e){if(S===e)return $;typeof y=="string"||typeof $=="string"?(y=_s(y),$=_s($)):(y=VT(y),$=VT($)),S=c(y,$)}return S}}function N0(c){return bo(function(p){return p=Ue(p,Es(Lt())),Qt(function(y){var $=this;return c(p,function(S){return Ts(S,$,y)})})})}function Rp(c,p){p=p===e?" ":_s(p);var y=p.length;if(y<2)return y?w0(p,c):p;var $=w0(p,xp(c/yl(p)));return bl(p)?hi(br($),0,c).join(""):$.slice(0,c)}function rnt(c,p,y,$){var S=p&b,D=th(c);function O(){for(var M=-1,H=arguments.length,it=-1,at=$.length,ht=et(at+H),wt=this&&this!==_n&&this instanceof O?D:c;++it<at;)ht[it]=$[it];for(;H--;)ht[it++]=arguments[++M];return Ts(wt,S?y:this,ht)}return O}function rE(c){return function(p,y,$){return $&&typeof $!="number"&&rs(p,y,$)&&(y=$=e),p=vo(p),y===e?(y=p,p=0):y=vo(y),$=$===e?p<y?1:-1:vo($),Uet(p,y,$,c)}}function Ap(c){return function(p,y){return typeof p=="string"&&typeof y=="string"||(p=nr(p),y=nr(y)),c(p,y)}}function oE(c,p,y,$,S,D,O,M,H,it){var at=p&I,ht=at?O:e,wt=at?e:O,Tt=at?D:e,Mt=at?e:D;p|=at?k:N,p&=~(at?N:k),p&v||(p&=~(b|w));var Jt=[c,p,S,Tt,ht,Mt,wt,M,H,it],Bt=y.apply(e,Jt);return O0(c)&&xE(Bt,Jt),Bt.placeholder=$,bE(Bt,c,p)}function T0(c){var p=xn[c];return function(y,$){if(y=nr(y),$=$==null?0:Vn(jt($),292),$&&bT(y)){var S=(be(y)+"e").split("e"),D=p(S[0]+"e"+(+S[1]+$));return S=(be(D)+"e").split("e"),+(S[0]+"e"+(+S[1]-$))}return p(y)}}var ont=Cl&&1/ap(new Cl([,-0]))[1]==tt?function(c){return new Cl(c)}:Y0;function iE(c){return function(p){var y=Un(p);return y==ie?r0(p):y==cn?wtt(p):dtt(p,c(p))}}function xo(c,p,y,$,S,D,O,M){var H=p&w;if(!H&&typeof c!="function")throw new Zs(i);var it=$?$.length:0;if(it||(p&=~(k|N),$=S=e),O=O===e?O:bn(jt(O),0),M=M===e?M:jt(M),it-=S?S.length:0,p&N){var at=$,ht=S;$=S=e}var wt=H?e:R0(c),Tt=[c,p,y,$,S,at,ht,D,O,M];if(wt&&wnt(Tt,wt),c=Tt[0],p=Tt[1],y=Tt[2],$=Tt[3],S=Tt[4],M=Tt[9]=Tt[9]===e?H?0:c.length:bn(Tt[9]-it,0),!M&&p&(I|C)&&(p&=~(I|C)),!p||p==b)var Mt=nnt(c,p,y);else p==I||p==C?Mt=snt(c,p,M):(p==k||p==(b|k))&&!S.length?Mt=rnt(c,p,y,$):Mt=Ep.apply(e,Tt);var Jt=wt?zT:xE;return bE(Jt(Mt,Tt),c,p)}function aE(c,p,y,$){return c===e||wr(c,vl[y])&&!we.call($,y)?p:c}function lE(c,p,y,$,S,D){return Ge(c)&&Ge(p)&&(D.set(p,c),kp(c,p,e,lE,D),D.delete(p)),c}function int(c){return sh(c)?e:c}function uE(c,p,y,$,S,D){var O=y&g,M=c.length,H=p.length;if(M!=H&&!(O&&H>M))return!1;var it=D.get(c),at=D.get(p);if(it&&at)return it==p&&at==c;var ht=-1,wt=!0,Tt=y&x?new da:e;for(D.set(c,p),D.set(p,c);++ht<M;){var Mt=c[ht],Jt=p[ht];if($)var Bt=O?$(Jt,Mt,ht,p,c,D):$(Mt,Jt,ht,c,p,D);if(Bt!==e){if(Bt)continue;wt=!1;break}if(Tt){if(!Jy(p,function(te,ae){if(!Uc(Tt,ae)&&(Mt===te||S(Mt,te,y,$,D)))return Tt.push(ae)})){wt=!1;break}}else if(!(Mt===Jt||S(Mt,Jt,y,$,D))){wt=!1;break}}return D.delete(c),D.delete(p),wt}function ant(c,p,y,$,S,D,O){switch(y){case ns:if(c.byteLength!=p.byteLength||c.byteOffset!=p.byteOffset)return!1;c=c.buffer,p=p.buffer;case fs:return!(c.byteLength!=p.byteLength||!D(new fp(c),new fp(p)));case Rt:case Et:case ce:return wr(+c,+p);case Wt:return c.name==p.name&&c.message==p.message;case Ve:case gn:return c==p+"";case ie:var M=r0;case cn:var H=$&g;if(M||(M=ap),c.size!=p.size&&!H)return!1;var it=O.get(c);if(it)return it==p;$|=x,O.set(c,p);var at=uE(M(c),M(p),$,S,D,O);return O.delete(c),at;case js:if(jc)return jc.call(c)==jc.call(p)}return!1}function lnt(c,p,y,$,S,D){var O=y&g,M=E0(c),H=M.length,it=E0(p),at=it.length;if(H!=at&&!O)return!1;for(var ht=H;ht--;){var wt=M[ht];if(!(O?wt in p:we.call(p,wt)))return!1}var Tt=D.get(c),Mt=D.get(p);if(Tt&&Mt)return Tt==p&&Mt==c;var Jt=!0;D.set(c,p),D.set(p,c);for(var Bt=O;++ht<H;){wt=M[ht];var te=c[wt],ae=p[wt];if($)var As=O?$(ae,te,wt,p,c,D):$(te,ae,wt,c,p,D);if(!(As===e?te===ae||S(te,ae,y,$,D):As)){Jt=!1;break}Bt||(Bt=wt=="constructor")}if(Jt&&!Bt){var os=c.constructor,Ds=p.constructor;os!=Ds&&"constructor"in c&&"constructor"in p&&!(typeof os=="function"&&os instanceof os&&typeof Ds=="function"&&Ds instanceof Ds)&&(Jt=!1)}return D.delete(c),D.delete(p),Jt}function bo(c){return P0(mE(c,e,$E),c+"")}function E0(c){return ET(c,$n,D0)}function _0(c){return ET(c,gs,cE)}var R0=yp?function(c){return yp.get(c)}:Y0;function Dp(c){for(var p=c.name+"",y=Il[p],$=we.call(Il,p)?y.length:0;$--;){var S=y[$],D=S.func;if(D==null||D==c)return S.name}return p}function Nl(c){var p=we.call(_,"placeholder")?_:c;return p.placeholder}function Lt(){var c=_.iteratee||j0;return c=c===j0?AT:c,arguments.length?c(arguments[0],arguments[1]):c}function Fp(c,p){var y=c.__data__;return gnt(p)?y[typeof p=="string"?"string":"hash"]:y.map}function A0(c){for(var p=$n(c),y=p.length;y--;){var $=p[y],S=c[$];p[y]=[$,S,fE(S)]}return p}function ma(c,p){var y=xtt(c,p);return RT(y)?y:e}function unt(c){var p=we.call(c,ca),y=c[ca];try{c[ca]=e;var $=!0}catch{}var S=hp.call(c);return $&&(p?c[ca]=y:delete c[ca]),S}var D0=i0?function(c){return c==null?[]:(c=Ee(c),ri(i0(c),function(p){return gT.call(c,p)}))}:Z0,cE=i0?function(c){for(var p=[];c;)oi(p,D0(c)),c=pp(c);return p}:Z0,Un=ss;(a0&&Un(new a0(new ArrayBuffer(1)))!=ns||Hc&&Un(new Hc)!=ie||l0&&Un(l0.resolve())!=Ie||Cl&&Un(new Cl)!=cn||Kc&&Un(new Kc)!=es)&&(Un=function(c){var p=ss(c),y=p==ue?c.constructor:e,$=y?ga(y):"";if($)switch($){case Utt:return ns;case Gtt:return ie;case Htt:return Ie;case Ktt:return cn;case qtt:return es}return p});function cnt(c,p,y){for(var $=-1,S=y.length;++$<S;){var D=y[$],O=D.size;switch(D.type){case"drop":c+=O;break;case"dropRight":p-=O;break;case"take":p=Vn(p,c+O);break;case"takeRight":c=bn(c,p-O);break}}return{start:c,end:p}}function hnt(c){var p=c.match(mQ);return p?p[1].split(gQ):[]}function hE(c,p,y){p=ci(p,c);for(var $=-1,S=p.length,D=!1;++$<S;){var O=Hr(p[$]);if(!(D=c!=null&&y(c,O)))break;c=c[O]}return D||++$!=S?D:(S=c==null?0:c.length,!!S&&Wp(S)&&yo(O,S)&&(Kt(c)||xa(c)))}function dnt(c){var p=c.length,y=new c.constructor(p);return p&&typeof c[0]=="string"&&we.call(c,"index")&&(y.index=c.index,y.input=c.input),y}function dE(c){return typeof c.constructor=="function"&&!eh(c)?$l(pp(c)):{}}function fnt(c,p,y){var $=c.constructor;switch(p){case fs:return S0(c);case Rt:case Et:return new $(+c);case ns:return Yet(c,y);case fo:case aa:case la:case zc:case si:case Wc:case Vc:case By:case zy:return jT(c,y);case ie:return new $;case ce:case gn:return new $(c);case Ve:return Zet(c);case cn:return new $;case js:return Jet(c)}}function pnt(c,p){var y=p.length;if(!y)return c;var $=y-1;return p[$]=(y>1?"& ":"")+p[$],p=p.join(y>2?", ":" "),c.replace(pQ,`{
/* [wrapped with `+p+`] */
`)}function mnt(c){return Kt(c)||xa(c)||!!(xT&&c&&c[xT])}function yo(c,p){var y=typeof c;return p=p??Z,!!p&&(y=="number"||y!="symbol"&&kQ.test(c))&&c>-1&&c%1==0&&c<p}function rs(c,p,y){if(!Ge(y))return!1;var $=typeof p;return($=="number"?ms(y)&&yo(p,y.length):$=="string"&&p in y)?wr(y[p],c):!1}function F0(c,p){if(Kt(c))return!1;var y=typeof c;return y=="number"||y=="symbol"||y=="boolean"||c==null||Rs(c)?!0:cQ.test(c)||!uQ.test(c)||p!=null&&c in Ee(p)}function gnt(c){var p=typeof c;return p=="string"||p=="number"||p=="symbol"||p=="boolean"?c!=="__proto__":c===null}function O0(c){var p=Dp(c),y=_[p];if(typeof y!="function"||!(p in ee.prototype))return!1;if(c===y)return!0;var $=R0(y);return!!$&&c===$[0]}function xnt(c){return!!fT&&fT in c}var bnt=up?wo:J0;function eh(c){var p=c&&c.constructor,y=typeof p=="function"&&p.prototype||vl;return c===y}function fE(c){return c===c&&!Ge(c)}function pE(c,p){return function(y){return y==null?!1:y[c]===p&&(p!==e||c in Ee(y))}}function ynt(c){var p=Bp(c,function($){return y.size===u&&y.clear(),$}),y=p.cache;return p}function wnt(c,p){var y=c[1],$=p[1],S=y|$,D=S<(b|w|T),O=$==T&&y==I||$==T&&y==R&&c[7].length<=p[8]||$==(T|R)&&p[7].length<=p[8]&&y==I;if(!(D||O))return c;$&b&&(c[2]=p[2],S|=y&b?0:v);var M=p[3];if(M){var H=c[3];c[3]=H?YT(H,M,p[4]):M,c[4]=H?ii(c[3],h):p[4]}return M=p[5],M&&(H=c[5],c[5]=H?ZT(H,M,p[6]):M,c[6]=H?ii(c[5],h):p[6]),M=p[7],M&&(c[7]=M),$&T&&(c[8]=c[8]==null?p[8]:Vn(c[8],p[8])),c[9]==null&&(c[9]=p[9]),c[0]=p[0],c[1]=S,c}function vnt(c){var p=[];if(c!=null)for(var y in Ee(c))p.push(y);return p}function Cnt(c){return hp.call(c)}function mE(c,p,y){return p=bn(p===e?c.length-1:p,0),function(){for(var $=arguments,S=-1,D=bn($.length-p,0),O=et(D);++S<D;)O[S]=$[p+S];S=-1;for(var M=et(p+1);++S<p;)M[S]=$[S];return M[p]=y(O),Ts(c,this,M)}}function gE(c,p){return p.length<2?c:pa(c,tr(p,0,-1))}function Int(c,p){for(var y=c.length,$=Vn(p.length,y),S=ps(c);$--;){var D=p[$];c[$]=yo(D,y)?S[D]:e}return c}function L0(c,p){if(!(p==="constructor"&&typeof c[p]=="function")&&p!="__proto__")return c[p]}var xE=yE(zT),nh=Ltt||function(c,p){return _n.setTimeout(c,p)},P0=yE(Ket);function bE(c,p,y){var $=p+"";return P0(c,pnt($,$nt(hnt($),y)))}function yE(c){var p=0,y=0;return function(){var $=ztt(),S=j-($-y);if(y=$,S>0){if(++p>=q)return arguments[0]}else p=0;return c.apply(e,arguments)}}function Op(c,p){var y=-1,$=c.length,S=$-1;for(p=p===e?$:p;++y<p;){var D=y0(y,S),O=c[D];c[D]=c[y],c[y]=O}return c.length=p,c}var wE=ynt(function(c){var p=[];return c.charCodeAt(0)===46&&p.push(""),c.replace(hQ,function(y,$,S,D){p.push(S?D.replace(yQ,"$1"):$||y)}),p});function Hr(c){if(typeof c=="string"||Rs(c))return c;var p=c+"";return p=="0"&&1/c==-tt?"-0":p}function ga(c){if(c!=null){try{return cp.call(c)}catch{}try{return c+""}catch{}}return""}function $nt(c,p){return Ys(bt,function(y){var $="_."+y[0];p&y[1]&&!op(c,$)&&c.push($)}),c.sort()}function vE(c){if(c instanceof ee)return c.clone();var p=new Js(c.__wrapped__,c.__chain__);return p.__actions__=ps(c.__actions__),p.__index__=c.__index__,p.__values__=c.__values__,p}function knt(c,p,y){(y?rs(c,p,y):p===e)?p=1:p=bn(jt(p),0);var $=c==null?0:c.length;if(!$||p<1)return[];for(var S=0,D=0,O=et(xp($/p));S<$;)O[D++]=tr(c,S,S+=p);return O}function Snt(c){for(var p=-1,y=c==null?0:c.length,$=0,S=[];++p<y;){var D=c[p];D&&(S[$++]=D)}return S}function Nnt(){var c=arguments.length;if(!c)return[];for(var p=et(c-1),y=arguments[0],$=c;$--;)p[$-1]=arguments[$];return oi(Kt(y)?ps(y):[y],Rn(p,1))}var Tnt=Qt(function(c,p){return tn(c)?Yc(c,Rn(p,1,tn,!0)):[]}),Ent=Qt(function(c,p){var y=er(p);return tn(y)&&(y=e),tn(c)?Yc(c,Rn(p,1,tn,!0),Lt(y,2)):[]}),_nt=Qt(function(c,p){var y=er(p);return tn(y)&&(y=e),tn(c)?Yc(c,Rn(p,1,tn,!0),e,y):[]});function Rnt(c,p,y){var $=c==null?0:c.length;return $?(p=y||p===e?1:jt(p),tr(c,p<0?0:p,$)):[]}function Ant(c,p,y){var $=c==null?0:c.length;return $?(p=y||p===e?1:jt(p),p=$-p,tr(c,0,p<0?0:p)):[]}function Dnt(c,p){return c&&c.length?Np(c,Lt(p,3),!0,!0):[]}function Fnt(c,p){return c&&c.length?Np(c,Lt(p,3),!0):[]}function Ont(c,p,y,$){var S=c==null?0:c.length;return S?(y&&typeof y!="number"&&rs(c,p,y)&&(y=0,$=S),Net(c,p,y,$)):[]}function CE(c,p,y){var $=c==null?0:c.length;if(!$)return-1;var S=y==null?0:jt(y);return S<0&&(S=bn($+S,0)),ip(c,Lt(p,3),S)}function IE(c,p,y){var $=c==null?0:c.length;if(!$)return-1;var S=$-1;return y!==e&&(S=jt(y),S=y<0?bn($+S,0):Vn(S,$-1)),ip(c,Lt(p,3),S,!0)}function $E(c){var p=c==null?0:c.length;return p?Rn(c,1):[]}function Lnt(c){var p=c==null?0:c.length;return p?Rn(c,tt):[]}function Pnt(c,p){var y=c==null?0:c.length;return y?(p=p===e?1:jt(p),Rn(c,p)):[]}function Mnt(c){for(var p=-1,y=c==null?0:c.length,$={};++p<y;){var S=c[p];$[S[0]]=S[1]}return $}function kE(c){return c&&c.length?c[0]:e}function Bnt(c,p,y){var $=c==null?0:c.length;if(!$)return-1;var S=y==null?0:jt(y);return S<0&&(S=bn($+S,0)),xl(c,p,S)}function znt(c){var p=c==null?0:c.length;return p?tr(c,0,-1):[]}var Wnt=Qt(function(c){var p=Ue(c,$0);return p.length&&p[0]===c[0]?p0(p):[]}),Vnt=Qt(function(c){var p=er(c),y=Ue(c,$0);return p===er(y)?p=e:y.pop(),y.length&&y[0]===c[0]?p0(y,Lt(p,2)):[]}),Unt=Qt(function(c){var p=er(c),y=Ue(c,$0);return p=typeof p=="function"?p:e,p&&y.pop(),y.length&&y[0]===c[0]?p0(y,e,p):[]});function Gnt(c,p){return c==null?"":Mtt.call(c,p)}function er(c){var p=c==null?0:c.length;return p?c[p-1]:e}function Hnt(c,p,y){var $=c==null?0:c.length;if(!$)return-1;var S=$;return y!==e&&(S=jt(y),S=S<0?bn($+S,0):Vn(S,$-1)),p===p?Ctt(c,p,S):ip(c,oT,S,!0)}function Knt(c,p){return c&&c.length?LT(c,jt(p)):e}var qnt=Qt(SE);function SE(c,p){return c&&c.length&&p&&p.length?b0(c,p):c}function jnt(c,p,y){return c&&c.length&&p&&p.length?b0(c,p,Lt(y,2)):c}function Xnt(c,p,y){return c&&c.length&&p&&p.length?b0(c,p,e,y):c}var Ynt=bo(function(c,p){var y=c==null?0:c.length,$=c0(c,p);return BT(c,Ue(p,function(S){return yo(S,y)?+S:S}).sort(XT)),$});function Znt(c,p){var y=[];if(!(c&&c.length))return y;var $=-1,S=[],D=c.length;for(p=Lt(p,3);++$<D;){var O=c[$];p(O,$,c)&&(y.push(O),S.push($))}return BT(c,S),y}function M0(c){return c==null?c:Vtt.call(c)}function Jnt(c,p,y){var $=c==null?0:c.length;return $?(y&&typeof y!="number"&&rs(c,p,y)?(p=0,y=$):(p=p==null?0:jt(p),y=y===e?$:jt(y)),tr(c,p,y)):[]}function Qnt(c,p){return Sp(c,p)}function tst(c,p,y){return v0(c,p,Lt(y,2))}function est(c,p){var y=c==null?0:c.length;if(y){var $=Sp(c,p);if($<y&&wr(c[$],p))return $}return-1}function nst(c,p){return Sp(c,p,!0)}function sst(c,p,y){return v0(c,p,Lt(y,2),!0)}function rst(c,p){var y=c==null?0:c.length;if(y){var $=Sp(c,p,!0)-1;if(wr(c[$],p))return $}return-1}function ost(c){return c&&c.length?WT(c):[]}function ist(c,p){return c&&c.length?WT(c,Lt(p,2)):[]}function ast(c){var p=c==null?0:c.length;return p?tr(c,1,p):[]}function lst(c,p,y){return c&&c.length?(p=y||p===e?1:jt(p),tr(c,0,p<0?0:p)):[]}function ust(c,p,y){var $=c==null?0:c.length;return $?(p=y||p===e?1:jt(p),p=$-p,tr(c,p<0?0:p,$)):[]}function cst(c,p){return c&&c.length?Np(c,Lt(p,3),!1,!0):[]}function hst(c,p){return c&&c.length?Np(c,Lt(p,3)):[]}var dst=Qt(function(c){return ui(Rn(c,1,tn,!0))}),fst=Qt(function(c){var p=er(c);return tn(p)&&(p=e),ui(Rn(c,1,tn,!0),Lt(p,2))}),pst=Qt(function(c){var p=er(c);return p=typeof p=="function"?p:e,ui(Rn(c,1,tn,!0),e,p)});function mst(c){return c&&c.length?ui(c):[]}function gst(c,p){return c&&c.length?ui(c,Lt(p,2)):[]}function xst(c,p){return p=typeof p=="function"?p:e,c&&c.length?ui(c,e,p):[]}function B0(c){if(!(c&&c.length))return[];var p=0;return c=ri(c,function(y){if(tn(y))return p=bn(y.length,p),!0}),n0(p,function(y){return Ue(c,Qy(y))})}function NE(c,p){if(!(c&&c.length))return[];var y=B0(c);return p==null?y:Ue(y,function($){return Ts(p,e,$)})}var bst=Qt(function(c,p){return tn(c)?Yc(c,p):[]}),yst=Qt(function(c){return I0(ri(c,tn))}),wst=Qt(function(c){var p=er(c);return tn(p)&&(p=e),I0(ri(c,tn),Lt(p,2))}),vst=Qt(function(c){var p=er(c);return p=typeof p=="function"?p:e,I0(ri(c,tn),e,p)}),Cst=Qt(B0);function Ist(c,p){return HT(c||[],p||[],Xc)}function $st(c,p){return HT(c||[],p||[],Qc)}var kst=Qt(function(c){var p=c.length,y=p>1?c[p-1]:e;return y=typeof y=="function"?(c.pop(),y):e,NE(c,y)});function TE(c){var p=_(c);return p.__chain__=!0,p}function Sst(c,p){return p(c),c}function Lp(c,p){return p(c)}var Nst=bo(function(c){var p=c.length,y=p?c[0]:0,$=this.__wrapped__,S=function(D){return c0(D,c)};return p>1||this.__actions__.length||!($ instanceof ee)||!yo(y)?this.thru(S):($=$.slice(y,+y+(p?1:0)),$.__actions__.push({func:Lp,args:[S],thisArg:e}),new Js($,this.__chain__).thru(function(D){return p&&!D.length&&D.push(e),D}))});function Tst(){return TE(this)}function Est(){return new Js(this.value(),this.__chain__)}function _st(){this.__values__===e&&(this.__values__=VE(this.value()));var c=this.__index__>=this.__values__.length,p=c?e:this.__values__[this.__index__++];return{done:c,value:p}}function Rst(){return this}function Ast(c){for(var p,y=this;y instanceof vp;){var $=vE(y);$.__index__=0,$.__values__=e,p?S.__wrapped__=$:p=$;var S=$;y=y.__wrapped__}return S.__wrapped__=c,p}function Dst(){var c=this.__wrapped__;if(c instanceof ee){var p=c;return this.__actions__.length&&(p=new ee(this)),p=p.reverse(),p.__actions__.push({func:Lp,args:[M0],thisArg:e}),new Js(p,this.__chain__)}return this.thru(M0)}function Fst(){return GT(this.__wrapped__,this.__actions__)}var Ost=Tp(function(c,p,y){we.call(c,y)?++c[y]:go(c,y,1)});function Lst(c,p,y){var $=Kt(c)?sT:ket;return y&&rs(c,p,y)&&(p=e),$(c,Lt(p,3))}function Pst(c,p){var y=Kt(c)?ri:NT;return y(c,Lt(p,3))}var Mst=eE(CE),Bst=eE(IE);function zst(c,p){return Rn(Pp(c,p),1)}function Wst(c,p){return Rn(Pp(c,p),tt)}function Vst(c,p,y){return y=y===e?1:jt(y),Rn(Pp(c,p),y)}function EE(c,p){var y=Kt(c)?Ys:li;return y(c,Lt(p,3))}function _E(c,p){var y=Kt(c)?ott:ST;return y(c,Lt(p,3))}var Ust=Tp(function(c,p,y){we.call(c,y)?c[y].push(p):go(c,y,[p])});function Gst(c,p,y,$){c=ms(c)?c:El(c),y=y&&!$?jt(y):0;var S=c.length;return y<0&&(y=bn(S+y,0)),Vp(c)?y<=S&&c.indexOf(p,y)>-1:!!S&&xl(c,p,y)>-1}var Hst=Qt(function(c,p,y){var $=-1,S=typeof p=="function",D=ms(c)?et(c.length):[];return li(c,function(O){D[++$]=S?Ts(p,O,y):Zc(O,p,y)}),D}),Kst=Tp(function(c,p,y){go(c,y,p)});function Pp(c,p){var y=Kt(c)?Ue:DT;return y(c,Lt(p,3))}function qst(c,p,y,$){return c==null?[]:(Kt(p)||(p=p==null?[]:[p]),y=$?e:y,Kt(y)||(y=y==null?[]:[y]),PT(c,p,y))}var jst=Tp(function(c,p,y){c[y?0:1].push(p)},function(){return[[],[]]});function Xst(c,p,y){var $=Kt(c)?Zy:aT,S=arguments.length<3;return $(c,Lt(p,4),y,S,li)}function Yst(c,p,y){var $=Kt(c)?itt:aT,S=arguments.length<3;return $(c,Lt(p,4),y,S,ST)}function Zst(c,p){var y=Kt(c)?ri:NT;return y(c,zp(Lt(p,3)))}function Jst(c){var p=Kt(c)?CT:Get;return p(c)}function Qst(c,p,y){(y?rs(c,p,y):p===e)?p=1:p=jt(p);var $=Kt(c)?wet:Het;return $(c,p)}function trt(c){var p=Kt(c)?vet:qet;return p(c)}function ert(c){if(c==null)return 0;if(ms(c))return Vp(c)?yl(c):c.length;var p=Un(c);return p==ie||p==cn?c.size:g0(c).length}function nrt(c,p,y){var $=Kt(c)?Jy:jet;return y&&rs(c,p,y)&&(p=e),$(c,Lt(p,3))}var srt=Qt(function(c,p){if(c==null)return[];var y=p.length;return y>1&&rs(c,p[0],p[1])?p=[]:y>2&&rs(p[0],p[1],p[2])&&(p=[p[0]]),PT(c,Rn(p,1),[])}),Mp=Ott||function(){return _n.Date.now()};function rrt(c,p){if(typeof p!="function")throw new Zs(i);return c=jt(c),function(){if(--c<1)return p.apply(this,arguments)}}function RE(c,p,y){return p=y?e:p,p=c&&p==null?c.length:p,xo(c,T,e,e,e,e,p)}function AE(c,p){var y;if(typeof p!="function")throw new Zs(i);return c=jt(c),function(){return--c>0&&(y=p.apply(this,arguments)),c<=1&&(p=e),y}}var z0=Qt(function(c,p,y){var $=b;if(y.length){var S=ii(y,Nl(z0));$|=k}return xo(c,$,p,y,S)}),DE=Qt(function(c,p,y){var $=b|w;if(y.length){var S=ii(y,Nl(DE));$|=k}return xo(p,$,c,y,S)});function FE(c,p,y){p=y?e:p;var $=xo(c,I,e,e,e,e,e,p);return $.placeholder=FE.placeholder,$}function OE(c,p,y){p=y?e:p;var $=xo(c,C,e,e,e,e,e,p);return $.placeholder=OE.placeholder,$}function LE(c,p,y){var $,S,D,O,M,H,it=0,at=!1,ht=!1,wt=!0;if(typeof c!="function")throw new Zs(i);p=nr(p)||0,Ge(y)&&(at=!!y.leading,ht="maxWait"in y,D=ht?bn(nr(y.maxWait)||0,p):D,wt="trailing"in y?!!y.trailing:wt);function Tt(en){var vr=$,Co=S;return $=S=e,it=en,O=c.apply(Co,vr),O}function Mt(en){return it=en,M=nh(te,p),at?Tt(en):O}function Jt(en){var vr=en-H,Co=en-it,e_=p-vr;return ht?Vn(e_,D-Co):e_}function Bt(en){var vr=en-H,Co=en-it;return H===e||vr>=p||vr<0||ht&&Co>=D}function te(){var en=Mp();if(Bt(en))return ae(en);M=nh(te,Jt(en))}function ae(en){return M=e,wt&&$?Tt(en):($=S=e,O)}function As(){M!==e&&KT(M),it=0,$=H=S=M=e}function os(){return M===e?O:ae(Mp())}function Ds(){var en=Mp(),vr=Bt(en);if($=arguments,S=this,H=en,vr){if(M===e)return Mt(H);if(ht)return KT(M),M=nh(te,p),Tt(H)}return M===e&&(M=nh(te,p)),O}return Ds.cancel=As,Ds.flush=os,Ds}var ort=Qt(function(c,p){return kT(c,1,p)}),irt=Qt(function(c,p,y){return kT(c,nr(p)||0,y)});function art(c){return xo(c,E)}function Bp(c,p){if(typeof c!="function"||p!=null&&typeof p!="function")throw new Zs(i);var y=function(){var $=arguments,S=p?p.apply(this,$):$[0],D=y.cache;if(D.has(S))return D.get(S);var O=c.apply(this,$);return y.cache=D.set(S,O)||D,O};return y.cache=new(Bp.Cache||mo),y}Bp.Cache=mo;function zp(c){if(typeof c!="function")throw new Zs(i);return function(){var p=arguments;switch(p.length){case 0:return!c.call(this);case 1:return!c.call(this,p[0]);case 2:return!c.call(this,p[0],p[1]);case 3:return!c.call(this,p[0],p[1],p[2])}return!c.apply(this,p)}}function lrt(c){return AE(2,c)}var urt=Xet(function(c,p){p=p.length==1&&Kt(p[0])?Ue(p[0],Es(Lt())):Ue(Rn(p,1),Es(Lt()));var y=p.length;return Qt(function($){for(var S=-1,D=Vn($.length,y);++S<D;)$[S]=p[S].call(this,$[S]);return Ts(c,this,$)})}),W0=Qt(function(c,p){var y=ii(p,Nl(W0));return xo(c,k,e,p,y)}),PE=Qt(function(c,p){var y=ii(p,Nl(PE));return xo(c,N,e,p,y)}),crt=bo(function(c,p){return xo(c,R,e,e,e,p)});function hrt(c,p){if(typeof c!="function")throw new Zs(i);return p=p===e?p:jt(p),Qt(c,p)}function drt(c,p){if(typeof c!="function")throw new Zs(i);return p=p==null?0:bn(jt(p),0),Qt(function(y){var $=y[p],S=hi(y,0,p);return $&&oi(S,$),Ts(c,this,S)})}function frt(c,p,y){var $=!0,S=!0;if(typeof c!="function")throw new Zs(i);return Ge(y)&&($="leading"in y?!!y.leading:$,S="trailing"in y?!!y.trailing:S),LE(c,p,{leading:$,maxWait:p,trailing:S})}function prt(c){return RE(c,1)}function mrt(c,p){return W0(k0(p),c)}function grt(){if(!arguments.length)return[];var c=arguments[0];return Kt(c)?c:[c]}function xrt(c){return Qs(c,m)}function brt(c,p){return p=typeof p=="function"?p:e,Qs(c,m,p)}function yrt(c){return Qs(c,d|m)}function wrt(c,p){return p=typeof p=="function"?p:e,Qs(c,d|m,p)}function vrt(c,p){return p==null||$T(c,p,$n(p))}function wr(c,p){return c===p||c!==c&&p!==p}var Crt=Ap(f0),Irt=Ap(function(c,p){return c>=p}),xa=_T(function(){return arguments}())?_T:function(c){return Ze(c)&&we.call(c,"callee")&&!gT.call(c,"callee")},Kt=et.isArray,$rt=ZN?Es(ZN):Aet;function ms(c){return c!=null&&Wp(c.length)&&!wo(c)}function tn(c){return Ze(c)&&ms(c)}function krt(c){return c===!0||c===!1||Ze(c)&&ss(c)==Rt}var di=Ptt||J0,Srt=JN?Es(JN):Det;function Nrt(c){return Ze(c)&&c.nodeType===1&&!sh(c)}function Trt(c){if(c==null)return!0;if(ms(c)&&(Kt(c)||typeof c=="string"||typeof c.splice=="function"||di(c)||Tl(c)||xa(c)))return!c.length;var p=Un(c);if(p==ie||p==cn)return!c.size;if(eh(c))return!g0(c).length;for(var y in c)if(we.call(c,y))return!1;return!0}function Ert(c,p){return Jc(c,p)}function _rt(c,p,y){y=typeof y=="function"?y:e;var $=y?y(c,p):e;return $===e?Jc(c,p,e,y):!!$}function V0(c){if(!Ze(c))return!1;var p=ss(c);return p==Wt||p==Ut||typeof c.message=="string"&&typeof c.name=="string"&&!sh(c)}function Rrt(c){return typeof c=="number"&&bT(c)}function wo(c){if(!Ge(c))return!1;var p=ss(c);return p==oe||p==xe||p==Nt||p==xr}function ME(c){return typeof c=="number"&&c==jt(c)}function Wp(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=Z}function Ge(c){var p=typeof c;return c!=null&&(p=="object"||p=="function")}function Ze(c){return c!=null&&typeof c=="object"}var BE=QN?Es(QN):Oet;function Art(c,p){return c===p||m0(c,p,A0(p))}function Drt(c,p,y){return y=typeof y=="function"?y:e,m0(c,p,A0(p),y)}function Frt(c){return zE(c)&&c!=+c}function Ort(c){if(bnt(c))throw new Gt(o);return RT(c)}function Lrt(c){return c===null}function Prt(c){return c==null}function zE(c){return typeof c=="number"||Ze(c)&&ss(c)==ce}function sh(c){if(!Ze(c)||ss(c)!=ue)return!1;var p=pp(c);if(p===null)return!0;var y=we.call(p,"constructor")&&p.constructor;return typeof y=="function"&&y instanceof y&&cp.call(y)==Rtt}var U0=tT?Es(tT):Let;function Mrt(c){return ME(c)&&c>=-Z&&c<=Z}var WE=eT?Es(eT):Pet;function Vp(c){return typeof c=="string"||!Kt(c)&&Ze(c)&&ss(c)==gn}function Rs(c){return typeof c=="symbol"||Ze(c)&&ss(c)==js}var Tl=nT?Es(nT):Met;function Brt(c){return c===e}function zrt(c){return Ze(c)&&Un(c)==es}function Wrt(c){return Ze(c)&&ss(c)==Vr}var Vrt=Ap(x0),Urt=Ap(function(c,p){return c<=p});function VE(c){if(!c)return[];if(ms(c))return Vp(c)?br(c):ps(c);if(Gc&&c[Gc])return ytt(c[Gc]());var p=Un(c),y=p==ie?r0:p==cn?ap:El;return y(c)}function vo(c){if(!c)return c===0?c:0;if(c=nr(c),c===tt||c===-tt){var p=c<0?-1:1;return p*rt}return c===c?c:0}function jt(c){var p=vo(c),y=p%1;return p===p?y?p-y:p:0}function UE(c){return c?fa(jt(c),0,lt):0}function nr(c){if(typeof c=="number")return c;if(Rs(c))return ut;if(Ge(c)){var p=typeof c.valueOf=="function"?c.valueOf():c;c=Ge(p)?p+"":p}if(typeof c!="string")return c===0?c:+c;c=lT(c);var y=CQ.test(c);return y||$Q.test(c)?ntt(c.slice(2),y?2:8):vQ.test(c)?ut:+c}function GE(c){return Gr(c,gs(c))}function Grt(c){return c?fa(jt(c),-Z,Z):c===0?c:0}function be(c){return c==null?"":_s(c)}var Hrt=kl(function(c,p){if(eh(p)||ms(p)){Gr(p,$n(p),c);return}for(var y in p)we.call(p,y)&&Xc(c,y,p[y])}),HE=kl(function(c,p){Gr(p,gs(p),c)}),Up=kl(function(c,p,y,$){Gr(p,gs(p),c,$)}),Krt=kl(function(c,p,y,$){Gr(p,$n(p),c,$)}),qrt=bo(c0);function jrt(c,p){var y=$l(c);return p==null?y:IT(y,p)}var Xrt=Qt(function(c,p){c=Ee(c);var y=-1,$=p.length,S=$>2?p[2]:e;for(S&&rs(p[0],p[1],S)&&($=1);++y<$;)for(var D=p[y],O=gs(D),M=-1,H=O.length;++M<H;){var it=O[M],at=c[it];(at===e||wr(at,vl[it])&&!we.call(c,it))&&(c[it]=D[it])}return c}),Yrt=Qt(function(c){return c.push(e,lE),Ts(KE,e,c)});function Zrt(c,p){return rT(c,Lt(p,3),Ur)}function Jrt(c,p){return rT(c,Lt(p,3),d0)}function Qrt(c,p){return c==null?c:h0(c,Lt(p,3),gs)}function tot(c,p){return c==null?c:TT(c,Lt(p,3),gs)}function eot(c,p){return c&&Ur(c,Lt(p,3))}function not(c,p){return c&&d0(c,Lt(p,3))}function sot(c){return c==null?[]:$p(c,$n(c))}function rot(c){return c==null?[]:$p(c,gs(c))}function G0(c,p,y){var $=c==null?e:pa(c,p);return $===e?y:$}function oot(c,p){return c!=null&&hE(c,p,Tet)}function H0(c,p){return c!=null&&hE(c,p,Eet)}var iot=sE(function(c,p,y){p!=null&&typeof p.toString!="function"&&(p=hp.call(p)),c[p]=y},q0(xs)),aot=sE(function(c,p,y){p!=null&&typeof p.toString!="function"&&(p=hp.call(p)),we.call(c,p)?c[p].push(y):c[p]=[y]},Lt),lot=Qt(Zc);function $n(c){return ms(c)?vT(c):g0(c)}function gs(c){return ms(c)?vT(c,!0):Bet(c)}function uot(c,p){var y={};return p=Lt(p,3),Ur(c,function($,S,D){go(y,p($,S,D),$)}),y}function cot(c,p){var y={};return p=Lt(p,3),Ur(c,function($,S,D){go(y,S,p($,S,D))}),y}var hot=kl(function(c,p,y){kp(c,p,y)}),KE=kl(function(c,p,y,$){kp(c,p,y,$)}),dot=bo(function(c,p){var y={};if(c==null)return y;var $=!1;p=Ue(p,function(D){return D=ci(D,c),$||($=D.length>1),D}),Gr(c,_0(c),y),$&&(y=Qs(y,d|f|m,int));for(var S=p.length;S--;)C0(y,p[S]);return y});function fot(c,p){return qE(c,zp(Lt(p)))}var pot=bo(function(c,p){return c==null?{}:Wet(c,p)});function qE(c,p){if(c==null)return{};var y=Ue(_0(c),function($){return[$]});return p=Lt(p),MT(c,y,function($,S){return p($,S[0])})}function mot(c,p,y){p=ci(p,c);var $=-1,S=p.length;for(S||(S=1,c=e);++$<S;){var D=c==null?e:c[Hr(p[$])];D===e&&($=S,D=y),c=wo(D)?D.call(c):D}return c}function got(c,p,y){return c==null?c:Qc(c,p,y)}function xot(c,p,y,$){return $=typeof $=="function"?$:e,c==null?c:Qc(c,p,y,$)}var jE=iE($n),XE=iE(gs);function bot(c,p,y){var $=Kt(c),S=$||di(c)||Tl(c);if(p=Lt(p,4),y==null){var D=c&&c.constructor;S?y=$?new D:[]:Ge(c)?y=wo(D)?$l(pp(c)):{}:y={}}return(S?Ys:Ur)(c,function(O,M,H){return p(y,O,M,H)}),y}function yot(c,p){return c==null?!0:C0(c,p)}function wot(c,p,y){return c==null?c:UT(c,p,k0(y))}function vot(c,p,y,$){return $=typeof $=="function"?$:e,c==null?c:UT(c,p,k0(y),$)}function El(c){return c==null?[]:s0(c,$n(c))}function Cot(c){return c==null?[]:s0(c,gs(c))}function Iot(c,p,y){return y===e&&(y=p,p=e),y!==e&&(y=nr(y),y=y===y?y:0),p!==e&&(p=nr(p),p=p===p?p:0),fa(nr(c),p,y)}function $ot(c,p,y){return p=vo(p),y===e?(y=p,p=0):y=vo(y),c=nr(c),_et(c,p,y)}function kot(c,p,y){if(y&&typeof y!="boolean"&&rs(c,p,y)&&(p=y=e),y===e&&(typeof p=="boolean"?(y=p,p=e):typeof c=="boolean"&&(y=c,c=e)),c===e&&p===e?(c=0,p=1):(c=vo(c),p===e?(p=c,c=0):p=vo(p)),c>p){var $=c;c=p,p=$}if(y||c%1||p%1){var S=yT();return Vn(c+S*(p-c+ett("1e-"+((S+"").length-1))),p)}return y0(c,p)}var Sot=Sl(function(c,p,y){return p=p.toLowerCase(),c+(y?YE(p):p)});function YE(c){return K0(be(c).toLowerCase())}function ZE(c){return c=be(c),c&&c.replace(SQ,ptt).replace(HQ,"")}function Not(c,p,y){c=be(c),p=_s(p);var $=c.length;y=y===e?$:fa(jt(y),0,$);var S=y;return y-=p.length,y>=0&&c.slice(y,S)==p}function Tot(c){return c=be(c),c&&iQ.test(c)?c.replace(TN,mtt):c}function Eot(c){return c=be(c),c&&dQ.test(c)?c.replace(Wy,"\\$&"):c}var _ot=Sl(function(c,p,y){return c+(y?"-":"")+p.toLowerCase()}),Rot=Sl(function(c,p,y){return c+(y?" ":"")+p.toLowerCase()}),Aot=tE("toLowerCase");function Dot(c,p,y){c=be(c),p=jt(p);var $=p?yl(c):0;if(!p||$>=p)return c;var S=(p-$)/2;return Rp(bp(S),y)+c+Rp(xp(S),y)}function Fot(c,p,y){c=be(c),p=jt(p);var $=p?yl(c):0;return p&&$<p?c+Rp(p-$,y):c}function Oot(c,p,y){c=be(c),p=jt(p);var $=p?yl(c):0;return p&&$<p?Rp(p-$,y)+c:c}function Lot(c,p,y){return y||p==null?p=0:p&&(p=+p),Wtt(be(c).replace(Vy,""),p||0)}function Pot(c,p,y){return(y?rs(c,p,y):p===e)?p=1:p=jt(p),w0(be(c),p)}function Mot(){var c=arguments,p=be(c[0]);return c.length<3?p:p.replace(c[1],c[2])}var Bot=Sl(function(c,p,y){return c+(y?"_":"")+p.toLowerCase()});function zot(c,p,y){return y&&typeof y!="number"&&rs(c,p,y)&&(p=y=e),y=y===e?lt:y>>>0,y?(c=be(c),c&&(typeof p=="string"||p!=null&&!U0(p))&&(p=_s(p),!p&&bl(c))?hi(br(c),0,y):c.split(p,y)):[]}var Wot=Sl(function(c,p,y){return c+(y?" ":"")+K0(p)});function Vot(c,p,y){return c=be(c),y=y==null?0:fa(jt(y),0,c.length),p=_s(p),c.slice(y,y+p.length)==p}function Uot(c,p,y){var $=_.templateSettings;y&&rs(c,p,y)&&(p=e),c=be(c),p=Up({},p,$,aE);var S=Up({},p.imports,$.imports,aE),D=$n(S),O=s0(S,D),M,H,it=0,at=p.interpolate||np,ht="__p += '",wt=o0((p.escape||np).source+"|"+at.source+"|"+(at===EN?wQ:np).source+"|"+(p.evaluate||np).source+"|$","g"),Tt="//# sourceURL="+(we.call(p,"sourceURL")?(p.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++YQ+"]")+`
`;c.replace(wt,function(Bt,te,ae,As,os,Ds){return ae||(ae=As),ht+=c.slice(it,Ds).replace(NQ,gtt),te&&(M=!0,ht+=`' +
__e(`+te+`) +
'`),os&&(H=!0,ht+=`';
`+os+`;
__p += '`),ae&&(ht+=`' +
((__t = (`+ae+`)) == null ? '' : __t) +
'`),it=Ds+Bt.length,Bt}),ht+=`';
`;var Mt=we.call(p,"variable")&&p.variable;if(!Mt)ht=`with (obj) {
`+ht+`
}
`;else if(bQ.test(Mt))throw new Gt(a);ht=(H?ht.replace(nQ,""):ht).replace(sQ,"$1").replace(rQ,"$1;"),ht="function("+(Mt||"obj")+`) {
`+(Mt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(M?", __e = _.escape":"")+(H?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ht+`return __p
}`;var Jt=QE(function(){return me(D,Tt+"return "+ht).apply(e,O)});if(Jt.source=ht,V0(Jt))throw Jt;return Jt}function Got(c){return be(c).toLowerCase()}function Hot(c){return be(c).toUpperCase()}function Kot(c,p,y){if(c=be(c),c&&(y||p===e))return lT(c);if(!c||!(p=_s(p)))return c;var $=br(c),S=br(p),D=uT($,S),O=cT($,S)+1;return hi($,D,O).join("")}function qot(c,p,y){if(c=be(c),c&&(y||p===e))return c.slice(0,dT(c)+1);if(!c||!(p=_s(p)))return c;var $=br(c),S=cT($,br(p))+1;return hi($,0,S).join("")}function jot(c,p,y){if(c=be(c),c&&(y||p===e))return c.replace(Vy,"");if(!c||!(p=_s(p)))return c;var $=br(c),S=uT($,br(p));return hi($,S).join("")}function Xot(c,p){var y=F,$=P;if(Ge(p)){var S="separator"in p?p.separator:S;y="length"in p?jt(p.length):y,$="omission"in p?_s(p.omission):$}c=be(c);var D=c.length;if(bl(c)){var O=br(c);D=O.length}if(y>=D)return c;var M=y-yl($);if(M<1)return $;var H=O?hi(O,0,M).join(""):c.slice(0,M);if(S===e)return H+$;if(O&&(M+=H.length-M),U0(S)){if(c.slice(M).search(S)){var it,at=H;for(S.global||(S=o0(S.source,be(_N.exec(S))+"g")),S.lastIndex=0;it=S.exec(at);)var ht=it.index;H=H.slice(0,ht===e?M:ht)}}else if(c.indexOf(_s(S),M)!=M){var wt=H.lastIndexOf(S);wt>-1&&(H=H.slice(0,wt))}return H+$}function Yot(c){return c=be(c),c&&oQ.test(c)?c.replace(NN,Itt):c}var Zot=Sl(function(c,p,y){return c+(y?" ":"")+p.toUpperCase()}),K0=tE("toUpperCase");function JE(c,p,y){return c=be(c),p=y?e:p,p===e?btt(c)?Stt(c):utt(c):c.match(p)||[]}var QE=Qt(function(c,p){try{return Ts(c,e,p)}catch(y){return V0(y)?y:new Gt(y)}}),Jot=bo(function(c,p){return Ys(p,function(y){y=Hr(y),go(c,y,z0(c[y],c))}),c});function Qot(c){var p=c==null?0:c.length,y=Lt();return c=p?Ue(c,function($){if(typeof $[1]!="function")throw new Zs(i);return[y($[0]),$[1]]}):[],Qt(function($){for(var S=-1;++S<p;){var D=c[S];if(Ts(D[0],this,$))return Ts(D[1],this,$)}})}function tit(c){return $et(Qs(c,d))}function q0(c){return function(){return c}}function eit(c,p){return c==null||c!==c?p:c}var nit=nE(),sit=nE(!0);function xs(c){return c}function j0(c){return AT(typeof c=="function"?c:Qs(c,d))}function rit(c){return FT(Qs(c,d))}function oit(c,p){return OT(c,Qs(p,d))}var iit=Qt(function(c,p){return function(y){return Zc(y,c,p)}}),ait=Qt(function(c,p){return function(y){return Zc(c,y,p)}});function X0(c,p,y){var $=$n(p),S=$p(p,$);y==null&&!(Ge(p)&&(S.length||!$.length))&&(y=p,p=c,c=this,S=$p(p,$n(p)));var D=!(Ge(y)&&"chain"in y)||!!y.chain,O=wo(c);return Ys(S,function(M){var H=p[M];c[M]=H,O&&(c.prototype[M]=function(){var it=this.__chain__;if(D||it){var at=c(this.__wrapped__),ht=at.__actions__=ps(this.__actions__);return ht.push({func:H,args:arguments,thisArg:c}),at.__chain__=it,at}return H.apply(c,oi([this.value()],arguments))})}),c}function lit(){return _n._===this&&(_n._=Att),this}function Y0(){}function uit(c){return c=jt(c),Qt(function(p){return LT(p,c)})}var cit=N0(Ue),hit=N0(sT),dit=N0(Jy);function t_(c){return F0(c)?Qy(Hr(c)):Vet(c)}function fit(c){return function(p){return c==null?e:pa(c,p)}}var pit=rE(),mit=rE(!0);function Z0(){return[]}function J0(){return!1}function git(){return{}}function xit(){return""}function bit(){return!0}function yit(c,p){if(c=jt(c),c<1||c>Z)return[];var y=lt,$=Vn(c,lt);p=Lt(p),c-=lt;for(var S=n0($,p);++y<c;)p(y);return S}function wit(c){return Kt(c)?Ue(c,Hr):Rs(c)?[c]:ps(wE(be(c)))}function vit(c){var p=++_tt;return be(c)+p}var Cit=_p(function(c,p){return c+p},0),Iit=T0("ceil"),$it=_p(function(c,p){return c/p},1),kit=T0("floor");function Sit(c){return c&&c.length?Ip(c,xs,f0):e}function Nit(c,p){return c&&c.length?Ip(c,Lt(p,2),f0):e}function Tit(c){return iT(c,xs)}function Eit(c,p){return iT(c,Lt(p,2))}function _it(c){return c&&c.length?Ip(c,xs,x0):e}function Rit(c,p){return c&&c.length?Ip(c,Lt(p,2),x0):e}var Ait=_p(function(c,p){return c*p},1),Dit=T0("round"),Fit=_p(function(c,p){return c-p},0);function Oit(c){return c&&c.length?e0(c,xs):0}function Lit(c,p){return c&&c.length?e0(c,Lt(p,2)):0}return _.after=rrt,_.ary=RE,_.assign=Hrt,_.assignIn=HE,_.assignInWith=Up,_.assignWith=Krt,_.at=qrt,_.before=AE,_.bind=z0,_.bindAll=Jot,_.bindKey=DE,_.castArray=grt,_.chain=TE,_.chunk=knt,_.compact=Snt,_.concat=Nnt,_.cond=Qot,_.conforms=tit,_.constant=q0,_.countBy=Ost,_.create=jrt,_.curry=FE,_.curryRight=OE,_.debounce=LE,_.defaults=Xrt,_.defaultsDeep=Yrt,_.defer=ort,_.delay=irt,_.difference=Tnt,_.differenceBy=Ent,_.differenceWith=_nt,_.drop=Rnt,_.dropRight=Ant,_.dropRightWhile=Dnt,_.dropWhile=Fnt,_.fill=Ont,_.filter=Pst,_.flatMap=zst,_.flatMapDeep=Wst,_.flatMapDepth=Vst,_.flatten=$E,_.flattenDeep=Lnt,_.flattenDepth=Pnt,_.flip=art,_.flow=nit,_.flowRight=sit,_.fromPairs=Mnt,_.functions=sot,_.functionsIn=rot,_.groupBy=Ust,_.initial=znt,_.intersection=Wnt,_.intersectionBy=Vnt,_.intersectionWith=Unt,_.invert=iot,_.invertBy=aot,_.invokeMap=Hst,_.iteratee=j0,_.keyBy=Kst,_.keys=$n,_.keysIn=gs,_.map=Pp,_.mapKeys=uot,_.mapValues=cot,_.matches=rit,_.matchesProperty=oit,_.memoize=Bp,_.merge=hot,_.mergeWith=KE,_.method=iit,_.methodOf=ait,_.mixin=X0,_.negate=zp,_.nthArg=uit,_.omit=dot,_.omitBy=fot,_.once=lrt,_.orderBy=qst,_.over=cit,_.overArgs=urt,_.overEvery=hit,_.overSome=dit,_.partial=W0,_.partialRight=PE,_.partition=jst,_.pick=pot,_.pickBy=qE,_.property=t_,_.propertyOf=fit,_.pull=qnt,_.pullAll=SE,_.pullAllBy=jnt,_.pullAllWith=Xnt,_.pullAt=Ynt,_.range=pit,_.rangeRight=mit,_.rearg=crt,_.reject=Zst,_.remove=Znt,_.rest=hrt,_.reverse=M0,_.sampleSize=Qst,_.set=got,_.setWith=xot,_.shuffle=trt,_.slice=Jnt,_.sortBy=srt,_.sortedUniq=ost,_.sortedUniqBy=ist,_.split=zot,_.spread=drt,_.tail=ast,_.take=lst,_.takeRight=ust,_.takeRightWhile=cst,_.takeWhile=hst,_.tap=Sst,_.throttle=frt,_.thru=Lp,_.toArray=VE,_.toPairs=jE,_.toPairsIn=XE,_.toPath=wit,_.toPlainObject=GE,_.transform=bot,_.unary=prt,_.union=dst,_.unionBy=fst,_.unionWith=pst,_.uniq=mst,_.uniqBy=gst,_.uniqWith=xst,_.unset=yot,_.unzip=B0,_.unzipWith=NE,_.update=wot,_.updateWith=vot,_.values=El,_.valuesIn=Cot,_.without=bst,_.words=JE,_.wrap=mrt,_.xor=yst,_.xorBy=wst,_.xorWith=vst,_.zip=Cst,_.zipObject=Ist,_.zipObjectDeep=$st,_.zipWith=kst,_.entries=jE,_.entriesIn=XE,_.extend=HE,_.extendWith=Up,X0(_,_),_.add=Cit,_.attempt=QE,_.camelCase=Sot,_.capitalize=YE,_.ceil=Iit,_.clamp=Iot,_.clone=xrt,_.cloneDeep=yrt,_.cloneDeepWith=wrt,_.cloneWith=brt,_.conformsTo=vrt,_.deburr=ZE,_.defaultTo=eit,_.divide=$it,_.endsWith=Not,_.eq=wr,_.escape=Tot,_.escapeRegExp=Eot,_.every=Lst,_.find=Mst,_.findIndex=CE,_.findKey=Zrt,_.findLast=Bst,_.findLastIndex=IE,_.findLastKey=Jrt,_.floor=kit,_.forEach=EE,_.forEachRight=_E,_.forIn=Qrt,_.forInRight=tot,_.forOwn=eot,_.forOwnRight=not,_.get=G0,_.gt=Crt,_.gte=Irt,_.has=oot,_.hasIn=H0,_.head=kE,_.identity=xs,_.includes=Gst,_.indexOf=Bnt,_.inRange=$ot,_.invoke=lot,_.isArguments=xa,_.isArray=Kt,_.isArrayBuffer=$rt,_.isArrayLike=ms,_.isArrayLikeObject=tn,_.isBoolean=krt,_.isBuffer=di,_.isDate=Srt,_.isElement=Nrt,_.isEmpty=Trt,_.isEqual=Ert,_.isEqualWith=_rt,_.isError=V0,_.isFinite=Rrt,_.isFunction=wo,_.isInteger=ME,_.isLength=Wp,_.isMap=BE,_.isMatch=Art,_.isMatchWith=Drt,_.isNaN=Frt,_.isNative=Ort,_.isNil=Prt,_.isNull=Lrt,_.isNumber=zE,_.isObject=Ge,_.isObjectLike=Ze,_.isPlainObject=sh,_.isRegExp=U0,_.isSafeInteger=Mrt,_.isSet=WE,_.isString=Vp,_.isSymbol=Rs,_.isTypedArray=Tl,_.isUndefined=Brt,_.isWeakMap=zrt,_.isWeakSet=Wrt,_.join=Gnt,_.kebabCase=_ot,_.last=er,_.lastIndexOf=Hnt,_.lowerCase=Rot,_.lowerFirst=Aot,_.lt=Vrt,_.lte=Urt,_.max=Sit,_.maxBy=Nit,_.mean=Tit,_.meanBy=Eit,_.min=_it,_.minBy=Rit,_.stubArray=Z0,_.stubFalse=J0,_.stubObject=git,_.stubString=xit,_.stubTrue=bit,_.multiply=Ait,_.nth=Knt,_.noConflict=lit,_.noop=Y0,_.now=Mp,_.pad=Dot,_.padEnd=Fot,_.padStart=Oot,_.parseInt=Lot,_.random=kot,_.reduce=Xst,_.reduceRight=Yst,_.repeat=Pot,_.replace=Mot,_.result=mot,_.round=Dit,_.runInContext=V,_.sample=Jst,_.size=ert,_.snakeCase=Bot,_.some=nrt,_.sortedIndex=Qnt,_.sortedIndexBy=tst,_.sortedIndexOf=est,_.sortedLastIndex=nst,_.sortedLastIndexBy=sst,_.sortedLastIndexOf=rst,_.startCase=Wot,_.startsWith=Vot,_.subtract=Fit,_.sum=Oit,_.sumBy=Lit,_.template=Uot,_.times=yit,_.toFinite=vo,_.toInteger=jt,_.toLength=UE,_.toLower=Got,_.toNumber=nr,_.toSafeInteger=Grt,_.toString=be,_.toUpper=Hot,_.trim=Kot,_.trimEnd=qot,_.trimStart=jot,_.truncate=Xot,_.unescape=Yot,_.uniqueId=vit,_.upperCase=Zot,_.upperFirst=K0,_.each=EE,_.eachRight=_E,_.first=kE,X0(_,function(){var c={};return Ur(_,function(p,y){we.call(_.prototype,y)||(c[y]=p)}),c}(),{chain:!1}),_.VERSION=s,Ys(["bind","bindKey","curry","curryRight","partial","partialRight"],function(c){_[c].placeholder=_}),Ys(["drop","take"],function(c,p){ee.prototype[c]=function(y){y=y===e?1:bn(jt(y),0);var $=this.__filtered__&&!p?new ee(this):this.clone();return $.__filtered__?$.__takeCount__=Vn(y,$.__takeCount__):$.__views__.push({size:Vn(y,lt),type:c+($.__dir__<0?"Right":"")}),$},ee.prototype[c+"Right"]=function(y){return this.reverse()[c](y).reverse()}}),Ys(["filter","map","takeWhile"],function(c,p){var y=p+1,$=y==K||y==Q;ee.prototype[c]=function(S){var D=this.clone();return D.__iteratees__.push({iteratee:Lt(S,3),type:y}),D.__filtered__=D.__filtered__||$,D}}),Ys(["head","last"],function(c,p){var y="take"+(p?"Right":"");ee.prototype[c]=function(){return this[y](1).value()[0]}}),Ys(["initial","tail"],function(c,p){var y="drop"+(p?"":"Right");ee.prototype[c]=function(){return this.__filtered__?new ee(this):this[y](1)}}),ee.prototype.compact=function(){return this.filter(xs)},ee.prototype.find=function(c){return this.filter(c).head()},ee.prototype.findLast=function(c){return this.reverse().find(c)},ee.prototype.invokeMap=Qt(function(c,p){return typeof c=="function"?new ee(this):this.map(function(y){return Zc(y,c,p)})}),ee.prototype.reject=function(c){return this.filter(zp(Lt(c)))},ee.prototype.slice=function(c,p){c=jt(c);var y=this;return y.__filtered__&&(c>0||p<0)?new ee(y):(c<0?y=y.takeRight(-c):c&&(y=y.drop(c)),p!==e&&(p=jt(p),y=p<0?y.dropRight(-p):y.take(p-c)),y)},ee.prototype.takeRightWhile=function(c){return this.reverse().takeWhile(c).reverse()},ee.prototype.toArray=function(){return this.take(lt)},Ur(ee.prototype,function(c,p){var y=/^(?:filter|find|map|reject)|While$/.test(p),$=/^(?:head|last)$/.test(p),S=_[$?"take"+(p=="last"?"Right":""):p],D=$||/^find/.test(p);S&&(_.prototype[p]=function(){var O=this.__wrapped__,M=$?[1]:arguments,H=O instanceof ee,it=M[0],at=H||Kt(O),ht=function(te){var ae=S.apply(_,oi([te],M));return $&&wt?ae[0]:ae};at&&y&&typeof it=="function"&&it.length!=1&&(H=at=!1);var wt=this.__chain__,Tt=!!this.__actions__.length,Mt=D&&!wt,Jt=H&&!Tt;if(!D&&at){O=Jt?O:new ee(this);var Bt=c.apply(O,M);return Bt.__actions__.push({func:Lp,args:[ht],thisArg:e}),new Js(Bt,wt)}return Mt&&Jt?c.apply(this,M):(Bt=this.thru(ht),Mt?$?Bt.value()[0]:Bt.value():Bt)})}),Ys(["pop","push","shift","sort","splice","unshift"],function(c){var p=lp[c],y=/^(?:push|sort|unshift)$/.test(c)?"tap":"thru",$=/^(?:pop|shift)$/.test(c);_.prototype[c]=function(){var S=arguments;if($&&!this.__chain__){var D=this.value();return p.apply(Kt(D)?D:[],S)}return this[y](function(O){return p.apply(Kt(O)?O:[],S)})}}),Ur(ee.prototype,function(c,p){var y=_[p];if(y){var $=y.name+"";we.call(Il,$)||(Il[$]=[]),Il[$].push({name:p,func:y})}}),Il[Ep(e,w).name]=[{name:"wrapper",func:e}],ee.prototype.clone=jtt,ee.prototype.reverse=Xtt,ee.prototype.value=Ytt,_.prototype.at=Nst,_.prototype.chain=Tst,_.prototype.commit=Est,_.prototype.next=_st,_.prototype.plant=Ast,_.prototype.reverse=Dst,_.prototype.toJSON=_.prototype.valueOf=_.prototype.value=Fst,_.prototype.first=_.prototype.head,Gc&&(_.prototype[Gc]=Rst),_},wl=Ntt();ua?((ua.exports=wl)._=wl,jy._=wl):_n._=wl}).call($e)}(Qf,Qf.exports);var ho=Qf.exports,xN={},Ty={},tp=$e&&$e.__assign||function(){return tp=Object.assign||function(n){for(var t,e=1,s=arguments.length;e<s;e++){t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},tp.apply(this,arguments)};Object.defineProperty(Ty,"__esModule",{value:!0});var vJ={delayFirstAttempt:!1,jitter:"none",maxDelay:1/0,numOfAttempts:10,retry:function(){return!0},startingDelay:100,timeMultiple:2};function CJ(n){var t=tp(tp({},vJ),n);return t.numOfAttempts<1&&(t.numOfAttempts=1),t}Ty.getSanitizedOptions=CJ;var Ey={},_y={},ep={},Ry={},Ay={};Object.defineProperty(Ay,"__esModule",{value:!0});function IJ(n){var t=Math.random()*n;return Math.round(t)}Ay.fullJitter=IJ;var Dy={};Object.defineProperty(Dy,"__esModule",{value:!0});function $J(n){return n}Dy.noJitter=$J,Object.defineProperty(Ry,"__esModule",{value:!0});var kJ=Ay,SJ=Dy;function NJ(n){switch(n.jitter){case"full":return kJ.fullJitter;case"none":default:return SJ.noJitter}}Ry.JitterFactory=NJ,Object.defineProperty(ep,"__esModule",{value:!0});var TJ=Ry,EJ=function(){function n(t){this.options=t,this.attempt=0}return n.prototype.apply=function(){var t=this;return new Promise(function(e){return setTimeout(e,t.jitteredDelay)})},n.prototype.setAttemptNumber=function(t){this.attempt=t},Object.defineProperty(n.prototype,"jitteredDelay",{get:function(){var t=TJ.JitterFactory(this.options);return t(this.delay)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"delay",{get:function(){var t=this.options.startingDelay,e=this.options.timeMultiple,s=this.numOfDelayedAttempts,r=t*Math.pow(e,s);return Math.min(r,this.options.maxDelay)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"numOfDelayedAttempts",{get:function(){return this.attempt},enumerable:!0,configurable:!0}),n}();ep.Delay=EJ;var _J=$e&&$e.__extends||function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var o in r)r.hasOwnProperty(o)&&(s[o]=r[o])},n(t,e)};return function(t,e){n(t,e);function s(){this.constructor=t}t.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}}(),RJ=$e&&$e.__awaiter||function(n,t,e,s){function r(o){return o instanceof e?o:new e(function(i){i(o)})}return new(e||(e=Promise))(function(o,i){function a(h){try{u(s.next(h))}catch(d){i(d)}}function l(h){try{u(s.throw(h))}catch(d){i(d)}}function u(h){h.done?o(h.value):r(h.value).then(a,l)}u((s=s.apply(n,t||[])).next())})},AJ=$e&&$e.__generator||function(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,r,o,i;return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(u){return function(h){return l([u,h])}}function l(u){if(s)throw new TypeError("Generator is already executing.");for(;e;)try{if(s=1,r&&(o=u[0]&2?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,r=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){e=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){e.label=u[1];break}if(u[0]===6&&e.label<o[1]){e.label=o[1],o=u;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(u);break}o[2]&&e.ops.pop(),e.trys.pop();continue}u=t.call(n,e)}catch(h){u=[6,h],r=0}finally{s=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(_y,"__esModule",{value:!0});var DJ=ep,FJ=function(n){_J(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.apply=function(){return RJ(this,void 0,void 0,function(){return AJ(this,function(e){return[2,this.isFirstAttempt?!0:n.prototype.apply.call(this)]})})},Object.defineProperty(t.prototype,"isFirstAttempt",{get:function(){return this.attempt===0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numOfDelayedAttempts",{get:function(){return this.attempt-1},enumerable:!0,configurable:!0}),t}(DJ.Delay);_y.SkipFirstDelay=FJ;var Fy={},OJ=$e&&$e.__extends||function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var o in r)r.hasOwnProperty(o)&&(s[o]=r[o])},n(t,e)};return function(t,e){n(t,e);function s(){this.constructor=t}t.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}}();Object.defineProperty(Fy,"__esModule",{value:!0});var LJ=ep,PJ=function(n){OJ(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t}(LJ.Delay);Fy.AlwaysDelay=PJ,Object.defineProperty(Ey,"__esModule",{value:!0});var MJ=_y,BJ=Fy;function zJ(n,t){var e=WJ(n);return e.setAttemptNumber(t),e}Ey.DelayFactory=zJ;function WJ(n){return n.delayFirstAttempt?new BJ.AlwaysDelay(n):new MJ.SkipFirstDelay(n)}var Oy=$e&&$e.__awaiter||function(n,t,e,s){function r(o){return o instanceof e?o:new e(function(i){i(o)})}return new(e||(e=Promise))(function(o,i){function a(h){try{u(s.next(h))}catch(d){i(d)}}function l(h){try{u(s.throw(h))}catch(d){i(d)}}function u(h){h.done?o(h.value):r(h.value).then(a,l)}u((s=s.apply(n,t||[])).next())})},Ly=$e&&$e.__generator||function(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,r,o,i;return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(u){return function(h){return l([u,h])}}function l(u){if(s)throw new TypeError("Generator is already executing.");for(;e;)try{if(s=1,r&&(o=u[0]&2?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,r=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){e=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){e.label=u[1];break}if(u[0]===6&&e.label<o[1]){e.label=o[1],o=u;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(u);break}o[2]&&e.ops.pop(),e.trys.pop();continue}u=t.call(n,e)}catch(h){u=[6,h],r=0}finally{s=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(xN,"__esModule",{value:!0});var VJ=Ty,UJ=Ey;function GJ(n,t){return t===void 0&&(t={}),Oy(this,void 0,void 0,function(){var e,s;return Ly(this,function(r){switch(r.label){case 0:return e=VJ.getSanitizedOptions(t),s=new KJ(n,e),[4,s.execute()];case 1:return[2,r.sent()]}})})}var HJ=xN.backOff=GJ,KJ=function(){function n(t,e){this.request=t,this.options=e,this.attemptNumber=0}return n.prototype.execute=function(){return Oy(this,void 0,void 0,function(){var t,e;return Ly(this,function(s){switch(s.label){case 0:if(this.attemptLimitReached)return[3,7];s.label=1;case 1:return s.trys.push([1,4,,6]),[4,this.applyDelay()];case 2:return s.sent(),[4,this.request()];case 3:return[2,s.sent()];case 4:return t=s.sent(),this.attemptNumber++,[4,this.options.retry(t,this.attemptNumber)];case 5:if(e=s.sent(),!e||this.attemptLimitReached)throw t;return[3,6];case 6:return[3,0];case 7:throw new Error("Something went wrong.")}})})},Object.defineProperty(n.prototype,"attemptLimitReached",{get:function(){return this.attemptNumber>=this.options.numOfAttempts},enumerable:!0,configurable:!0}),n.prototype.applyDelay=function(){return Oy(this,void 0,void 0,function(){var t;return Ly(this,function(e){switch(e.label){case 0:return t=UJ.DelayFactory(this.options,this.attemptNumber),[4,t.apply()];case 1:return e.sent(),[2]}})})},n}();class qJ{constructor(){Io(this,"cache",{})}addToCache(t){this.cache={...this.cache,...t}}getCache(){return this.cache}getEmbeddingFast(t){if(!(t in this.cache))throw new Error(`Text not cached in embedding ${t}}`);return this.cache[t]}async bulkEmbed(t,e,s="text-embedding-ada-002"){Bc.info("Bulk embedding...");const r=[...new Set(t.flatMap(a=>[a.text_1,a.text_2]))],o=await mN.embeddings.bulkGet(r.map(a=>[a,s])),i=[];for(let a=0;a<o.length;a++){const l=o[a];l?this.cache[l.text]=l.embedding:i.push(r[a])}if(i.length>0){Bc.info(`Fetching ${i.length} embeddings`);const a=ho.chunk(i,150);for(let l=0;l<a.length;l++){const u=a[l];Bc.info(`Fetching ${u.length} embeddings chunk`);const f=(await(await HJ(()=>fetch("https://api.openai.com/v1/embeddings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:s,input:u})}))).json()).data.map(m=>({embedding:m.embedding,text:u[m.index],dateCreated:new Date,model:s}));await mN.embeddings.bulkPut(f),f.forEach(m=>{this.cache[m.text]=m.embedding}),postMessage({type:"embeddingProgress",progress:l/a.length,total:i.length})}Bc.info("Done fetching")}else Bc.info("No embeddings to fetch")}}function bN(n){const t=[];for(const i of ho.range(-1e3,1e3,1)){const a=i/1e3;let l=0;for(const[h,d]of n){let f;h>a?f=1:f=-1,f===d&&(l+=1)}const u=l/n.length;t.push(u)}const e=ho.max(t),s=t.length,r=Math.sqrt(e*(1-e)/s),o=`${(e*100).toFixed(1)}% ± ${(1.96*r*100).toFixed(1)}%`;return{accuracy:e,se:r,message:o}}function yN(n,t){return t?n.matMul(t):n}async function wN(n,t){const e=X(()=>O$(yN(n.e1,t),yN(n.e2,t)).mul(-1).arraySync());return ho.zip(e,n.labels.arraySync())}function Py(n,t,e,s){return X(()=>{const r=Lg(n,s),o=Lg(t,s),i=r.matMul(e),a=o.matMul(e);return O$(i,a).mul(-1)})}function My(n,t){return n.sub(t).square().mean()}const jJ=(n,t,e,s)=>function(o){const i=Py(t,e,o,n);return My(i,s)};async function*XJ(n,t,e){const s=n.tfDataset.shuffle(n.tfDataset.size).batch(t.batchSize);let r=1/0;const o=e.clone().variable();for(let i=0;i<t.epochs;i++){await s.forEachAsync(l=>{X(()=>{const{e1:u,e2:h,labels:d}=l,m=DD(jJ(t.dropoutFraction,u,h,d))(o);o.assign(o.sub(m.mul(t.learningRate)))})});const a=X(()=>{const l=Py(n.e1,n.e2,o,t.dropoutFraction);return My(l,n.labels).dataSync()[0]});a<r&&(r=a,e.assign(o)),yield i}o.dispose()}async function*YJ(n,t,e){const s=n.tfDataset.shuffle(n.tfDataset.size).batch(t.batchSize),r=Oi.adamax(t.learningRate);for(let o=0;o<t.epochs;o++)await s.forEachAsync(i=>{const{e1:a,e2:l,labels:u}=i;r.minimize(()=>My(Py(a,l,e,t.dropoutFraction),u),!1,[e])}),yield o}function ZJ(n,t){return zw([n,t]).variable()}function JJ(n,t,e){switch(t.optimizer){case"gradient":return XJ(n,t,e);case"adamax":return YJ(n,t,e)}}function vN(n,t){const e=[],s=[],r=[];for(const{text_1:m,text_2:g,label:x}of n){const b=t.getEmbeddingFast(m),w=t.getEmbeddingFast(g);e.push(b),s.push(w),r.push(x)}const o=Vu(e),i=Vu(s),a=jn(r),l=ab(e),u=ab(s),h=ab(r),d=oz({e1:l,e2:u,labels:h}),f=o.shape[1];return{e1:o,e2:i,labels:a,embeddingSize:f,tfDataset:d}}function CN({text_1:n,text_2:t}){return[n,t].sort().join("___")}function IN(n){const t=new Set,e=new Set;for(const{text_1:a,text_2:l}of n)t.add(a),t.add(l),e.add(CN({text_1:a,text_2:l}));const s=Array.from(t),r=[];for(let a=0;a<s.length;a++)for(let l=a+1;l<s.length;l++){const u=s[a],h=s[l],d=CN({text_1:u,text_2:h});e.has(d)||r.push({text_1:u,text_2:h,label:-1})}const[o,i]=ho.partition(n,({label:a})=>a===1);return[...n,...ho.shuffle(r).slice(0,o.length-i.length)]}function QJ(n,t){const e=ho.sortBy(n,["label"]),s=[],r=[],o=Math.floor(1/t);for(let l=0;l<n.length;l++)l%o===0?r.push(e[l]):s.push(e[l]);const i=ho.shuffle(s),a=ho.shuffle(r);return{train:i,test:a}}function $N(n){return n.length===0?1:n.reduce((t,e)=>t*e)}function kN(n,t,e){for(let s=0;s<t.length;s++)n.setInt8(e+s,t.charCodeAt(s));return e+t.length}async function tQ(n){const t=new Map([["float32","<f4"],["int32","<i4"]]).get(n.dtype),e="NUMPY",s="\0",r=String(n.shape.join(","))+",",[o,i,a]=[t,"False",r];let l=`{'descr': '${o}', 'fortran_order': ${i}, 'shape': (${a}), }`;const u=1+e.length+s.length+2+l.length,h=" ".repeat((16-u%16)%16);l+=h,SN((u+h.length)%16,0);const f=4*$N(n.shape),m=u+h.length+f,g=new ArrayBuffer(m),x=new DataView(g);let b=0;x.setUint8(b++,147),b=kN(x,e+s,b),x.setUint16(b,l.length,!0),b+=2,b=kN(x,l,b);const w=await n.data();SN(w.length,$N(n.shape));for(let v=0;v<w.length;v++)switch(n.dtype){case"float32":x.setFloat32(b,w[v],!0),b+=4;break;case"int32":x.setInt32(b,w[v],!0),b+=4;break;default:throw Error(`dtype ${n.dtype} not yet supported.`)}return g}function SN(n,t){if(n!==t)throw new Error(`actual ${n} not equal to expected ${t}`)}function ni(n){postMessage(n)}class eQ{constructor(){Io(this,"trainDataset");Io(this,"testDataset");Io(this,"embeddingCache",new qJ)}async getPerformance(t){const e=await wN(this.testDataset,t),s=await wN(this.trainDataset,t),r=bN(e),o=bN(s);return{testCosinePairings:e,trainCosinePairings:s,testAccuracyAndSE:r,trainAccuracyAndSE:o}}async initDataset(t,e){const{train:s,test:r}=QJ(t,e.testSplitFraction),o=e.generateSyntheticNegatives,i=o?IN(r):r,a=o?IN(s):s;await mR(),this.trainDataset=vN(a,this.embeddingCache),this.testDataset=vN(i,this.embeddingCache),ni({type:"initialPerformance",performance:await this.getPerformance()})}async embedLocalPairings(t,e,s){await this.embeddingCache.bulkEmbed(t,e,s)}async fetchPrecomputedEmbeddings(t){try{ni({type:"fetchingStatus",status:"fetching"});const s=await(await fetch(t,{method:"GET"})).json();if(this.embeddingCache)this.embeddingCache.addToCache(s),ni({type:"fetchingStatus",status:"complete"});else throw new Error("Embedding cache not initialized")}catch(e){ni({type:"error",message:e.toString()})}}async train(t){gR()!=="webgl"&&ni({type:"error",message:"Your browser doesn't support worker WebGL, try Chrome. It will be slow otherwise!"});const e=ZJ(this.trainDataset.embeddingSize,t.targetEmbeddingSize);for await(const r of JJ(this.trainDataset,t,e)){const o=await this.getPerformance(e);ni({type:"updatedPerformance",performance:o,epoch:r})}const s=await tQ(e);postMessage({type:"doneTraining",matrixNpy:s,shape:e.shape},[s]),e.dispose()}getEmbeddingCache(){return this.embeddingCache.getCache()}}const ml=new eQ;addEventListener("message",async n=>{try{switch(n.data.type){case"initializeLocalDataset":await ml.embedLocalPairings(n.data.allPairings,n.data.apiKey,n.data.model),await ml.initDataset(n.data.allPairings,n.data.parameters);break;case"initializeExampleDataset":await ml.fetchPrecomputedEmbeddings(n.data.cacheUrl),await ml.initDataset(n.data.allPairings,n.data.parameters);break;case"train":await ml.train(n.data.parameters);break;case"getEmbeddingCache":ni({type:"dumpEmbeddingCache",cache:ml.getEmbeddingCache()});break;default:console.error("Unknown message type",n.data);break}}catch(t){ni({type:"error",message:t.toString()})}})})();
